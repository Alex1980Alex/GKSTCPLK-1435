Глава 38. Поставка и поддержка конфигурации

38.1. Общая информация

38.2. Поставка конфигурации

38.2.1. Настройка поставки

Типовые конфигурации регулярно меняются. Это может быть связано с изменением законодательства, добавлением новых функциональных возможностей или внесением исправлений. Поэтому большое значение для пользователей типовых конфигураций представляет механизм поддержки этих конфигураций.

Для описания механизмов поддержки используются термины «поставка» и «поддержка конфигурации», а также «комплект поставки».

Поставка. Различают полную поставку и поставку обновлений. Полная поставка представляет файл конфигурации формата *.cf, сформированный специальным образом. Поставка обновлений представляет файл обновлений формата *.cfu.

Поддержка. Поддержка конфигурации заключается в способности конфигурации быть обновляемой средствами конфигуратора с использованием файлов поставки. Назначение механизма поддержки ‑ в защите логической целостности конфигурации. В описании также применяется термин «конфигурация, находящаяся на поддержке».

Комплект поставки представляет собой дистрибутив, в состав которого входит программа установки для операционных систем Windows (файл setup.exe), Linux (файл setup) и macOS (каталог setup.app, который операционная система представляет установочным приложением), а также файлы поставки, сжатые в специальный архив (файл 1cv8.efd). Язык получаемого дистрибутива соответствует языку конфигуратора (локализованные ресурсы дистрибутива находятся в каталоге дистрибутива, в подкаталоге с именем, соответствующим имени языка).

Конфигуратор позволяет разработчикам типовых конфигураций осуществлять поставку не только новых версий конфигураций, но и устанавливать режим поддержки этих конфигураций с учетом произведенных изменений в пользовательских конфигурациях.

Настройка поставки заключается в указании правил поставщика на изменение объектов конфигурации разработчиками, осуществляющими поддержку конфигураций конечных пользователей.

Для настройки прав нужно выбрать пункт Конфигурация ‑ Поставка конфигураций ‑ Настройка поставки. Открывается диалог настройки поставки.

Рис. 770. Настройка поставки

В иерархическом списке объектов конфигурации доступны только объекты первого уровня.

По каждому объекту следует указать правило изменения. Для этого нужно указать объект и нажать кнопку Изменить, а для изменения правил для группы объектов ‑ выбрать группу и нажать кнопку Изменить подчиненные.

Рис. 771. Настройка правил поставщика

В дереве объектов допускается множественный выбор. В этом случае настройка выполняется для выбранных объектов.

Допускается указание следующих правил:

•

Изменения разрешены ‑ допускается любое изменение в пользовательской конфигурации.

•

Изменения не рекомендуются ‑ изменения в пользовательской конфигурации не рекомендуются.

•

Изменения запрещены ‑ изменения полностью запрещены. Данное право не позволяет изменять объекты, находящиеся на поддержке. Объект с таким правилом нельзя снять с поддержки. Для изменения такого объекта нужно снимать с поддержки всю конфигурацию.

38.2.2. Создание файлов поставки

объединения с конфигурацией поставщика или при обновлении новой версией конфигурации поставщика объект с таким правилом по умолчанию не предлагается к включению в пользовательскую конфигурацию.

По умолчанию конфигуратор устанавливает правило Изменения разрешены.

Если в поставку включается только скомпилированный текст модуля, нужно снять флажок Включать в поставку исходный текст модулей объекта. В этом случае функциональность не нарушается, но текст модуля недоступен для просмотра. Не поддерживается исключение исходных текстов для следующих модулей:

•

модуль управляемого приложения;

•

модули форм;

•

модули команд;

•

модули, включающие директивы препроцессора;

•

клиентские общие модули, работающие в управляемом режиме (тонкий клиент, веб-клиент и управляемый режим толстого клиента).

ПРИМЕЧАНИЕ. Если флажок Включать в поставку исходный текст модулей объекта снят для корневого элемента конфигурации, то без исходных текстов будут поставляться модули обычного приложения, внешнего соединения и сеанса.

Для настройки файла поставки флажок Файл поставки может использоваться для обновления следует установить, если файл поставки предназначается для обычного обновления конфигурации. Снять флажок нужно в том случае, когда предполагается использовать полученный файл поставки как промежуточный, когда требуется произвести ряд последовательных обновлений.

Например, смена типа реквизита при обычной технологии может привести к потерям введенных данных пользователей. Поэтому часто используют промежуточную версию, в которой вводят новый реквизит с нужным типом, а прежний реквизит остается. Обычно подготавливается только файл обновления. Специальная обработка выполняет преобразование данных. Затем используют следующую версию конфигурации, в которой имя вспомогательного реквизита, имеющего нужный тип, заменяется прежним. Назначение второй версии ‑ только в выполнении переходной функции, поэтому его нельзя использовать как отдельное обновление.

После указания прав нужно нажать кнопку Закрыть.

Для создания файлов поставки и обновлений следует выбрать пункт Конфигурация ‑ Поставка конфигурации ‑ Создать файлы поставки и обновления конфигурации.

Предварительно в категории свойств Разработка должны быть указаны свойства Поставщик и Версия.

Поставщик ‑ наименование поставщика конфигурации.

Версия ‑ версия конфигурации (строка).

СОВЕТ. Рекомендуемая структура номера версии: <версия>.<подверсия>.<релиз>.<сборка>, где элементы структуры представляют собой десятичные числа. Такая структура упрощает идентификацию версии конфигурации при последовательной разработке и построении файлов (комплектов) поставки.

В списке шаблонов и обновлений конфигураций конфигурации сортируются по номерам версий с учетом структуры номера.

Если конфигурация или база данных модифицирована, то конфигуратор просит произвести сохранение конфигурации и обновить конфигурацию базы данных.

На экран выводится окно формирования поставки:

38.2.3. Подготовка комплекта поставки тиражных конфигураций

38.2.3.1. Описание комплекта поставки

Рис. 772. Формирование поставки

По кнопке Каталог файлов поставки формируется каталог, который будет использован для создания каталогов поставки новых версий. Имя каталога версии совпадает с номером версии.

Для создания файла поставки нужно установить флажок Создать файл поставки. В поле задания имени по умолчанию будет предложено имя файла поставки.

Для создания файла обновления установить флажок Создать файл обновления конфигурации. В поле задания имени по умолчанию будет предложено имя файла обновления.

Если флажок Создать файл обновления конфигурации установлен, то требуется включить в файл обновления прежние обновления. Для этого нужно выполнить команду Добавить из предыдущих версий и выбрать файлы поставки прежних версий.

Для формирования указанных файлов нужно нажать кнопку Выполнить.

Текстовые файлы комплекта поставки нужно подготавливать в кодировке UTF-8.

Полученные файлы передаются разработчикам, осуществляющим поддержку конфигураций конечных пользователей.

Для создания комплекта поставки сначала необходимо сформировать описание комплекта (хранится в файле), а затем в соответствии с этим описанием создать комплект поставки.

Для формирования описания комплекта поставки нужно выбрать пункт Конфигурация ‑ Поставка конфигурации ‑ Комплект поставки.

На экран выводится диалог:

38.2.3.1.1. Создание нового описания комплекта поставки

Рис. 773. Выбор описания комплекта поставки

В диалоге выбрать режим работы с описанием.

Затем установить переключатель Открыть описание комплекта поставки, если требуется внести изменения в имеющееся описание. Файл описания указывается в поле ввода.

Для создания нового описания следует установить переключатель Создать новое описание.

На экран выводится окно помощника создания описания.

Рис. 774. Помощник создания комплекта поставки

Нужно указать наименование комплекта поставки и поставщика. Нажать кнопку Далее >.

На следующем шаге указываются параметры шаблона.

38.2.3.1.2. Редактирование описания комплекта поставки

По умолчанию (установлен флажок Определять параметры по текущей конфигурации) параметры выбираются из соответствующих свойств конфигурации. Если флажок не установлен, эти параметры можно изменить.

В параметре Путь указывается каталог, в котором будет создан файл-манифест.

Параметры шаблона записываются в файл манифеста, который входит в комплект поставки. О структуре файла-манифеста см. здесь.

На следующем шаге указываются параметры шаблона.

Рис. 776. Задание параметров шаблонов

Следует отметить файлы шаблона, которые должны войти в описание комплекта поставки. Для дополнительных файлов, включаемых в комплект, указать каталог их расположения. Все файлы этого каталога, в том числе и подкаталоги, будут включены в описание комплекта поставки.

Для создания описания нажать кнопку Готово. На экран выводится окно редактирования описания комплекта поставки.

Окно редактирования описания комплекта поставки открывается после создания описания (см. раздел выше) или при выборе режима редактирования (см. здесь).

Рис. 777. Редактор описания комплекта поставки

поставки.

Описание представляет собой дерево, состоящее из четырех основных ветвей:

•

шаблоны конфигураций,

•

варианты поставки,

•

базовые каталоги,

•

языки.

По любой ветке возможно добавление новых данных, удаление ненужных и изменение существующих свойств. Все действия по составу выполняются с помощью команд меню Действие. Редактирование свойств производится в палитре свойств.

Шаблоны конфигураций

Шаблоны конфигураций представляют собой основные элементы комплекта поставки. В состав шаблонов конфигураций входят файлы и группы файлов.

Файлы могут быть как произвольными (или наборами файлов, определяемыми по маске), так и файлами конфигурации или выгрузки данных, получаемыми из текущей информационной базы.

Каждый шаблон имеет свое размещение в каталоге шаблонов. Соответственно, файлы и группы файлов размещаются в каталоге шаблонов, исходя из адреса файла-манифеста (группы файлов представляют при этом подкаталоги).

В файл-манифест включаются только файлы конфигурации и выгрузки данных. Остальные файлы просто размещаются в каталоге шаблона конфигурации.

Шаблоны

Для настройки свойств шаблона нужно выбрать шаблон и указать его свойства.

Текущая конфигурация ‑ если флажок установлен, то данные (поставщик, имя, версия) выбираются из текущей информационной базы. Если флажок снят, то допускается редактирование этих свойств:

•

Поставщик ‑ поставщик конфигурации (соответствует свойству конфигурации Поставщик);

•

Имя ‑ имя конфигурации (соответствует свойству конфигурации Имя);

•

Версия ‑ версия конфигурации (соответствует свойству конфигурации Версия);

•

Размещение манифеста ‑ относительный путь к файлу-манифесту шаблона в каталоге шаблонов.

Файлы и группы файлов

Для добавления файла нужно выбрать шаблон и пункт Действия ‑ Добавить. На экран выводится диалог выбора файла.

В диалоге указывается местонахождение добавляемого элемента шаблона.

Файл может располагаться в текущей конфигурации, текущей информационной базе, в отдельном файле, а также представлять набор файлов указанного каталога, отбираемый по маске файлов (допускается включение файлов подкаталогов).

Для настройки свойств файла нужно выбрать файл и указать его свойства:

•

Наименование ‑ наименование файла.

•

Данные ‑ источник данных для файла (файл, текущая конфигурация или текущая информационная база).

•

Базовый каталог ‑ базовый каталог для ссылки на файл.

•

Файл/каталог ‑ относительный (относительно базового каталога) или абсолютный путь к файлу.

•

Поставить на поддержку ‑ для файла конфигурации или выгрузки данных ‑ поставить файл на поддержку.

•

Включать в манифест ‑ для файла конфигурации или выгрузки данных включать файл в манифест.

•

Наименование в шаблоне ‑ наименование в каталоге шаблонов. Наименование является локализуемым в соответствии с языками комплекта установки.

•

Размещение ‑ каталог для информационной базы, предлагаемый по умолчанию.

•

Наименование для обновлений ‑ использовать наименование файла в каталоге шаблонов для наименования обновлений.

Для добавления группы файлов нужно выбрать шаблон и пункт Действия ‑ Новая группа. В палитре свойств ввести наименование группы.

Если в списке указать группу и выбрать пункт Действия ‑ Добавить, то в данную группу добавляется файл. Число файлов в группе неограниченно.

Допускается создание вложенных групп файлов.

Варианты поставки

Варианты поставки представляют собой различные комбинации файлов поставки. Такие комбинации могут использоваться для различной комплектации поставки (например, при полной поставке или же при поставке только обновлений):

•

Наименование ‑ наименование варианта поставки.

•

Поставляемые файлы ‑ набор поставляемых файлов. По умолчанию создается полный вариант, в который включены все файлы. Если указано несколько вариантов построения, то состав файлов можно сформировать, нажав для него в палитре свойств ссылку Редактировать. Нужно установить отметки для тех файлов, которые будут включены в выбранный вариант построения.

•

Файл описания поставки ‑ описание, показываемое пользователю после проведения установки продукта.

•

Базовый каталог и Каталог ‑ используются для указания на место создания комплекта поставки или набора файлов поставки. Если эти каталоги указаны, то при запросе места создания они будут автоматически подставлены в диалог запроса.

38.2.3.2. Создание комплекта

Рис. 779. Вариант построения

Базовые каталоги

Базовые каталоги используются для переносимого между различными компьютерами указания файлов поставки.

В качестве базового каталога может быть указано значение переменной среды или имя каталога. После этого имя файла поставки может быть указано как комбинация базового каталога и относительного пути от этого каталога:

•

Наименование ‑ наименование базового каталога.

•

База ‑ может принимать два значения:

•

Переменная среды,

•

Каталог.

•

Переменная среды/Каталог ‑ содержит имя переменной среды (переменной окружения) или абсолютный адрес каталога в зависимости от значения свойства База.

Языки

Языки предназначены для представления локализуемых наименований элементов шаблонов.

Для корректного отображения наименований следует создавать языки в соответствии с наименованиями каталогов платформы системы «1С:Предприятие», содержащими соответствующие локализованные интерфейсы. Один из языков является языком по умолчанию (локализованная по умолчанию строка наименования используется при отсутствии строки, соответствующей текущему языку платформы):

•

Наименование ‑ наименование языка;

•

Каталог ресурсов ‑ имя каталога языковых ресурсов, соответствующее этому языку.

Для создания комплекта поставки нужно выбрать пункт Действия ‑ Создать архив комплекта. При этом будет создан zip-архив комплекта поставки, соответствующий указанному варианту поставки. Архив будет содержать файл 1cv8.efd (содержащий файлы конфигурации, обновления конфигурации, файлы выгрузки), вспомогательные файлы комплекта поставки, а также файлы, позволяющие выполнить установку прикладного решения на каждой из поддерживаемых операционных системы:

•

ОС Windows: файл setup.exe.

38.3. Поддержка конфигурации

38.3.1. Общая информация

•

OC macOS: каталог setup.app, который содержит все необходимые файлы для выполнения установки и который воспринимается ОС как установочное приложение.

Для исполняемых файлов, предназначенных для ОС Linux и macOS установлены корректные признаки исполняемых файлов. Поэтому при распаковке сформированного архива на целевой операционной системы, можно будет сразу запустить установку прикладного решения. Однако, если выполнить распаковку архива на ОС Windows и затем скопировать получившиеся файлы на дисковый накопитель, который будет использоваться из ОС Linux или macOS, то признаки исполняемых файлов будут утеряны.

Чтобы создать комплект файлов поставки, нужно выбрать пункт Действия ‑ Создать комплект файлов поставки. При этом будут созданы файлы поставки (не сжатые в пакет установки) без программы установки, соответствующие указанному варианту поставки.

Если при этом описание комплекта поставки не было сохранено, конфигуратор предлагает его сохранить.

Если количество вариантов больше одного, то на экран выводится диалог выбора варианта построения. В диалоге нужно выбрать требуемый вариант.

Создаваемые файлы комплекта обновления следует размещать в каталоге ресурсов, указанном в свойстве Адрес каталога обновлений (см. здесь).

Помимо лицензирования с использованием аппаратного ключа, ограничивающего общее количество рабочих мест и не контролирующего используемые конфигурации, допускается использование электронных лицензий, которые выдаются на конкретное рабочее место и контролируют использование на нем определенных конфигураций, записанных в лицензии. Программные лицензии выдаются Центром лицензирования фирмы «1С» и сохраняются на компьютере пользователя.

ПРИМЕЧАНИЕ. Для создания комплекта поставки конфигурации, распространяемой по схеме лицензирования рабочего места пользователя, для команд пакетного запуска конфигуратора /CreateDistributionFiles и /CreateDistributivePackage реализован параметр ‑DigiSign, позволяющий задать файл с параметрами лицензирования. Возможность создания и распространения конфигураций, поддерживающих схему лицензирования рабочего места пользователя, может быть получена партнером на основании отдельного договора с фирмой «1С».

Новую версию конфигурации можно получить в виде поставки (файл поставки конфигурации новой версии) и/или в виде обновления.

Конфигурации пользователей, которые могут быть обновлены с учетом полученных файлов поставки, должны находиться на поддержке.

Режим поддержки объектов можно менять, предварительно отказавшись от полной поддержки. Возможность устанавливать правила пользователя (изменение объектов) зависит от правил, заданных поставщиком, и текущих блокировок пользовательской конфигурации.

Для конфигураций, находящихся на поддержке, предусмотрен режим сравнения с поставкой, сравнения новой поставки с прежней, а также сравнение текущего состояния конфигурации с первоначальным.

Если конфигурация находится на поддержке, то в окне Конфигурация объекты помечаются специальными пиктограммами, располагающимися справа от объекта, вдоль границы окна.

38.3.2. Постановка конфигурации на поддержку

38.3.3. Настройка поддержки

Рис. 780. Пиктограммы режимов поддержки

Описание пиктограмм, обозначающих различные режимы поддержки, приведено на рис.780.

После установки типовой конфигурации она автоматически устанавливается на поддержку.

Если конфигурация не находится на поддержке, то для постановки ее на поддержку нужно выбрать пункт Конфигурация ‑ Сравнить, объединить с конфигурацией из файла, а в качестве сравниваемого файла выбрать файл поставки.

В этом случае конфигуратор предлагает произвести постановку конфигурации на поддержку. На экран выводится диалог, в котором помещен текст Обнаружена возможность объединения с постановкой на поддержку и сообщаются основные параметры конфигурации поставщика. Производится запрос на постановку.

При нажатии кнопки Да будет открыто окно сравнения и объединения конфигураций.

После указания условий и режимов объединения нужно нажать кнопку Выполнить. Будет произведен пообъектный анализ конфигураций на соответствие правил поставщика правилам объединения.

Если обнаруживаются объекты, по которым правила поставщика вступают в противоречие с правилами объединения, то на экран выводится окно со списком этих объектов. В окне сравнения следует выполнить нужные настройки, чтобы снять противоречия, и повторить попытку объединения. Если противоречий в правилах нет, то производится объединение конфигураций с постановкой текущей конфигурации на поддержку.

При включении возможности изменений конфигурации поставщика, при постановке на поддержку и при обновлении конфигурации поставщика с включенной возможностью изменений имеется возможность детально настроить правила поддержки по умолчанию для объектов с разными правилами поставки.

Если текущая конфигурация подключена к хранилищу конфигураций, то при постановке конфигурации на поддержку требуется, чтобы все объекты конфигурации, которые должны быть полностью взяты из конфигурации поставщика, а также корневой объект конфигурации должны быть захвачены в хранилище.

Настройка поддержки заключается в установке правил пользователя для каждого объекта

поддержки. На экран выводится окно настройки правил поддержки.

Рис. 781. Настройка поддержки

В верхней строке окна настройки конфигуратор сообщает, в каком состоянии поддержки находится данная конфигурация.

Ниже указывается имя конфигурации, поставщик и текущая версия конфигурации.

В разделе Настройка правил поддержки объектов размещено дерево объектов и показываются правила поддержки поставщика и правила пользователя по каждому объекту.

Правила поддержки поставщика не могут быть изменены. Можно менять только правила пользователя (при условии, что конфигурация снята с полной поддержки). В окне настройки допускается использование множественного выбора для настройки одинаковых правил поддержки выбранным объектам. В этом случае для изменения правил поддержки нужно использовать контекстное меню в колонке правил поддержки.

Комплект поставки может содержать данные на нескольких языках. С помощью выбора языков поддержки можно указать те из них, которые используются данной конфигурацией. Для этого следует нажать кнопку Языки поддержки и в открывшемся окне указать эти языки.

38.3.3.1. Полная (автоматическая) поддержка

38.3.3.2. Поддержка с возможностью обновления

Если в строке состояния окна настройки поддержки указано Конфигурация находится на поддержке, то это означает, что все объекты данной конфигурации находятся на поддержке и не могут быть изменены (отредактированы). В этом случае конфигурацию можно обновить автоматически.

Для выполнения автоматического обновления текущей версии конфигурации:

•

нужно выбрать пункт Конфигурация ‑ Поддержка ‑ Обновить конфигурацию;

•

выбрать файл поддержки.

Обновление производится без вывода окна Сравнение и объединение.

В данном состоянии изменение правил пользователя для любого объекта конфигурации недоступно независимо от правил поддержки поставщика.

Часто требуется изменить типовую конфигурацию, чтобы учесть требования конкретного пользователя. В таких случаях необходимо отказаться полностью (объект поставщика снят с поддержки) или частично (объект поставщика редактируется с возможностью поддержки) от поддержки некоторых объектов.

Для получения доступа к установке правил поддержки пользователя в окне настройки поддержки нужно нажать кнопку Включить возможность изменения.

После нажатия кнопки на экран выводится предупреждение: Изменение режима приведет к невозможности выполнять обновление конфигурации полностью автоматически. Продолжить? Если выбрать Да, то будет предложено выбрать правила поддержки для объектов с разными правилами поставки.

Рис. 783. Настройка правил поддержки

После указания правил поддержки и нажатия кнопки ОК произойдет изменение статуса конфигурации, и она будет находиться на поддержке с возможностью изменения. В результате такой настройки все объекты конфигурации окажутся заблокированными от случайных изменений, независимо от правил поставки, установленных поставщиком. Теперь для изменений объекта необходимо явно включать возможность изменения объекта или его подчиненных объектов (см. здесь).

Если не требуется менять режим поддержки (действия были выполнены по ошибке), нужно закрыть конфигурацию без сохранения.

После отказа от полной поддержки заново установить поддержку для всей конфигурации возможно только при последовательном выполнении следующих действий:

38.3.3.2.1. Изменение правил поддержки объектов

38.3.3.2.2. Сравнение и объединение с конфигурацией поставщика

конфигурации и нажать кнопку Снять с поддержки);

•

выбрать пункт Конфигурация ‑ Загрузить конфигурацию из файла;

•

выбрать файл поставки.

Чтобы изменить правила поддержки, в дереве объектов окна настройки поддержки следует выбрать нужный объект и в контекстном меню выбрать Установить правило поддержки. В диалоге выбрать нужное правило пользователя из трех возможных:

•

объект поставщика не редактируется;

•

объект поставщика редактируется с сохранением поддержки;

•

объект поставщика снят с поддержки.

Доступность правил определяется установленным правилом поддержки поставщика.

Если установлено правило поддержки поставщика Изменения разрешены, то доступна установка любого правила поставщика.

Если установлено правило поддержки поставщика Изменения не рекомендуются, то также доступна установка любого правила поставщика, но при изменении данного правила будет выдано предупреждающее сообщение.

Если установлено правило поддержки поставщика Изменения запрещены, то установка правил поставщика невозможна.

ВНИМАНИЕ! После установки правила пользователя Объект поставщика снят с поддержки нельзя «вернуть» правило Объект поставщика не редактируется.

Если выбранный объект содержит подчиненные объекты, то для изменения правил поддержки одновременно и для этих объектов нужно установить флажок Установить для подчиненных объектов (по умолчанию установлен).

Полный отказ от поддержки. Для отказа от поддержки всех объектов конфигурации следует выбрать пункт Действия ‑ Снять с поддержки. На экран выводится предупреждение: Снятие с поддержки приведет к невозможности получать обновления от поставщика. Продолжить? Для снятия с поддержки необходимо выбрать кнопку Да. Конфигурация полностью снимается с поддержки. Если данные действия выполнены по ошибке, нужно закрыть конфигурацию без сохранения.

ВНИМАНИЕ! Отказ от поддержки не означает, что данную конфигурацию невозможно обновлять методом сравнения и объединения.

Из окна настройки поддержки можно выполнить сравнение и объединение с первоначальным (предыдущим) файлом поставки. Для этого нужно нажать кнопку Сравнить, объединить. На экран выводится окно сравнения и объединения.

38.3.4. Обновление конфигурации

Рис. 784. Сравнение и объединение с конфигурацией поставщика

Основные приемы сравнения и объединения см. здесь.

В отличие от «обычного» режима сравнения и объединения конфигураций, в окно сравнения добавлена строка показа правил поставщика и пользователя, а также кнопка Изменить для изменения правила пользователя. В этом случае открывается диалог с возможностью указания правила поддержки и возможностью иерархического указания этого правила (флажок Установить для подчиненных объектов).

При сравнении с файлом поставки текущая конфигурация всегда является потомком конфигурации-поставщика, поэтому кнопка выбора режима настройки конфигураций отсутствует.

Для выполнения обновления конфигурации, находящейся на поддержке, нужно выбрать пункт Конфигурация ‑ Поддержка ‑ Обновить конфигурацию.

На экран выводится помощник обновления.

Рис. 785. Помощник обновления

На первом шаге пользователь для обновления конфигурации может выбрать отдельный файл обновления или начать поиск по возможным местам расположения файлов обновлений.

Если выбран отдельный файл обновления, то на следующем шаге этот файл выбирается.

Рис. 786. Выбор файла обновления

При нажатии кнопки Готово выводится диалог, в котором указываются основные параметры текущей конфигурации и конфигурации поставщика (см. ниже).

Если выбран поиск отдельных обновлений, то после нажатия кнопки Далее > помощник обновления переходит к выбору возможных мест расположения обновлений.

Рис. 787. Места расположения обновлений

В качестве возможных мест расположения приводятся:

•

текущий каталог шаблонов;

•

съемные диски (при этом для дисков CR-ROM добавляется каталог v8updates);

•

адрес, указанный в конфигурации как адрес каталога обновления.

По указанным каталогам производится поиск обновлений следующим образом:

•

для локальных каталогов производится поиск файлов обновлений и файлов списка шаблонов в указанных каталогах и в подкаталогах. Найденные файлы списка шаблонов должны описывать каталоги шаблонов и находиться в корне этих каталогов;

•

для удаленных каталогов производится поиск файлов списка шаблонов только в указанных каталогах.

Если в свойстве конфигурации Адрес каталога обновлений указан адрес, с которого можно получить обновление конфигурации, то при нажатии кнопки Далее > выполняется аутентификация пользователя.

Рис. 788. Аутентификация доступа к интернет-ресурсу

Необходимо ввести имя и пароль пользователя для получения доступа к серверу, на котором размещен комплект обновления, а также имя и пароль для доступа через прокси-сервер.

На третьем шаге показываются обновления, для которых найдены соответствующие им шаблоны. В списке этих обновлений жирным шрифтом выделяется обновление, которое наиболее вероятно подходит для обновления конфигурации.

Рис. 789. Выбор обновления

Если выбирается обновление, которое находится в удаленном каталоге, то это обновление копируется в текущий каталог шаблонов, если он является локальным.

Нажатие кнопки Готово завершает поиск файла обновления.

На экран выводится диалог, в котором указываются основные параметры текущей конфигурации и конфигурации поставщика.

Рис. 790. Параметры обновления

Следует обратить внимание, что в нижней части диалога приводится предупреждение о том, что необходимо отчетливо понимать, что источник, из которого получен файл обновления конфигурации, является надежным и действительно содержит обновление используемой конфигурации, без нежелательных модификаций (подробнее см. здесь).

Для продолжения нужно нажать кнопку ОК.

Конфигуратор производит сравнение конфигураций и выводит на экран окно Обновление конфигурации.

Рис. 791. Обновление конфигурации

Основные приемы сравнения и объединения см. здесь.

Если в настройках конфигуратора выбрано использование внешней программы (см. здесь), то для программных модулей в список режимов объединения добавляется пункт Объединить с помощью внешней программы. При выборе этого режима для объединения модулей используются возможности внешней программы. Если у выбранной внешней программы не заполнено свойство Автоматическое трехстороннее объединение, то для выполнения объединения будет использоваться интерактивное трехстороннее объединение. Интерактивное трехсторонее объединение будет также использоваться в том случае, если внешняя программа не смогла автоматически разрешить конфликты при выполнении объединения.

Некоторые действия, которые можно выполнить в окне обновления конфигурации, зависят от настроек конфигуратора (см. здесь):

•

Команда контекстного меню Показать различия в модулях:

•

Настройка конфигуратора: Режимы "Взять из …", "Объединить с приоритетом …";

•

Настройка внешней программы: Объединение двух файлов;

•

Результаты работы: игнорируется.

•

Команда контекстного меню Показать различия в модулях без учета структуры:

•

Настройка конфигуратора: Показать различия без учета структуры;

•

Настройка внешней программы: Сравнение двух файлов;

•

Действия, выполняемые при указании режима объединения Взять из … или Объединить с приоритетом …:

•

Настройка конфигуратора: Режимы "Взять из …", "Объединить с приоритетом …";

•

Настройка внешней программы: Трехстороннее объединение;

•

Результаты работы: используется в качестве результата объединения.

•

Действия, выполняемые при указании режима объединения Объединить с помощью внешней программы:

•

Настройка конфигуратора: Режим "Объединить с помощью внешней программы";

•

Настройка внешней программы: Трехсторонее объединение;

•

Результаты работы: используется в качестве результата объединения.

•

Действия, выполняемые после нажатия кнопки Выполнить:

•

Настройка конфигуратора: группа Обновление конфигурации на поддержке;

•

Настройка внешней программы: Автоматическое трехсторонее объединение или Трехсторонее объединение;

•

Результаты работы: используется в качестве результата объединения.

При вызове команды будет использоваться тот инструмент, который указан в соответствующей настройке конфигуратора, а если в качестве инструмента выбрана какая-либо внешняя программа ‑ для выполнения действия будет использоваться командная строка, заданная в соответствующей настройке внешней программы.

При объединении конфигураций вначале выполняется объединение модулей. Для режима Объединить с помощью внешней программы, запуск внешней программы, поддерживающей автоматическое трехсторонее объединение, выполняется только при обнаружении конфликтов. Если разработчик не сохранил результат объединения, то текст модуля не меняется, и объединение конфигураций продолжается. Если среди всех модулей был хотя бы один не разрешенный конфликт, то после неудачной попытки объединения модулей объединение конфигураций останавливается, и в окно сообщений выдается список модулей, которые не были объединены. Окно объединения конфигураций не закрывается, в дереве объектов обновляется колонка с состоянием настройки объединения. Разработчик должен вручную объединить необъединенные модули и продолжить объединение конфигураций нажатием кнопки Выполнить.

Для объединения значений типа Тип используются следующие правила объединения:

•

Режим объединения Взять из файла:

•

Описание типа замещается значением из новой конфигурации поставщика.

•

Режим объединения Объединить с приоритетом:

•

Для упрощения описания объединения значений типа Тип будет использовано следующее допущение: любой тип считается составным, даже если фактически это не составной тип или тип не допускает участия в составном типе.

•

При объединении происходит выполнение следующей операции для каждого элемента объединяемых типов:

•

Если тип присутствует в старой конфигурации поставщика и отсутствует в новой конфигурации поставщика или в основной конфигурации, то он не попадет в результат объединения.

•

Если тип отсутствует в старой конфигурации поставщика и присутствует в новой конфигурации поставщика или в основной конфигурации, то он попадет в результат объединения. Если тип присутствует и в новой конфигурации поставщика и в основной конфигурации, у и этого типа есть квалификаторы, то правила объединения

•

И при этом квалификаторы типа для объекта старой конфигурации поставщика совпадают с квалификаторами этого типа в одной из оставшихся конфигураций, а в другой конфигурации квалификатор отличается, то в результат объединения попадет отличающееся значение типа (приоритет объединения в этом случае не учитывается).

•

И при этом во всех трех конфигурациях различаются квалификаторы, то в результат объединения попадут квалификаторы из приоритетной конфигурации.

•

Для одинаковых типов с разными квалификатором используются правила для квалификаторов, описанные ниже. То есть если в базе была Строка(10), у поставщика так и осталось, а в основной поменяли на Строка(15), то в результате будет Строка(15), независимо от приоритета.

•

Если в одной из конфигураций в свойстве Тип одиночный не комбинируемый с другими тип, то свойство Тип у объекта целиком берем из приоритетной конфигурации.

•

Если в результате объединения получается пустой набор типов или к не комбинируемому типу добавляются другие типы, то свойство Тип целиком берется из приоритетной конфигурации, без какого-либо объединения.

По сравнению с обычным режимом сравнения и объединения в табличное поле добавлены две колонки, показывающие статусы по истории объектов. Расшифровка пиктограмм статусов приведена в нижней части окна. С помощью пиктограмм легко понять, какого рода и в какой конфигурации были выполнены изменения.

Для того чтобы посмотреть правила поставщика, нужно указать объект в табличном поле. Правило будет показано в реквизите, расположенном сразу под табличным полем.

Для анализа произведенных изменений в конфигурациях удобно использовать специальный фильтр, настройка которого вызывается по кнопке Фильтр. На экран выводится окно настройки:

Рис. 792. Настройка фильтров просмотра

38.3.5. Файл описания каталога шаблонов

установки режимов показа отличий.

В качестве объектов сравнения выступает основная (текущая) конфигурация, новая и старая конфигурации поставщика. Поэтому окно настройки фильтра состоит из трех разделов, схожих по составу реквизитов. Каждый раздел предназначен для настройки режима сравнения любой пары конфигураций.

С помощью настроек фильтра можно производить установки режимов показа отличий сразу по всем конфигурациям.

Для удобства сравнения можно использовать шаблон фильтров. В шаблоне сформированы наиболее распространенные варианты сочетаний установок.

На основе данных об изменениях и правилах поддержки пользователь принимает решение по объединению.

В тех случаях, когда шаблоны (в том числе и обновления) конфигураций располагаются на HTTP(S) или FTP-ресурсах, необходимо указать перечень конфигураций, расположенных на том или ином ресурсе. Для этого служит файл описания каталога шаблонов v8cscdsc.lst. Данный файл находится в корневом каталоге шаблонов конфигураций, расположенных на HTTP(S) или FTP-ресурсах.

Этот файл используется для определения наличия обновлений на том или ином ресурсе в процессе выполнения команды Конфигурация ‑ Поддержка ‑ Обновить конфигурацию.

Рис. 793. Создание файла списка шаблонов

Для создания и редактирования файла описания каталога шаблонов нужно выбрать пункт Конфигурация ‑ Поддержка ‑ Шаблоны конфигураций и обновлений.

В таблице Каталоги приведен перечень каталогов шаблонов, который получается из файла 1CEStart.cfg (подробное описание файла см. здесь). В таблице Шаблоны указывается перечень шаблонов, который присутствует в выбранном каталоге шаблонов.

Редактирование каталога шаблонов конфигураций заключается в удалении из него элементов шаблонов (или шаблонов вместе с элементами целиком) и добавлении в него шаблонов конфигураций из других каталогов.

Для добавления шаблонов в каталог нужно выбрать команду Добавить командной панели таблицы

элементы, отсутствующие в текущем каталоге.

Для удаления шаблонов из каталога следует выбрать команду Удалить командной панели таблицы Шаблоны. На экран выводится диалог удаления. Далее выбрать нужный способ удаления (только указанные элементы или шаблоны целиком, в которые входят эти элементы) и нажать кнопку ОК.

Создание файла описания каталога шаблонов выполняется с помощью команды Создать файл списка шаблонов командной панели таблицы Шаблоны. Данный пункт нужно обязательно выполнить для сохранения внесенных изменений в описание каталога шаблонов.

После этого следует переместить каталог шаблонов (вместе с файлом описания каталога) на необходимый внешний ресурс.

Общий подход к работе с шаблонами, расположенными на HTTP(S) или FTP-ресурсах, следующий:

•

На диске локального компьютера создается каталог, в котором будут располагаться шаблоны, публикуемые на внешних ресурсах.

•

Выполняется установка всех шаблонов, которые планируется разместить на внешних ресурсах, в этот каталог.

•

В конфигураторе (в окне Каталоги шаблонов конфигураций, см. выше) в список Каталоги: добавляется созданный на шаге 1 каталог с шаблонами.

•

В окне Каталоги шаблонов конфигураций выполняется создание файла описания каталога шаблонов (кнопка Создать файл списка шаблонов). Для этого нужно предварительно встать курсором на каталог шаблонов, добавленный на шаге 3.

•

Затем необходимо перенести каталог шаблонов (вместе с файлом описания каталога шаблонов) из каталога локального компьютера на HTTP(S) или FTP-ресурс.