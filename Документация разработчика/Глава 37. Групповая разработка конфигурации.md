Глава 37. Групповая разработка конфигурации

37.1. Общая информация

37.2. Администрирование хранилища

37.2.1. Создание хранилища

Разработка конфигурации авторским коллективом может производиться последовательно, когда разработчики договариваются о модификации объектов конфигурации, производят изменения, а затем объединяют результат. Такой режим связан с риском случайного изменения других объектов, с необходимостью понимания всех процессов изменений и взаимосвязи объектов. Объединение конфигураций при этом должен производить специалист, хорошо представляющий направление разработки.

Снизить вероятность ошибок, повысить производительность и упростить процесс разработки призван механизм групповой разработки конфигурации, рассматриваемый в данной главе.

Под групповой разработкой понимается одновременная работа группы пользователей (разработчиков) по изменению конфигурации, при которой модификация объекта конфигурации доступна только тому разработчику, который предварительно захватил данный объект. При этом под термином «конфигурация» в этой главе понимается как основная конфигурация информационной базы, так и любое расширение конфигурации (см. здесь), которое подключено к информационной базе, в которой ведется разработка.

Для групповой разработки создается хранилище, в которое средствами конфигуратора помещается конфигурация. Организуется доступ разработчиков к хранилищу конфигурации: либо в рамках локальной сети, либо удаленный доступ с использованием веб-сервера. Для хранилища назначается администратор, который осуществляет формирование списка пользователей, имеющих доступ к хранилищу. Административные права могут быть назначены и другим пользователям.

При групповой разработке конфигурация рассматривается как набор объектов, закрытых для изменения. Чтобы произвести изменения в объекте, его нужно захватить. Одновременно объект может быть захвачен только одним пользователем. Пользователь может захватить произвольное число не захваченных другими пользователями объектов.

Приемы работы с захваченными объектами конфигурации ничем не отличаются от приемов работы в обычном режиме. Допускается редактирование свойств самого объекта, удаление и создание подчиненных объектов.

Для добавления объектов требуется, чтобы был захвачен объект, которому он подчинен. Например, для добавления константы необходимо захватить корневой объект конфигурации. Для добавления реквизита или формы объекта ‑ сам объект.

Для удаления незахваченного объекта требуется захватить сам объект, а также объект, которому он подчинен, и все подчиненные ему объекты.

После работы с захваченными объектами результат их модификации можно поместить в хранилище. С другой стороны, если какие-либо незахваченные объекты были изменены, то можно получить обновление данных объектов сразу после помещения этих объектов в хранилище конфигурации автором изменений.

Результаты работы с хранилищем можно просмотреть в истории хранилища. Версии конфигурации, сохраненные в хранилище, можно открыть для просмотра, сравнить с текущей конфигурацией, конфигурацией базы данных, а также сравнить различные версии хранилища.

Объекты конфигурации тесно взаимосвязаны друг с другом. Поэтому хранилище конфигурации поддерживает целостность метаданных при захвате или помещении объектов в хранилище.

Таким образом, механизм групповой разработки обеспечивает синхронизацию работы группы разработчиков по модификации конфигурации.

Рис. 728. Создание хранилища конфигурации

В поле Каталог хранилища нужно указать каталог расположения хранилища. По указанному каталогу не должно быть зарегистрировано другое хранилище конфигурации. Нажать кнопку Далее >.

Рис. 729. Указание политики паролей

На следующем шаге необходимо указать политику паролей для данного хранилища: минимальная длина пароля и необходимость проверки сложности для пароля. Нажать кнопку Далее >.

Рис. 730. Задание администратора хранилища

Указать имя администратора хранилища и пароль доступа. Гиперссылка Сгенерировать пароль позволит создать пароль, удовлетворяющий заданной политике паролей. Если на предыдущей странице политика паролей не указана, то будет создан пароль из 7 символов. Также можно использовать кнопки просмотра паролей в полях Пароль и Подтверждение пароля. Администратор хранилища производит формирование списка пользователей, имеющих право доступа в хранилище конфигурации.

После нажатия клавиши ОК конфигуратор производит анализ данных, формирование структуры объектов и запись данных в указанный каталог. Этот процесс может занять некоторое время (в зависимости от размера конфигурации). По окончании формирования хранилища конфигуратор предлагает пользователю подключиться к хранилищу.

37.2.2. Подключение к хранилищу

Если по указанному адресу зарегистрировано хранилище конфигурации, то конфигуратор выводит предупреждение о невозможности создания хранилища.

При создании хранилища конфигурации следует помнить, что хранилище, созданное для конфигурации и хранилище, созданное для расширения конфигурации, несовместимы друг с другом. К хранилищу конфигурации нельзя подключиться для работы с расширением и наоборот.

Хранилище конфигурации создается в формате версии 8.3.8 с размером страницы, равным 8 912 байта. Для того чтобы изменить формат базы хранилища или размер страницы ‑ следует воспользоваться утилитой cnvdbfl (подробнее см. здесь). Файл базы данных хранилища конфигурации имеет имя 1cv8ddb.1CD. Необходимо помнить, что к хранилищу конфигурации, созданному «1С:Предприятие» версии 8.3.10 и старше, не сможет подключиться конфигуратор версии 8.3.7 и младше. В этом случае будет необходимо выполнять конвертацию хранилища конфигурации.

Для подключения к хранилищу конфигурации нужно выбрать пункт Конфигурация ‑ Хранилище конфигурации ‑ Подключиться к хранилищу. Перед подключением конфигуратор сообщает, что текущая конфигурация будет замещена конфигурацией из хранилища, и запрашивает подтверждение на подключение.

После утвердительного ответа на экран выводится диалог подключения:

Рис. 732. Подключение к хранилищу конфигурации

Нужно ввести место расположения хранилища, а также имя пользователя и пароль для доступа к хранилищу, если они задан. Если под указанным именем никто не зарегистрирован, выводится предупреждение: Ошибка аутентификации! Проверьте правильность введенного имени пользователя и пароля. При выборе места расположения хранилища следует помнить, что хранилище, в котором размещена конфигурация, не может использоваться для работы с расширением конфигурации и наоборот.

Для каждого пользователя к данному хранилищу может быть подключена только одна конфигурация. Поэтому конфигуратор сначала производит проверку регистрации подключения по данному пользователю.

Если имя пользователя зарегистрировано и для этого пользователя информационная база еще не была подключена к хранилищу конфигурации, то производится подключение и устанавливается связь. Конфигурация из хранилища замещает собой конфигурацию текущей информационной базы и в хранилище по данному пользователю записывается информация о конфигурации и ее месте расположения.

Если в данный момент времени есть открытая конфигурация, связанная с указанным пользователем, то конфигуратор выводит предупреждение об аутентификации.

Если для данного пользователя в данный момент времени нет открытой информационной базы, но данные о месте расположения не совпадают с данными о связи (конфигурация расположена в другом каталоге, или подключение производится с другого рабочего места), то конфигуратор выводит сообщение: Для данного пользователя уже имеется конфигурация, связанная с данным хранилищем конфигурации. Продолжить? Если нажать кнопку Да, то происходит установка нового подключения, текущая конфигурация заменяется конфигурацией из хранилища и устанавливается новая связь текущей конфигурации с хранилищем для данного пользователя. В этом случае прежняя связь будет утеряна (информационная база, которая была ранее подключена к хранилищу, уже не сможет соединиться с этим пользователем без повторного подключения).

37.2.3. Соединение с хранилищем

«1С:Предприятия», подключающихся к хранилищу:

Версия 8.3.2 и ниже Версия 8.3.3 ‑ 8.3.5

Версия 8.3.5 и старше Да Да

Версия 8.3.4 Да Ограниченно

Версия 8.3.3 Да Ограниченно

Версия 8.3.2 и младше Да

В колонках перечислены режимы совместимости, в строках указаны номера версий конфигуратора, с помощью которого выполняется попытка подключения к хранилищу конфигурации. Значение Да в ячейке означает, что определенная версия конфигуратора может подключиться к хранилищу с указанным режимом совместимости. Значение Ограниченно означает, что с хранилищем без ограничений могут работать только конфигураторы версий 8.3.3 и 8.3.4. Если к хранилищу, которое находится в режиме совместимости Версия 8.3.3 ‑ 8.3.5, одновременно подключаются конфигураторы версий 8.3.5 и 8.3.4, то конфигуратор версии 8.3.4 не может поместить в хранилище измененные объекты.

Также необходимо помнить, что если хранилище конфигурации создавалось с помощью платформы «1С:Предприятие» версии 8.3.10 и старше, то к нему не сможет подключиться конфигуратор версии 8.3.7 и младше. Если такое необходимо ‑ следует выполнить конвертацию файла хранилища конфигурации в формат версии 8.2.14 с помощью утилиты cnvdbfl.

В том случае, если информационная база уже подключена к хранилищу, то при ее открытии запрашиваются параметры доступа к хранилищу. Если после первого подключения параметры доступа не изменялись, то необходимо подтвердить соединение с хранилищем конфигурации. Если изменилось местоположение хранилища конфигурации (без изменения остальных параметров доступа), необходимо указать новое местоположение хранилища в диалоге соединения с хранилищем конфигурации. После соединения будет открыто окно конфигурации.

Если при соединении с хранилищем конфигурации неправильно указано имя пользователя или пароль или указано имя пользователя, подключенного к данному хранилищу в данный момент времени, то выдается сообщение: Ошибка аутентификации! Проверьте правильность введенного имени пользователя и пароля.

Если при соединении с хранилищем указать другого пользователя, то подключение закончится ошибкой Пользователь существующей связи отличается от текущего. В этом случае (при смене пользователя, от имени которого выполняется работа с хранилищем) следует отключиться от хранилища конфигурации и выполнить повторное подключение с указанием нового пользователя.

Если производится попытка соединения с хранилищем конфигурации для открытой в данный момент конфигурации, то конфигуратор выдает предупреждение об ошибке с указанием имени пользователя.

Если сменилось местоположение информационной базы, подключенной к хранилищу, то будет выведено предупреждение Месторасположение информационной базы изменилось. Продолжить? При утвердительном ответе в хранилище запоминается новое месторасположение информационной базы и выполняется соединение. При отрицательном ответе соединение к хранилищу не выполняется. В этом случае для повторной попытке выполнить соединение с хранилищем конфигурации следует использовать команду Конфигурация ‑ Хранилище конфигурации ‑ Открыть хранилище.

Если к одному хранилищу конфигурации подключено две информационные базы от имени одного пользователя хранилища, то работа с хранилищем конфигурации будет возможна только для того разработчика, который выполнил подключение последним. Для первого разработчика будет выводится ошибка Информационная база не связана с хранилищем конфигурации. В этом случае первому разработчику необходимо выполнить подключение к хранилищу от имени другого пользователя хранилища.

подключенной к хранилищу:

Рис. 733. Конфигурация, подключенная к хранилищу

Состояние объектов конфигурации отображается специальными значками, размещенными вдоль правой границы окна Конфигурация. Значки объекта и подчиненного объекта отличаются размером (для подчиненного объектов они меньше) и видом (у подчиненных объектов присутствует изображение ветви дерева).

Рис. 734. Значки объектов

37.2.5. Ведение списка пользователей хранилища

37.2.6. Кеш версий хранилища

Если объект захвачен другим пользователем (см. рис.734), то данный объект может быть модифицирован только тем пользователем, который захватил данный объект. Подсказка к объекту метаданных, появляющаяся над пиктограммой текущего состояния объекта в хранилище конфигурации, содержит имя пользователя, захватившего объект, дату захвата объекта пользователем, имя компьютера, с которого было осуществлено соединение пользователя с хранилищем конфигурации, и месторасположение информационной базы.

Созданные пользователем и еще не помещенные в хранилище объекты, а также объекты, удаленные из хранилища, но еще присутствующие в локальной конфигурации, обозначаются значком в виде отметки красного цвета.

Для создания нового пользователя хранилища нужно выбрать пункт меню Конфигурация ‑ Хранилище конфигураций ‑ Администрирование хранилища и на закладке Пользователи выбрать пункт Действия ‑ Добавить. На экран выводится окно редактирования информации о пользователе. На закладке Основные вводится наименование пользователя и пароль доступа к хранилищу.

Рис. 735. Параметры пользователя хранилища

На закладке Права указывается, какими правами обладает данный пользователь.

Рис. 736. Права пользователя хранилища

Административные функции ‑ пользователь имеет права создания, удаления и отключения пользователей, отмены захвата, изменять режим совместимости хранилища и выполнять процедуру оптимизации.

Изменение состава версий ‑ пользователь имеет права выполнения отката и сокращения истории версий (подробнее см. здесь).

Захват объектов ‑ пользователям с данным правом доступны захват и внесение изменений в конфигурацию хранилища. Если право не установлено, то объекты хранилища можно только просмотреть.

37.2.7. Администрирование хранилища конфигурации

локальный, он располагается на стороне компьютера, на котором работает конфигуратор, подключенный к хранилищу. Другой кеш ‑ глобальный, он расположен на том компьютере, где расположен каталог с хранилищем. Кеш предназначен для ускорения некоторых операций по работе с хранилищем. В кеш попадают версии в результате выполнения следующих операций:

•

Подключение к хранилищу;

•

Открытие версии конфигурации в хранилище;

•

Сравнение версий конфигурации в хранилище;

•

Сохранение версии конфигурации в хранилище;

•

При выборочном сравнении следующих объектов конфигурации:

•

Формы (при работе через сервер хранилища);

•

Права доступа (при работе с хранилищем конфигурации, расположенной на сетевом ресурсе или через сервер хранилища);

•

Командные интерфейсы (при работе с хранилищем конфигурации, расположенной на сетевом ресурсе или через сервер хранилища).

При необходимости выполнить какую либо из вышеперечисленных операций, система последовательно анализирует локальный и глобальный кеши версий. Если поиск не привел к положительному результату ‑ выполняется получение нужной версии непосредственно из хранилища.

Управление местом расположения и объемом кешей выполняется с помощью диалога администрирования хранилища или конфигурационных файлов.

Для администрирования хранилища конфигурации предназначено специальное окно, вызываемое пунктом меню Главное меню ‑ Конфигурация ‑ Хранилище конфигураций ‑ Администрирование хранилища.

На экран выводится окно (см. рис.737).

Рис. 737. Администрирование хранилища

разработчиков конфигурации (далее в этой главе ‑ пользователи). Всем пользователям доступен режим изменения собственных параметров (имя, пароль), кроме смены прав. Жирным шрифтом выделены те пользователи, который в данный момент подключены к хранилищу. На рис.737 это пользователь Администратор.

В правой колонке списка отображается информация о том, установлен у пользователя хранилища пароль (картинка закрытого замка) или не установлен (желтый круг с восклицательным знаком). Также, под списком, выводится сводная информация по пользователям: общее количество пользователей и количество пользователей без пароля. Колонка и сводная информация отображается только администратору хранилища.

ВНИМАНИЕ! Добавление, удаление и смена прав доступны только пользователям, имеющим административные права.

На закладке Подключения выводится список пользователей, подключенных к хранилищу.

Рис. 738. Подключенные пользователи

С помощью кнопки Отключить можно отключить от хранилища любого из указанных пользователей, не работающих в данный момент с хранилищем.

ВНИМАНИЕ! Кнопка Отключить доступна пользователям, имеющим административные права.

На закладке Отмена захвата производится отмена захвата объектов для указанного пользователя.

Рис. 739. Отмена захваченных объектов

При этом пользователь, захвативший объекты, лишается возможности поместить изменения этих объектов в хранилище.

ВНИМАНИЕ! Данная кнопка доступна пользователям, имеющим административные права.

На закладке Прочие расположены параметры, управляющие работой самого хранилища.

Рис. 740. Параметры хранилища

Группа параметров Глобальный кеш версий конфигурации служит для задания размера глобального кеша версий конфигурации. Алгоритм очистки кеша совпадает с алгоритмом очистки локального кеша версий. Кнопка Очистить кеш приводит к полной очистке кеша.

Для управления параметрами глобального кеша версий служит файл cfgrepo.conf, описание которого см. здесь.

взаимодействия с сервером хранилища.

В следующей таблице отражено, какие версии системы могут работать с хранилищем, для которого установлен тот или иной режим совместимости:

Режим совместимости Реализован в версии Может работать

Версии 8.3.2 и младше 8.3.3 Любая версия

Версии 8.3.3 ‑ 8.3.5 8.3.6 8.3.3 и старше

Не использовать 8.3.6 и старше

Если свойство Режим совместимости установлено в значение Версии 8.3.2 и младше, то с хранилищем могут работать любые версии «1С:Предприятия». Если установить это свойство в значение Версии 8.3.3 ‑ 8.3.5 и выше (включая Не использовать), то после нажатия кнопки Установить, хранилище будет преобразовано в оптимизированный формат. После выполнения оптимизации работа с хранилищем будет выполняться быстрее (в том числе и при использовании сервера хранилища). Операцию изменения режима совместимости может выполнять только пользователь с административными правами.

ВНИМАНИЕ! Преобразование хранилища может занимать существенное время.

При необходимости, можно обратно преобразовать хранилище конфигурации в формат, пригодный для использования любыми версиями «1С:Предприятия». Для этого необходимо установить свойство Режим совместимости в значение Версии 8.3.2 и младше и нажать кнопку Установить. Кроме того, может потребоваться выполнение конвертации самого файла хранилища. Такая операция может потребоваться в том случае, если хранилище конфигурации было создано в «1С:Предприятии» версии 8.3.10 и старше. Для конвертации необходимо использовать утилиту cnvdbfl.

Для нового хранилища конфигурации свойство Режим совместимости устанавливается в значение Не использовать, а файл базы даных хранилища создается в формает версии 8.3.8.

Группа Политика паролей позволяет настроить требования к паролям пользователей хранилища. Эти требования распространяютс на вновь создаваемых пользователей и в том случае, когда изменяется пароль для уже созданного пользователя хранилища. Если пользователь не является аджминистратором хранилища, то данная группа ему отображается, но редактировать ее нельзя.

Группа Оптимизация данных хранилища позволяет выполнить оптимизацию хранилища, которое не находится в режиме совместимости с версией 8.3.2. В результате оптимизации будет повышена скорость работы с хранилищем. Оптимизацию требуется проводить только после того, как система предложит это сделать.

Для пользователя с административными правами можно включить рекомендацию выполнить оптимизацию после проведения операции хранилищем (помещение объектов, откат версий, слияние версий). Для этого предназначен флажок Предлагать оптимизацию после выполнения операций с хранилищем на закладке Прочие диалога администрирования хранилища. В этом случае, после завершения операции с хранилищем, пользователю может быть показан диалог:

Рис. 741. Предложение оптимизировать хранилище

Если пользователь (администратор хранилища) отказывается от проведения оптимизации непосредственно при появлении рекомендации, то оптимизацию можно выполнить позднее. В этом случае следует зайти в диалог администрирования хранилища и на закладке Прочие нажать кнопку Оптимизировать. Кнопку стоит нажимать в том случае, если справа от нее отображается

время.

Рис. 742. Рекомендуется выполнить оптимизацию

Во время выполнения оптимизации работать с хранилищем не рекомендуется.

Оптимизацию можно также выполнить с помощью параметра командной строки запуска конфигуратора /ConfigurationRepositoryOptimizeData.

Для настройки параметров локальных данных хранилища предназначен диалог, который доступен с помощью команды Главное меню ‑ Конфигурация ‑ Хранилище конфигурации ‑ Настройка использования локальных данных хранилища.

Рис. 743. Настройка использования локальных данных хранилища

В данном диалоге указываются характеристики локального кеша версий, а также возможно выполнить оптимизацию хранилища информации об объектах разработки.

Локальный кеш формируется в том случае, когда хранилище конфигурации расположено на сетевом диске или работа с хранилищем выполняется с помощью сервера хранилища. Свойство Каталог служит для указания каталога в локальной файловой системе, где будет располагаться кеш. По умолчанию, кеш располагается в каталоге:

•

Для ОС Windows: %APPDATA%\1C\1Cv8\<Уникальный идентификатор информационной базы>\cfgrepo\cache.

•

Для ОС Linux: ~/.1cv8/1C/1cv8/<Уникальный идентификатор информационной базы>/cfgrepo/cache.

37.2.8. Резервное копирование хранилища

37.3. Работа с хранилищем конфигурации

умолчанию ‑ 500 Мбайт. Если в процессе работы размер локального кеша превысит установленный размер, будет автоматически удалены самые старые версии в количестве 50% от размера кеша. Кнопка Очистить кеш приводит к полной очистке локального кеша.

Для управления параметрами локального кеша версий служит файл cfgrepo.conf, описание которого см. здесь.

В зависимости от режима совместимости хранилища, резервное копирование выполняется по-разному.

ВНИМАНИЕ! Во время выполнения операции резервного копирования хранилища конфигурации, к нему не должно быть ни одного подключения.

Для выполнения резервного копирования необходимо скопировать следующие файлы:

•

Свойство Режим совместимости равно Версии 8.3.2 и младше ‑ необходимо скопировать только файл 1Cv8ddb.1CD.

•

Свойство Режим совместимости не равно Версии 8.3.2 и младше ‑ необходимо скопировать файл 1Cv8ddb.1CD и полностью каталог data, расположенный в том же каталоге, что и файл 1Cv8ddb.1CD.

Захват, получение, помещение объектов в хранилище и другие действия с объектами хранилища удобнее выполнять в окне Хранилище конфигурации. Для его открытия нужно выбрать пункт Конфигурация ‑ Хранилище конфигурации ‑ Хранилище.

Рис. 744. Хранилище конфигурации

Окно Хранилище конфигурации состоит из панели инструментов и табличного поля, в первой колонке которого показывается иерархическая структура объектов хранилища или список объектов в зависимости от режима просмотра (меню Вид).

Если режим показа удаленных объектов установлен (подменю Вид), то в списке удаленные объекты показываются более светлым шрифтом.

Во второй колонке пиктограммами показывается состояние захваченных объектов. Захваченные текущим пользователем объекты показываются пиктограммой, содержащей красную галочку. В колонке Пользователь указывается пользователь, захвативший объект. В колонке Дата

37.3.1. Фильтр хранилища

37.3.2. Захват объектов хранилища

колонке Информационная база ‑ имя локального каталога информационной базы на компьютере пользователя.

ВНИМАНИЕ! В окне хранилища не показываются созданные пользователем новые объекты (еще не помещенные в хранилище).

Для удобства работы с конфигурацией можно настроить показ объектов в графе Объект окна Хранилище конфигурации. Фильтр вызывается пунктом меню Действия ‑ Отбор. На экран выводится окно:

Рис. 745. Отбор объектов хранилища

Смысл элементов управления понятен из их названия.

Также имеется возможность быстро отобрать только те объекты, которые захвачены в хранилище текущим пользователем.

Рис. 746. Отбор захваченных объектов

Для этого необходимо воспользоваться командой Действия ‑ Захваченные объекты или нажать специальную кнопку на командной панели окна Конфигурация. Кнопка отображается только в том случае, если конфигурация подключена к хранилищу конфигурации. Повторное выполнение команды отключает отбор. Отбор работает совместно с отбором по подсистемам (см. здесь) и поиском по дереву конфигурации (см. здесь).

Захват объекта предназначен для монопольного владения объектом хранилища с целью его редактирования. Захваченный объект для других пользователей становится недоступным для изменений (возможен только просмотр и получение измененного объекта для использования).

Для захвата в окне Хранилище конфигурации следует указать нужный объект (допускается множественный выбор) и выполнить команду Действия ‑ Захватить в хранилище…

37.3.3. Помещение объекта в хранилище

Рис. 747. Захват объектов в хранилище

Если объект связан с другими объектами, то в список будут также включены эти объекты. В этом случае выбранный объект показывается жирным шрифтом. Захват выбранного объекта возможен только в случае получения этих объектов из хранилища.

При этом в список включаются также те объекты, которые не связаны непосредственно с выбранным объектом, а имеют косвенную связь.

Для получения этих объектов необходимо установить флажок в первой колонке списка. Если также требуется захватить объекты, то для них нужно установить флажок в колонке Захватить. Если не все требуемые для захвата объекты отмечены для получения, конфигуратор выдает сообщение Для выполнения операции требуется получение объектов и перечисляет требуемые объекты. Захват в данном случае не производится.

Если объекты содержат подчиненные объекты и требуется захват подчиненных объектов, нужно установить флажок Выполнять рекурсивно.

Если требуется получить данные уже захваченных объектов, то установить флажок Разрешить получать захваченные.

ВНИМАНИЕ! Если флажок Разрешить получать захваченные установлен, изменения, сделанные в захваченных и повторно получаемых объектах, будут потеряны.

После захвата указанные объекты будут помечены специальным значком.

При захвате имеется возможность заранее внести комментарий, который может быть использован при помещении объекта в хранилище (см. здесь). Для этого нужно ввести текст в поле Комментарий для последующего помещения или выбрать такой комментарий из списка ранее внесенных комментариев (кнопка … в правой части поля). В этом списке содержится 20 последних комментариев, которые вводились при захвате или помещении объектов.

Для добавления новых объектов в конфигурацию нужно захватить родительский объект. Например, для создания нового справочника необходимо захватить корневой объект конфигурации; для создания новой формы или реквизита справочника ‑ захватить сам объект-справочник.

После захвата родительского объекта можно создавать подчиненные объекты. Затем все новые и захваченный родительский объекты нужно поместить в хранилище.

Модифицированный объект можно поместить в хранилище, чтобы другие пользователи могли

Рис. 748. Помещение объектов в хранилище

Необходимо установить флажки для тех объектов, которые будут помещены в хранилище.

Для описания произведенных изменений ввести их в многострочное поле Комментарий. Если комментарий вводился при захвате объекта (объектов) в хранилище (см. здесь) или ранее использовался при помещении объекта в хранилище, этот комментарий можно выбрать для повторного использования из списка последних комментариев. Для открытия списка необходимо нажать кнопку "…", расположенную справа от поля Комментарий:. В этом списке содержится 20 последних комментариев, которые вводились при помещении или захвате объектов.

Рис. 749. Список последних комментариев

Если объекты содержат подчиненные объекты и требуется их поместить в хранилище, нужно установить флажок Выполнять рекурсивно.

Если требуется, чтобы указанные объекты оставались захваченными, установить флажок Оставить захваченными.

Если в хранилище помещаются объекты, связанные с другими объектами конфигурации, в диалог выводится полный список таких объектов.

Для того чтобы поместить в хранилище новые объекты, в окне Конфигурация нужно выбрать объект и в контекстном меню выбрать пункт Поместить в хранилище… На экран выводится окно помещения объектов в хранилище.

Помимо этого объекта в список могут быть включены и другие объекты, связанные с данным

37.3.4. Получение объектов из хранилища

37.3.5. Отмена захвата объектов

Чтобы получить объекты, измененные другими пользователями, в списке объектов хранилища следует указать нужные объекты и выполнить команду Действия ‑ Получить из хранилища. На экран выводится диалог:

Рис. 750. Получение объектов из хранилища

В строках списка объектов нужно установить флажки для тех объектов, которые требуется получить из хранилища.

Если объекты содержат подчиненные объекты и требуется их получение, установить флажок Получать рекурсивно.

Если выбранный объект уже захвачен, то установка флажка Получать захваченные приведет к потере произведенных изменений в данном объекте. В этом случае производится восстановление данных объекта данными из хранилища.

Если не требуется сохранять произведенные в объекте хранилища изменения или нужно предоставить данный объект для модификации другому пользователю, данный объект можно отпустить. Для этого следует выполнить команду Действия ‑ Отменить захват в хранилище…

37.3.6. Обновление статуса объектов хранилища

37.3.7. Сравнение хранилища с текущей конфигурацией

37.3.8. Сравнение объекта хранилища с объектом текущей конфигурации

37.3.9. Сохранение хранилища как конфигурации

37.3.10. Отключение от хранилища

37.3.11. История хранилища

Во второй колонке списка пиктограмма показывает отличие объекта в конфигурации и хранилище. Если пиктограмма отсутствует, то объекты совпадают.

Если объекты содержат подчиненные объекты и требуется отмена их захвата, нужно установить флажок Выполнять рекурсивно.

После отмены захвата объекты будут получены из хранилища.

Если требуется обновить информацию об объектах, размещенных в хранилище, нужно выполнить команду Обновить статус. По этой команде производится обновление информации о захвате или отмене захвата, появлении новых объектов по всему хранилищу.

В любой момент времени можно произвести сравнение текущей конфигурации с хранилищем. Для этого нужно выполнить команду Конфигурация ‑ Хранилище конфигураций ‑ Сравнить/объединить конфигурацию с хранилищем. На экран выводится окно сравнения (см. здесь).

Иногда нужно произвести сравнение конкретного объекта в хранилище и в текущей конфигурации. Для этого в окне Хранилище конфигурации нужно выбрать объект и выполнить команду Действия ‑ Сравнить с объектом конфигурации.

На экран выводится вопрос: Отображать сравнение конфигураций? В случае утвердительного ответа производится сравнение конфигураций, выводится окно сравнения конфигураций, в окне сравнения активизируется строка с выбранным объектом, и на экран выводится диалог настройки отчета. В случае отрицательного ответа окно сравнения конфигураций на экран не выводится и сравнение не выполняется.

Если в хранилище отключен режим совместимости с версией 8.3.2 (см. здесь), то имеется возможность выполнить выборочное сравнение двух объектов конфигурации, не выполняя сравнение все конфигурации. При этом для выборочного сравнения будут доступны только версии объектов, которые помещались в хранилище с помощью «1С:Предприятия» версии 8.2.9 и старше. Для выборочного сравнения следует использовать команду контекстного меню Сравнить выборочно с объектом хранилища, Сравнить выборочно с объектом конфигурации или Сравнить выборочно версии объекта, в зависимости от того, откуда требуется выполнить сравнение: из дерева конфигурации, дерева хранилища или из окна истории хранилища. При выборе выборочного сравнения из дерева конфигурации, сравнение будет выполнено с последней версией объекта, расположенной в хранилище конфигурации. Если выборочное сравнение будет недоступно ‑ платформа сообщит об этом с помощью диагностического сообщения.

Возможность проводить выборочное сравнение реализована для следующих объектов конфигурации: модуль, макет, картинка, WS-ссылка, расписание, агрегаты регистра, состав плана обмена, стиль, рабочая область начальной страницы, карта маршрута, форма (без учета модуля формы), модуль формы, справочная информация, предопределенные элементы, фрагмент командного интерфейса, права роли.

Сохранение хранилища как конфигурации производится с помощью команды Конфигурация ‑ Хранилище конфигурации ‑ Сохранить конфигурацию хранилища в файл.

Для отключения от хранилища нужно выбрать пункт Конфигурация ‑ Хранилище конфигурации ‑ Отключиться от хранилища.

37.3.11.1. Работа с версией хранилища

информации об объектах конфигурации. В истории записываются результаты помещения объектов.

Каждое изменение объекта можно просмотреть, сравнить с текущим состоянием, сравнить версии конфигурации, а также получить конфигурацию указанной версии из хранилища.

Для открытия окна истории хранилища следует выбрать пункт Конфигурация ‑ Хранилище ‑ История хранилища.

Рис. 752. История хранилища

В табличном поле, расположенном в левой части окна, выводится хронологический список версий конфигурации.

Ниже списка версий расположено поле для показа комментария по выбранной версии.

В табличном поле, расположенном в правой части окна, выводится список объектов, которые были изменены, добавлены или удалены в выбранной версии.

В списке версий допускается множественный выбор версий. В этом случае в поле Комментарий выводятся комментарии всех выбранных версий, а в списке объектов ‑ список всех объектов по данным версиям.

Каждый объект списка объектов окна История хранилища можно открыть для просмотра, посмотреть историю изменений данного объекта и сравнить с объектом текущей конфигурации. Эти действия выполняются с помощью команд контекстного меню списка объектов.

Каждую версию хранилища конфигурации можно открыть для просмотра, загрузить вместо текущей конфигурации, сравнить с текущей конфигурацией, сохранить в файл на диске. Также предоставлена возможность сравнить версии хранилища конфигурации с конфигурацией, хранящейся в файле. Все действия выполняются с помощью команд меню Действия окна История хранилища.

Чтобы вывести информацию по истории хранилища, можно использовать специальный отчет. Для запуска отчета в окне История хранилища следует выбрать пункт Действия ‑ Отчет по истории хранилища. На экран выводится окно для указания параметров отчета.

37.3.11.2. Возврат к предыдущим версиям

37.3.11.3. Сокращение версий

37.3.11.4. Объединение версий

Рис. 753. Параметры отчета по истории хранилища

В группе Отчет по выбирают вид группировки информации в отчете. В каждой группе информация сортируется по алфавиту.

Если выбран вид Версиям хранилища, то информация группируется по номерам версий. Если выбран вид Объектам разработки, то информация группируется по объектам. Если выбран вид Комментариям к версиям, то информация группируется по комментариям в истории хранилища.

В группе Выводить в выбирают вид представления отчета (текстовый или табличный документ).

В группе Параметры указываются дополнительные параметры отчета.

Для исключения строк комментария, начинающихся с «//», следует установить соответствующий флажок.

Чтобы указать объекты, по которым требуется выполнить отчет, и интервал дат, следует нажать кнопку Отбор. В открывшемся окне задания отбора установить параметры отбора.

Для начала построения отчета нажать кнопку ОК.

Если в хранилище конфигурации были опубликованы ненужные версии, конфигуратор предоставляет возможность отката до нужной версии хранилища. Для этого в списке версий нужно выбрать ту, до которой следует откатиться, и выбрать пункт Действия ‑ Откатить до версии. На экран выводится вопрос-предупреждение: При выполнении отката информация об откатываемых версиях будет удалена без возможности восстановления. Продолжить? В случае утвердительного ответа будет произведен откат, при котором из хранилища удаляются все версии, помещенные после указанной.

Если для отката выбрано очень большое количество версий (несколько тысяч), то во время операции возврата к предыдущей версии может возникнуть ошибка нехватки оперативной памяти и операция будет прервана. В этом случае рекомендуется выполнять операцию отката более мелкими порциями, по несколько сотен версий.

Если ранние версии конфигураций становятся ненужными, их можно удалить из хранилища. Для этого в списке версий следует выбрать ту версию, до которой нужно сократить, и выбрать пункт Действия ‑ Сократить до версии. На экран выводится вопрос-предупреждение с описанием выполняемого действия и запросом подтверждения. В случае утвердительного ответа будет произведено сокращение, при котором из хранилища удаляются все версии, сделанные ранее выбранной.

Если для удаления выбрано очень большое количество версий (несколько тысяч), то во время операции сокращения версий может возникнуть ошибка нехватки оперативной памяти и операция будет прервана. В этом случае рекомендуется выполнять операцию сокращения более мелкими порциями, по несколько сотен версий.

37.3.11.5. Установка меток версий

37.3.11.6. Отбор

хранилища нужно выделить объединяемые версии (при этом в разделе Комментарий формируется сводный комментарий, состоящий из комментариев версий, а в списке объектов показываются все объекты, над которыми были выполнены любые действия, выбранных версий) и выбрать пункт Действия ‑ Объединить версии. На экран выводится вопрос-предупреждение с описанием выполняемого действия и запросом подтверждения. В случае утвердительного ответа будет выполнено объединение версий, а в истории хранилища будет сформирована одна версия, включающая сводные изменения всех версий, выбранных для объединения.

Для каждой версии конфигурации в окне История хранилища можно установить метку. Для этого следует выбрать нужную версию и в контекстном меню выбрать пункт Изменить. На экран выводится диалог.

Рис. 754. Версия хранилища

Нужно ввести значение метки. При вводе первого символа становится доступным поле Комментарий метки, в которое записывается текст, описывающий назначение данной метки. Метки в основном играют роль отметок завершения определенных логических этапов или действий (выпуск новых версий конфигураций, подготовка поставки и др.).

Диалог отбора списка История хранилища отличается от стандартного.

37.3.11.7. Сравнение версий хранилища

Рис. 755. Отбор версий

Отбор версий выполняется в интервале времени, в интервале версий хранилища (или в комбинации версии и даты), по указанному списку пользователей хранилища, выполнивших размещение версий, по определенным объектам конфигурации, по определенной версии конфигурации. Также имеется возможность устанавливать отбор по конкретным свойствам объектов конфигурации. Для этого предназначено дерево свойств в окне установки отбора. Так, в примере на рис.755, для всех выбранных справочников (АдресныеСокращения, Банки, ВычетыНДФЛ в дереве Объект) будут отображены только те версии, где у этих справочников изменялись модули менеджеров и модули объектов (в дереве Свойство). Для упрощения выбора свойств в командной панели дерева Свойство присутствует кнопка Отметить все свойства выбранных объектов. С помощью этой кнопки выбираются все свойства для тех объектов конфигурации, которые отмечены в дереве объектов. Возможность выполнять отбор истории реализован по следующим свойствам объектов конфигурации: модуль, макет, картинка, WS-ссылка, расписание регламентного задания, агрегаты оборотного регистра накопления, состав плана обмена, стиль, рабочая область начальной страницы, карта маршрута, форма, справочная информация, предопределенные элементы, фрагмент командного интерфейса, права роли.

При выборе в дереве свойств элемента Объект, в историю попадут те версии, где изменялись свойства соответствующего объекта конфигурации, для которых недоступно выборочное сравнение.

Кроме того, можно указать необходимость вывода версий, помеченных метками, а также включения в выборку только тех версий, которые помечены метками.

По каждой выбранной версии списка версий в левой части окна История хранилища содержится список объектов, которые были добавлены, изменены или удалены. Этот список всегда полный для данной версии (не зависит от условий отбора). Если в условиях отбора указываются конкретные объекты конфигурации (не вся конфигурация), то в списке объекты, удовлетворяющие условию отбора, выделяются другим цветом фона.

37.3.12. История объекта

хранилища нужно выбрать две сравниваемые версии (выбор производится с нажатой клавишей Ctrl) и выполнить команду Действия ‑ Сравнить версии конфигурации или Действия ‑ Сравнить выборочно версии объекта. Подробнее о выборочном сравнении см. здесь.

Производится сравнение указанных версий конфигураций друг с другом, и выводится окно сравнения конфигураций.

Для просмотра истории изменения объекта в списке объектов хранилища или в окне Конфигурация нужно указать объект и выбрать пункт Действия ‑ История объекта или с помощью меню Действия ‑ Выборочная история объекта. Для каждого объекта доступен собственный набор свойств, по которым можно просматривать историю.

После выбора вида просмотра, на экран выводится диалог отбора истории.

Рис. 756. Отбор истории объекта

Следует указать нужные параметры отбора и нажать кнопку ОК.

На экран выводится окно истории объекта.

Рис. 757. История объекта

Каждое изменение объекта можно просмотреть, сравнить с текущим состоянием, сравнить версии (для этого необходимо в списке выбрать две версии).

По каждой версии объекта можно просмотреть комментарии и метки аналогично версиям конфигурации (см. выше), а также получить конфигурацию указанной версии из хранилища.

В списке версий объекта можно выполнить отбор. Отбор выполняется аналогично описанному выше отбору в истории хранилища. При этом в окне отбора версий будет выбран текущий объект и соответствующие свойства: все, если был выбран просмотр истории объекта или указанное, если был выбран просмотр выборочной истории.

Если требуется перейти в окно истории хранилища, то в подменю Перейти окна истории объектов нужно выбрать пункт История хранилища. Если требуется открыть окно истории хранилища с одновременной установкой отбора по текущему объекту, то следует выбрать пункт История хранилища по объекту.

37.4. Удаленная работа с хранилищем конфигурации

37.4.1. Общая информация

37.4.2. Обзор архитектуры

37.4.2.1. Общая информация

Некоторые действия с хранилищем можно выполнять без подключения.

Если конфигурация не подключена к хранилищу, то предварительно нужно установить соединение с хранилищем. Для этого следует выбрать любой доступный пункт из группы Конфигурация ‑ Хранилище конфигурации. На экран выводится диалог соединения с хранилищем.

Рис. 758. Подключение к хранилищу

Нужно указать те же данные, что и при подключении, и нажать кнопку ОК.

После установки соединения при выборе других доступных пунктов меню диалог соединения не выводится.

В режиме соединения доступны все действия, связанные с просмотром данных хранилища, сравнением объектов и конфигураций, а также администрирование хранилища в полном объеме (для пользователей, имеющих административные права). Недоступны действия, связанные с получением объектов из хранилища.

В режиме соединения пользователи, имеющие административные права, могут выполнять все действия, связанные с историей хранилища.

Механизм удаленной работы с хранилищем конфигурации расширяет возможности групповой разработки конфигурации:

•

хранилище конфигурации может быть расположено на компьютере, работающем под управлением операционных систем Windows или Linux;

•

доступ к хранилищу конфигурации могут иметь пользователи локальной сети (по протоколу TCP/IP) и пользователи сети Интернет (по протоколу HTTP).

Для прикладного разработчика удаленная работа с хранилищем конфигурации практически ничем не отличается от работы с хранилищем, расположенным на общем сетевом ресурсе, за исключением некоторых особенностей, описание которых см. здесь.

ПРИМЕЧАНИЕ. Механизм удаленной работы с хранилищем ориентирован, в основном, на работу через соединение с высокой пропускной способностью. Кроме этого, следует учитывать, что при использовании удаленной работы может существенно возрастать время операций, требующих обмена большим количеством информации, например таких, как получение полной версии хранилища.

Удаленную работу с хранилищем конфигурации обеспечивает специальное приложение ‑ сервер хранилища конфигурации. Компьютер, на котором функционирует приложение сервера хранилища конфигурации (crserver), также называется сервер хранилища конфигурации. В зависимости от протокола работы (TCP или HTTP) используются различные схемы удаленного взаимодействия клиентского приложения и хранилища конфигурации. При этом обеспечивается одновременная работа с хранилищем конфигурации как удаленно, так и «локально», как с общим файловым ресурсом.

37.4.2.2. Общая схема работы с хранилищем конфигурации

Рис. 759. Удаленное хранилище

В общем случае система «1С:Предприятие» обеспечивает одновременную работу с хранилищем конфигурации с использованием всех протоколов доступа к хранилищу: файловый доступ, протокол TCP и протокол HTTP.

Рис. 760. Взаимодействие с удаленным хранилищем

При этом один и тот же сервер хранилища конфигурации позволяет работать клиентам с различными хранилищами конфигурации. Единственное ограничение ‑ все хранилища должны быть расположены в одном корневом каталоге.

37.4.2.3. Взаимодействие по протоколу TCP

37.4.2.4. Взаимодействие по протоколу HTTP

Рис. 761. Расположение различных файлов хранилищ

Когда используется протокол TCP, клиентское приложение взаимодействует с сервером хранилища конфигурации, который, в свою очередь, взаимодействует непосредственно с самим хранилищем конфигурации.

Рис. 762. Взаимодействие по протоколу TCP

Когда используется протокол HTTP, взаимодействие осуществляется по следующей цепочке: клиентское приложение ‑ веб-сервер ‑ сервер хранилища конфигурации ‑ хранилище конфигурации.

37.4.3. Установка сервера хранилища

37.4.4. Настройка веб-сервера для работы с хранилищем

37.4.4.1. Общая информация

Копировать в буфер обмена <?xml version="1.0" encoding="UTF-8"?> <storage connectString="tcp://RepServ"/>

37.4.4.2. Для веб-сервера Microsoft Internet Information Services

Рис. 763. Взаимодействие по протоколу HTTP

Установка сервера хранилища конфигурации см. здесь.

После установки сервера хранилища конфигурации необходимо для пользователя, от имени которого работает сервер хранилища конфигурации, права записи и чтения на каталог, в котором расположено хранилище конфигурации (файл 1Cv8DDB.1CD и каталог data).

Если планируется удаленная работа с хранилищем по протоколу HTTP, то кроме настройки сервера хранилища конфигурации необходимо настроить веб-сервер на работу с системой «1С:Предприятие» и сервером хранилища конфигурации. Настройка заключается в следующих действиях:

•

Зарегистрировать модуль расширения веб-сервера;

•

Зарегистрировать виртуальное приложение на веб-сервере;

•

Опубликовать конфигурационный файл работы с сервером хранилища конфигурации.

ПРИМЕЧАНИЕ. На веб-сервере обязательно должна быть установлена поддержка ISAPI расширений.

Публикация конфигурационного файла работы с сервером хранилища конфигурации сводится к размещению файла с расширением 1ccr в виртуальном каталоге веб-сервера. Например, такой конфигурационный файл может иметь имя storage.1ccr и следующее содержание:

Описание файла *.1ccr приведено в книге 1С:Предприятие 8.3. "Руководство администратора".

Для настройки веб-сервера необходимы права администратора.

Данный раздел содержит настройки веб-сервера Microsoft Internet Information Services (далее IIS) в зависимости от версии веб-сервера.

Необходимо создать виртуальный каталог. Для этого необходимо использовать мастер создания виртуального каталога из контекстного меню пункта Веб-узел по умолчанию (Internet Information Services ‑ <Имя компьютера с веб-сервером> ‑ Веб-узлы ‑ Веб-узел по умолчанию). В контекстном меню необходимо выбрать пункт Создать ‑ Виртуальный каталог ….

Рис. 764. Задание имени виртуального каталога

Имя, указанное в поле Псевдоним, будет использоваться при формирования URL доступа с хранилищу. Затем необходимо указать путь к папке, содержащей файлы создаваемого каталога.

Рис. 765. Указание каталога

На следующем шаге необходимо указать, какие действия необходимо разрешить при работе с

Рис. 766. Установка разрешений

На следующем шаге мастера необходимо нажать кнопку Готово. На этом создание виртуального каталога завершено. Следующим шагом необходимо настроить созданный каталог и зарегистрировать для него расширение веб-сервера. Для этого надо открыть свойства созданного виртуального каталога и в открывшемся диалоге нажать кнопку Настройка.

Рис. 767. Регистрация расширения веб-сервера

37.4.4.2.2. Для IIS версий 7.0 и последующих

расположенная в каталоге bin конкретной версии «1С:Предприятия».

СОВЕТ. Для регистрации расширения веб-сервера используйте или короткий путь («формат 8.3») или устанавливайте «1С:Предприятие» в каталог, не содержащий пробелов и имен каталогов, длиннее 8 символов.

В качестве расширения (поле Расширение: в диалоге на рис.767) можно указать как конкретное расширение (.1ccr), так и маску всех файлов (*).

Последним шагом необходимо перезапустить веб-сервер.

Необходимо создать виртуальное приложение. Для этого необходимо использовать мастер создания виртуального приложения из контекстного меню пункта Default Web Site (<Имя компьютера с веб-сервером> ‑ сайты ‑ Default Web Site). В контекстном меню необходимо выбрать пункт Добавить приложение ….

Рис. 768. Создание виртуального приложения

Имя, указанное в поле Псевдоним, будет использоваться при формировании URL доступа с хранилищу.

Затем необходимо добавить обработчик для файлов .1ccr. Для этого необходимо выбрать команду <Имя компьютера с веб-сервером> ‑ сайты ‑ Default Web Site ‑ storage ‑ Сопоставления обработчиков ‑ Добавить сопоставление сценария ….

37.4.4.3. Для веб-сервера Apache

Копировать в буфер обмена LoadModule _1cws_module "C:\Program Files\1cv8\8.3.1.100\bin\wsap22.dll"

Рис. 769. Добавление обработчика

В качестве расширения веб-сервера IIS выступает динамическая библиотека wsisapi.dll, расположенная в каталоге bin конкретной версии «1С:Предприятия».

В качестве расширения (поле Путь запроса: в диалоге на рис.769) можно указать как конкретное расширение (*.1ccr), так и маску всех файлов (*).

Последним шагом необходимо перезапустить веб-сервер.

Для того чтобы выполнить настройку веб-сервера Apache на работу с хранилищем конфигурации, необходимо выполнить следующие действия:

•

Включить в конфигурационный файл веб-сервера (httpd.conf) загрузку модуля расширения веб-сервера. В зависимости от версии веб-сервера и используемой операционной системы, модули расширения имеют разное имя:

•

Для ОС Windows:

•

Для Apache 2.0: wsapch2.dll.

•

Для Apache 2.2: wsap22.dll.

•

Для ОС Linux:

•

Для Apache 2.0: wsapch2.so.

•

Для Apache 2.2: wsap22.so.

Модуль расширения веб-сервера имеет идентификатор _1cws_module. Для загрузки модуля необходимо внести в конфигурационный файл следующую строку вида LoadModule _1cws_module <путь к модулю расширения веб-сервера>.

Пример для ОС Windows:

Пример для ОС Linux:

LoadModule _1cws_module /opt/1C/v8.2/i386/wsap22.so

Копировать в буфер обмена Alias "/repos" "C:\www\repos\" <Directory "C:\www\repos\"> AllowOverride None Options None Order allow,deny Allow from all SetHandler 1c-application </Directory>

Копировать в буфер обмена Alias "/repos" "/var/1C/www/repos" <Directory "/var/1C/www/repos"> AllowOverride None Options None Order allow,deny Allow from all SetHandler 1c-application </Directory>

Копировать в буфер обмена <?xml version="1.0" encoding="UTF-8"?> <repository connectString="tcp://192.168.0.12"/>

37.4.4.4. Настройка веб-сервера для работы с несколькими разными версиями хранилища конфигурации

•

Создать на веб-сервере виртуальный каталог, через который будет осуществляться доступ к хранилищу конфигурации и зарегистрировать обработчик файлов для каталога виртуального приложения. Идентификатор регистрируемого обработчика: 1c-application.

Пример виртуального каталога для ОС Windows:

Пример виртуального каталога для ОС Linux:

•

Разместить в папке с файлами виртуального каталога файл *.1ccr, в котором указать адрес сервера хранилища конфигурации (в схеме TCP).

Пример файла .1ccr:

•

Перезапустить веб-сервер.

Допускается использовать хранилища конфигурации, которые обслуживаются разными версиями системы «1С:Предприятие». Для организации такой работы следует выполнить следующие действия:

•

Создать новый экземпляр сервера хранилища конфигурации, который работает на порту с уникальным номером. Уникальность порта должна соблюдаться для компьютера, на котором работает сервер хранилища.

•

Каждый сервер хранилища должен быть опубликован в своем виртуальном приложении (включая корректно сформированный 1ccr-файл).

С точки зрения веб-серверов, одновременная работа с разными версиями системы «1С:Предприятие» требует специфических настроек:

•

Для веб-сервера IIS: требуется создание пула приложений для каждой уникальной версии сервера хранилища.

•

Для веб-сервера Apache: требуется создание экземпляра веб-сервера для каждой уникальной версии сервера хранилища.

Под «уникальной версией» понимается полный номер версии «1С:Предприятия» (4 значения, разделенные символом «.»). Что необходимо сделать для создания нового пула приложений или экземпляра веб-севера, необходимо узнать в документации к используемому веб-серверу.

37.4.5. Запуск сервера хранилища

37.4.5.1. Для ОС Windows

Копировать в буфер обмена crserver.exe -instsrvc | -rmsrvc -usr <пользователь> -pwd <пароль> -start | -stop -port <порт> -d <каталог>

37.4.5.2. Для ОС Linux

Копировать в буфер обмена ./crserver -daemon -port <порт> -d <каталог>

по умолчанию. Для веб-сервера IIS следует выполнять настройку для пула прилоджений с требуемой версии сервера хранилища, а для веб-севера Apache ‑ для экземпляра веб-сервера с требуемой версией сервера хранилища конфигурации.

В операционной системе Windows сервер хранилища конфигурации может быть запущен как приложение или установлен как сервис.

В операционной системе Linux сервер хранилища конфигурации может быть запущен как процесс или как демон.

Запуск сервера хранилища выполняется из командной строки:

В случае установки в качестве сервиса сервер хранилища имеет имя 1C:Enterprise 8 Configuration Repository Server.

ВНИМАНИЕ! Название и значение команды должны разделяться символом пробел.

Команда Описание

-d Корневой каталог для хранилищ конфигурации. По умолчанию используется каталог %LOCALAPPDATA%\1C\1Cv8\.

-instsrvc Регистрация сервера хранилища как сервиса.

-port Рабочий порт сервера хранилища. По умолчанию используется порт 1542.

-pwd Пароль пользователя, от имени которого будет зарегистрирован сервис.

-rmsrvc Удаление регистрации сервера хранилища как сервиса.

-start Запуск сервиса сервера хранилища.

-stop Остановка сервиса сервера хранилища.

-usr Имя пользователя, от имени которого будет зарегистрирован сервис. Этот пользователь должен обладать правом Вход в систему как сервис (Log on as a service). Кроме этого, он должен обладать правами на чтение каталога исполняемых файлов соответствующей версии системы «1С:Предприятие» и полными правами на корневой каталог хранилища конфигурации (каталог %LOCALAPPDATA%\1C\1Cv8\ или тот каталог, который указан в параметре ‑d).

Запуск сервера хранилища выполняется из командной строки:

ВНИМАНИЕ! Название и значение команды должны разделяться символом пробел.

Команда Описание

-d Корневой каталог для хранилищ конфигурации. По умолчанию используется каталог /home/usr1cv8/.1cv8 или ~/.1cv8.

При работе с сервером хранилища может возникать ошибка вида <ПолноеИмяФайла> too many open files. В этом случае необходимо увеличить максимальное количество

37.4.6. Подключение к серверу хранилища конфигурации

Копировать в буфер обмена tcp://<имя сервера хранилища>/<относительный путь к хранилищу>

Копировать в буфер обмена <адрес файла описания>/<относительный путь к хранилищу>

Копировать в буфер обмена tcp://RepServ/MyConfRep

Копировать в буфер обмена http://www.MyCompany.ru/VirtualFolder/storage.1ccr/MyConfRep

37.4.7. Создание хранилища конфигурации

Команда Описание (необходимы привилегии суперпользователя (root)). Для пользователя, от имени которого запускается сервер хранилища, следует изменить значение параметр nofile. Значение подбирается опытным путем и зависит от размера конфигурации и количества пользователей, работающих с хранилищем. Рекомендуется в качестве начального значения использовать значение 10 0000. Если ошибка продолжает появляться, значит значение параметра nofile следует еще увеличить.

-daemon Запуск сервера как демона.

-port Рабочий порт сервера хранилища. По умолчанию используется порт 1542.

Подключение клиента к хранилищу конфигурации при удаленной работе осуществляется так же, как и при работе с хранилищем, расположенным на общем сетевом ресурсе. Отличие заключается лишь в способе указания каталога хранилища. В зависимости от используемого протокола каталог хранилища может быть указан двумя способами.

Для протокола TCP:

Для протокола HTTP:

Например:

Или:

•

RepServ ‑ имя сервера хранилища конфигурации;

•

http://www.MyCompany.ru ‑ адрес веб-сервера, на котором опубликован файл описания Web-сервиса;

•

http://www.MyCompany.ru/VirtualFolder/storage.1ccr ‑ полный адрес файла описания см. в схеме HTTP;

•

MyConfRep ‑ относительный путь к хранилищу конфигурации.

Относительный путь указывается от каталога по умолчанию (%APPDATA%\1C\1Cv8\), если каталог не был задан в явном виде, или от каталога, указанного в параметре ‑d при запуске сервера хранилища. Если относительный путь к хранилищу не указан, будет выполнено подключение к хранилищу по умолчанию (каталог maincr).

При работе с сервером хранилища конфигурации, версии сервера хранилища и Конфигуратора должны совпадать. В случае несовпадения версий Конфигуратора и сервера хранилища конфигураций работа с хранилищем невозможна.

При первом запуске сервера хранилища конфигурации на компьютере будет создан каталог по умолчанию для размещения хранилища конфигурации. Такой каталог имеет имя maincr. Если при запуске сервера не был указан ключ ‑d, то хранилище конфигурации по умолчанию будет располагаться в каталоге %APPDATA%\1C\1Cv8\maincr.

Для создания нового хранилища конфигурации следует из клиентского приложения в режиме

37.4.8. Особенности удаленной работы с хранилищем конфигурации

37.5. Рекомендации по использованию хранилища

Чтобы обеспечить максимальную производительность, рекомендуется размещать корневой каталог хранилища конфигурации на компьютере сервера хранилища конфигурации. Система «1С:Предприятие» поддерживает размещение каталогов хранилища на сетевых ресурсах, доступных серверу хранилища, однако такой вариант работы может приводить к снижению производительности.

При удаленной работе с хранилищем конфигурации не выполняется автоматическое обновление состояния объектов в хранилище. Для обновления информации об объектах, размещенных в хранилище, следует выполнить команду Действия ‑ Обновить статусы.

Активные пользователи, работающие с хранилищем конфигурации удаленно, не выделяются жирным шрифтом в списке пользователей хранилища.

Для обеспечения группы разработчиков информацией о внесенных изменениях каждый разработчик одновременно с помещением в хранилище измененных объектов конфигурации составляет описание внесенных изменений.

Чтобы описать изменения, нужно сформировать текстовый отчет о сравнении рабочей конфигурации с конфигурацией хранилища (только по помещаемым в хранилище объектам конфигурации) и поместить его в доступное место.

Администратор хранилища периодически (период определяется интенсивностью работы) должен производить архивирование хранилища и отчетов об изменениях, внесенных разработчиками.

Не рекомендуется выполнять групповые операции с хранилищем (получение объектов, помещение объектов и т. д.), а также выполнять снятие конфигурации с поддержки при открытом окне сравнения конфигураций.