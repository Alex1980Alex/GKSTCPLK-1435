Глава 19. Механизм заданий

19.1. Общая информация

Механизм заданий предназначен для выполнения какой-либо прикладной функциональности по расписанию или асинхронно.

Механизм заданий решает следующие задачи:

•

возможность определения регламентных процедур на этапе конфигурирования системы;

•

выполнение заданных действий по расписанию;

•

выполнение вызова заданной процедуры или функции асинхронно, т. е. без ожидания ее завершения;

•

отслеживание хода выполнения определенного задания и получение его статуса завершения (значения, указывающего успешность или неуспешность его выполнения);

•

получение списка текущих заданий;

•

возможность ожидания завершения одного или нескольких заданий;

•

управление заданиями (возможность отмены, блокировка выполнения и др.).

Механизм заданий состоит из следующих компонентов:

•

фоновых заданий,

•

метаданных регламентных заданий,

•

регламентных заданий,

•

планировщика заданий.

Фоновые задания предназначены для выполнения прикладных задач асинхронно, реализуются средствами встроенного языка.

Регламентные задания предназначены для выполнения прикладных задач по расписанию. Регламентные задания хранятся в информационной базе и создаются на основе метаданных, определяемых в конфигурации. Метаданные регламентного задания содержат такую информацию, как наименование, метод, использование и т. д. Фактическое выполнение регламентного задания осуществляется с помощью фонового задания, которое запускается планировщиком заданий.

Регламентное задание имеет расписание, которое определяет, в какие моменты времени нужно выполнять связанный с регламентным заданием метод. Расписание, как правило, задается в информационной базе, но может быть задано и на этапе конфигурирования (например, для предопределенных регламентных заданий).

Планировщик заданий используется для планирования выполнения регламентных заданий. Для каждого регламентного задания планировщик периодически проверяет, соответствует ли текущая дата и время расписанию регламентного задания. Если соответствует, планировщик назначает такое задание на выполнение. Для этого по данному регламентному заданию планировщик создает фоновое задание, которое и выполняет реальную обработку.

Механизм заданий позволяет реализовать ситуацию, когда в один момент времени гарантированно выполняется одно фоновое задание. Для обеспечения этой возможности предназначен ключ фонового или регламентного задания. В качестве ключа может выступать любое прикладное значение. Уникальность работающих фоновых заданий выполняется отдельно для фоновых заданий, которые запускаются из встроенного языка («самостоятельные» фоновые задания) и отдельно ‑ для фоновых заданий, которые запускаются посредством регламентных заданий («регламентные» фоновые задания). Для «самостоятельных» фоновых заданий ключ обеспечивает исполнение в единицу времени только одного задания с указанным значением ключа и конкретным именем метода фонового задания (имя метода состоит из имени модуля и имени процедуры или функции).

19.2. Фоновые задания

19.2.1. Общая информация

одного фонового задания, которое порождено определенным регламентным заданием и для которого указано определенное значение ключа.

Таким образом, ключ позволяет группировать выполняющиеся фоновые задания, по определенному прикладному признаку с тем, чтобы в рамках одной группы (отдельно для «самостоятельных» и «регламентных» фоновых заданий) выполнялось не более одного фонового задания.

Фоновые задания удобно использовать для выполнения сложных вычислений, когда результат вычисления может быть получен через продолжительное время. Механизм заданий имеет средства для выполнения таких вычислений асинхронно.

С фоновым заданием связан метод, который вызывается при выполнении фонового задания. В качестве метода фонового задания может выступать любая процедура или функция не глобального общего модуля, которую можно вызвать на сервере. Параметрами фонового задания могут быть любые значения, которые разрешено передавать на сервер. Параметры фонового задания должны в точности соответствовать параметрам той процедуры или функции, которую оно вызывает. Параметры фонового задания, в сериализованном виде, не могут превышать размер в 1 Гбайт. Если размер сериализованных параметров фонового задания превышает значение 1 Гбайт ‑ формируется исключение. Если методом фонового задания является функция, то ее возвращаемое значение игнорируется.

Создание и управление фоновыми заданиями выполняются программно из любого соединения. Создавать фоновое задание разрешено любому пользователю. При этом оно выполняется от имени того пользователя, который его создал. Получать задания, а также ожидать их завершения разрешено из любого соединения пользователю с административными правами либо пользователю, который создал эти фоновые задания.

Фоновое задание является чисто сеансовым объектом, но не принадлежит какому-либо пользовательскому сеансу. Для каждого задания создается специальный системный сеанс, выполняющийся от имени того пользователя, который выполнил вызов. Фоновые задания не имеют сохраняемого состояния.

Фоновое задание может порождать другие фоновые задания. В клиент-серверном варианте это позволяет распараллеливать сложные вычисления по рабочим процессам кластера, что может значительно ускорить процесс вычисления в целом. Распараллеливание реализуется порождением нескольких дочерних фоновых заданий с ожиданием завершения каждого из них в основном фоновом задании.

Фоновое задание имеет возможность помещать данные во временное хранилище вызывающего сеанса (см. здесь). Это может быть использовано, например, для передачи в вызывающий сеанс сформированного отчета или подготовленных для обработки данных. Передача данных из вызывающего сеанса в сеанс фонового задания невозможна.

Запуск фонового задания выполняется следующим образом:

•

Выполняются служебные действия:

•

Фиксируется факт запуска фонового задания в журнале регистрации (см. здесь);

•

Устанавливаются параметры соединения с внешними источниками данных (см. здесь);

•

Устанавливается режим интерфейса и т. д.

•

В модуле сеанса выполняется обработчик события УстановкаПараметровСеанса (см. здесь);

•

Выполняется собственно фоновое задание.

Завершившиеся успешно или аварийно фоновые задания хранятся в течение суток, а потом удаляются. История выполнения фоновых и регламентных заданий имеет следующие особенности:

19.2.2. Работа с фоновыми заданиями из встроенного языка

Копировать в буфер обмена Функция ВыгрузитьДанные(ОписаниеДанных, ПутьКФайлу) Экспорт // здесь выполняется собственно выгрузка данных КонецФункции

Копировать в буфер обмена ПараметрыВызова = Новый Массив; ПараметрыВызова.Добавить(ВыгружаемыеДанные); ПараметрыВызова.Добавить("c:\temp\data.dat"); ЗаданиеВыгрузки = ФоновыеЗадания.Выполнить("ОбщийМодульФоновые.ВыгрузитьДанные", ПараметрыВызова, "ВыгрузкаДанных", "Выгрузка данных в файл на диске");

•

Фоновых заданий ‑ не более 1 000 заданий.

•

Регламентных заданий ‑ не более 1 000 заданий. При этом система пытается хранить не менее 3 последних запусков для каждого различного регламентного задания. При превышении общего ограничения в 1 000 запусков, система будет пытаться обеспечить хранение 2 последних запусков для каждого регламентного задания, а потом 1.

•

Системных фоновых заданий ‑ не более 1 000 запусков. В данном разделе речь идет о фоновых заданиях, которые инициируются системой для выполнения каких-либо действий (выполнение отчетов, поиск и т. д.).

ПРИМЕЧАНИЕ. Примеры, приведенные в данном разделе, не являются законченными. Они предназначены только для демонстрации способов работы с фоновыми заданиями.

Управление фоновыми заданиями выполняется с помощью менеджера фоновых заданий (ФоновыеЗадания). С помощью менеджера фоновых заданий предоставляется возможность:

•

Выполнить фоновое задание с передачей параметров (метод ФоновыеЗадания.Выполнить()). После запуска фонового задания возвращается объект, описывающий запущенное фоновое задание (ФоновоеЗадание).

•

Получить список фоновых заданий, соответствующих некоторому отбору (метод ФоновыеЗадания.ПолучитьФоновыеЗадания()) или найти фоновое задание по уникальному идентификатору фонового задания (ФоновыеЗадания.НайтиПоУникальномуИдентификатору()).

•

Ожидать завершение одного (ФоновоеЗадание.ОжидатьЗавершенияВыполнения()) или нескольких (метод ФоновыеЗадания.ОжидатьЗавершенияВыполнения()) ранее запущенных фоновых заданий с указанием времени ожидания.

Более подробно рассмотрим все этапы.

Для запуска фонового задания необходима экспортируемая процедура или функция, описанная в не глобальном общем модуле, который доступен на сервере. Параметры вызываемого метода необходимо перечислить в специальном массиве параметров. При этом порядок следования параметров в методе должен в точности соответствовать порядку элементов массива: самый левый параметр соответствует элементу массива с индексом 0. Все значения параметров фонового задания должны поддерживать сериализацию. Затем передается ключ и описание запускаемого фонового задания. Ключ используется для обеспечения уникальности запускаемого фонового задания.

В качестве фонового задания будет использоваться экспортный метод общего модуля с именем ВыгрузитьДанные(), расположенный в серверном общем модуле ОбщийМодульФоновые:

Для запуска фонового задания необходимо выполнить следующее:

В качестве параметра ОписаниеДанных будет передано значение переменной ВыгружаемыеДанные, в качестве значения параметра ПутьКФайлу будет передана строка c:\temp\data.dat. Для запускаемого фонового задания будет установлен ключ уникальности ВыгрузкаДанных и некоторое описание.

Копировать в буфер обмена ЗаданиеВыгрузки = ФоновыеЗадания.НайтиПоУникальномуИдентификатору(Идентификатор);

Копировать в буфер обмена Пока Истина Цикл ЗаданиеВыгрузки = ЗаданиеВыгрузки.ОжидатьЗавершенияВыполнения(10); Если ЗаданиеВыгрузки.Состояние = СостояниеФоновогоЗадания.Активно Тогда // продолжаем ждать завершения Продолжить; Иначе // фоновое задание завершено Прервать; КонецЕсли; КонецЦикла;

19.2.3. Фоновое задание и расширения

значения метода ФоновыеЗадания.Выполнить() будет получен объект, описывающий запущенное фоновое задание (типа ФоновоеЗадание). Этот объект будет помещен в переменную ЗаданиеВыгрузки.

С помощью описания фонового задания можно получить идентификатор фонового задания, который используется для поиска фонового задания (свойство УникальныйИдентификатор объекта ФоновоеЗадание). При проверке состояния фонового задания (с помощью свойства фонового задания Состояние) следует помнить, что это состояние фиксируется на момент создания объекта ФоновоеЗадание и в дальнейшем не обновляется. Для проверки состояния необходимо перед каждой проверкой получать описание для проверяемого фонового задания:

При необходимости, работу конкретного экземпляра фонового задания можно прервать с помощью метода ФоновоеЗадание.Отменить(). При этом следует помнить, что после прерывания фонового задания необходимо реализовать «сборку мусора». Например, удалить временные файлы, которые могло порождать прерываемое фоновое задание.

После запуска фонового задания может потребоваться периодически проверять статус выполнения задания. Для этого предназначен метод ФоновоеЗадание.ОжидатьЗавершенияВыполнения(). В качестве параметра метода передается время, в течение которого ожидается изменение состояния фонового задания. В любом случае, не позднее, чем указанный таймаут, метод завершает свою работу и формирует объект ФоновоеЗадание, который описывает текущее состояние фонового задания (включая свойство Состояние).

Таким образом, ожидание завершения работы фонового задания можно выполнить следующим образом:

В примере таймаут установлен в 10 секунд (параметр метода ОжидатьЗавершенияВыполнения()). Если за 10 секунд фоновое задание не завершило свою работу ‑ цикл ожидания завершения будет продолжен. Если фоновое задание перестало выполняться (перестало быть активным), то конкретная причина завершения будет понятна по анализу свойства ФоновоеЗадание.Состояние.

Следует отметить, что ожидать завершения работы можно не только для одного фонового задания. У менеджера фоновых заданий существует аналогичный метод (ФоновыеЗадания.ОжидатьЗавершенияВыполнения()). Разница заключается в том, что в качестве параметра метода передается массив объектов ФоновоеЗадание, завершение которых необходимо отслеживать.

Фоновое задание в процессе своей работы может формировать сообщения пользователю (с помощью объекта СообщениеПользователю). Эти сообщения могут быть получены с помощью метода ФоновоеЗадание.ПолучитьСообщенияПользователю(). Сообщения можно получать как во время работы фонового задания, так и после завершения работы задания.

При старте фонового задания в сеансе фонового задания будут подключены те расширения, которые были подключены в родительском сеансе. В то же время имеется возможность запустить фоновое задание таким образом, чтобы в сеансе фонового задания были подключены все расширения, зарегистрированные для текущей информационной базы и текущего набора разделителей. Для этого следует использовать метод

19.3. Регламентные задания

конфигурации. Для этого следует использовать метод РасширенияКонфигурации.ВыполнитьФоновоеЗаданиеБезРасширений().

Регламентные задания используются, когда необходимо выполнить определенные периодические или однократные действия в соответствии с расписанием.

Регламентные задания хранятся в информационной базе и создаются на основе метаданных регламентного задания, определенных в конфигурации. Метаданные задают такие параметры регламентного задания, как вызываемый метод, наименование, ключ, возможность использования, признак предопределенности и др. При создании регламентного задания дополнительно можно указать расписание (может быть указано в метаданных), значения параметров метода, имя пользователя, от имени которого должно выполняться регламентное задание, и др.

Создание и управление регламентными заданиями выполняется с помощью встроенного языка из любого соединения и разрешены только пользователям, имеющим административные права.

ПРИМЕЧАНИЕ. При работе в файловом варианте создавать и редактировать регламентные задания возможно без запуска планировщика заданий.

С регламентным заданием связан метод, который вызывается при выполнении регламентного задания. В качестве метода регламентного задания может выступать любая процедура или функция неглобального общего модуля, которую можно вызвать на сервере. Параметрами регламентного задания могут быть любые значения, которые разрешено передавать на сервер. Параметры регламентного задания должны в точности соответствовать параметрам той процедуры или функции, которую оно вызывает. Если методом регламентного задания является функция, то ее возвращаемое значение игнорируется.

При конфигурировании можно определить предопределенные регламентные задания. Предопределенные регламентные задания ничем не отличаются от обычных регламентных заданий, за исключением того, что их нельзя явно создавать и удалять. Если в метаданных регламентного задания установлен признак предопределенного регламентного задания, то при обновлении конфигурации в информационной базе автоматически будет создано предопределенное регламентное задание. Если признак предопределенности снят, то при обновлении конфигурации в информационной базе автоматически будет удалено предопределенное регламентное задание. Начальные значения свойств предопределенного регламентного задания (например, расписание) устанавливаются в метаданных. В дальнейшем при работе приложения их можно менять через соответствующие методы встроенного языка. Изменение свойств уже созданного предопределенного регламентного задания в метаданных не окажет влияния на реальные параметры этого задания в информационной базе. Предопределенные регламентные задания не имеют параметров.

Расписание регламентного задания определяет, в какие моменты времени регламентное задание должно быть запущено. Расписание позволяет:

•

задавать дату и время начала и окончания выполнения задания;

•

период выполнения;

•

дни недели и месяцы, по которым нужно выполнять регламентное задание и др. (см. описание встроенного языка).

Примеры расписаний регламентных заданий:

Расписание Значения параметров

Каждый час, только один день ПериодПовтораДней = 0

ПериодПовтораВТечениеДня = 3600

Каждый день один раз в день ПериодПовтораДней = 1

ПериодПовтораВТечениеДня = 0

Расписание Значения параметров

Через день один раз в день ПериодПовтораДней = 2

Каждый час с 01.00 до 07.00 каждый день ПериодПовтораДней = 1

ПериодПовтораВТечениеДня = 3600

ВремяНачала = 01.00

ВремяКонца = 07.00

Каждую субботу и воскресенье в 09.00 ПериодПовтораДней = 1

ДниНедели = 6, 7

ВремяНачала = 09.00

Каждый день одну неделю, неделя пропуска ПериодПовтораДней = 1

ПериодНедель = 2

В 01.00 один раз ВремяНачала = 01.00

Последнее число каждого месяца в 9.00 ПериодПовтораДней = 1

ДеньВМесяце = ‑1

ВремяНачала = 09.00

Пятое число каждого месяца в 9.00 ПериодПовтораДней = 1

ДеньВМесяце = 5

ВремяНачала = 09.00

Вторая среда каждого месяца в 9.00 ПериодПовтораДней = 1

ДеньНеделиВМесяце = 2

ДниНедели = 3

ВремяНачала = 09.00

Можно проверять, выполняется ли задание для заданной даты (метод ТребуетсяВыполнение() объекта РасписаниеРегламентныхЗаданий). Регламентные задания всегда выполняются от имени определенного пользователя. Если пользователь регламентного задания не указан, то выполнение происходит с правами, которые определяются набором ролей, указанных в свойстве конфигурации ОсновныеРоли. В том случае, если в этом свойстве не указано ни одной роли, выполнение происходит без ограничения прав доступа.

Выполнение регламентных заданий происходит с использованием фоновых заданий. Когда планировщик определяет, что регламентное задание должно быть запущено, то автоматически на основе данного регламентного задания создается фоновое задание, которое и выполняет всю дальнейшую обработку. Если данное регламентное задание уже выполняется, то оно не будет запущено повторно, вне зависимости от его расписания.

Регламентные задания имеют возможность перезапуска. Это особенно актуально, когда метод регламентного задания должен быть гарантированно выполнен. Перезапуск регламентного задания осуществляется в том случае, когда оно завершено аварийно, либо когда рабочий процесс (в клиент-серверном варианте) или клиентский процесс (в файловом варианте), на котором выполнялось регламентное задание, завершен аварийно. В регламентном задании можно указать, сколько раз нужно его перезапускать (свойство Количество повторов при аварийном завершении), а также интервал между перезапусками (свойство Интервал повтора при аварийном завершении). После выполнения заданного количества перезапусков, попытки запуска прекращаются до момента, когда наступит очередное время старта регламентного задания (в соответствии с

19.4. Особенности выполнения фоновых заданий в разных окружениях

19.4.1. Файловый вариант

регламентного задания, процесс перезапуска начинается сначала.

При реализации метода перезапускаемого регламентного задания нужно учитывать, что при перезапуске его выполнение будет начато с начала, а не продолжено с момента аварийного завершения.

Механизмы выполнения фоновых заданий имеет различия, которые зависят от того, где исполняется фоновое задание.

Фоновые и регламентные задания выполняются клиентскими приложениями или расширением веб-сервера. Фоновые задания выполняются на том клиентском приложении, которое инициировало запуск фонового задания. Фоновые задания исполняются последовательно, т. е. на одном клиентском приложении не может одновременно выполняться два фоновых задания. В случае работы через веб-сервер, для каждой информационной базы, доступ к которой осуществляется через этот веб-сервер, организовано последовательное выполнение фоновых и регламентных заданий.

Поведение фоновых и регламентных заданий в файловом варианте имеет следующие особенности:

•

Информация о фоновых заданиях, вызванных с помощью методов языка или выполняющих отчеты, доступна только в том клиентском приложении (или расширении веб-сервера), которое выполняло эти задания. Из этой особенности следует, что контроль уникальности ключа действует на каждом клиенте отдельно, независимо от других клиентов. Информация о выполненных фоновых заданиях не сохра-няется после завершения работы клиентского приложения (или рас-ширения веб-сервера).

•

Информация о фоновых заданиях, инициированных регламентными заданиями, доступна на всех клиентских приложениях и сохраняется между запусками.

•

Регламентные задания выполняются только одним клиентским приложением. Имеется возможность запретить запуск регламентных заданий определенным клиентским приложением или указать, что какое-либо клиентское приложение принудительно назначается исполнителем регламентных заданий. Такое управление осуществляется с помощью:

•

Параметра командной строки /AllowExecuteScheduledJobs для толстого и тонкого клиентских приложений.

•

Атрибута allowexecutescheduledjobs элемента point файла публикации default.vrd (см. здесь) в случае публикации информационной базы на веб-сервере.

•

Регламентные задания выполняются первым, по порядку запуска, клиентским приложением, у которого не указан запрет выполнения регламентных заданий. После завершения сеанса этого клиентского приложения, выполнение переходит к какому-либо из оставшихся запущенными клиентских приложений. Если запускается клиентское приложение с явным указанием на необходимость исполнения регламентных заданий, то регламентные задания начинают выполняться этим клиентским приложением, независимо от наличия других клиентских приложений (включая расширения веб-сервера).

•

Регламентные задания выполняются расширением веб-сервера до тех пор, пока расширение веб-сервера обслуживает хотя бы один клиентский сеанс.

•

Если расписание регламентного задания настроено так, что в это время не работает ни одно клиентское приложение ‑ такое фоновое задание никогда не будет выполнено.

•

Регламентные задания обрабатываются один раз в 60 секунд.

•

Инициализация планировщика фоновых заданий выполняется через 60 секунд после старта клиентского приложения или после попытки запустить первое фоновое задание. До момента запуска планировщика фоновых заданий в синхронном режиме выполняются следующие

19.4.2. Клиент-серверный вариант

19.4.3. Мобильное приложение

19.5. Создание метаданных регламентного задания

глобальный поиск.

•

Инициализация механизма планировщика регламентных заданий выполняется через 60 секунд после запуска механизма планировщика фоновых заданий. Следовательно, регламентные задания прикладного решения начинают выполняться максимум через 120 секунд после запуска клиентского приложения.

•

Выполняется принудительное завершение фоновых заданий, которые не завершились в течение 30 секунд после завершения работы клиентского приложения. В журнале регистрации в этом случае фиксируется событие Фоновое задание. Принудительное завершение (_$Job$_.Terminate).

•

Не поддерживается работа регламентных заданий в файловом варианте информационной базы в сеансе, который получен с использованием automation-сервера «1С:Предприятия» или COM-соединения. Если в таком сеансе создаются фоновые задания, они размещаются в очередь, но запуск таких заданий выполнен не будет.

В клиент-серверном варианте для выполнения фоновых заданий используется планировщик заданий, который физически находится в менеджере кластера. Планировщик получает наименее загруженный рабочий процесс для всех поставленных в очередь на выполнение фоновых заданий и использует его для выполнения соответствующего фонового задания. Рабочий процесс выполняет задание и уведомляет планировщик о результатах выполнения.

В клиент-серверном варианте имеется возможность блокирования выполнения регламентных заданий. Блокирование выполнения регламентных заданий происходит в следующих случаях:

•

На информационную базу установлена явная блокировка регламентных заданий. Блокировка может быть установлена через консоль кластера.

•

На информационную базу установлена блокировка начала сеансов. Блокировка может быть установлена через консоль кластера.

•

Из встроенного языка вызван метод УстановитьМонопольныйРежим() с параметром Истина.

•

В некоторых других случаях (например, при обновлении конфигурации базы данных).

Фоновые задания выполняются мобильным приложением. Фоновые задания исполняются последовательно, т. е. в один момент времени на мобильном устройстве не может одновременно выполняться два фоновых задания.

Поведение фоновых заданий на мобильном устройстве имеет следующие особенности:

•

На мобильном устройстве не поддерживаются регламентные задания.

•

Инициализация планировщика фоновых заданий выполняется после попытки запустить первое фоновое задание. До момента запуска планировщика фоновых заданий в синхронном режиме выполняются следующие операции: поиск в динамическом списке, построение отчетов, поиск для ввода по строке и глобальный поиск.

•

Выполняется принудительное завершение фоновых заданий, которые не завершились в течение 30 секунд после завершения работы клиентского приложения.

Перед тем как создать регламентное задание в информационной базе с помощью встроенного языка, необходимо создать для него объект конфигурации.

Для создания объекта конфигурации регламентного задания в ветке Общие дерева конфигурации для ветки Регламентные задания нужно выполнить команду Добавить.

Ключ ‑ указывается произвольное строковое значение, которое будет использовано в качестве ключа регламентного задания.

Расписание ‑ указывается расписание регламентного задания. Для формирования расписания следует перейти по ссылке Открыть и в открывшейся форме расписания установить нужные значения.

На закладке Общее указывается дата начала и завершения задания и режим повтора.

Рис. 520. Общее расписание

На закладке Дневное указывается дневное расписание задания.

В расписании можно указать:

•

Время начала и окончания запуска задания. За границами этого временного интервала задание автоматически запускаться не будет.

•

Время завершения задания, после которого оно будет принудительно завершено.

•

Период повтора задания.

•

Продолжительность паузы между повторами.

•

Продолжительность выполнения.

Допускается указание произвольного сочетания условий.

На закладке Недельное указывается недельное расписание задания.

Рис. 522. Недельное расписание

Нужно установить флажки по тем дням недели, по которым задание будет выполняться. Если требуется повторять задание, указать интервал повтора в неделях. Например, задание выполняется через 2 недели, значение повтора ‑ 2.

Когда задано недельное расписание и значение свойства Повторять каждые больше 1, то при определении границ недели будет учитываться свойство Первый день недели, заданный в региональных настройках информационной базы (подробнее см. здесь).

На закладке Месячное указывается месячное расписание задания.

Копировать в буфер обмена ФоновыеЗадания.Выполнить("ОбновлениеИндексаПолнотекстовогоПоиска");

Копировать в буфер обмена Расписание = Новый РасписаниеРегламентногоЗадания; Расписание.ПериодПовтораДней = 1; Расписание.ПериодПовтораВТечениеДня = 0;

Рис. 523. Месячное расписание

Нужно установить флажки по тем месяцам, в которых задание будет выполняться. При необходимости можно указать конкретный день (месяца или недели) выполнения с начала месяца/ недели или конца.

При записи регламентного задания проверяется возможность запуска задания на выполнение в соответствии с указанным расписанием. Допустим, регламентное задание сохраняется 12.09.2021 в 12:33.

Если сохраняемое регламентное задание имеет расписание «каждый день; с 1:00:00 один раз в день», то оно будет выполнено сразу после записи регламентного задания, а затем будет выполняться каждый день в 1:00, что соответствует заданному расписанию.

Если изменить расписание регламентного задания на следующее «каждый день; с 1:00:00 по 1:01:00 один раз в день», то после записи регламентного задания оно не будет выполнено, т. к. время сохранения находится за границами интервала запуска из расписания. В последующем, регламентное задание будет выполняться в соответствии с расписанием, т. е. в каждый день в 1:00.

Использование ‑ если установлено, то задание будет выполняться согласно расписанию.

Предопределенное ‑ если установлено, то задание является предопределенным.

Количество повторов при аварийном завершении ‑ указывает количество повторов при аварийном завершении.

Интервал повтора при аварийном завершении ‑ указывает интервал повтора при аварийном завершении.

Пример создания фонового задания «Обновление индекса полнотекстового поиска»:

Пример создания регламентного задания «Восстановление последовательностей»:

Задание.Расписание = Расписание; Задание.Записать();