---
description: 
globs: 
alwaysApply: true
---
Глава 2. Работа с конфигурацией

2.1. Общая информация

2.2. Открытие конфигурации

В этой главе будут рассмотрены общие приемы работы с объектами конфигурации, которые применимы к объектам любых типов. Особенности создания и редактирования объектов конфигурации различных типов рассматриваются далее в соответствующих главах Руководства.

В данной главе в основном рассматриваются визуальные средства управления объектами конфигурации, имеющиеся в конфигураторе. Описание встроенного языка представлено в справке по встроенному языку.

С описанием процедур сохранения и восстановления информационной базы данных можно ознакомиться в книге «1С:Предприятие 8.3. Руководство администратора». Описание процедуры резервного копирования:

•

Для файлового варианта см. здесь.

•

Для клиент-серверного варианта см. здесь.

В информационной базе системы «1С:Предприятие» хранятся две конфигурации:

•

основная конфигурация (редактируемая, далее просто конфигурация),

•

конфигурация базы данных.

Конфигурация базы данных определяет структуру таблиц базы данных и всю функциональность, с которой работают пользователи. Основная конфигурация используется только для изменения. Это позволяет вносить и сохранять изменения в конфигурации в процессе работы пользователей. Произвести изменение в конфигурации базы данных в процессе работы пользователей нельзя. О работе с конфигурацией базы данных см. здесь. Все основные команды работы с конфигурацией (как основной, так и конфигурацией базы данных) собраны в меню Конфигурация.

Кроме того, в конфигураторе могут быть открыты окна расширений конфигурации (см. здесь). Внешний вид окна расширения конфигурации практически не отличается от окна редактирования основной конфигурации. Однако, действия, которые пользователь может выполнить с конфигурацией расширения, недоступны из меню Конфигурация (кроме открытия списка расширений (см. здесь) и сохранения конфигурации расширения, см. здесь). Команды, предназначенные для работы с конфигурацией расширения, собраны в меню Действия ‑ Конфигурация окна с расширением конфигурации или в контекстном меню списка расширений (см. здесь).

Если нет отдельной оговорки, все действия, описанные далее, относятся к основной конфигурации, если они выполняются из меню Конфигурация главного меню конфигуратора. Команды, которые доступны при управлении расширениями, относятся к соответствующим расширениям. Отдельно действие таких команд не описывается.

Работа с конфигурацией осуществляется в окне Конфигурация. Для открытия конфигурации нужно выбрать пункт Конфигурация ‑ Открыть конфигурацию. На экран выводится окно Конфигурация.

2.3. Сохранение конфигурации

2.4. Закрытие конфигурации

Рис. 4. Конфигурация

Чтобы увеличить рабочую область для работы с различными объектами, окно Конфигурация можно временно закрыть. Закрытие окна Конфигурация не означает завершения работы с отдельными ее составляющими, открытыми для редактирования: закрывается не конфигурация, а окно конфигурации. Для открытия окна Конфигурация нужно выбрать пункт Конфигурация ‑ Окно конфигурации.

В процессе редактирования конфигурации могут быть созданы новые, изменены существующие или удалены имеющиеся объекты, подчиненные объекты (формы, реквизиты и т. д.). Любое такое изменение приводит к модифицированности конфигурации. Признак модифицированности конфигурации «*» показывается в заголовке окна Конфигурация.

Для сохранения конфигурации (без завершения работы с конфигурацией) нужно выбрать пункт Конфигурация ‑ Сохранить конфигурацию. Пункт доступен, если конфигурация была изменена, в отличие от редакторов текстового, табличного и HTML-документов, для которых пункт доступен всегда.

Сохранение измененной конфигурации возможно в любой момент времени, даже если запущен режим 1С:Предприятие или производится отладка.

Описанное поведение верно также для окна расширения конфигурации (см. здесь).

Для закрытия конфигурации нужно выбрать пункт Конфигурация ‑ Закрыть конфигурацию. При этом если конфигурация была модифицирована (были произведены изменения), то конфигуратор выводит сообщение: Конфигурация 'Синоним конфигурации' была изменена. Сохранить изменения? Для сохранения внесенных изменений выбрать кнопку Да.

Закрытие конфигурации с сохранением произведенных изменений возможно в любой момент времени, даже если запущен режим 1С:Предприятие или производится отладка.

2.5. Сохранение конфигурации в файл

2.6. Загрузка конфигурации из файла

2.7. Дерево объектов конфигурации

Для сохранения конфигурации в файл .cf на диск нужно выбрать пункт Конфигурация ‑ Сохранить конфигурацию в файл. На экран выводится стандартный диалог выбора файла. Следует выбрать каталог и указать имя файла, в который будет записана конфигурация.

Сохраненный файл конфигурации необходим для операции сравнения и объединения конфигураций (см. здесь).

ПРИМЕЧАНИЕ. Если конфигурация стоит на поддержке, то в информационной базе всегда хранится конфигурация поставщика.

Для полной замены текущей конфигурации на конфигурацию, сохраненную в файле .cf, нужно выбрать пункт Конфигурация ‑ Загрузить конфигурацию из файла.

Конфигурация представляется в виде древовидной структуры, каждая ветвь которой описывает определенную составляющую конфигурации. Объекты конфигурации в дереве конфигурации представлены своими именами. Например, в ветви Документы располагаются объекты всех документов, используемых в конфигурации, а ветвь РасходнаяНакладная описывает объект документа Расходная накладная, ветвь Общие ‑ Роли ‑ все роли (права доступа к информации), используемые для различных видов пользователей, а ветвь Менеджер ‑ права доступа менеджера отдела продаж и т. д.

Корневые ветви дерева объединяют объекты конфигурации, логически связанные между собой и имеющие общее назначение.

Например, ветвь Документы объединяет объекты типа Последовательности, Нумераторы и, собственно, объекты конфигурации типа Документ. Все эти объекты предназначены для организации ввода документов в системе «1С:Предприятие».

Для работы в конфигураторе удобно использовать клавиатуру. Перечень сочетаний клавиш, которые могут использоваться в конфигураторе, можно получить во встроенной справке (раздел называется Сочетания клавиш (Конфигуратор)).

Объекты конфигурации в пределах «своей» группы объектов конфигурации можно расставить в требуемом порядке. В таком же порядке объекты конфигурации будут выдаваться в различных списках.

Для перестановки объекта конфигурации необходимо выделить его в окне Конфигурация и использовать пункты меню Действия ‑ Переместить вверх или Действия ‑ Переместить вниз, а также Действия ‑ Упорядочить список.

Для удобства поиска в дереве конфигурации объекта, редактируемого в данный момент (окно редактирования объекта, формы, макеты, модули), следует использовать пункт меню Правка ‑ Найти в дереве. Предварительно нужно сделать активным окно редактирования объекта. После выполнения команды в дереве конфигурации будет выбран объект, данные которого в данный момент редактируются.

Поиск в дереве метаданных можно осуществить несколькими способами:

•

Начать набирать на клавиатуре наименования объекта (при этом поиск будет выполняться только в открытых ветках дерева).

•

Использовать стандартный механизм поиска (для вызова окна поиска необходимо нажать Ctrl + F). В этом случае будет открыто окно Результаты поиска, из которого можно перейти к требуемому объекту метаданных.

•

С помощью специального поля поиска, расположенного между списком объектов и командной панелью окна конфигурации. Переход в это поле и любого места конфигуратора выполняется с помощью сочетания клавиш Ctrl + Alt + M. Поиск начинается после того, как в поле введено более двух непробельных символов. Поиск осуществляется по свойствам объектов

2.8. Настройка сортировки дерева метаданных

набранной подстроке.

При включенном отборе, нажатие клавиши ESC очищает поле ввода и отменяет поиск в том случае, если фокус ввода находится в дереве конфигурации или поле поиска. Клавиша TAB предназначена для перехода между деревом объектов конфигурации и полем поиска.

Если при установленном отборе пользователь добавляет объект, который не соответствует наложенному отбору ‑ система отменяет наложенный отбор и отображает все дерево конфигурации.

Рис. 5. Поиск в дереве конфигурации

Наименования объектов конфигурации, а также подчиненных объектов (реквизитов, табличных частей, форм и т. д.) можно перетаскивать в модули и текстовые документы с помощью мыши стандартным образом.

Данный режим предназначен для сортировки объектов конфигурации. За один раз могут быть отсортированы однотипные объекты конфигурации, подчиненные одному объекту конфигурации.

Рис. 6. Сортировка метаданных

Например, формы конкретного справочника.

•

Сортировать по ‑ выбор свойства, по которому будет выполняться сортировка:

2.9. Создание и удаление объекта конфигурации

2.9.1. Создание объекта конфигурации

•

Комментарию. Сортировка будет выполнена по комментариям объектов конфигурации.

•

Направление сортировки ‑ выбор направления сортировки:

•

По возрастанию. Будет выполняться сортировка в порядке возрастания.

•

По убыванию. Будет выполняться сортировка по убыванию.

Управление большинством объектов конфигурации выполняется в окне Конфигурация. В этом разделе будут изложены общие приемы создания объектов конфигурации, применимые к объектам конфигурации любых типов.

Для создания нового объекта конфигурации необходимо выполнить следующие действия:

•

в дереве конфигурации выделить наименование типа объекта конфигурации или любого из существующих объектов конфигурации того типа, который должен быть у создаваемого объекта;

•

выбрать пункт Действия ‑ Добавить окна Конфигурация.

Создание нового подчиненного объекта можно также производить следующим образом:

•

открыть окно редактирования объекта (выбрать пункт Действия ‑ Изменить окна Конфигурация);

•

указать нужный вид подчиненного объекта;

•

нажать кнопку Добавить.

В результате этих действий на текущей ветви дерева конфигурации появится новый объект, а на экран для редактирования свойств этого объекта будет автоматически вызвана палитра свойств, если палитра еще не была открыта (о работе с палитрой свойств см. здесь). Для объектов, имеющих широкий набор редактируемых свойств, дополнительно к палитре свойств может вызываться окно редактирования (о работе в окне см. здесь).

Новому объекту конфигурации присваивается условное имя, состоящее из слова, соответствующего типу создаваемого объекта, и числа ‑ порядкового номера нового объекта конфигурации. Например, для нового справочника имя будет начинаться со слова «Справочник». Палитра свойств объекта будет содержать значения свойств, задаваемые по умолчанию.

В конфигураторе контролируются имена объектов перед обновлением конфигурации базы данных и перед формированием поставки.

Для объектов, которые могут иметь подчиненные объекты (например, справочник может иметь реквизиты, табличные части, формы и макеты), производится создание нужного числа и состава подчиненных объектов. Их формирование и настройка производятся с использованием различных средств конфигуратора.

Для облегчения создания некоторых составных частей (запросов, макетов и процедур печати, движений регистров, ввода на основании) объектов в конфигураторе имеются различные конструкторы ‑ вспомогательные инструменты, облегчающие процесс проектирования (подробнее см. здесь).

Для тех типов объектов, которые могут иметь формы, в системе имеются конструкторы форм ‑ вспомогательные инструменты, облегчающие разработку форм объектов. Конструктор форм запускается при создании новой формы (о работе с конструктором форм см. здесь).

Для редактирования форм предназначен редактор форм (о работе с ним см. здесь).

Редактирование макетов, которые основаны на табличном документе, производится редактором табличных документов (см. здесь). Для формирования макетов можно использовать

2.9.2. Удаление объекта конфигурации

текстовых документов (см. здесь).

Программы на встроенном языке, располагающиеся в модулях, создаются с использованием текстового редактора (см. здесь).

Для создания нового объекта можно использовать механизм перетаскивания объектов с помощью мыши. При перетаскивании объекта (как в пределах «своей» ветки, так и за ее пределы) создается новый объект. При этом производится проверка возможности использования исходных свойств объекта в результирующем. Если результирующий объект поддерживает свойства, то они копируются. Пример успешного копирования: перенос реквизитов, макетов справочника в документ. При копировании того же справочника в объект типа Стиль успешно перенесутся только имя, синоним и комментарий.

Если исходный объект содержит подчиненные объекты (реквизиты, формы, макеты и др.), то при перетаскивании на «подобный» уровень (например, перетаскивается объект Справочник.Валюты в ветвь Документы) скопируются реквизиты, формы, макеты и табличные части. При этом некоторые свойства составных частей могут быть изменены (например, для документа отсутствует свойство Родитель).

Для удаления объекта конфигурации нужно указать его в дереве конфигурации и выбрать пункт Действия ‑ Удалить окна Конфигурация. Если на объект нет ссылок в других объектах конфигурации, объект удаляется.

Если на объект есть ссылки (объект используется), то выдается сообщение: Объект не может быть удален, так как на него есть ссылки в других объектах! А в окне сообщений выводится список использования данного объекта.

На Рис. 7 приведен пример окна сообщений при попытке удаления документа ПриходТовара.

Рис. 7. Служебные сообщения

Для перехода к объекту, в котором используется ссылка на удаляемый объект, нужно дважды щелкнуть мышью наименование этого объекта в окне сообщений.

В зависимости от настройки При удалении выполнять проверку в модулях (подробнее см. здесь), при удалении объекта конфигурации будет выполняться проверка использования удаляемого объекта в модулях. Если в результате проверки будет обнаружено использование удаляемого объекта в текстах на встроенном языке, то на экран будет выдан список использований и будет запрошено подтверждение удаления объекта.

2.9.3. Ссылки на объект конфигурации

2.10. Палитра свойств

Рис. 8. Проверка использования удаляемого объекта в модулях

С точки зрения взаимосвязи объекты конфигурации делятся на несвязанные (например, реквизит Закупочная цена, имеющий тип Число) и связанные (например, реквизит Единица измерения справочника Номенклатура, ссылающийся на справочник Единицы измерения).

Часто бывает полезно знать, какие объекты конфигурации ссылаются на данный объект, а также выяснить, какие объекты связаны с данным объектом. Для этих целей используются команды Действия ‑ Поиск ссылок на объект и Действия ‑ Поиск ссылок в объекте окна Конфигурация.

На экран выводится диалог (см. Рис. 9).

Рис. 9. Ссылки на объект

В нем нужно указать область поиска (свойства, подчиненные объекты) и нажать кнопку ОК.

Если ссылки есть, то при выполнении команды в окно сообщений выводится список ссылок. Если ссылок нет, то на экран выводится одно из предупреждений:

•

Ссылок на данный объект не существует,

•

Ссылок в объекте не обнаружено.

Команда Действия ‑ Поиск ссылок в объекте выводит перечень всех агрегатных типов, которые использованы в объекте.

Для перехода по ссылке необходимо дважды щелкнуть мышью соответствующую строку с наименованием объекта-ссылки в окне сообщений.

Процесс редактирования объекта конфигурации заключается в изменении свойств объекта, чтобы добиться требуемого поведения объекта в процессе использования.

Палитра свойств ‑ это окно в виде набора свойств, которые можно определить для объекта конфигурации. Состав свойств зависит от типа редактируемого объекта.

Рис. 10. Палитра свойств

В этом разделе описываются основные приемы работы с палитрой свойств.

Для вызова палитры свойств нужно указать объект конфигурации и выбрать пункт Правка ‑ Свойства.

В палитре свойств свойства объекта группируются по категориям. Число категорий и состав свойств, размещенных в каждой категории, зависит от вида рассматриваемого объекта. Например, для реквизита документа палитра свойств содержит только категории свойств Основные, Использование и Представление. Состав свойств категории также зависит от вида объекта. Даже в случае выбора одинаковых видов объектов состав свойств определяется индивидуальными настройками конкретных объектов. Например, для иерархического справочника в состав свойств табличного поля категории Использование дополнительно включаются свойства Отображение, Отображать корень и другие.

Состав свойств также зависит от выбранных значений других свойств. Например, в свойстве Тип при выборе примитивного типа Число добавляются свойства, характеризующие выбранный тип: Длина, Точность и Неотрицательное.

При необходимости быстро найти какое-либо свойство в палитре свойств можно воспользоваться полем поиска. Доступ в это поле выполняется с помощью сочетания клавиш Ctrl + Alt + I. Поиск выполняется по представлению свойств в палитре свойств (см. Рис. 11) и начинается после ввода двух непробельных символов. Для того чтобы отключить наложенный фильтр, необходимо нажать кнопку очистки или клавишу ESC, находясь в поле поиска.

Рис. 11. Поиск в палитре свойств

Панель инструментов палитры свойств состоит из пяти кнопок (см. Рис. 12). С помощью первых трех кнопок производится управление показом свойств.

Рис. 12. Кнопки окна свойств

Далее описываются кнопки панели:

•

Сортировка по алфавиту. Производит вывод свойств объекта, отсортированных по алфавиту (кнопка нажата). Сами категории не показываются. Если включено отображение имен свойств, то сортировка выполняется по имени, в противном случае ‑ по представлению свойства. Если у свойства не задано имя, то сортировка всегда выполняется по представлению свойства. Отображение имен свойств управляется пунктом Отображать имена свойств контекстного меню окна свойств.

категориям (кнопка нажата).

•

Показывать только важные. При нажатой кнопке выводятся только важные свойства объекта; при отжатой ‑ все свойства.

•

Отменить редактирование. Отмена изменений в текстовом поле свойства.

•

Сохранить. Записать изменения в текстовое поле свойства.

Категории свойств можно располагать в виде закладок или списком. При расположении свойств списком сами свойства могут быть представлены в виде списка по категориям или по алфавиту (при этом наименования категорий не показываются).

Для выбора способа показа категорий (должен быть включен показ категорий ‑ кнопка Сортировка по категориям нажата) в любом свободном месте окна палитры свойств нужно открыть контекстное меню и выбрать необходимый способ показа (Закладками или Списком). Если выбран способ показа Закладками, то кнопки (Сортировка по алфавиту и Сортировка по категориям) становятся недоступными.

При выборе способа показа Закладками для перехода к свойствам другой категории необходимо щелкнуть мышью соответствующую закладку.

Для возврата к режиму показа категорий списком в окне свойств контекстного меню нужно выбрать пункт Списком.

Если выбран способ показа Списком, то свойства объекта располагаются по категориям или по алфавиту. Для расположения по алфавиту следует нажать кнопку Сортировка по алфавиту панели инструментов палитры свойств. Все свойства показываются подряд в алфавитном порядке.

Для расположения по категориям нужно нажать кнопку Сортировка по категориям панели инструментов. Все свойства группируются по категориям в виде списка (одна под другой). Наименование категории показывается полужирным шрифтом. Слева от наименования расположена кнопка управления показом свойств, входящих в категорию. Кнопка позволяет скрыть или показать набор свойств.

Двойной щелчок мыши по наименованию категории свойств приводит к сворачиванию всех остальных категорий и показу свойств данной категории.

При нажатой кнопке Показывать только важные производится показ только важных (основных) свойств объекта (независимо от режима показа списком или закладками, по категориям или по алфавиту). Для просмотра всех свойств нужно снова нажать кнопку Показывать только важные.

В зависимости от вида объекта его свойства бывают доступными или недоступными для изменения. Например, в текстовом документе свойства объекта предназначены только для показа числа строк и символов, а также статуса документа, но они недоступны для изменения.

Каждое свойство в палитре свойств имеет наименование, а также развернутое пояснение. Режим получения развернутого описания устанавливается с помощью команды контекстного меню Пояснение, вызываемого в любом свободном месте палитры свойств (вне полей ввода). Если этот режим установлен, то при выборе свойства в нижней части палитры свойств выводится развернутое пояснение. Помимо пояснительного описания может выводиться имя свойства для доступа к значению из программного модуля.

Для свойств, которые могут быть доступны с помощью средств встроенного языка, можно настроить их показ в виде наименования или в виде имен свойств. Например, свойство с наименованием Тип значения имеет имя ТипЗначения. Режим показа можно изменить с помощью команды Отображать имена свойств контекстного меню. Имена свойств показываются в соответствии с выбранным вариантом встроенного языка.

ВНИМАНИЕ! Имена свойств объектов метаданных и объекта метаданных Конфигурация не отображаются.

Способ ввода значений в палитре свойств зависит от типа редактируемого свойства.

2.11. Окно «Дополнительно»

Рис. 13. Возможные действия

Для текстовых реквизитов ‑ это обычный ввод текста (можно использовать буфер обмена), для свойств типа «флажок» ‑ щелчок мышью. Значения некоторых свойств выбираются из списков. Поля таких свойств имеют кнопку списка выбора (см. Рис. 13). Если поле свойства имеет кнопку выбора (см. Рис. 13), то при ее нажатии открывается окно, в котором производится выбор значения свойства (или его просмотр в случае, когда редактирование объекта невозможно, например, для не захваченных в хранилище конфигурации объектов или для объектов, находящихся на поддержке без возможности редактирования). К таким свойствам относится, например, выбор файла картинки, определение цвета и другие.

По кнопке просмотра (см. Рис. 13) для текстовых данных вызывается окно редактирования строки на разных языках, для событий ‑ процедура модуля формы, отрабатывающая данное событие, для свойств из категории Представление ‑ существующая форма объекта данных. По кнопке очистки (см. Рис. 13) производится сброс значения указанного свойства. Кнопка регулирования (см. Рис. 13) позволяет увеличивать или уменьшать числовое значение на 1 в сторону больших или меньших значений.

Кнопки в полях могут комбинироваться.

При начале редактирования любого текстового поля палитры свойств становятся доступными кнопки панели инструментов палитры свойств Отменить редактирование (см. Рис. 12) и Сохранить (см. Рис. 12). Нажатие кнопки отмены отменяет произведенные изменения. Нажатие кнопки сохранения сохраняет изменение.

В палитре свойств могут располагаться ссылки, с помощью которых открываются связанные с выбранным объектом различные формы. Например, вызов справочной информации (описание) объекта конфигурации, различных форм, процедур модуля формы. Такие ссылки изображаются подчеркнутым текстом. Нажатие ссылки открывает окно, связанное с этой ссылкой.

Если просматриваются свойства объекта, редактирование которого запрещено (например, объект не захвачен в хранилище, см. здесь), то допускается открытие диалога редактирования типа в режиме «только просмотр».

Для удобства просмотра и установки основных интерфейсных свойств объекта конфигурации можно использовать окно Дополнительно. Для его открытия нужно выбрать пункт Правка ‑ Дополнительно.

Для просмотра свойств достаточно в окне Конфигурация выбрать требуемый объект. Его свойства будут сразу показаны в окне Дополнительно.

Информация в окне распределена по закладкам.

Для объектов метаданных допустимо включение объекта в те или иные подсистемы независимо от взаимной подчиненности подсистем. Объект может быть отнесен одновременно и к «родительской», и к подчиненной ей подсистемам. Это выполняется на закладке Подсистемы.

Рис. 14. Закладка «Подсистемы»

На закладке Права представлен список ролей и права каждой роли по данному объекту.

Рис. 15. Закладка «Права»

В табличном поле Ограничение доступа к данным редактируются ограничения доступа к данным на уровне отдельных полей и записей (подробнее см. здесь).

На закладке Функциональные опции представлен список функциональных опций, существующих в системе. Можно отметить те функциональные опции, к которым привязан данный объект метаданных.

Рис. 16. Закладка «Функциональные опции»

Закладка Общие реквизиты позволяет указывать, в состав каких общих реквизитов входит текущий объект. Правила редактирования в этом окне одинаковы с правилами редактирования в окне Состав свойства общего реквизита.

Рис. 17. Закладка «Общие реквизиты»

На закладке Планы обмена представлен список планов обмена. В списке отметками указаны те планы обмена, в которых производится учет изменений по данному объекту.

Рис. 18. Закладка «Планы обмена»

На закладке Командный интерфейс можно редактировать видимость стандартных и пользовательских команд выбранного объекта метаданных в разрезе различных подсистем. Команды, отображаемые на начальной странице, собраны в узел Рабочий стол.

Рис. 19. Закладка «Командный интерфейс»

На закладке Ввод на основании представлен список объектов, на основании которых может вводиться данный объект, и список объектов, являющихся основанием планов обмена.

2.12. Окно редактирования объекта

Рис. 20. Закладка «Ввод на основании»

С помощью флажка Только выбранные можно отображать только выбранные объекты или все объекты, которые могут вводиться на основании, где выбранные объекты отмечены флажками.

На закладке Настройка поставки можно выбрать правило поставки для выбранного объекта конфигурации, аналогично тому, как это делается в специальном диалоге настройки поставки (см. здесь).

Рис. 21. Закладка «Настройка поставки»

Для основных объектов конфигурации (справочники, документы, журналы документов и др.) редактирование свойств объектов, управление составом подчиненных объектов, настройку взаимодействия объектов удобно производить с помощью окна редактирования объекта.

В большинстве случаев окно редактирования объекта вызывается при выборе пункта Действия ‑ Изменить окна Конфигурация.

Редактируемые свойства располагаются на нескольких закладках. Каждая закладка содержит набор реквизитов для настройки свойств объекта определенного вида. Так, на закладке Основные вводятся свойства Имя, Синоним и Комментарий; на закладке Подсистемы указывается, в каких подсистемах используется данный объект. Переход по закладкам производится с помощью кнопок Далее > и < Назад. Кроме того, нужная закладка может быть выбрана указателем мыши. В форме есть кнопка Действия, при нажатии которой на экран выводится контекстное меню объекта. С помощью команд этого меню можно открыть нужную форму, модуль объекта (если есть), вызвать нужный конструктор и другие действия.

Состав закладок и набор управляющих элементов на однотипных закладках может меняться в зависимости от типа объекта конфигурации.

Рис. 22. Закладка «Основные»

На закладке Основные указываются свойства Имя, Синоним и Комментарий. Кроме того, на данной закладке задаются свойства, участвующие в формировании представления объекта в командном интерфейсе (подробнее см. здесь).

Если выполняется изменение имени объекта (редактируется свойство Имя), то система выполняет поиск возможных вхождений старого имени по конфигурации. Поиск выполняется в строковых константах, запросах (в том числе используемых в системе компоновки данных и динамических списках) и текстах ограничений доступа к данным.

В процессе поиска обнаруживаются случаи фактического использования старого наименования ‑ случаи, когда факт использования не требует уточнения, например в программном коде присутствует конструкция Справочники.Номенклатура (при переименовании этого справочника), а также случаи возможного использования старого наименования ‑ случаи, когда однозначно определить факт использования затруднительно. Если в процессе поиска были обнаружены только случаи фактического использования, то все замены выполняются автоматически (включая собственно переименование объекта). Если в процессе поиска обнаруживаются случаи возможного использования, то дальнейшие действия настраиваются с помощью диалога настройки параметров конфигуратора (подробнее см. здесь).

Работа со списком использований в коде объекта метаданных выглядит следующим образом.

строке: «i» описывает случай фактического использования, а "!" описывает случай возможного использования.

В крайней правой колонке отображается гиперссылка Заменить…, при нажатии на которую будет выполнена замена старого имени объекта конфигурации на новое имя в одном, конкретном месте. После замены гиперссылка пропадет. Если в этой колонке сразу отсутствует гиперссылка, то замена уже выполнена системой.

Для ускорения процесса замены можно выделить несколько строк в результатах поиска и выбрать в контекстном меню команду Заменить….

На закладке Подсистемы указывается, в каких подсистемах используется данный объект. Допустимо включение объекта в те или иные подсистемы независимо от взаимной подчиненности подсистем. Объект может быть отнесен одновременно и к «родительской», и к подчиненной подсистемам. Отнесение объекта к подсистемам определяет, в каких фрагментах командного интерфейса будут отображаться команды редактируемого объекта. Подробнее о командном интерфейсе см. здесь.

На закладке Данные создаются реквизиты, ресурсы, измерения, табличные части и реквизиты табличных частей, а также другие подчиненные объекты (в зависимости от типа объекта). Кроме того, на закладке могут содержаться другие элементы управления для настройки свойств, характерных для конкретных типов объектов.

Так, для справочника определяется длина наименования и кода, указывается тип кода и основное представление элемента справочника.

Рис. 24. Закладка «Данные»

С помощью кнопок панели инструментов, расположенной над списками подчиненных объектов, производится добавление, удаление и упорядочивание этих объектов. Свойства подчиненных объектов задаются в палитре свойств.

Если окно редактирования открыто для объекта, редактирование которого запрещено (например, объект не захвачен в хранилище), то допускается открытие диалога редактирования типа в режиме «только просмотр».

Рис. 25. Закладка «Формы»

Подробнее про основные и дополнительные формы см. здесь.

В группе Ввод по строке описывается поведение данного объекта в случае ввода по строке. Подробнее про ввод по строке см. здесь.

Свойство Быстрый выбор отвечает за режим выбора по умолчанию. Подробнее о работе данного свойства см. здесь.

На закладке Команды имеется возможность задать пользовательские команды, связанные с данным объектом. Описание видов команд см. здесь.

При добавлении новой формы запускается конструктор форм, с помощью которого производится выбор вида формы, подбор состава размещаемых в форме реквизитов и построение собственно формы. Подробнее о работе с конструктором форм см. здесь. Основные приемы редактирования формы см. здесь.

На закладке Макеты ведется управление макетами объекта.

При добавлении нового макета запускается конструктор макетов, с помощью которого создается макет. Подробнее о работе с конструктором макетов см. здесь.

Ниже списка макетов располагается кнопка Конструкторы, при нажатии на которую открывается подменю для выбора вида конструктора (состав конструкторов зависит от типа объекта):

•

При выборе пункта Конструктор печати запускается конструктор печати, с помощью которого создается макет и процедура для печати. Подробнее о работе с конструктором печати см. здесь.

•

При выборе пункта Конструктор выходной формы запускается конструктор выходных (отчетных) форм.

На закладке Права определяются права по объектам данного типа для каждой созданной роли.

Для прикладных объектов (справочники, документы, планы видов характеристик, планы счетов, планы видов расчета, регистры, бизнес-процессы и задачи) на закладке Планы обмена указывается список объектов типа ПланОбмена. Следует установить пометку для тех планов обмена, в которых учитываются изменения редактируемого объекта.

На закладке Прочее расположены кнопки открытия модуля объекта, модуля менеджера, справочной информации, а также может располагаться кнопка Предопределенные для открытия списка предопределенных элементов объекта (для справочников, планов видов характеристик, планов счетов, планов видов расчетов). Также на закладке могут располагаться реквизиты управления блокировкой (см. здесь) и настройки использования полнотекстового поиска (см. здесь). Эти реквизиты присутствуют только для следующих прикладных объектов:

•

справочники,

•

документы,

•

планы видов характеристик,

•

планы счетов,

•

планы видов расчета,

•

регистры,

•

бизнес-процессы,

•

задачи.

Некоторые объекты могут содержать специальные закладки, относящиеся только к данному типу объектов:

•

для объекта Справочник ‑ это закладки Иерархия, Владельцы, Нумерация, Ввод на основании;

•

для объекта Документ ‑ это Нумерация, Движения, Журналы и Последовательности, Ввод на основании;

2.13. Создание раздела справочной информации

2.14. Работа с конфигурацией базы данных

2.14.1. Дерево объектов конфигурации базы данных

•

для объекта ПланСчетов ‑ Субконто и Ввод на основании;

•

для объекта РегистрРасчета ‑ Перерасчет;

•

для объекта Задача ‑ Адресация и Ввод на основании;

•

для всех регистров ‑ Регистраторы;

•

для объекта, изменение которого могут учитываться планами обмена, ‑ Обмен данными;

•

для внешнего источника данных ‑ Функции;

•

для таблицы внешнего источника данных ‑ Ввод на основании.

К некоторым объектам конфигурации можно «прикрепить» текст, объясняющий назначение и порядок использования объекта. Такой текст называется пользовательским описанием. При работе с системой «1С:Предприятие» пользователь может вывести описание на экран для просмотра.

Создание и корректировка пользовательского описания выполняются при помощи встроенного HTML-редактора, который можно вызвать из палитры свойств объекта по ссылке Открыть свойства Справочная информация. Создание и редактирование текста описания производятся средствами HTML-редактора. Чтобы установить название, в тексте главы следует создать заголовок первого уровня, используя тег <H1> языка разметки. Следует иметь ввиду, что тег <STYLE> (и его содержимое), который может быть указан при ручном редактировании текста справочной информации вне тега <BODY>, будет проигнорирован при отображении главы справки в режиме «1С:Предприятие». Если требуется применить какое-либо специальное оформление для страницы справочной информации, его определение следует выполнять внутри тега <BODY>.

Если установлено свойство Включать в содержание справки, то для данного объекта в содержание справки может включаться элемент по значению синонима объекта. Независимо от установки данного свойства в список индексов (для поиска в справке) включается строка по значению синонима объекта. Следует помнить, что появление объекта в дереве содержания зависит от значения одноименного свойства у подсистем, в состав которых входит объект (см. здесь).

Для просмотра структуры конфигурации базы данных, свойств, форм, макетов и другой информации об объектах можно открыть окно конфигурации базы данных. Для этого нужно выбрать пункт Конфигурация ‑ Конфигурация базы данных ‑ Открыть окно конфигурации БД. По виду оно не отличается от окна Конфигурация.

2.14.2. Обновление конфигурации базы данных

2.14.2.1. Общая информация

Рис. 27. Конфигурация базы данных

Приемы работы с объектами конфигурации базы данных совпадают с приемами работы в окне Конфигурация с тем лишь отличием, что все объекты доступны только для чтения (просмотра).

В процессе редактирования конфигурации могут быть созданы новые, изменены существующие или удалены имеющиеся объекты. Текущая структура базы данных может быть отлична от структуры конфигурации. Отличие конфигураций показывается в заголовке окна Конфигурация символами <!>.

Знак отличия <!> конфигураций появляется только после сохранения изменений в основной конфигурации. После сохранения основной конфигурации можно продолжить внесение изменений, и в этом случае в заголовке окна Конфигурация будут присутствовать признаки изменения для обеих конфигураций.

Чтобы выполнить приведение в соответствие конфигурации и конфигурации базы данных, необходимо произвести обновление конфигурации базы данных. Предоставляется несколько вариантов выполнения такого обновления:

•

С помощью команды Конфигурация ‑ Обновить конфигурацию базы данных.

•

С помощью команды Конфигурация ‑ Конфигурация базы данных ‑ Обновить конфигурацию базы данных на сервере.

Существенное отличие в этих двух способах обновления заключается в том, что в первом случае перед тем, как начать выполнение реструктуризации, пользователю будет показан диалог (см. здесь), в котором перечислены изменения, которые будут выполнены. В диалоге можно подтвердить выполнение реструктуризации или отказаться от этого действия. Во втором случае (обновление на сервере) диалог показан не будет и реструктуризация будет выполнена безусловно.

2.14.2.2. Возможные ситуации при выполнении реструктуризации

2.14.2.2.1. Ошибка монопольного доступа

сохранение, а потом произведет обновление конфигурации базы данных. Если при обновлении конфигурации базы данных было открыто окно сообщений, то оно очищается.

ВНИМАНИЕ! Обновление конфигурации базы данных может потребовать прекращения работы всех пользователей.

Перед обновлением можно сравнить конфигурации, а также провести их объединение (см. здесь).

Если на момент выполнения обновления конфигурации базы данных выполнялась отладка, то после сохранения текущей конфигурации на экран выводится вопрос: Для обновления конфигурации базы данных необходимо прекратить отладку. Продолжить? При ответе Да отладка прекращается, и конфигурация базы данных обновляется. При ответе Нет не производится обновление, и отладка не прекращается.

Обновление конфигурации базы данных требует монопольного доступа конфигуратора к информационной базе. В зависимости от наличия пользователей, работающих с базой данных, и их режимов работы, возможно несколько вариантов поведения системы:

•

конфигуратор выдает сообщение об ошибке исключительной блокировки в том случае, если:

•

используется файловый вариант базы данных;

•

есть сеансы, подключенные к информационной базе без использования веб-сервера;

•

нет сеансов, работающих через веб-сервер;

•

обновление конфигурации требует реструктуризации базы данных.

•

конфигуратор предлагает завершить все сеансы и повторить обновление, если:

•

обновление конфигурации требует реструктуризации базы данных;

•

с файловым вариантом информационной базы работают веб-клиенты или тонкие клиенты, подключенные через веб-сервер;

•

в остальных случаях конфигуратор предлагает выполнить динамическое обновление.

ПРИМЕЧАНИЕ 1. При выдаче диагностических сообщений указываются характеристики сеансов, которые мешают выполнению действия. Если количество сеансов меньше или равно 5, то выводится подробный список сеансов (с указанием имени компьютера, типа приложения и т. д.), в противном случае выводится общее число сеансов.

ПРИМЕЧАНИЕ 2. Работа информационной базы в монопольном режиме не переводит базу данных Microsoft SQL Server в однопользовательский (single user) режим.

ПРИМЕЧАНИЕ 3. Для ускорения процесса реструктуризации информационной базы, при использовании СУБД Microsoft SQL Server, рекомендуется режим восстановления для базы данных устанавливать в значение Простой или С неполным протоколированием. Смену режима можно выполнять или перед выполнением реструктуризации или на постоянной основе, если не требуется выполнять восстановление базы данных на произвольный момент времени. Перед сменой режима восстановления базы данных необходимо выполнить резервное копирование базы данных!

Если система не может получить монопольный доступ, то имеется возможность только дождаться, пока пользователи будут отключены от информационной базы, и повторить операцию обновления.

2.14.2.2.2. Завершение сеансов и попытка обновления

2.14.2.2.3. Динамическое обновление

Рис. 28. Ошибка исключительной блокировки

Если для обновления конфигурации базы данных необходимо завершить все сеансы, то пользователю выдается сообщение (см. Рис. 29).

Рис. 29. Отключение сеансов для обновления

Если выбрана команда Завершить сеансы и повторить, то у пользователя запрашивается подтверждение выбранного действия (Завершение сеансов приведет к аварийному завершению работы пользователей! Выполнить завершение сеансов?) и в случае утвердительного ответа происходит попытка завершения работы всех сеансов информационной базы. Затем выполняется попытка повторного сохранения конфигурации базы данных.

Завершение всех сеансов приведет к аварийному завершению работы всех клиентских приложений.

Возможны ситуации, когда завершение работы сеанса невозможно. Например, файловый вариант информационной базы опубликован на веб-сервере, доступ к которому требует клиентского сертификата или на веб-сервере настроена аутентификация и для доступа требуется ввод имени пользователя и пароля. При этом к информационной базе подключения выполняются только с использованием веб-сервера. Конфигуратор не поддерживает аутентифицированный доступ к веб-серверу и поэтому не может выполнить попытку завершения сеансов. В том случае, если Конфигуратор не смог завершить сеансы доступа к информационной базе, попытку обновления конфигурации базы данных можно либо выполнить позже, либо завершить работу сеансов другими способами.

Если есть возможность выполнить динамическое обновление, пользователю выдается специальное сообщение (см. Рис. 30).

2.14.2.3. Завершение реструктуризации

2.14.2.4. Выбор механизма реструктуризации

Рис. 30. Динамическое обновление

Если выбрана команда Обновить динамически, то выполняется обновление без завершения работы пользователей. Предполагается, что выполненные изменения будут записаны динамически в виде версии изменений конфигурации (конфигурация базы данных при этом не изменяется). Допускается выполнение повторных изменений основной конфигурации. Если при очередной попытке обновления конфигурации базы данных может быть установлен монопольный режим работы, конфигуратор осуществляет обновление конфигурации базы данных с учетом всех изменений (как текущих, так и предыдущих).

Если было выполнено динамическое обновление, то работающие в этот момент пользователи продолжают работать со старой конфигурацией. Для того чтобы начать работать с обновленной конфигурацией, пользователю необходимо перезапустить систему «1С:Предприятие». Для контроля и оповещения пользователей о произведенных динамических изменениях следует использовать метод глобального контекста КонфигурацияБазыДанныхИзмененаДинамически().

ПРИМЕЧАНИЕ. После выполнения обновления конфигурации базы данных все версии, созданные динамическим обновлением, будут удалены.

Если были обнаружены изменения, требующие реструктуризации базы данных, то на экран выводится диалог со списком таких изменений для подтверждения обновления.

Рис. 31. Реорганизация информации

Для подтверждения сохранения нужно нажать кнопку Принять, для отказа ‑ кнопку Отмена.

Реструктуризация может выполняться двумя разными способами:

2.14.3. Фоновое обновление конфигурации базы данных

2.14.3.1. Общее описание

«1С:Предприятии» версии 8.3.10 и младше.

В данном режиме реструктуризация всегда выполняется через создание копии каждой изменяемой таблицы с последующим преобразованием каждой строки данных в конфигураторе или на стороне сервере (в зависимости от настроек выполнения реструктуризации).

•

Оптимизированный механизм реструктуризации. Работает только для клиент-серверного варианта работы информационной базы в том случае, если в качестве СУБД используется Microsoft SQL Server или PostgreSQL.

В данном режиме происходит попытка выполнить максимальное количество действий на стороне СУБД, а также выполнить модификацию существующих данных и индексов вместо создания копии и переноса данных с обработкой. В данном режиме большинство действий выполняется на стороне сервера системы «1С:Предприятие».

При выполнении реструктуризации из конфигуратора, используемый механизм реструктуризации определяется параметром UpdateDBCfg файла conf.cfg. Конфигурационный файл анализируется на том компьютере, где запущен конфигуратор. Указание «стороны» реструктуризации (просто или на сервере) определяет наличие диалога с возможностью подтвердить или отказаться от выполнения реструктуризации.

При выполнении реструктуризации с помощью командной строки пакетного запуска конфигуратора (команда /UpdateDBCfg), используемый способ реструктуризации определяется непосредственно в командной строке. Если в командной строке явного указания на используемый механизм не указано, для выбора будет также использован конфигурационный файл conf.cfg.

Смотри также:

•

Файл conf.cfg (см. здесь).

•

Команда /UpdateDBCfg (см. здесь).

ПРИМЕЧАНИЕ. Доступно только для лицензии КОРП. Подробнее о видах лицензий см. здесь.

Обновление конфигурации базы данных, которое связано с реструктуризацией базы данных, выполняемое для информационных баз большого объема, может занимать длительное время. Во время выполнения обновления, работать с информационной базой не возможно.

Для того чтобы свести потери времени на эту операцию к минимуму, существует специальный режим, выполняющий обновление конфигурации базы данных в фоновом режиме. Фоновое обновление конфигурации базы данных характеризуется следующими особенностями:

•

Доступно только в клиент-серверном варианте информационной базы;

•

Может выполняться при закрытом конфигураторе.

•

Большая часть фонового обновления конфигурации базы данных выполняется без монопольного доступа к базе данных (включая выполнение операции реструктуризации базы данных).

•

Во время фонового обновления недоступны следующие операции:

•

Редактирование конфигурации.

•

Отладка прикладного решения.

•

Выполнение операции обновления конфигурации базы данных.

•

Не допускается использование методов УстановитьРежимАгрегатов(), УстановитьИспользованиеАгрегатов(), ПерестроитьИспользованиеАгрегатов().

регистр бухгалтерии или регистр расчета участвует в операции фонового обновления. Попытка изменить содержимое таких планов счетов или планов вида расчета вызывает ошибку.

•

Фоновое обновление конфигурации можно поставить «на паузу» длительностью не более 48 часов. Если «пауза» продлится более 48 часов ‑ фоновое обновление будет отменено.

•

Не поддерживается работа фонового обновления для конфигураций, находящихся в режиме совместимости с версией 8.1 (см. здесь).

•

Не поддерживается работа фонового обновления конфигурации базы данных при работе на СУБД IBM Db2 9.1.

Процесс фонового обновления конфигурации состоит из нескольких этапов:

•

Фаза обработки:

•

Выполняется длительное время.

•

Запуск данной фазы может быть выполнен любым способом:

•

Интерактивно, из конфигуратора;

•

С помощью режима пакетного запуска конфигуратора.

•

Во время выполнения фазы пользователи могут работать с информационной базой.

•

Выполняется реструктуризация основного объема данных для следующих объектов конфигурации:

•

Справочники,

•

Документы,

•

Журналы документов,

•

Регистры сведений,

•

Регистры накоплений,

•

Регистры бухгалтерии,

•

Регистры расчета,

•

Последовательности,

•

Планы счетов,

•

Бизнес-процессы,

•

Задачи.

•

Во время выполнения фазы обработки, система фиксирует все измененные данные для вышеперечисленных объектов, по аналогии с механизмами обмена данными.

•

Фаза актуализации:

•

Запускается автоматически, после окончания фазы обработки, с интервалом 1 минута.

•

Во время выполнения фазы пользователи могут работать с информационной базой.

•

Фаза состоит из автоматически повторяющихся итераций. Каждая итерация анализирует изменения, накопленные с момента выполнения предыдущей итерации (или завершения фазы обработки) и выполняет реструктуризацию накопленных изменений.

•

Итерации завершаются в момент перехода к следующей фазе.

•

Фаза принятия изменений:

2.14.3.2. Диалог фонового обновления конфигурации базы данных

•

Во время выполнения фазы пользователи не могут работать с информационной базой.

•

Первым шагом этой фазы выполняется актуализация данных, накопленных с момента проведения последней, перед текущей фазой, итерации фазы актуализации.

•

Затем выполняется реструктуризация данных, не участвующих в фазах обработки и актуализации. В этих данных не предполагается большого объема изменений, и их реструктуризация выполняется быстро.

•

Следующим шагом выполняется принятие всех изменений, выполненных в базе данных.

•

После этого обновление конфигурации базы данных завершается.

Если фоновое обновление запущено так, что не требуется выполнения реструктуризации базы данных, то в этом случае все обновление выполняется в фазе принятия изменений, переход к которой возможен сразу после начала фонового обновления.

Во время фонового обновления имеется возможность остановить работу сервера или поставить процесс фонового обновления «на паузу».

После остановки сервера или после аварийного завершения рабочего процесса, обслуживающего системное фоновое задание, выполняющее обновление, создание первого сеанса будет происходить несколько большее время, нежели обычно. Это связано с восстановления фонового обновления. Однако сам процесс фонового обновления находится в приостановленном состоянии. Для продолжения работы необходимо возобновить работу фонового обновления. Такое поведение реализовано для того, чтобы не произошло зацикливание системы в том случае, если причиной аварийного завершения рабочего процесса, обслуживающего фоновое обновление, является собственно фоновое обновление.

После восстановления работоспособности сервера, фоновое обновление конфигурации базы данных продолжает работу следующим образом:

•

Если работа была прервана в фазе обработки, то процесс продолжается с последнего объекта конфигурации, обработка которого не была завершена.

•

Если работа была прервана в фазе актуализации ‑ незаконченная итерация начинается заново.

СОВЕТ. Рекомендуется отменять запущенный процесс фонового обновления конфигурации базы данных в тех случаях, когда не планируется завершение фонового обновления конфигурации базы данных (например, процесс поставлен на бесконечную «паузу»). Выполнение данной рекомендации положительно скажется на характеристиках системы, т. к. не будет происходить регистрация изменений для выполнения фазы актуализации.

При выполнении операции фоновой реструктуризации следует учитывать некоторые особенности работы системы:

•

Если регистр бухгалтерии или накопления добавлен в состав разделителя, то данный регистр обрабатывается во время фазы принятия изменений.

•

Если изменен тип независимого разделителя (см. здесь), то все объекты, входящие в состав этого разделителя, обрабатываются во время фазы принятия изменений.

•

Если изменяется тип измерения, входящего в основной отбор независимого регистра сведений, то такой регистр обрабатывается во время фазы принятия изменений.

Для вызова операции фонового обновления конфигурации базы данных нужно выбрать пункт меню Конфигурация ‑ Конфигурация базы данных ‑ Фоновое обновление конфигурации базы данных.

Копировать в буфер обмена Старт фонового обновления конфигурации БД прошел успешно Конфигурация недоступна для редактирования. Выполняется фоновое обновление конфигурации базы данных.

Рис. 32. Диалог фонового обновления конфигурации базы данных

Нажатие кнопки Запустить запускает фазу обработки. При этом в окне служебных сообщений отображается текст:

После запуска фонового обновления конфигурация блокируется от изменения. Во время выполнения любой фазы, работу фонового обновления можно приостановить с помощью кнопки Приостановить. Для того, чтобы продолжить выполнение фонового обновления служит кнопка Продолжить.

После окончания фазы обработки начинается фаза актуализации, во время выполнения которой можно перевести систему к выполнению фазы принятия изменений с помощью кнопки Завершить или отказаться от обновления с помощью кнопки Отменить.

СОВЕТ. Рекомендуется отменять запущенный процесс фонового обновления конфигурации базы данных в тех случаях, когда не планируется завершение фонового обновления конфигурации базы данных (например, процесс поставлен на бесконечную «паузу»). Выполнение данной рекомендации положительно скажется на характеристиках системы, т. к. не будет происходить регистрация изменений для выполнения фазы актуализации.

Флажок Разрешить динамическое обновление служит для того, чтобы определить, нужно ли при нажатии на кнопку Запустить попытаться выполнить динамическое обновление вместо запуска процесса фонового обновления конфигурации базы данных. Если этот флажок установлен, то сразу же после нажатия на кнопку Запустить будет производиться проверка на возможность выполнить динамическое обновление конфигурации. В случае, когда конфигурация допускает такую возможность, вместо фонового обновления конфигурации базы данных будет производиться динамическое обновление.

Флажок Выполнять на сервере служит для того, чтобы определить, где будет выполняться запуск, завершение и отмена. Если этот флажок сброшен, то данные действия будут выполняться на стороне клиентского приложения, а если установлен ‑ то на стороне сервера «1С:Предприятия». Кроме того, если установлен данный флажок, то можно выполнять обновление конфигурации только при наличии права ОбновлениеКонфигурацииБазыДанных, без установленного права Администрирование.

2.14.5. Сравнение конфигурации и конфигурации базы данных

2.14.6. Отказ от изменений в конфигурации

2.15. Запуск «1С:Предприятия»

2.16. Выгрузка и загрузка файлов конфигурации

Для сохранения конфигурации базы данных в файл на диск нужно выбрать пункт Конфигурация ‑ Конфигурация базы данных ‑ Сохранить конфигурацию БД в файл. На экран выводится стандартный диалог выбора файла. Необходимо выбрать каталог и указать имя файла, в который будет записана конфигурация базы данных.

Сохраненный файл конфигурации базы данных необходим для операции сравнения и объединения конфигураций (см. здесь).

Если в процессе внесения изменений в конфигурацию требуется получить отчет об отличиях от конфигурации базы данных, то следует выбрать пункт Конфигурация ‑ Конфигурация базы данных ‑ Сравнить, объединить с конфигурацией БД.

В случае необходимости можно восстановить измененные объекты.

Для отказа от изменений в конфигурации достаточно выбрать пункт Конфигурация ‑ Конфигурация базы данных ‑ Вернуться к конфигурации БД.

Примечание. Пункты меню Сохранить конфигурацию БД в файл… и Вернуться к конфигурации БД доступны даже в случае закрытой редактируемой конфигурации. Команда Вернуться к конфигурации БД по-прежнему недоступна, когда информационная база подключена к хранилищу конфигурации.

В конфигураторе предусмотрен запуск режима 1С:Предприятие. Для этого нужно выбрать пункт Сервис ‑ 1С:Предприятие. Часто необходимо запустить «1С:Предприятие» в режиме отладки. Для этого существует команда Отладка ‑ Начать отладку (подробнее про отладчик см. здесь).

Если конфигурация была модифицирована (были произведены изменения), то конфигуратор выводит вопрос: Редактируемая конфигурация отличается от конфигурации базы данных. Обновить конфигурацию базы данных? Для сохранения внесенных изменений следует выбрать кнопку Да.

Если выбрана кнопка Нет, то режим 1С:Предприятие запускается без сохранения конфигурации.

В случае отказа на экран выводится вопрос: Конфигурация базы данных не соответствует сохраненной конфигурации. Продолжить? Если выбрана кнопка ОК, то запускается режим 1С:Предприятие с прежней конфигурацией базы данных. Если выбрана кнопка Отмена, то запуск режима 1С:Предприятие не производится.

Механизм выгрузки и загрузки файлов конфигурации позволяет осуществлять выборочную выгрузку/загрузку некоторых свойств объектов конфигурации (модулей, макетов и справочной информации). Для выгрузки свойств нужно выбрать пункт Конфигурация ‑ Выгрузить файлы конфигурации.

Рис. 33. Выгрузить файлы конфигурации

В открывшемся окне следует отметить те объекты конфигурации, которые нужно выгрузить, укажите вид выгружаемых данных и укажите каталог, в который будет осуществлена выгрузка. Для начала выгрузки нажмите кнопку Выполнить. Выгружаемые данные записываются в файлы с именами, соответствующими названию выгружаемого свойства. Расширение файла соответствует типу данных:.

•

htm ‑ для справки и макетов HTML-документа;

•

txt ‑ для модулей и макетов текстового документа;

•

mxl ‑ для макетов табличного документа;

•

geo ‑ для макетов географической схемы;

•

grs ‑ для макетов графической схемы;

•

bin ‑ для макетов двоичных данных.

Картинки выгружаются в том формате, в котором они хранятся в конфигурации. Загружаются картинки всех поддерживаемых форматов (см. здесь).

Для выгрузки/загрузки прав доступа необходимо выбрать требуемые роли (или все) и указать пункт Права в списке Обрабатывать. Права доступа выгружаются в формате XML. Файл выгрузки включает в себя собственно права доступа, ограничения доступа к данным и шаблоны ограничений доступа.

При выгрузке файлов справки и макетов HTML-документов формируется отдельный файл для каждого языка, для которого определен макет. При этом код языка включается в имя файла перед его расширением: например, Документ.РасходТовара.Справка.ru.htm означает файл со справочной информацией на русском языке документа РасходТовара.

2.17. Выгрузка и загрузка конфигурации в файлы

2.17.1. Общая информация

2.17.2. Версии формата выгрузки

Действия в окне аналогичны действиям, описанным для режима выгрузки данных.

При загрузке производится попытка загрузить файлы справки и макеты HTML-документов для каждого языка, определенного в прикладном решении. Если при загрузке обнаружен только один файл (без указания в наименовании кода языка), то он загружается для текущего языка конфигурации.

Данный механизм позволяет осуществлять выгрузку всех объектов конфигурации в xml-файлы и выполнить обратную загрузку. Все объекты конфигурации выгружаются в один или несколько файлов. Основным файлом в выгрузке является файл Configuration.xml, который содержит описание свойств собственно конфигурации. Выгрузка может формироваться в двух форматах: линейном (см. здесь) и иерархическом (см. здесь). Имеется возможность осуществлять частичную загрузку из файлов (см. здесь). Выгрузка конфигурации осуществляется с помощью команды Конфигурация ‑ Выгрузить конфигурацию в файлы. Загрузка ‑ с помощью команды Конфигурация ‑ Загрузить конфигурацию из файлов.

Имеется возможность выполнить выгрузку и загрузку расширения конфигурации (см. здесь). В этом случае следует использовать команды меню Действия ‑ Конфигурация (из окна с конфигурацией расширения), либо соответствующими командами в диалоге Расширения конфигурации (см. здесь). Выгружаться будут расширенные или контролируемые свойства.

Если в объектах конфигурации существуют ссылки на отсутствующие объекты конфигурации, то такие ссылки выгружаются в виде текстового представления идентификатора и при загрузке также будут восстановлены в ссылку на отсутствующий объект конфигурации (для сохранения идентичности двух конфигураций). Для реквизитов и элементов управляемой формы выгружаются внутренние идентификаторы, используемые, в частности, для сохранения и восстановления настроек.

При выгрузке ролей выгружаются значения только тех прав, которые отличаются от значений по умолчанию в момент выгрузки. При определении значений прав по умолчанию используются свойства роли Устанавливать права для новых объектов и Устанавливать права для реквизитов и табличных частей по умолчанию. Значения этих флажков являются значениями по умолчанию для прав доступа на объекты конфигурации и прав доступа на реквизиты и табличные части, соответственно.

ПРИМЕЧАНИЕ. Обычные формы и интерфейсы обычного приложения выгружаются в двоичном виде.

При загрузке, если обнаружены ошибки в файлах, то будет сформировано окно со списком ошибок. Если ошибки не являются критичными, то можно нажать кнопку Принять. Выбрав строку с ошибкой ‑ можно открыть файл, содержащий ошибку.

Файлы выгрузки версионируются. Номер версии формата выгрузки, в зависимости от номера версии системы «1С:Предприятие», приводятся в следующей таблице.

Версия платформы Версия формата

8.3.6 1.0

8.3.7 2.0

8.3.8 2.1

8.3.9 2.2 до версии 8.3.9.1850 включительно

2.3 начиная с версии 8.3.9.2033

8.3.10 2.4

2.17.3. Форматы выгрузки

2.17.3.1. Иерархический формат выгрузки

Версия платформы Версия формата

8.3.12 2.6

8.3.13 2.7

8.3.14 2.8

8.3.15 2.9

8.3.16 2.9.1

8.3.17 2.10

8.3.18 2.11

8.3.19 2.12

8.3.20 2.13

8.3.21 2.14

8.3.22 2.15

8.3.23 2.16

8.3.24 2.17

8.3.25 2.18

8.3.26 2.19

Явное указание номера версии в самих файлах выгрузки начинается с версии 2.0 (выгрузка из платформы версии 8.3.7 и старше). Если в файлах выгрузки отсутствует явное указание номера версии, считается, что эта выгрузка имеет номер версии 1.0.

Версия формата едина для всех объектов конфигурации, которые могут быть выгружены в файлы. Версия формата записывается в корневые XML-файлы объектов конфигурации, а также в корневые XML-файлы некоторых подчиненных объектов конфигурации. Файлы выгрузки, имеющие формат отличный от XML, не содержат внутри себя указания на версию формат выгрузки.

Выгрузка всегда выполняется в формате текущей версии платформы «1С:Предприятие» (той, из которой выполняется выгрузка).

Загрузка выполняется успешно только в том случае, если версия загружаемых файлов меньше или равна версии платформы «1С:Предприятие», с помощью которой загружаются файлы выгрузки.

При выгрузке в иерархическом формате, все объекты конфигурации выгружаются в иерархическую файловую структуру, которая формируется по некоторым правилам. Все файлы и каталоги формируются в рамках каталога, который указан в диалоге выгрузки.

Этот каталог будет называться корневым каталогом выгрузки. Рекомендуется не указывать путь к корневому каталогу выгрузки, если его длина превышает 30 символов. Это уменьшит вероятность прерывания выгрузки из-за ошибки, связанной с превышением пути к выгружаемому файлу.

Все объекты конфигурации располагаются в подкаталогах, соответствующих своим типам. Так, справочники будут в подкаталоге Catalogs корневого каталога выгрузки, документы ‑ в Documents и т. д. Объекты конфигурации, расположенные в ветке Общие, также будут выгружать в «свои» подкаталоги корневого каталога выгрузки, без промежуточного подкаталога. Свойства всей конфигурации выгружаются в файл Configuration.xml, который размещается непосредственно в корневом каталоге выгрузки.

Каждый объект выгружается следующим образом:

подчиненные объекты (реквизиты, команды, формы и т. д.), то в этом же каталоге создается подкаталог с именем объекта.

•

В подкаталоге объекта выделяются подкаталоги для всех групп подчиненных объектов, кроме реквизитов и табличных частей. Реквизиты и табличные части располагаются в xml-файле с описанием самого объекта. Таким образом, в отдельные подкаталоги выносятся:

•

Формы ‑ подкаталог Forms;

•

Команды ‑ подкаталог Commands;

•

Макеты ‑ подкаталог Templates;

•

Кубы внешнего источника данных ‑ подкаталог Cubes;

•

Таблицы внешнего источника данных ‑ подкаталог Tables;

•

Остальные свойства объекта конфигурации (включая и собственно конфигурацию) размещаются в подкаталогах Ext разного уровня подчинения.

•

Если подчиненный объект имеет иерархическую структуру ‑ то он выгружается аналогично родительскому объекту конфигурации.

•

В подкаталоге Ext может располагаться:

•

Для собственно конфигурации:

•

Модуль управляемого приложения ‑ ManagedApplicationModule.bsl.

•

Модуль обычного приложения ‑ OrdinaryApplicationModule.bsl.

•

Модуль внешнего соединения ‑ ExternalConnectionModule.bsl.

•

Модуль сеанса ‑ SessionModule.bsl.

•

Для объекта конфигурации:

•

Модуль объекта ‑ ObjectModule.bsl.

•

Модуль команды ‑ CommandModule.bsl.

•

Модуль менеджера объекта ‑ ManagerModule.bsl.

•

Модуль набора записей ‑ RecordSetModule.bsl.

•

Модуль менеджера значения ‑ ValueManagerModule.bsl.

•

Предопределенные данные ‑ Predefined.xml.

•

Расписание регламентного задания ‑ Schedule.xml.

•

Права роли ‑ Rights.xml.

•

Файл макета ‑ Template.xml.

•

Справочная информация. В этом случае общее описание справки находится в файле Help.xml. В каталоге Help располагаются файлы справки с именем <код языка>.html. Если файлы справки содержат абсолютные картинки ‑ они располагаются в подкаталоге _files каталога Help.

•

Графическая схема или диаграмма бизнес-процесса. В этом случае общее описание схемы находится в файле Flowchart.xml. В каталоге Flowchart расположены подкаталоги с описанием графических элементов схемы, которые расположены в подкаталоге Items. Каждый элемент представлен в виде подкаталога, внутри которого расположена собственно абсолютная картинка.

•

Для подчиненного объекта конфигурации:

•

Абсолютные картинки элементов управляемой формы.

•

Абсолютные картинки, хранящиеся в общих картинках (Общие ‑ Общие картинки).

•

Справочная информация. Для подчиненного объекта хранится аналогично справочной информации по объекту конфигурации.

•

Форма выгружается в следующую структуру:

•

Описание формы выгружается в xml-файл со своим именем.

•

Также создается подкаталог с именем формы, в котором содержится подкаталог Ext.

•

В подкаталоге Ext расположено:

•

Описание собственно формы ‑ Form.xml.

•

Подкаталог Form.

•

В подкаталоге Form расположен файл с модулем формы ‑ Module.bsl.

•

В подкаталоге Ext расположена справочная информация выгружаемой формы (описано выше).

•

Макет выгружается в следующую структуру:

•

Описание макета выгружается в xml-файл с именем макета.

•

Также создается подкаталог с именем макета, в котором содержится подкаталог Ext.

•

В подкаталоге Ext содержится следующая информация:

•

Template.txt ‑ макет, помещенный как текстовый документ;

•

Template.xml ‑ макет, помещенный как документ HTML (с дальнейшей структурой аналогичной справочной информации);

•

Template.bin ‑ макеты во всех остальных форматах.

•

Кубы внешнего источника данных выгружаются в следующую структуру:

•

Собственно внешний источник данных выгружается в xml-файл с именем источника;

•

Также создается подкаталог с именем внешнего источника данных, в котором содержится подкаталог Cubes;

•

Кубы выгружаются следующим образом:

•

Каждый куб выгружается в xml-файл с именем куба;

•

Также создается подкаталог с именем куба, в котором создается подкаталог DimensionTables;

•

В подкаталоге DimensionTables находятся файлы с описанием таблиц измерений со своими именами.

•

Таблицы внешнего источника данных выгружаются в следующую структуру:

•

Собственно внешний источник данных выгружается в xml-файл с именем источника;

•

Также создается подкаталог с именем внешнего источника данных, в котором содержится подкаталог Tables;

•

Таблицы выгружаются следующим образом:

•

Каждая таблица выгружается в xml-файл с именем таблицы;

•

Подсистемы выгружаются в следующую структуру:

•

Подсистема выгружается как обычный объект конфигурации.

•

Если у подсистемы есть подчиненные подсистемы, то в каталоге с именем подсистемы будет создан подкаталог Sybsystems, в который будут выгружены подчиненные подсистемы.

•

Не рекомендуется использовать более трех вложенных подсистем, включая подсистему верхнего уровня, для того, чтобы не нарушить ограничение на полный путь к файлам объектов подсистем (255 символов). Если прикладное решение требует использование более трех вложенных подсистем ‑ рекомендуется для подсистем использовать максимально короткие имена.

Далее приведено соответствие между объектом конфигурации и каталогом, в который этот объект будет выгружен:

Имя подкаталога выгрузки Объект

AccumulationRegisters Регистры накопления

BusinessProcesses Бизнес-процессы

Catalogs Справочники

ChartsOfAccounts Планы счетов

ChartsOfCalculationTypes Планы расчетов

ChartsOfCharacteristicTypes Планы видов характеристик

CommandGroups Группы команд

CommonCommands Общие команды

CommonForms Общие формы

CommonModules Общие модули

CommonPictures Общие картинки

CommonTemplates Общие макеты

Constants Константы

DataProcessors Обработки

DefinedTypes Определяемые типы

DocumentJournals Журнал документов

Documents Документы

Enums Перечисления

ExchangePlans Планы обмена

Ext Дополнительные данные

ExternalDataSources Внешние источники данных

FilterCriteria Критерии отбора

FunctionalOptions Функциональные опции

FunctionalOptionsParameters Параметры функциональных опций

HTTPServices HTTP-сервисы

InformationRegisters Регистры сведений

Languages Языки

2.17.3.2. Линейный формат выгрузки

Имя подкаталога выгрузки Объект

Reports Отчеты

Roles Роли

ScheduledJobs Регламентные задания

Sequences Последовательности

SessionParameters Параметры сеанса

SettingsStorages Хранилища настроек

StyleItems Элементы стиля

Styles Стили

Subsystems Подсистемы

Tasks Задачи

WebServices Web-сервисы

WSReferences WS-ссылки

XDTOPackages Пакеты XDTO

ВНИМАНИЕ! Линейный формат выгрузки является устаревшим. Его использование не рекомендуется. Автономный сервер не поддерживает работу с линейным форматом выгрузки. Рекомендуется использовать иерархический формат выгрузки.

В отдельные файлы выгружаются:

•

Объекты конфигурации ‑ объекты верхнего уровня, и подчиненные объекты, отдельно захватываемые в хранилище конфигурации.

Примеры имен файлов:

•

Document.ПродажиТоваров.xml ‑ описание объект конфигурации Документ.ПродажиТоваров.

•

CommonPicture.ПодсистемаЗакупки.xml ‑ описание объекта конфигурации ОбщаяКартинка.ПодсистемаЗакупки (но не сама картинка).

•

Отдельные свойства ‑ как правило, имеющие большой объем или сложную структуру.

Примеры имен файлов:

•

CommonPicture.ПодсистемаЗакупки.Picture.xml ‑ описание картинки (но не сама картинка).

•

DataProcessor.Путеводитель.Template.ГлавнаяСтраница.xml ‑ описание макета, расположенного в обработке (но не сам макет).

•

Значения отдельных свойств, являющиеся файлами известных форматов (но не XML). К таким файлам можно отнести модули форм, макеты, картинки.

Примеры имен файлов:

•

CommonPicture.ПодсистемаЗакупки.Picture.Picture.png ‑ картинка, сохраненная в общие картинки под именем ПодсистемаЗакупки.

•

Catalog.Товары.Form.ФормаЭлемента.Form.Module.txt ‑ модуль управляемой формы элемента справочника Товары.

•

2.17.4. Выгрузка

КартинкаВторойИнформационнойБазы.

Объекты, не являющиеся объектами разработки, сохраняются в файле родительского объекта, например, файл DataProcessor.ПечатьЭтикетокИЦенников.Template.КомпонентаПечатиШтрихкодовLinux32.Template.b означает собственно внешнюю компоненту печати этикетов и ценников, расположенную в двоичном макете КомпонентаПечатиШтрихкодовLinux32.

Специальным образом выгружаются следующие элементы:

•

Модуль объекта ‑ выгружается в виде текстового файла (если таковой может быть получен) или в бинарном виде.

Пример имени файла:

•

DataProcessor.ЖурналРегистрации.ObjectModule.txt ‑ модуль объекта метаданных Обработка.ЖурналРегистрации.

•

HTML ‑ выгружается в виде набора файлов: корневой файл свойства, файлы HTML страниц, файлы картинок (если таковые имеются). Корневой файл содержит список HTML страниц входящих в документ. HTML файлы являются страницами входящими в документ. Каждая из них соответствует конкретному языку, определенному в конфигурации. Справка по объектам конфигурации является частным случаем выгрузки HTML.

Примеры имен файлов (для свойства Справка):

•

Catalog.Товары.Help.xml ‑ корневой файл внешнего свойства справка объекта метаданных Справочник.Товары.

•

Catalog.Товары.Help.ru.html, Catalog.Товары.Help.en.html ‑ страницы справки для русского и английского языков соответственно.

•

Catalog.Товары.Help.Картинка.png ‑ файл картинки, содержащийся в HTML документе со справкой.

•

Конфигурации поставщиков ‑ выгружается как файл информации о конфигурациях поставщиков во внутреннем формате (не XML) и файлы конфигурации (.cf) для каждой конфигурации поставщика.

Примеры имен файлов:

•

Configuration.ParentConfigurations ‑ файл информации о конфигурациях поставщиков.

•

Configuration.ParentConfigurations.УправлениеТорговлей.cf ‑ конфигурация поставщика УправлениеТорговлей.

При выгрузке все ссылки на объекты метаданных, ссылки на поля, идентификаторы типов и т. д. выгружаются в виде имен (Catalog.Товары). Все идентификаторы выгружаются на английском языке ‑ упоминание справочника Товары будет выглядеть Catalog.Товары, а не Справочник.Товары.

При использовании линейного формата следует учитывать следующие возможные проблемы:

•

сложность переноса каталога выгрузки между различными файловыми системами;

•

проблемы с уникальностью имен файлов выгружаемых объектов в ряде случаев.

Выгрузка конфигурации может происходить в двух разных форматах: линейном или иерархическом. Из конфигуратора доступна выгрузка только в иерархическом формате. Выгрузка в линейном формате является устаревшим вариантом, не рекомендуется к использованию и может быть выполнена только с помощью пакетного режима запуска конфигуратора.

2.17.5. Загрузка

2.17.5.1. Общая информация

Рис. 34. Выгрузка конфигурации в файлы

В диалоге можно указать то, в каком виде будет выполняться выгрузка: в виде xml-файлов или в виде zip-архива. В случае выгрузки в виде zip-архива, размер выгрузки будет существенно меньше. Кроме того, zip-архив быстрее передавать по различным каналам связи. Структура архива совпадает со структурой каталога выгрузки в файлы.

Также в диалоге можно указать, что выгрузка будет выполняться на сервере (в клиент-серверном варианте работы). Для этого служит флажок Выпонять на сервере. В этом случае выгрузка будет выполняться олдновременно несколькими системными фоновыми заданиями. Если выбрана выгрузка на сервере, то имеется возможность указать, какое количество фоновых заданий будет использоваться для выгрузки. Если этот параметр (Количество заданий выгрузки) установлен в значение 0, то это означает, что платформа автоматически определит это количество, исходя из параметров процессора на компьютере с кластером серверов «1С:Предприятия».

После указания каталога и способа выгрузки, выполняется собственно выгрузка. В процессе выгрузки (как было сказано ранее) формируется файл Configuration.xml, который содержит свойства самой конфигурации. Однако, кроме этого файла, система формирует файл версий (ConfigDumpInfo.xml), который содержит в себе информацию об имени объекта и его версии. Если, в дальнейшем, для текущей конфигурации будет предпринята повторная попытка выгрузки конфигурации в файлы в этот каталог, то конфигуратор выгрузит только те объекты, версия которых отличается от версии, которая была во время предыдущей выгрузки. Под «версией» в данном случае понимается некоторая последовательность символов, которая будет отличаться от предыдущей версии (последовательности символов) в том случае, если объект редактировался. Это единственное назначение этой информации.

Если каталог выгрузки не содержит файла версий, то будет выполнена полная выгрузка конфигурации (с формированием этого файла). Полная выгрузка также будет выполнена в том случае, если в процессе обновления выгрузки будут обнаружены любые из следующих изменений:

•

Переименование собственно конфигурации;

•

Переименование или удаление объекта конфигурации;

•

Изменение свойств ПредопределенныеДанные или ДиаграммаБизнесПроцесса. В конфигурации могут быть ссылки на элементы предопределенных данных и на точки бизнес процесса, поэтому изменения в этих свойствах влияют на целостность выгрузки конфигурации.

Следует помнить, что формат выгрузки в каталоге, выбранном для выгрузки, должен совпадать с форматом текущей выгрузки. Другими словами, если была выполнена выгрузка в иерархическом формате, а затем в этот же каталог попытаются выгрузить конфигурацию в линейном формате ‑ будет выдана ошибка и выгрузка не произойдет.

Смотри также:

•

Форматы выгрузки (см. здесь).

•

ConfigDumpInfo.xml (см. здесь).

Для того, чтобы выполнить загрузку, необходимо выбрать команду Конфигуратора Главное меню ‑ Конфигурация ‑ Загрузить конфигурацию из файлов. В диалоге необходимо указать каталог, в котором находятся файл/файлы загружаемой конфигурации.

2.17.5.2. Полная загрузка

2.17.5.3. Частичная загрузка

2.17.5.3.1. Общая информация

Рис. 35. Загрузка конфигурации из файлов

Если в диалоге выбран режим Загрузить из: Архив, то в поле диалога Каталог будет необходимо указать zip-архив, который содержит файлы загружаемой конфигурации.

Загрузку можно разделить на два, существенно различающихся по времени работы, варианта загрузки:

•

полная загрузка;

•

частичная загрузка.

При выполнении любой загрузки следует помнить, что система не выполняет проверку корректности настроек поддержки при загрузке из XML. Соответственно, при выполнении данной операции, пользователь сам отвечает за то, чтобы настройки поддержки были корректными. При этом следует понимать, что загрузка неверных настроек поддержки может повлечь за собой неработоспособность механизма обновления конфигурации, а также неработоспособность самой конфигурации.

При полной загрузке происходит полная замена основной конфигурации данными, которые расположены в загружаемых файлах. Полная загрузка достаточно большой конфигурации может занимать существенное время.

При выполнении полной загрузки конфигурации из файлов имеются следующие особенности:

•

конфигурацию, которая не стоит на поддержке и не подключена к хранилищу конфигурации, можно загрузить без ограничений;

•

конфигурацию, подключенную к хранилищу конфигурации, загрузить невозможно (недоступен соответствующий пункт меню);

•

конфигурацию, стоящую на поддержке, можно загрузить только при соблюдении следующих условий:

•

включена возможность изменений;

•

все объекты конфигурации можно редактировать.

Полная загрузка конфигурации из xml-файлов занимает существенное время. При этом изменения не всегда затрагивают большинство файлов конфигурации. Часто загрузки требуют только некоторые объекты конфигурации. Для ускорения загрузки, в таких случаях, предназначена частичная загрузка конфигурации из xml-файлов.

Частичная загрузка может быть выполнена как для собственно объекта конфигурации, так и для подчиненных объектов (формы, справка, модули и т. д.). Если выполняется загрузка объекта, то он загружается полностью, вместе со всеми подчиненными объектами. Объекты из файлов с объектами конфигурации сопоставляются по полному имени и внутреннему идентификатору. Для подчиненных объектов родительский объект определяется по имени файла (линейный формат) или иерархии каталогов (иерархический формат).

Частичная загрузка может выполняться только с помощью ключа /LoadConfigFromFiles пакетного запуска конфигуратора и не поддерживается в интерактивном режиме. Также частичная загрузка

2.17.5.3.2. Добавление объектов

2.17.5.3.3. Удаление объектов

2.17.5.3.4. Переименование объектов

2.17.5.3.5. Изменение объектов

здесь.

Общая схема частичной загрузки выглядит следующим образом:

1. Подготавливаются файлы, которые будут загружаться в конфигурацию. Формат и расположение файлов полностью соответствует файлам выгрузки в выбранном формате: линейном (см. здесь) или иерархическом (см. здесь).

2. Выполняется запуск конфигуратора в пакетном режиме запуска, с указанием списка измененных файлов и форматом загружаемых файлов.

3. Если ошибок при загрузке не обнаружено ‑ будет выполнена запись конфигурации. Если во время загрузки обнаружены ошибки, то произойдет возврат к последней сохраненной основной конфигурации. Если в конфигурации, в которую выполнялась попытка загрузки, были измененные и не сохраненные данные ‑ они будут утеряны.

При выполнении частичной загрузки может помочь ключ командной строки /Out (более подробно см. здесь), с помощью которого можно получить файл, который содержит диагностические сообщения, формируемые в процессе частичной загрузки.

При выполнении частичной загрузки конфигурации из файлов имеются следующие особенности:

•

Загрузка возможна, только если все загружаемые объекты захвачены в хранилище конфигурации;

•

Загрузка возможна, если для всех загружаемых объектов включена возможность изменения (для конфигурации, стоящей на поддержке).

•

При частичной загрузке корневого элемента конфигурации, конфигурация перестает находиться на поддержке, если отсутствует файл внешнего свойства ParentConfigurations.bin (хранит информацию о настройках поддержки).

Далее будут более подробно описаны различные ситуации частичной загрузки.

Добавление объекта осуществляется путем загрузки двух объектов: собственно добавляемого и его родителя. При попытке загрузки нового объекта, может быть обнаружена ошибка:

•

При не уникальности имени загружаемого объекта;

•

В том случае, когда в объекте есть ссылка на подчиненный объект, а файлов для подчиненного объекта не предоставляется.

В том случае, если для подчиненных объектов отсутствуют файлы, и на эти подчиненные объекты отсутствуют ссылки ‑ такие объекты примут значения по умолчанию.

Для удаления объекта необходимо загрузить файл родительского объекта, в котором отсутствует информация об удаляемом объекте.

Для переименования объекта необходимо загрузить сам объект (со всеми подчиненными) и его родителя (со всеми подчиненными). Родитель должен содержать ссылки на объект с новым именем. Следует помнить, что если при загрузке будут отсутствовать файлы с подчиненными объектами ‑ эти объекты будут принимать значения по умолчанию (если на них нет ссылок) или будет формироваться ошибка загрузки, если такие ссылки есть.

2.17.5.3.6. Загрузка подчиненных объектов

Копировать в буфер обмена 1cv8 DESIGNER /IBName "IBName" /LoadConfigFromFiles D:\Source -files D:\Source\Catalogs\Товары\Ext\Help.xml

Копировать в буфер обмена \Source \Catalogs \Товары \Ext Help.xml \Help ru.html en.html

Копировать в буфер обмена 1cv8 DESIGNER /IBName "IBName" /LoadConfigFromFiles D:\Source -files D:\Source\Catalogs\Контрагенты\Ext\ObjectModule.bsl

Копировать в буфер обмена \Source \Catalogs \Контрагенты \Ext ObjectModule.bsl

2.18. Расширения конфигурации

2.19. Работа с мобильным приложением

самом измененном объекте и всех его подчиненных объектах. Следует помнить, что если при загрузке будут отсутствовать файлы с подчиненными объектами ‑ эти объекты будут принимать значения по умолчанию (если на них нет ссылок) или будет формироваться ошибка загрузки, если такие ссылки есть.

При загрузке подчиненных объектов, загружаемые объекты должны описываться файлами в точности таким же образом, как и при выгрузке этих объектов. Для линейной выгрузки это означает, что имена файлов должны соответствовать аналогичным именам при выгрузке, а для иерархической выгрузки ‑ кроме имен файлов, должна совпадать еще и иерархия каталогов.

Так, если необходимо загрузить справочную информацию для справочника Товары, то необходимо указать следующую команду загрузки:

При этом на диске D: должна быть создана следующая структура каталогов (для случая иерархической выгрузки):

При загрузке указывается только имя собственно загружаемого объекта (в данном случае это справочная информация ‑ Help.xml), подчиненные объекты (файлы справки на соответствующих языках) должны присутствовать на диске и будут использоваться автоматически.

Аналогично будет выглядеть команда загрузки модуля объекта справочника Контрагенты. Команда загрузки:

При этом на диске D: должна быть создана следующая структура каталогов (для случая иерархической выгрузки):

Открытие списка подключенных расширений конфигурации выполняется с помощью команды главного меню Конфигурация ‑ Расширения конфигурации. В открывшемся окне можно создавать новые расширения и управлять подключенными. Подробнее описание работы с расширениями с помощью этого окна см. здесь.

Описание работы с мобильным приложением см. здесь.

2.21. Отчет по конфигурации

2.22. Глобальный поиск и замена

В конфигураторе можно вывести в текстовом или табличном виде информацию обо всех объектах конфигурации. Для этого следует выбрать пункт Конфигурация ‑ Отчет по конфигурации.

На экран выводится диалог. В нем нужно выбрать тип (текстовый или табличный) и имя файла, в который предполагается сохранить описание структуры конфигурации.

Рис. 36. Отчет по конфигурации

Создание описания объектов конфигурации для сложных конфигураций может занимать продолжительное время.

Если требуется получить отчет по отдельным объектам конфигурации, то в поле Объекты нужно нажать кнопку выбора и в открывшемся диалоге выбора объектов установить флажки у нужных объектов.

Рис. 37. Выбор объектов для отчета по конфигурации

Допускается отбор по подсистемам.

После окончания создания описания конфигурации будет открыто окно с описанием в выбранном формате (текстовом или табличном).

Режим глобального поиска и замены предназначен для поиска определенной строки во всех модулях, диалогах, табличных документах, описаниях конфигурации и внешних файлах (внешние отчеты и обработки, табличные документы). Найденный текст может быть заменен другим. Этот режим может быть использован, например, для поиска всех вызовов некоторой глобальной процедуры или обращения к какому-либо реквизиту в разных модулях.

замены ‑ выбором пункта Правка ‑ Глобальная замена.

В этих режимах используется один и тот же диалог. Если выбран режим поиска, то становятся недоступными реквизиты режима замены. Поэтому для краткости рассмотрим процедуру глобальной замены, а потом укажем особенности режима поиска.

На экран будет выдан диалог для задания параметров поиска.

Рис. 38. Окно глобальной замены

В поле Искать этого диалога следует ввести образец для поиска или выбрать один из образцов, которые были использованы ранее в операциях поиска из списка истории.

В поле Заменить нужно ввести текст, на который следует произвести замену найденного текста, или выбрать один из образцов, которые были использованы ранее в операциях замены из списка истории.

Чтобы различать при поиске прописные и строчные буквы, требуется установить флажок Учитывать регистр. При установленном флажке Искать слово целиком будут найдены только целые слова, а не части слов.

Если не требуется открытия редакторов при групповой замене (по кнопке Заменить все), то нужно установить флажок Не открывать редакторы при групповой замене. При любом состоянии флажка редактор будет открываться при нажатии клавиши Искать или Заменить.

Ниже расположена панель, на закладках которой указывается, где следует искать указанный образец.

На закладке Типы текстов помечаются типы объектов, в которых будет произведен поиск. Если конфигурация редактируется для режима запуска Управляемое приложение (см. здесь), то из списка объектов будут исключены пользовательские интерфейсы.

На закладке Конфигурации можно указать с точностью до объекта разделы конфигураций, в которых будет произведен поиск.

Рис. 39. Глобальный поиск

В список конфигураций помимо основной включается конфигурация базы данных, конфигурации хранилища, конфигурации расширений (если они открыты) и конфигурации расширений, сохраненных в базу данных (для открытых расширений). Конфигурации хранилища должны быть открыты перед вызовом режима поиска или замены. Конфигурации базы данных (основной и расширений) доступны только в случае использования глобального поиска.

Для указания набора объектов нужно установить переключатель Выбранные объекты и пометить те объекты, в которых будет произведен поиск. При первом запуске в списке по умолчанию установлены пометки всех объектов. Чтобы снять установку, следует снять флажок в строке с наименованием конфигурации. Затем можно указывать конкретные объекты для поиска.

На закладке Файлы можно указать каталог и типы файлов, в которых может производиться поиск. Могут быть просмотрены следующие типы просматриваемых файлов: конфигурации, расположенные в файлах (сохраненные, файлы поставки), внешние отчеты и обработки, текстовые и табличные документы. Если каталог не указан (реквизит Каталог не заполнен), то поиск в файлах не осуществляется. Поиск может также производиться в открытых документах тех же типов. Для этого следует установить флажок Искать в открытых документах.

Выбранную совокупность настроек можно сохранить для дальнейшего использования. Для этого в поле Область поиска нужно указать имя настройки. Для использования прежней настройки достаточно выбрать имя настройки в выпадающем списке. Сохраняются следующие настройки: настройки на закладке Типы текстов, состав объектов только для основной конфигурации на закладке Конфигурации и настройки на закладке Файлы.

Если был запущен режим поиска, то для начала поиска нужно нажать кнопку Искать.

В режиме глобального поиска можно прервать процесс нажатием Ctrl + Break или Ctrl + Alt + E.

На экран в окно Результаты поиска будет выведен список найденных вхождений исходного текста.

2.23. Настройка рабочей области конфигуратора

Рис. 40. Результат глобального поиска

Если какой-либо модуль имеет ограничение доступа (см. здесь), то перед поиском исходного текста в данном модуле система запрашивает пароль доступа. Необходимо ввести правильный пароль или отказаться от ввода пароля. Если пароль не введен, то просмотр в данном модуле не производится.

Результат поиска можно просмотреть, а к каждому найденному значению можно перейти, если выбрать в результате поиска нужную строчку и нажать клавишу Enter. Для просмотра следующего или предыдущего найденного значения можно воспользоваться пунктами Действия ‑ Следующая позиция и Действия ‑ Предыдущая позиция.

Результат поиска (весь список) можно запомнить в буфер обмена с помощью команды Копировать контекстного меню окна или с помощью соответствующей кнопки панели инструментов окна результатов поиска, а также вывести в табличный или текстовый документ.

Ширину колонок можно изменить стандартным приемом ‑ с помощью указателя мыши при нажатой клавише Ctrl.

Если был запущен режим замены, то в поле На текст указывается образец текста, на который следует заменить исходный текст, указанный в поле Заменить.

Если перед заменой требуется посмотреть исходный текст, то для начала поиска следует нажать кнопку Искать. На экран выводится результат первого найденного исходного текста. Если снова нажать кнопку Искать, то текущий текст будет пропущен и на экран будет выведено очередное вхождение исходного текста в текущем окне или другое окно, содержащее исходный текст.

Групповая замена (без подтверждения каждой замены) будет выполнена при нажатии на кнопку Заменить все. Если в этом случае не требуется открытия объектов, в которых обнаружено вхождение исходного текста, то следует установить флажок Не открывать редакторы при групповой замене.

ВНИМАНИЕ! Во время просмотра результатов поиска изменить условия поиска нельзя.

Структура выбора области поиска (типы текста, список объектов конфигураций, файлов и открытые документы) запоминается и при следующем открытии диалога восстанавливается. Если требуется сохранить несколько областей, то каждой области в реквизите Область поиска нужно присвоить имя. При повторном открытии окна поиска в списке областей достаточно выбрать нужную и выполнить поиск.

Для создания и редактирования конфигурации требуется одновременное использование различных окон. Например, просмотр, выбор, добавление и удаление объектов конфигурации производятся в окне Конфигурация; редактирование свойств объектов и их составных частей производится в палитре свойств; получение справочной информации по встроенному языку ‑ в окне синтакс-помощника; сообщения и результаты поиска выводятся в окне сообщений. Кроме того, каждый объект конфигурации в общем случае может состоять из различных частей, каждая из которых редактируется в отдельном окне.

Одновременное открытие различных служебных окон заметно сужает рабочую область, предназначенную для редактирования прикладных объектов (формы, модули и макеты) и

2.23.1. Настройка панелей

2.23.2. Окно «Конфигурация»

2.23.3. Использование режимов показа окон

стили, интерфейсы и др.).

Для расширения рабочей области и удобства работы можно воспользоваться некоторыми рекомендациями по настройке различных панелей конфигуратора, наличию и поведению различных служебных окон, использованию режимов показа окон.

Конфигуратор спроектирован таким образом, чтобы максимально использовать рабочую область за счет автоматического выбора нужных панелей инструментов для каждого вида окна. Так, при редактировании табличного документа конфигуратор предоставляет панель инструментов, предназначенную для выполнения команд по редактированию табличного документа; при переходе в окно, содержащее модуль формы, конфигуратор закрывает панель инструментов табличного документа и показывает панель инструментов текстового редактора.

Пользователь может самостоятельно настроить состав панелей инструментов и их размещение на экране. Если при настройке стандартной командной панели на ней размещают команды, которые отсутствуют на этой панели по умолчанию, то возможна ситуация, когда после перезапуска конфигуратора порядок команд на командной панели будет изменен. В этом случае рекомендуется скрыть стандартную панель, а вместо нее создать дополнительную командную панель, разместив на ней требуемые команды в нужном порядке. Порядок команд на ней изменяться не будет.

Помимо панелей инструментов внизу располагается Панель окон и Панель состояния. Каждая из них занимает отдельную строку и не может быть перемещена в другое место. Если какая-либо панель не нужна, то ее можно скрыть с помощь контекстного меню в любом месте любой панели. Панель показывается, если слева от ее названия установлен флажок, и скрыта, если флажок снят. Для изменения режима показа панели достаточно в контекстном меню выбрать строку с наименованием панели.

Чтобы панель окон не занимала постоянно часть рабочей области программы, можно установить режим Автоматически прятать. При работе панель окон скрыта. Чтобы она появилась, нужно подвести указатель мыши к месту размещения панели.

Окно Конфигурация может быть закрыто и открыто в любой момент времени. После выбора всех требуемых для работы окон окно Конфигурация может быть закрыто. Закрытие окна не приводит к окончанию работы с конфигурацией. Его можно открыть в любой момент.

Первоначальное состояние окна Конфигурация ‑ Прикрепленное. В этом состоянии оно «перекрывает» все окна, находящиеся в состоянии Обычное (большинство окон показываются в этом состоянии). Чтобы использовать область, занимаемую окном Конфигурация, его состояние можно изменить на Обычное (в этом случае другие окна будут показываться поверх окна Конфигурация) или на Прячущееся (если окно не нужно, оно скрывается автоматически, а при подведении к нему указатель мыши раскрывается).

В режиме Обычный окно может располагаться (его видно) только в пределах свободной рабочей области конфигуратора. Использование других режимов позволяет расширить рабочую область или рациональнее ее использовать. Кроме того, можно «вынести» окно за пределы рабочей области.

Каждое окно (кроме калькулятора) в конфигураторе может быть переведено в режим Прячущееся. Этот режим позволяет без лишних действий выбрать нужное окно для просмотра и редактирования, переведя указатель мыши в строку с заголовком окна. Когда просмотр закончен, для сворачивания окна достаточно просто перевести указатель мыши на любое другое окно или заголовок другого прячущегося окна. Целесообразно в этом режиме использовать окна, работа с которыми носит кратковременный характер (синтакс-помощник, окно Конфигурация, окно сообщений и результатов поиска, а также окно прикладных объектов, табличных и текстовых документов, открываемых в основном для просмотра).

Режим состояния окна Свободное позволяет поместить данное окно в любое место экрана, независимо от размеров и положения окна программы (конфигуратора).

2.24. Сохранение в файл идентификатора конфигурации

2.25. Работа с конфигурацией из встроенного языка

Копировать в буфер обмена Конфигурация = Новый ОбъектМетаданныхКонфигурация(Новый ДвоичныеДанные(ПутьККонфигурации));

Копировать в буфер обмена Расширение = Новый ОбъектМетаданныхКонфигурация(РасширенияКонфигурации.Получить() [0].ПолучитьДанные());

Копировать в буфер обмена ИзКонфигурации = Новый ОписаниеКонфигурации(Новый ДвоичныеДанные(ПутьККонфигурации));

Копировать в буфер обмена ИзОбновления = Новый ОписаниеОбновленияКонфигурации(Новый ДвоичныеДанные(ПутьКОбновлению));

состоянии, или к одной из сторон окна, а также расположено поверх другого прикрепляемого окна (совмещенные окна).

Рекомендуется совмещать такие окна, просмотр которых одновременно не требуется. Например, окно палитры свойств и окно синтакс-помощника или Табло и Стек вызовов во время отладки.

Подробнее о режимах показа окон см. здесь.

Служебная команда, используемая для механизма проверки лицензирования. Подробнее о защите обновлений прикладных решений см. здесь.

С помощью встроенного языка можно проанализировать метаданные конфигурации, которая исполняется в данный момент. Для этого предназначено свойство глобального контекста Метаданные. Данное свойство предоставляет доступ к объекту типа ОбъектМетаданныхКонфигурация. Свойства этого объекта позволяют получить информацию о свойствах конфигурации, узнать количество и состав объектов конфигурации.

Кроме возможности выполнить анализ основной конфигурации, система обеспечивает возможность выполнить аналогичный анализ для любой другой конфигурации или расширения конфигурации, сохраненного в файл. Для того, чтобы провести такой анализ, необходимо создать объект ОбъектМетаданныхКонфигурация на основании файла конфигурации (или расширения конфигурации).

В результате, в переменной Конфигурация будет расположен объект, аналогичный свойству глобального контекста Метаданные. При этом значение переменной Конфигурация будет описывать конфигурацию, расположенную в файловой системе по пути, который указан в переменной ПутьККонфигурации.

Также возможно выполнить следующее действие:

Данный пример создает объект с метаданными расширения, которое было добавлено первым в текущую конфигурацию. Очевидно, что если в конфигурации нет расширений, данный пример кода приведет к ошибке времени исполнения.

В том случае, когда необходимо получить из конфигурации (или расширения) минимальный набор информации: имя конфигурации, версию конфигурации и имя поставщика, можно воспользоваться объектов ОписаниеКонфигурации. Для этого следует выполнить следующее действие:

Результатом данного примера будет объект ОписаниеКонфигурации, созданный на основании конфигурации, путь к которой указан в переменной ПутьККонфигурации.

Кроме получения информации о структуре конфигурации и ее базовых характеристиках, система позволяет получить некоторый базовый набор информации из файла обновления конфигурации. Этот набор включает в себя описание конфигурации, которая получится в результате обновления, а также массив с описанием версий конфигурации, которые можно обновить с помощью указанного файла .cfu.

ОписаниеОбновленияКонфигурации.

Смотри также:

•

Обновление конфигурации (см. здесь).