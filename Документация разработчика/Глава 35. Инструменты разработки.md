Глава 35. Инструменты разработки

35.1. Редактор формы

35.1.1. Описание редактора

Редактор формы позволяет выполнять все действия, которые возникают при создании и изменении формы. Редактор формы представляет собой группу из нескольких связанных между собой редакторов:

•

реквизитов ‑ закладка Реквизиты;

•

команд ‑ закладка Команды;

•

элементов ‑ закладка Элементы;

•

параметров ‑ закладка Параметры;

•

модуля ‑ закладка Модуль;

•

командного интерфейса ‑ закладка Командный интерфейс.

В нижней части окна расположена форма в режиме предварительного просмотра.

Рис. 626. Редактор формы

В редакторах доступно множественное выделение. В этом случае в палитре свойств будут отражены только те свойства, которые присутствуют у всех выделенных объектов. Изменения, которые сделаны в палитре свойств, будут применены для всех выделенных объектов.

Добавление элементов формы обычно осуществляется перетаскиванием реквизита формы на панель элементов. При этом имя элемента формы становится равным имени реквизита, а в качестве данных элемента формы установлен путь к реквизиту. В дальнейшем имя элемента можно изменить. Система автоматически определяет как элемент формы, с помощью которого будет отображаться реквизит, так и вид этого элемента, если такое возможно. Аналогичным образом выполняется добавление на форму команд (как команд формы, так и глобальных команд). Если реквизит формы или команда размещена на форме, то справа от названия у нее выводится специальный маркер серого цвета.

что для таких элементов свойство Данные не будет перенесено. Для всех элементов, перенесенных таким образом, будет необходимо заново установить корректные пути к данным.

При выборе элемента формы на закладке Элементы происходит автоматическое позиционирование на выбранный элемент в окне предварительного просмотра. Если элемент выделяется в окне предварительного просмотра, то происходит автоматическое выделение этого элемента в дереве элементов формы на закладке Элементы.

Рис. 627. Связь редакторов

Выделять элементы формы можно как в редакторе элементов, так и в окне предварительного просмотра. При этом возможности, доступные в окне предварительного просмотра, практически совпадают с таковыми в списке элементов. В частности, доступны контекстные меню элементов, открытие окна свойств, перетаскивание элементов и т. д. Если выделить элемент в окне предварительного просмотра, вокруг элемента возникает рамка, которая в зависимости от элемента может быть нескольких цветов.

Цвет рамки

Описание

Синяя Выделение обычного элемента

Оранжевая Выделение автоматически созданных кнопок и подменю командных панелей. Служит для индикации того, что для данного элемента невозможно выполнить никаких настроек (свойства, положение)

Серая Выделение родительского элемента, если выбранный элемент невозможно выделить в окне предварительного просмотра. Например, если в списке элементов выбрать контекстное меню поля ввода, то поле ввода будет выделено в окне предварительного просмотра серым цветом

Зеленая Используется при перетаскивании элементов и отображает элемент, в который выполняется перетаскивание (например, таблицу или группу формы), и индикатор того, где будет размещен перетаскиваемый элемент

Щелчок мышью по заголовку окна в окне предварительного просмотра эквивалентен выбору элемента Форма (на закладке Элементы). Контекстное меню, которое возникает в этом случае, также эквивалентно контекстному меню, соответствующему элементу Форма.

Рис. 628. Индикация перетаскивания

Если необходимо выделить родительский элемент (например, группу, в которую входит поле) для какого-либо другого элемента, это можно сделать двумя последовательными щелчками левой кнопкой мыши на подчиненном элементе. Такое выделение сработает, если интервал между щелчками составляет от 1 до 2 секунд. При меньшем времени система может воспринять щелчки как двойной щелчок, при большем ‑ как раздельные действия. Если в момент первого щелчка было выделено несколько элементов, то выделение родительского элемента не будет выполнено.

Для быстрого перехода к связанным объектам существует команда Перейти. Эта команда расположена в контекстном меню объекта, в редакторах элементов, фрагментов командного интерфейса, реквизитов, команд и окне предварительного просмотра. С помощью этой команды можно, например, быстро перейти от элемента формы (выделенного в списке элементов или окне предварительного просмотра) к реквизиту формы, который отображается этим элементом. Если доступно несколько объектов, к которым возможен переход, будет открыто окно с предложением выбрать нужный объект.

Также в редакторе формы возможно быстрое создание (или переход) обработчиков событий того или иного элемента формы с помощью подменю События контекстного меню элемента.

Рис. 629. Меню «События»

В состав этого меню входят все события, которые доступны для данного элемента формы в окне свойств этого элемента. Если в меню указано имя события в угловых скобках, это значит, что обработчик события не определен (например, для события Очистка элемента Организация на рис.629). Для создания обработчика следует выбрать нужное событие ‑ произойдет переход в редактор модуля формы с созданием необходимого обработчика.

Если обработчик для события уже создан, то выбор соответствующего пункта в подменю События вызовет переход к существующему обработчику в редакторе формы (например, обработчик ОрганизацияПриИзменении() на рис.629).

Для кнопки подменю События не формируется, а команда перехода к обработчику соответствующей команды расположена непосредственно в контекстном меню элемента.

Если выполняется создание клиентского обработчика, то система предлагает на выбор несколько вариантов его создания:

Рис. 630. Создание клиентского обработчика

Первый вариант (Создать на клиенте) предполагает создание только клиентского обработчика событий. Вариант Создать на клиенте и процедуру на сервере без контекста предполагает создание клиентского обработчика события, внеконтекстной серверной процедуры и вызов процедуры из клиентского обработчика. Последний вариант отличается от предыдущего тем, что серверная процедура создается контекстной. Если в каком либо клиентском обработчике события не рекомендуется использовать контекстные серверные вызовы (информация об этом доступа в Синтакс-помощнике), то использование последнего варианта (с контекстной серверной процедурой) недоступно. Удаление обработчика события не приводит к удалению серверной процедуры (если при создании обработчика события она создавалась).

связаны с удаляемым реквизитом. Если связь с этим реквизитом для элемента не является основной (данные подвала, данные, отображаемые в заголовке группы, и т. д.), то такой элемент не удаляется, но очищается связь с удаляемым реквизитом. Вне зависимости от ответа на вопрос об удалении будут удалены команды командного интерфейса формы, связанные с удаляемым реквизитом.

Если удалить команды формы, также предлагается удалить связанные элементы. При отрицательном ответе элементы формы не удаляются, но очищается свойство элемента Команда. При положительном ответе удаляются кнопки, связанные с удаляемой командой.

При разработке формнеобходимо видеть, как форма будет отображаться в нужных вариантах интерфейса (Такси, версия 8.2, мобильное устройство). Это можно сделать непосредственно в редакторе формы.

Рис. 631. Переключение режима интерфейса

На рис.631 приведен пример того, как меняется отображение при смене режима интерфейса с интерфейса Такси (верхняя левая часть рисунка) на интерфейс версии 8.2 (средняя часть рисунка) и на интерфейс мобильного устройства (правая нижняя часть рисунка). Однако следует помнить, что в режиме тестирования формы в интерфейсе Такси, некоторые элементы изображаются в интерфейсе 8.2.

Состав пунктов меню, который отображается при нажатии кнопки Вариант интерфейса, зависит от значения свойство Режим совместимости интерфейса. Если данное свойство не позволяет использовать интерфейс Такси, то в меню будет отсутствовать пункт Персональный компьютер (Такси). В противном случае меню будет отображать все три варианта интерфейса, как показано на рис.631.

В особых случаях требуется разрабатывать формы, для которых можно выбирать масштаб отображения (см. здесь). Если у самой формы свойство Вариант масштаба установлено в значение Авто, то в редакторе формы имеется возможность выбора, в каком масштабе будет отображаться предварительный просмотр формы.

Рис. 632. Переключение варианта масштаба

Если форма будет использоваться только в интерфейсе Такси, и при этом не будет использоваться компактный режим отображения, в редакторе формы можно проверить, как форма будет выглядеть в случае установки нестандартного масштаба.

Рис. 633. Выбор масштаба формы

Изменение масштаба приведет к соответствующему изменению формы в окне предварительного

В связи с тем, что формы системы «1С:Предприятие» могут отображаться на устройствах с разным разрешением, в процессе разработки требуется проверять, как будет выглядеть разрабатываемая форма на том или ином разрешении. Для этого в редакторе реализована возможность быстрого выбора разрешения, для которого система будет выполнять размещение элементов в панели предварительного просмотра формы.

Рис. 634. Выбор разрешения панели предварительного просмотра

При выборе разрешения форма будет перестраиваться так, как будто в панели предварительного просмотра установлено выбранное разрешение. При этом физические размеры формы не будут изменяться. Текущий монитор (тот, на которым отображается редактор формы) отображается первой строчкой меню и начинается со строки Текущий монитор.

Прикладные решения могут работать на устройствах, экраны которых во время работы могут изменять свою ориентацию (портретная или ландшафтная ориентации). Для проверки того, как будет выглядеть форма при смене ориентации экрана, имеется возможность быстро эмулировать этой операции в редакторе формы.

Рис. 635. Выбор ориентации экрана

Так, на рис.635 приведен пример того, как форма будет отображаться в разрешении 1024x768 в ландшафтной (верхняя часть рисунка) и портретной (нижняя часть рисунка) ориентации.

При разработке прикладного решения, которое будет работать на мобильном устройстве, становится актуальной проблема предварительного просмотра разрабатываемой формы в том виде, как это будет на мобильном устройстве. Для этого следует с помощью кнопки Вариант интерфейса выбрать режим отображения Мобильное устройство (Такси).

Рис. 636. Мобильное устройство

Для мобильного устройства также имеется возможность выбирать ориентацию: портретная или ландшафтная.

Рис. 637. Смена ориентации мобильного устройства

В этом смысле поведение редактора совпадает с таковым для любого другого варианта интерфейса.

Редактор формы также позволяет выбрать режим отображения мобильного устройства в окне предварительного просмотра. Для этого предназначена кнопка По размеру окна.

Рис. 638. Размер просмотра

Имеется возможность выбрать один из нескольких вариантов просмотра:

1. По размеру окна ‑ в этом случае масштаб отображения подбирается таким образом, чтобы область экрана мобильного устройства поместилась в окне предварительного просмотра без необходимости использовать прокрутку.

2. Реальный размер ‑ в этом случае размер устройства в окне предварительного просмотра соответствует геометрическим размерам целевого мобильного устройства. Для достижения полного соответствия масштаб отображения в операционной системе должен соответствовать реальному DPI используемого монитора.

3. Пиксель в пиксель ‑ в этом случае каждая точка экрана мобильного устройства соответствует точке области предварительного просмотра на компьютере разработчика.

4. Выбрать любой из доступных вариантов масштаба формы.

35.1.2. Ролевая настройка формы

элементов, которые будут приводить к проблемам при размещении элементов формы, имеется возможность отобразить эти ошибки с помощью специальной кнопки.

Рис. 639. Показать ошибки размещения

Если нужно открыть форму для проверки, следует нажать сочетание клавиш Ctrl + R. Форма будет открыта в отдельном окне. Если в редакторе формы выбран режим Мобильное устройство, то проверка формы будет недоступна.

При переименовании или удалении реквизита, параметра или элемента формы, система ищет случаи использования переименуемого (удаляемого) объекта в модуле формы и во всей конфигурации (если это разрешено в настройках конфигуратора, см. здесь).

В редакторе формы имеется возможность выполнить ролевую настройку поведения формы.

Данная возможность предоставляется для следующих свойств:

•

Просмотр ‑ свойство реквизита формы. Отсутствие возможности просмотра исключает реквизит из данных формы (реквизит не передается с сервера). Изменить эту настройку пользователь не может.

•

Редактирование ‑ свойство реквизита формы. Отсутствие возможности редактирования делает связанный с реквизитом элемент формы доступным только для просмотра. Вне зависимости от состояния данного свойства редактирование будет недоступно, если недоступен просмотр реквизита формы. Изменить эту настройку пользователь не может.

•

Пользовательская видимость ‑ свойство элемента формы. Определяет видимость элемента формы по умолчанию. При этом пользователь может самостоятельно изменить это свойство в редакторе настройки формы.

•

Использование ‑ свойство команды формы. Если у команды выключено использование, то в командном интерфейсе отсутствуют все связанные с ней кнопки. Изменить эту настройку пользователь не может.

Редакторы всех вышеперечисленных свойств выглядят одинаково и имеют одинаковый принцип работы. Рассмотрим работу редактора на примере свойства Просмотр.

Рис. 640. Редактирование свойства «Просмотр» реквизита формы

35.2. Редактор текстов

35.2.1. Редактирование модулей

35.2.1.1. Выделение цветом синтаксических конструкций

роли, у которой флажок находится в «третьем» состоянии (серый фон флажка). Затем состояния просмотра для всех доступных ролей складываются «по ИЛИ», и результат этого сложения будет определять итоговое свойство Просмотр для редактируемого объекта.

Текстовый редактор системы «1С:Предприятие» предоставляет пользователю все основные функции, необходимые при редактировании текстов. При работе с текстовым редактором доступны операции с блоками текста, функции поиска и замены, цветовое выделение синтаксических элементов программных модулей.

В системе «1С:Предприятие» текстовый редактор используется в двух режимах: для редактирования текстовых документов и как составная часть редактора форм для редактирования текстов модулей.

В данной главе приводится описание особенностей работы редактора текстов при редактировании текстов модулей.

Так как работа с любым текстовым редактором в системе Microsoft Windows осуществляется примерно одинаковым образом, в данном разделе будет дано описание специфических возможностей текстового редактора системы «1С:Предприятие».

ПРИМЕЧАНИЕ. В текстовом редакторе невозможно ввести символы, недопустимые с точки зрения спецификации XML версии 1.0 (http://www.w3.org/TR/xml/). При попытке ввода такого символа он просто игнорируется, при вставке из буфера обмена недопустимые символы пропускаются и во вставленный текст не попадают.

Таблицу сочетаний клавиш для редактора текстов можно посмотреть в справке при использовании программы.

Редактирование модулей выполняется в процессе создания формы объекта конфигурации, а также при разработке модулей (модуль приложения, модуль внешнего соединения, общие модули, модули прикладных объектов).

При создании формы текстовый редактор выступает как составная часть редактора форм и вызывается щелчком мыши на закладке Модуль в окне редактора форм, в остальных случаях текстовый редактор вызывается в виде отдельного окна. Для открытия модуля управляемого приложения, модуля внешнего соединения, модуля сеанса и модуля обычного приложения нужно щелкнуть правой кнопкой мыши по имени конфигурации (самая верхняя строка дерева конфигурации) и в контекстном меню выбрать соответствующий пункт меню.

Для редактирования модуля объекта выбрать объект и в контекстном меню выбрать пункт Открыть модуль объекта.

Для редактирования модуля менеджера (если такой модуль есть у объекта) следует выбрать объект и в контекстном меню выбрать пункт Открыть модуль менеджера.

Чтобы отредактировать модуль команды, нужно дважды щелкнуть мышью по команде или в контекстном меню команды выбрать пункт Открыть модуль команды.

Для редактирования общего модуля в окне Конфигурация, в ветви Общие ‑ Общие модули выбрать нужный модуль и в контекстном меню выбрать пункт Открыть модуль.

Процесс редактирования текста программного модуля ничем не отличается от процесса редактирования текстовых документов ‑ можно использовать все возможности редактора текстов.

В этом разделе будут описаны специфические режимы редактора текстов, которые доступны при редактировании модулей.

Для удобства редактирования текстов модулей текстовый редактор имеет функцию выделения

35.2.1.2. Группировка

будут выделяться разные типы синтаксических конструкций, можно установить в окне Параметры, которое открывается выбором пункта Сервис ‑ Параметры (о настройке параметров текстового редактора см. здесь).

Названия встроенных функций цветом не выделяются (цвет совпадает с цветом идентификаторов).

В общем случае когда текстовый редактор вызывается для редактирования текста модуля, эта функция включается автоматически. Однако в некоторых случаях текст модуля может быть расположен во внешнем текстовом файле. Тогда при открытии такого файла конфигуратор не распознает модуль и будет считать его обычным текстовым документом. В этом случае при редактировании текста будет недоступно выделение цветом синтаксических конструкций и автоматическое форматирование текста модуля. Для указания конфигуратору, что редактируется модуль, а не текстовый документ, служит пункт Текст ‑ Встроенный язык, выполняющий функцию переключателя.

Когда он включен (слева от слов Встроенный язык в меню появляется отметка), текстовый редактор считывает загруженный в него текст текстом модуля и выделяет цветом найденные синтаксические конструкции.

Рис. 641. Включено выделение цветом

Если этот режим включен при редактировании обычного текстового документа, для вывода текста будет также использоваться шрифт, установленный для текстов модулей в настройке параметров конфигуратора (пункт Сервис ‑ Параметры, закладка Тексты, реквизит Шрифт).

Настройка параметров системы «1С:Предприятие» позволяет отключить режим выделения цветом синтаксических конструкций. Тогда выбор пункта Встроенный язык не включит выделение цветом синтаксических конструкций модуля, а будет использовать только установки шрифта модуля и шага табуляции.

Если режим выделения цветом синтаксических конструкций выключен, для вывода текста используются цвета операционной системы.

В модулях или в текстовых документах, просматриваемых в режиме Встроенный язык, некоторые синтаксические конструкции автоматически объединяются в группы. К таким конструкциям относятся Если … Тогда … КонецЕсли, Пока … Цикл … КонецЦикла, Процедура … КонецПроцедуры и другие.

Группы текста позволяют лучше воспринимать различные части текста, а также переносить и копировать группу целиком. Отображение группировок можно увидеть на рис.642.

Рис. 642. Группировки в текстовом редакторе

Свернуть и развернуть группу можно с помощью мыши. Для этого достаточно щелкнуть левой кнопкой мыши по маркеру группы.

Если при этом нажать клавишу Ctrl, то сворачивание и разворачивание будет производиться также для подчиненных групп (условий, циклов и проч.).

Для отображения свернутого текста необходимо подвести курсор к маркеру, как показано на рис.642. Если текст группы достаточно большой, то выводится только его начальная часть.

В процессе разработки возникает необходимость группировать фрагменты модуля. Например, нужно выделить логически связанные процедуры и функции или выделить фрагменты алгоритма в рамках одной процедуры или функции. Это можно сделать с помощью инструкций препроцессора #Область … #КонецОбласти (#Region … #EndRegion).

Копировать в буфер обмена // Верный пример использования области #Область Верно … #Если Клиент Тогда … #КонецЕсли … #КонецОбласти // Вложенные области #Область АлгоритмРасчета … #Область Этап1 … #КонецОбласти … #Область Этап2 … #КонецОбласти … #КонецОбласти // Неверный пример использования области #Область Неверно … #Если Клиент Тогда … #КонецОбласти … #КонецЕсли // Неверный пример использования области #Область Неверно Процедура ПолучитьДанные() … #КонецОбласти … КонецПроцедры

Все строки, которые находятся внутри области, ограниченные директивами препроцессора, в редакторе модуля можно свернуть (аналогично другим конструкциям встроенного языка). Каждая область должна обладать собственным именем, которое формируется по правилам встроенного языка. В примере, показанном на рис.643, именем области является идентификатор ФайлКартинки. Области могут быть вложенными, но не могут пересекаться с другими синтаксическими конструкциями языка. Далее приведены примеры использования областей, как корректные, так и некорректные:

Область может описываться комментарием, располагающимся перед началом области (#Область). Этот комментарий также может группироваться.

С помощью команд, выполняемых с клавиатуры, можно легко управлять состоянием групп.

Клавиши Действия

Ctrl + Num- Сворачивает группу (курсор может быть в любом месте группы)

Ctrl + Num+ Разворачивает группу (курсор должен быть в первой строке группы)

Ctrl + Shift + Num- Сворачивает все группы

Ctrl + Shift + Num+ Разворачивает все группы

Ctrl + Shift + R Обновить группировки

При написании текста модуля, во время завершения написания синтаксической конструкции, автоматически создаются группы для всех синтаксических конструкций любого уровня вложенности. Обновление группировок выполняется с помощью пункта Текст ‑ Группировки ‑ Обновить группировки или автоматически при сохранении текста согласно настройке показа

35.2.1.3. Работа с закладками

конструкций, вложенных только в тело процедуры или функции, но не в тело других синтаксических конструкций. Режим показа групп можно настроить. О настройке режима см. здесь.

В процессе работы с текстом модуля разработчик может отметить какую-либо строку текста для того, чтобы потом быстро перейти к отмеченному фрагменту. Такая отметка называется закладкой.

Рис. 644. Закладки в тексте

Для установки следует воспользоваться командой Текст ‑ Установить/снять закладку. Закладка отмечается цветовой меткой в колонке, левее текста модуля.

Также имеется возможность перейти к следующей (команда Текст ‑ Следующая закладка) или предыдущей закладке (команда Текст ‑ Предыдущая закладка), а также удалить все установленные закладки (Текст ‑ Убрать все закладки).

Список всех установленных закладок можно увидеть в специльном списке, который открывается с помощью команды Правка ‑ Список закладок.

Рис. 645. Список закладок

С помощью данного списка можно перейти сразу к нужной закладке, удалить одну, конкретную, закладку или сразу все. Следует помнить, что переход к закладке осуществляется только с помощью специальной кнопки. Нажатие на кнопку ОК не вызывает переход к отмеченной закладке.

Также следует отметить, что система сохраняет список закладок между сеансами редактирования

35.2.1.4.1. Форматирование синтаксических конструкций

Копировать в буфер обмена Процедура СледующийЭлемент(Справочник, Выборка) Пока Истина Цикл Если Выборка.Следующий() = Ложь Тогда Выборка = Справочник.Выбрать(); Продолжить; Иначе Прервать; КонецЕсли; Если Выборка.ЭтоГруппа Тогда Продолжить; КонецЕсли; Возврат; КонецЦикла; КонецПроцедуры

35.2.1.4.2. Вставка/удаление признака комментария

Редактор текстов системы «1С:Предприятие» включает ряд режимов, облегчающих разработку модулей.

Хорошим стилем написания модулей считается использование синтаксического отступа ‑ выделения лидирующими пробелами (табуляцией) управляющих конструкций встроенного языка системы «1С:Предприятие», например, так, как это показано в приведенном ниже фрагменте модуля.

В данном фрагменте строки модуля, расположенные внутри структурных операторов Если … Тогда … КонецЕсли и Пока … Цикл … КонецЦикла, смещены вправо, чтобы подчеркнуть их «вложенность». Текст модуля, отформатированный с использованием синтаксического отступа, удобнее в восприятии и проще в отладке.

Текстовый редактор системы «1С:Предприятие» предоставляет функции автоматического форматирования управляющих конструкций встроенного языка. Для настройки автоматического форматирования в режиме установки параметров системы (команда Сервис ‑ Параметры главного меню конфигуратора, закладка Модули) можно выбрать один из двух видов отступа.

Синтаксический отступ выполняет автоматическое форматирование текста модуля, смещая вправо текст, расположенный внутри управляющих конструкций типа Если … Тогда … КонецЕсли и Пока … Цикл … КонецЦикла и подобных. Смещение выполняется за счет добавления в начало строк необходимого количества знаков табуляции.

«Обыкновенный» отступ автоматически выравнивает текст строки по левой границе предыдущей строки.

Если автоотступ отключен, никаких дополнительных символов в текст добавляться не будет.

Кроме автоматического форматирования текста модуля в процессе ввода можно также отформатировать уже введенный текст. Для этого необходимо выделить блок текста, который требуется отформатировать, и выбрать пункт Текст ‑ Блок ‑ Форматировать. При этом текстовый редактор проанализирует текст модуля и выполнит его форматирование, при котором содержимое каждой синтаксической конструкции будет сдвинуто вправо на величину табуляции независимо от первоначального расположения строк (лидирующих пробелов). В пустые строки устанавливаются знаки табуляции в соответствии с синтаксической конструкцией.

Блок текста также можно целиком сдвигать вправо или влево с шагом табуляции. Для этого необходимо выделить блок текста и выбрать команду Текст ‑ Блок ‑ Сдвинуть вправо (Текст ‑ Блок ‑ Сдвинуть влево).

Текстовый редактор системы «1С:Предприятие» осуществляет автоматическое удаление пробелов на концах строк. Это выполняется при записи модуля.

35.2.1.4.3. Вставка/удаление переноса строки

35.2.1.5. Переход по процедурам и функциям модуля

модуля, чтобы они не исполнялись при работе системы. Обычно это выполняется путем превращения таких строк в комментарии ‑ добавлением перед ними признака комментария «//». Позднее, чтобы опять «включить» закомментированные строки в работу, признак комментария удаляется.

Для выключения (и последующего включения) больших фрагментов модуля удобно использовать режим автоматической установки признаков комментария у всех строк выделенного блока или текущей строки (ее выделять не обязательно).

Для этого следует выделить блок текста или установить указатель на нужную строку и выбрать пункт Текст ‑ Блок ‑ Добавить комментарий (Текст ‑ Блок ‑ Удалить комментарий).

При удалении комментария, если перед строкой установлено несколько признаков комментария, удаляется только один.

При написании значения строковых констант для переноса строки используется символ «|».

Текстовый редактор позволяет легко добавлять или удалять этот символ в предварительно выделенные строки.

Для вставки/удаления символа переноса у всех строк выделенного блока или текущей строки (ее выделять не обязательно) нужно указать область и выбрать пункт Текст ‑ Блок ‑ Добавить перенос строки для вставки и Текст ‑ Блок ‑ Удалить перенос строки для удаления.

Символ переноса вставляется в первую значимую (не пробел и не знак табуляции) позицию каждой строки.

При значительном количестве имеющихся в модуле описаний процедур и функций удобно использовать режим поиска процедур, который предоставляет редактор текстов системы «1С:Предприятие».

Если воспользоваться командой Текст ‑ Процедуры и функции, то на экран будет выдано окно, содержащее список всех процедур и функций редактируемого модуля.

Рис. 646. Список процедур и функций

Имена процедур и функций в списке выдаются в порядке их расположения в модуле. Если установлен флажок Сортировка, список будет отсортирован по алфавиту.

Имена процедур и функций, уже расположенных в форме, имеют пиктограмму слева от наименования.

кнопку Перейти.

В списке процедур и функций в угловых скобках показываются наименования событий, процедура-обработчик которых еще не создана. Созданные процедуры и функции имеют перед наименованием пиктограмму (P() и F(х) соответственно). Состав событий, которые могут быть обработаны, определяются типом объекта и видом формы, а также составом элементов управления, расположенных в форме. При выборе такой строки в модуль добавляется текст предопределенной процедуры, а в соответствующее событие категории События ‑ ссылка на эту процедуру.

ВНИМАНИЕ! Создание процедур-обработчиков событий, определенных системой для данного модуля, необходимо выполнять в палитре свойств для формы в категории свойств События, или с помощью окна Процедуры и функции, или из поля списка Процедуры и функции. При простом копировании процедур-обработчиков событий из других модулей обработчики событий для формы не будут инициированы системой, и скопированные процедуры не будут вызываться для обработки событий.

При перемещении указателя в строку модуля наименование текущей процедуры или функции показывается в поле выбора процедуры панели инструментов Модуль (команда Процедуры и функции). С помощью этого списка можно также перейти к нужной процедуре или функции.

Для перехода к процедуре, функции и переменным достаточно указать мышью их наименование и нажать клавишу F12. Переход возможен только для процедур, функций и переменных, расположенных в данном модуле, или к экспортируемым процедурам, функциям и переменным модуля приложения, общих модулей и модулей объектов. Для того чтобы вернуться к точке, из которой был осуществлен переход к определению, необходимо нажать сочетание клавиш Ctrl + "-" (рядом с клавишей "=").

Рис. 647. Перейти к определению

Если записанное выражение состоит из частей, определенных в разных местах конфигурации, перед переходом на экран будет выведен список таких объектов для выбора перехода. Переход может осуществляться к определению переменной, определению объекта метаданных, тип которого имеет текущее выражение, или определению процедуры или функции, используемой в выражении (например, в модуле объекта, тип которого имеет выражение).

Например, для выражения Спр.НайтиПоКоду(), где Спр определен как справочник Валюты, при нажатии клавиши F12 будет выведен список перехода к определению переменной Спр и определению объекта метаданных Справочники ‑ Валюты в дереве объектов конфигурации.

Существует возможность выполнить поиск мест использования переменной, процедуры или функции. Поиск будет выполняться по всей конфигурации. Для выполнения такого поиска следует

35.2.1.6. Контекстная подсказка при вводе текстов модулей

F12).

Рис. 648. Найти использование

После выполнения поиска открывается окно с результатами поиска. Из этого окна можно перейти в соответствующий модуль с помощью двойного щелчка мышью по требуемой строке.

Первый символ в результатах поиска описывает достоверность определения каждого найденного использования. Символ «i» означает, что использование определено полностью и однозначно, а символ "!" означает, что использование переменной, процедуры или функции определено не четко.

Текстовый редактор системы «1С:Предприятие» предоставляет средство контекстного ввода выражений с использованием системных объектов, их свойств, методов, процедур и функций, наименований объектов, определенных в конфигурации, а также переменных, процедур и функций, определенных в общих модулях, модулях прикладных объектов и модулях форм. В список включаются предопределенные элементы справочников, планов счетов, планов видов характеристик и планов видов расчетов.

В список контекстной подсказки могут быть включены шаблоны текстов и ключевые слова.

ПРИМЕЧАНИЕ. Контекстная подсказка текста не поддерживается системой для текстовых документов с установленным свойством Встроенный язык.

Ввод осуществляется из списка, который выводится в виде контекстного меню в месте текущего расположения курсора (с учетом близости границ экрана).

Список вызывается нажатием комбинации клавиш Ctrl + Пробел или Ctrl + M на любой стадии набора выражения или автоматически после ввода символа «.» после выражения, представляющего собой объект, имеющий свойства и/или методы (при разрешенном вызове контекстной подсказки ‑ см. здесь).

Состав списка зависит от контекста выполнения программного модуля (см. раздел «Общее описание языка» справки по встроенному языку) и предварительно введенного текста.

На начальном этапе, когда текст еще не введен или введены только начальные символы выражения, состав списка определяется контекстом выполнения.

Список представлен в виде строк текста, отсортированных по алфавиту.

Если при открытии списка был введен фрагмент текста, то список позиционируется на первой строке, наименование которой максимально включает набранный или выделенный текст (от начала наименования). Если набранный текст не содержится в строках списка, то список позиционируется на строке, в которой максимально представлен набранный текст.

При открытом списке можно продолжить набор текста. В этом случае список будет

выбранной строки переносится в модуль, заменяя выделенный или набранный текст.

ПРИМЕЧАНИЕ. При переносе текста в модуль не вставляются параметры методов и используется контекст клиентского приложения.

В левой части строк имеются пиктограммы, показывающие вид объекта и тип места его расположения.

Пиктограмма Объект

черта (черная) ● Свойства глобального контекста,

•

Системные наборы значений,

•

Перечисления

черта (зеленая) ● Свойства объектов универсальных коллекций значений,

•

Свойства интерфейсных объектов,

•

Реквизиты прикладного объекта,

•

Предопределенные элементы

черта (синяя) Экспортируемые переменные модулей

черта (красная) Локальные переменные модуля

Р() (черная) Процедуры глобального контекста

Р() (зеленая) Процедуры интерфейсных и прикладных объектов

Р() (синяя) Экспортируемые процедуры других модулей

Р() (красная) Локальные процедуры модуля

F() (черная) Функции глобального контекста

F() (зеленая) Функции интерфейсных объектов и прикладных объектов

F() (синяя) Экспортируемые функции других модулей

F() (красная) Локальные функции модуля

Цветные строки Ключевые слова (Если, Цикл, Попытка и др.)

Картинка шаблонов Шаблон текста

Шаблон текста включается в список только в том случае, если в нем определена строка автозамены.

Если в результате набора или после выбора из списка текст будет представлять выражение, имеющее свойства или методы, то после ввода символа «.» на экран автоматически будет выведен список, содержащий возможный набор свойств и методов, предоставляемых данным выражением.

Например, при вводе текста «Справочники.» выводится список, содержащий наименования всех справочников, описанных в данной конфигурации. После выбора конкретного справочника и ввода символа «.» на экран снова будет выведен список, но, в отличие от предыдущего, в нем будут содержаться наименования процедур и функций работы со справочником, а также предопределенные элементы справочника. При выборе метода, возвращающего значение некоторого типа, также имеющего свойства и методы, контекстный ввод может быть продолжен (нужно в конце наименования ввести открывающую и закрывающую скобки). Список контекстной подсказки содержит только возможный набор, определяемый типом введенного выражения.

Для переменных модулей также можно использовать механизм контекстной подсказки. При использовании объявления переменных следует помнить о следующей особенности: для того, чтобы явно объявленные переменные попадали в контекстную подсказку, каждая переменная доллжна быть оформлена «своим» оператором Перем (см. здесь). В противном случае контекстная

Копировать в буфер обмена Перем ИмяМакета; Перем СкрыватьСкидку; Перем СальдоВзаиморасчетов;

Копировать в буфер обмена Перем ИмяМакета, СкрыватьСкидку, СальдоВзаиморасчетов;

следующем примере будут отображаться все объявленные переменные:

В следующем примере контекстная подсказка будет отображать только одну переменную: ИмяМакета:

Контекстная подсказка может использоваться при вводе оператора Новый, а также для переменных, созданных с помощью оператора Новый.

Контекстная подсказка может использоваться при вводе различных ключевых слов (например, Если, Для, Цикл и др.). Ключевые слова входят в список, вызываемый стандартным образом нажатием комбинации клавиш Ctrl + Пробел (Ctrl + M) на любой стадии набора слова.

Показ в списке ключевых слов можно настроить (см. здесь).

Если для какой-либо переменной или метода список состоит только из одной строчки, то нажатие комбинации клавиш Ctrl + Пробел (Ctrl + M) приводит к непосредственной вставке этой строки.

Контекстная подсказка также позволяет отображать перечень параметров какого-либо метода и его тип. Параметры отображаются как для объектов глобального контекста и объектов встроенного языка, так и для методов прикладного решения, описание которых соответствует определенным требованиям. Для операторов встроенного языка контекстная подсказка по параметрам не отображается. Отображение параметров начинается после ввода символов "(" или "," (можно настроить, подробнее см. здесь) или после нажатия комбинации клавиш Ctrl + Shift + Пробел (Ctrl + Shift + M), если она нажата после символа "(" вызова процедуры или функции.

Рис. 649. Контекстная подсказка параметров

Если у метода есть несколько вариантов синтаксиса, то будет отображен первый по порядку вариант. Однако перед описанием синтаксиса будут присутствовать стрелки вверх и вниз, с помощью которых можно переключаться между различными вариантами. Переключаться можно также с помощью клавиш Ctrl + Стрелка вверх и Ctrl + Стрелка вниз.

Копировать в буфер обмена <Комментарий> = [<СекцияЗаголовка>] [<СекцияПараметров>] [<СекцияВозвращаемогоЗначения>] [<СекцияПримера>] <НоваяСтрока> = Начало строки модуля <Имя> = Идентификатор встроенного языка <Тип> = <Имя> | <Имя>"."<Имя> <СписокТипов> = <Тип>{","<Тип>} <СтрокаТекста> = Произвольный текст без перевода на другую строку <Текст> = <СтрокаТекста> {<НоваяСтрока> <СтрокаТекста>} <СекцияЗаголовка> = [<Текст>] <СекцияПараметров> = <НоваяСтрока> ("Параметры:" | "Parameters:") {<ОписаниеПараметра> {<ОписаниеТипа>} } <ОписаниеПараметра> = <НоваяСтрока> <Имя> [" " <СписокТипов>] " " [<Текст>] <ОписаниеТипа> = <НоваяСтрока> " " <СписокТипов>] " " [<Текст>] <СекцияВозвращаемогоЗначения> = <НоваяСтрока> ("Возвращаемое значение:" | "Returns:") <ОписаниеЗначения> <ОписаниеЗначения> = <НоваяСтрока> [<СписокТипов> " "] [<Текст>] <СекцияПримера> = <НоваяСтрока> ("Пример:" | "Sample:") <НоваяСтрока> <Текст>

Если значение может быть нескольких типов, эти типы будут перечислены через запятую. Имя типа является гиперссылкой, нажатие на которую приведет к открытию синтакс-помощника (см. здесь) с информацией о типе. Контекстная подсказка параметров закрывается после ввода символа ")" или нажатия клавиши Esc при открытом окне контекстной подсказки параметров.

Для того чтобы контекстная подсказка показывала описание параметров и их типы для методов прикладного решения, перед началом метода должен располагаться комментарий, выполненный по определенным правилам. В общем случае, описание процедуры или функции состоит из следующих секций:

•

секция Описание ‑ содержит краткое описание назначения и/или принципов работы процедуры или функции, может быть единственной секцией для функций без параметров;

•

секция Параметры ‑ описывает параметры процедуры или функции. Если параметров нет ‑ секция пропускается;

•

секция Возвращаемое значение ‑ описывает тип и содержание возвращаемого значения функции. Для процедур эта секция отсутствует;

•

секция Пример ‑ содержит пример использования процедуры или функции.

Общий формат комментария следующий:

В результате, комментарий перед началом процедуры или функции, оформленный в соответствии с описанным форматом, приведет к тому, что контекстная подсказка параметров методов будет адекватно показывать подсказку для метода прикладного решения.

Рис. 651. Контекстная подсказка параметров методов прикладного решения

Таким образом, механизм контекстной подсказки текстового редактора системы «1С:Предприятие»

35.2.1.7.1. Общая информация

35.2.1.7.2. Выделить фрагмент

35.2.1.7.3. Переименовать

Рефакторинг ‑ процесс переработки кода на встроенном языке с целью добиться улучшения читаемости кода и общей внутренней структуры при полном и точном сохранении изначального смысла и поведения. Конфигуратор предлагает несколько встроенных инструментов, которые могут помочь при проведении рефакторинга прикладного решения. Доступ к этим инструментам выполняется с помощью подменю Рефакторинг контекстного меню редактора текста встроенного языка или с помощью одноименного подменю меню Текст главного меню конфигуратора.

Далее средства рефакторинга будут рассмотрены более подробно. В этом рассмотрении будут использоваться следующие термины:

•

Блок ‑ множество строк между ключевыми словами Тогда…КонецЕсли, Тогда…Иначе, Тогда… ИначеЕсли, Цикл…КонецЦикла, Попытка…Исключение, Исключение…КонецПопытки, Процедура… КонецПроцедуры, Функция…КонецФункции;

•

Терминальный вызов ‑ вызов, являющийся последней выполняемой инструкцией метода встроенного языка:

•

Располагается перед ключевым словом КонецПроцедуры, КонецФункции или Возврат;

•

Является последним в рекурсивно-последнем блоке инструкций метода.

•

Асинхронный метод ‑ метод, который может использоваться в цепочках вызовов с использованием обработчиков оповещений.

Данная команда преобразует выделенный, синтаксически целостный, фрагмент кода в отдельную процедуру или функцию. Тип выделяемого фрагмента зависит от итоговых областей видимости переменных родительского метода и структуры фрагмента.

В том случае, когда выделенный фрагмент может выступать источником в операторе присваивания (см. здесь), фрагмент будет выделен как функция. Так же в функцию выделяется фрагмент, в котором инициализируется единственная переменная, которая используется в оставшейся части родительского метода. В остальных случаях фрагмент выделяется в процедуру.

В случае использования переменных выделяемого фрагмента в оставшейся части родительского метода, эти переменные передаются выделяемому методу в виде параметров, с их предварительной инициализацией или объявлением (при наличии такой необходимости).

Если родительский метод (из которого выделяется фрагмент) предваряется какой-либо директивой компиляции (см. здесь), то выделяемый метод также будет предваряться точно такой же директивой компиляции.

Код нового метода размешается сразу после кода родительского метода (из которого выделяется фрагмент) и соответствующим образом форматируется (см. здесь).

Данная команда предназначена для изменения имени переменной или метода. Если обращение к экспортной переименуемой переменной или методу нельзя определить однозначно, то переименование не выполняется и выводится список использования переменной или метода.

Для экспортных переменных и методов модуля формы производится анализ уникальности идентификатора в рамках всей конфигурации и отсутствия синонимов среди методов и свойств объектов платформы. В случае выполнения этого условия пользователю предлагается возможность глобальной замены идентификатора во всех местах его возможного использования.

Переименование параметра метода не приводит к изменению имени этого параметра в комментариях, включая и описание метода (созданное любым образом).

35.2.1.7.4. Создать описание метода

35.2.1.7.5. Создать обработку оповещения

35.2.1.7.6. Работа с нерекомендуемыми синхронными вызовами

Общая информация

Преобразовать вызов

качестве строкового литерала:

•

в конструкторы объектов:

•

Действие;

•

ОписаниеОповещения.

•

методы глобального контекста:

•

УстановитьДействие();

•

ПодключитьОбработчикИзмененияДанных();

•

ОтключитьОбработчикОжидания();

•

ПодключитьОбработчикОжидания();

•

ПодключитьОбработчикОповещения().

Переименование метода-обработчика в модуле формы приводит к автоматически замене ссылки на переименуемый обработчик в соответствующих свойствах элементов формы и командах. Когда выполняется переименование метода-обработчика из палитры свойств элемента формы или команды ‑ автоматически переименовываются все вызовы данного обработчика из программного кода (если таковые встречаются).

Команда создает перед объявлением метода комментарий, который будет использоваться для контекстной подсказки при вводе текста модулей (см. здесь).

Данная команда предназначена для упрощения применения асинхронных методов встроенного языка (см. здесь). Команда становится доступной после того, как введено имя метода и открывающая круглая скобка (курсор должен располагаться на имени метода). Дальнейшее поведение команды эквивалентно поведению команды рефакторинга Преобразовать вызов, за исключением переименования метода, к которому применена команда рефакторинга. Если метод уже содержит передачу объекта типа ОписаниеОповещения, то перед продолжением работы пользователю предлагается подтвердить выполнение команды.

Данный раздел описывает команды рефакторинга, которые помогают при переработке кода прикладного решения для использования асинхронных вызовов взамен синхронных вызовов (см. здесь).

Команда заменяет тривиальные и простые случаи использования синхронных методов на их асинхронные аналоги (см. здесь).

Тривиальным считается случай, преобразование которого затрагивает только один метод и не требует операций, отличных от выделения фрагмента. При наличии следующих признаков, использование модального вызова считается тривиальным:

1. Вызов расположен в процедуре, не вызываемой из других процедур и функций, за

Преобразовать в асинхронную процедуру

наблюдается, то случай может быть простым или требовать преобразование в асинхронную процедуру (см. здесь).

2. Вызов расположен вне блоков цикла, за исключением случая инструкций Прервать или Возврат, следующих на том же уровне вложенности.

3. Вызов расположен вне блоков перехвата исключения.

4. Уровень вложенности модального вызова не превышает 2, за исключением рекурсивно-последних инструкций блока. Уровень вложенности модального вызова можно уменьшить с помощью команды выделения фрагмента (см. здесь). Если выделяемый фрагмент содержит оператор Возврат, то для выделения такого фрагмента следует использовать команду выделения фрагмента в асинхронную процедуру (см. здесь).

5. Параметры процедуры не изменяются после вызова модального диалога ‑ ни в самой процедуре, ни в одном из вложенных вызовов.

Простым считается случай, не удовлетворяющий только первому условию тривиальности и, требующий дополнительно только преобразование процедуры или функции, содержащей синхронный вызов в асинхронный вид. При обнаружении такого синхронного вызова, и если такое преобразование возможно, система автоматически предлагает выполнить преобразование в асинхронную процедуру (см. здесь).

Результатом преобразования являются:

•

Исходная процедура с заменой синхронного вызова на асинхронный вызов;

•

Процедура обработки оповещения. Если синхронный вызов являлся последней инструкцией родительского блока ‑ решение о создании пустой процедуры принимает пользователь

•

Фрагмент-окончание ‑ общий для исходной процедуры и процедуры обработки оповещения код, в случае, когда вызов синхронного метода не входит в единственную последовательность выполнения кода.

Если случай не соответствует одному или нескольким требованиям, пользователю предоставляется возможность выполнить частичное преобразование: максимальный синтаксически-корректный фрагмент кода будет выделен в процедуру обработки оповещения, и после вызова асинхронного метода будет вызвано исключение. В код модуля будет так же добавлен комментарий с описанием причин несоответствия.

Команда используется для преобразования метода к виду, который допускает использование метода в асинхронных вызовах. Преобразование затрагивает все уже существующие последовательности вызовов с участием выбранного метода, однако методы, которые вызываются из преобразуемого метода, не подвергаются преобразованию. Данную команду следует применять в тех случаях, когда необходимо преобразовать модальный вызовы (один или несколько) внутри функции или процедуры, вызываемой из других методов. После выполнения данной команды будет необходимо преобразовать модальный вызов в его блокирующий аналог с помощью команды преобразования модального вызова (см. здесь).

Преобразование методов, изменяющих свои ссылочные параметры, не поддерживается в целях предотвращения труднодиагностируемых логических ошибок. Также не поддерживается преобразование последовательностей вызовов, содержащих непосредственный вызов процедур обработки событий форм и объектов метаданных в связи со строго фиксированным списком их формальных параметров. Если преобразование затрагивает несколько модулей ‑ от пользователя требуется дополнительное подтверждение.

Рассмотрим пример преобразования вызова в асинхронный вид.

ПРИМЕЧАНИЕ. Данный пример служит исключительно для демонстрации процесса преобразования и не является примером выполнения каких-либо действий.

&НаКлиенте Перем ПроцедураВыполнена; &НаКлиенте Перем ФункцияВыполнена; &НаКлиенте Процедура КомандаФормы(Команда) ПроцедураВыполнена = Ложь; ФункцияВыполнена = Ложь; ВыполнитьПроцедуру(); КонецПроцедуры &НаКлиенте Процедура ВыполнитьПроцедуру() Результат = ВыполнитьФункцию(); ПроцедураВыполнена = Истина; КонецПроцедуры &НаКлиенте Функция ВыполнитьФункцию() ПоказатьДиалог(); ФункцияВыполнена = Истина; Возврат Истина; КонецФункции &НаКлиенте Процедура ПоказатьДиалог() Предупреждение("Предупреждение!"); КонецПроцедуры

Копировать в буфер обмена &НаКлиенте Перем ПроцедураВыполнена; &НаКлиенте Перем ФункцияВыполнена; &НаКлиенте Процедура КомандаФормы(Команда) ПроцедураВыполнена = Ложь; ФункцияВыполнена = Ложь; ВыполнитьПроцедуру(Неопределено); КонецПроцедуры &НаКлиенте Процедура ВыполнитьПроцедуру(Знач Оповещение) Результат = Неопределено; ВыполнитьФункцию(Новый ОписаниеОповещения("ВыполнитьПроцедуруЗавершение", ЭтотОбъект, Новый Структура("Оповещение", Оповещение))); КонецПроцедуры &НаКлиенте Процедура ВыполнитьПроцедуруЗавершение(Результат1, ДополнительныеПараметры) Экспорт Оповещение = ДополнительныеПараметры.Оповещение; Результат = Результат1; ПроцедураВыполнена = Истина; ВыполнитьОбработкуОповещения(Оповещение); КонецПроцедуры

Выполнять преобразование следует для метода ПоказатьДиалог().

Цепочка вызовов начинается при вызове из обработчика команды формы (процедура КомандаФормы()) процедуры Процедура1(). Действия, выполняемые в методах ВыполнитьПроцедуру() и ВыполнитьФункцию() в данном примере являются демонстрацией наличия некоторого программного кода после вызова другой процедуры.

Цепочка вызовов выглядит следующим образом: КомандаФормы() ‑> ВыполнитьПроцедуру() ‑> ВыполнитьФункцию() ‑> ПоказатьДиалог().

Т. к. в самом «низу» стека вызовов вызывается модальный диалог, то всю цепочку вызовов методов необходимо преобразовать к асинхронному виду. Метод Предупреждение() может быть заменен на асинхронный аналог, для других процедур этот аналог будет создаваться системой.

Выполним преобразование метода ПоказатьДиалог() и отказаться от предложения создания пустых обработчиков оповещения. В результате получится следующий программный код:

ПоказатьДиалог(Новый ОписаниеОповещения("ВыполнитьФункциюЗавершение", ЭтотОбъект, Новый Структура("Оповещение", Оповещение))); КонецПроцедуры &НаКлиенте Процедура ВыполнитьФункциюЗавершение(Результат, ДополнительныеПараметры) Экспорт Оповещение = ДополнительныеПараметры.Оповещение; ФункцияВыполнена = Истина; ВыполнитьОбработкуОповещения(Оповещение, Истина); Возврат; КонецПроцедуры &НаКлиенте Процедура ПоказатьДиалог(Знач Оповещение) Предупреждение("Предупреждение!"); ВыполнитьОбработкуОповещения(Оповещение); КонецПроцедуры

Выделить в асинхронную процедуру

Найти вызовы модуля

Преобразовать вызовы модуля

Анализ нерекомендуемых синхронных вызовов конфигурации

Во время преобразования не был изменен вызов модального вызова Предупреждение() в методе ПоказатьДиалог(), т. к. замена модального вызова не является задачей описываемой команды. Также стоит отметить, что все преобразуемые методы теперь получают в качестве входного параметра описание оповещения. Теперь цепочка вызовов выглядит следующим образом: КомандаФормы() ‑> ВыполнитьПроцедуру() ‑> ВыполнитьФункцию() ‑> ПоказатьДиалог() ‑> ВыполнитьФункциюЗавершение() ‑> ВыполнитьПроцедуруЗавершение(). Вызов методов с суффиксом Завершение выполняется с помощью передачи оповещений.

Данная команда преобразует выделенный, синтаксически целостный, фрагмент кода в отдельную процедуру или функцию, одновременно преобразуя выделяемый метод к асинхронному виду.

Команда выводит список использования нерекомендуемых синхронных методов в текущем модуле.

Команда выполняет преобразование всех тривиальных (см. здесь) случаев использования нерекомендуемых синхронных вызовов в их асинхронные версии (см. здесь). Преобразование выполняется в рамках текущего модуля.

С помощью данной команды (Главное меню ‑ Конфигурация ‑ Рефакторинг ‑ Анализ нерекомендуемых синхронных вызовов конфигурации) во всей конфигурации выполняется поиск нерекомендуемых синхронных вызовов и анализ возможности их преобразования. Если в каком-то случае преобразование будет невозможно ‑ система укажет причину этой невозможности.

Во время выполнения анализа нерекомендуемых синхронных вызовов, учитываются следующие особенности прикладного решения:

•

Выполняется анализ всех модулей, которые могут исполняться на стороне клиентского приложения.

•

Не выполняется анализ модулей, которые не могут исполняться на стороне клиентского приложения:

•

модули Web-сервисов;

35.2.1.8. Синтаксический контроль модуля

•

общие модули, которые могут исполняться только во внешнем соединении.

•

Выполняется анализ процедур и функций, которые предваряются следующими директивами компиляции (см. здесь):

•

&НаКлиенте;

•

&НаКлиентеНаСервере;

•

&НаКлиентеНаСервереБезКонтекста.

•

Выполняется анализ фрагментов текста процедур и функций, которые обрамлены инструкциями препроцессора (см. здесь):

•

Клиент;

•

ТонкийКлиент;

•

ВебКлиент;

•

ТолстыйКлиентУправляемоеПриложение;

•

ТолстыйКлиентОбычноеПриложение.

Флажок Отображать методы объектов неопределенного типа указывает системе, что следует включать в результат поиска методы, которые являются синхронными, но однозначно нельзя определить объект, у которого они вызываются.

Если в диалоге настройки поиска выбран флажок Производить преобразование найденных вызовов, то выполняется преобразование только тривиальных (см. здесь) случаев использования синхронных вызовов с выводом результатов операции.

Редактируемый модуль может быть проверен на правильность использования синтаксических конструкций встроенного языка. Для выполнения синтаксического контроля модуля необходимо воспользоваться пунктом Текст ‑ Проверка модуля.

Синтаксический контроль выполняется в следующей последовательности:

•

общие модули,

•

модуль управляемого приложения,

•

модуль объекта,

•

модуль формы.

При этом контроль модулей выполняется, если модуль еще не проходил контроля или был модифицирован.

При контроле модуля проверяются только те модули, которые в списке расположены до данного модуля. Например, при проверке модуля приложения проверяются только общие модули. Модуль внешнего соединения проверяется только при его редактировании.

При наличии ошибок их список будет выдан в окне сообщений с указанием полного адреса месторасположения и описания ошибки. При подведении указателя мыши к строке, содержащей сообщение об ошибке, он принимает вид увеличительного стекла. Для перехода к строке модуля, вызвавшей ошибку, следует дважды щелкнуть мышью по этому сообщению. Если модуль, содержащий ошибку, закрыт, он будет открыт автоматически.

Если ошибки не обнаружены, в окно сообщений будет выдано сообщение об отсутствии ошибок в модуле.

В режиме настройки параметров конфигуратора (пункт главного меню Сервис ‑ Параметры,

35.2.1.9. Ограничение доступа к модулям конфигурации

35.2.1.9.1. Установка пароля доступа

35.2.1.9.2. Открытие защищенного модуля

модуля или при сохранении конфигурации в целом будет выполняться синтаксический контроль модуля. Режим автоматической проверки удобно использовать, когда производится отладка какого-либо элемента конфигурации.

Для полного синтаксического контроля всех модулей конфигурации за один проход следует выбрать пункт Конфигурация ‑ Проверка модулей.

В процессе исправления ошибок в модулях можно получить подсказку по встроенному языку, вызвав синтакс-помощник и найдя в нем описание нужного элемента встроенного языка (см. здесь).

Подсказку по конкретному элементу языка (оператору, процедуре, функции, свойству, методу) можно получить, если поместить курсор в модуле на этот элемент языка и нажать клавиши Ctrl + F1. В синтакс-помощнике будет выдано описание выбранного элемента встроенного языка.

Для некоторых модулей можно установить пароль доступа. Основное назначение пароля ‑ защита авторских прав разработчиков конфигураций.

При установке пароля существуют следующие ограничения:

•

не защищается модуль управляемого приложения;

•

не защищаются модули форм;

•

не защищаются модули команд;

•

не защищаются модули, включающие директивы препроцессора;

•

не защищаются клиентские общие модули, работающие в управляемом режиме (тонкий клиент, веб-клиент и управляемый режим толстого клиента).

Для установки пароля нужно открыть требуемый модуль и выбрать команду Текст ‑ Установить пароль. Пункт доступен, если модуль открыт для записи.

Если модуль содержит директивы препроцессору, то программа выводит предупреждение: Защищенный модуль не должен содержать директив препроцессора. Продолжить? Если нажать кнопку Нет, то попытка установки пароля не производится. Если нажать кнопку Да, то установка пароля становится возможной, и подразумевается, что в дальнейшем директивы будут удалены. Если директивы не удалить, то в режиме 1С:Предприятие методы такого общего модуля будут недоступны (ошибка Метод объекта не обнаружен <Имя метода>).

На экран выводится диалог ввода пароля.

Рис. 652. Установка пароля на модуль

Нужно ввести пароль и повторить его. Для установки пароля нажать кнопку ОК, для отказа от установки ‑ кнопку Отмена.

Если на модуль установлен пароль доступа, то при попытке открыть модуль выводится диалог ввода пароля.

35.2.1.9.3. Смена пароля

35.2.2. Редактирование текстовых макетов

35.2.2.1. Формат текстового макета

Копировать в буфер обмена #Область ХХХХХ #КонецОбласти

Копировать в буфер обмена #Область Заголовок1 RU #КонецОбласти #Область Заголовок1 EN #КонецОбласти

Копировать в буфер обмена #Область ХХХХХ [служебная часть] [текстовая часть] #КонецОбласти

35.2.2.2. Служебная часть области

Рис. 653. Открытие модуля с установленным паролем

Если пароль указан верно, то модуль открывается. Если введен неправильный пароль, то выводится предупреждение Некорректный пароль и модуль не открывается.

Для смены пароля нужно открыть модуль и выбрать команду Текст ‑ Установить пароль. На экран выводится диалог ввода пароля. Следует ввести прежний пароль. Если пароль введен правильно, то на экран выводится диалог ввода нового пароля (см. здесь).

Для снятия пароля нужно очистить поля для ввода пароля и, не вводя значения пароля, нажать кнопку ОК.

Если в конструкторе макетов в качестве типа макета выбран Текстовый документ, то открывается текстовый редактор в режиме ввода текстового макета.

Режим редактирования текстового макета также доступен для текстовых документов с установленным расширением Текстовый макет.

Весь текст макета делится на области. Области должны следовать друг за другом и не могут пересекаться или включаться друг в друга. В тексте макета области выделяются следующим образом:

Где ХХХХХ ‑ имя области.

Конец области указывать не обязательно. Объявление начала области означает окончание предыдущей области.

Для хранения вариантов области на нескольких языках после имени области может следовать код языка, для которого написана область.

Если для какого-либо варианта области код языка не указан, то этот вариант области будет возвращаться, когда в метод ПолучитьОбласть() передан код языка, не указанный ни в одном из вариантов описаний областей.

Каждая область состоит из служебной и текстовой частей.

35.2.2.2.1. Структура служебной части области

35.2.2.2.2. Описания полей

Копировать в буфер обмена #Поле ВидРаботы #Выравнивание ПоШирине

Копировать в буфер обмена #Поле Дата1 #Формат "ДФ=dd.MM.yy" #Поле Вр1 #Формат "ЧЦ=4; ЧДЦ=0; ЧРД=."

Копировать в буфер обмена #Поле ИтогОтчета #Формат "ЧЦ=18; ЧДЦ=2; ЧРД=." #Забивать Истина

которые начинаются специальным символом «#». В служебной части описываются поля текстового макета, используемые внутри области. Если нет надобности в служебной части, она может отсутствовать.

Управляющие конструкции текстового макета выделяются цветом.

Служебная часть области состоит из описаний некоторых общих параметров области и описаний форматов полей, входящих в область. Все описания, сделанные в служебной части области, действуют только в пределах области. Если в некоторой области описан формат поля и оно же встречается в другой области без описания формата, для него в другой области будет использоваться формат по умолчанию.

В начале служебной части области может следовать ключевое слово общей области #ЗаменаСимвола A B. С его помощью будет производиться замена символов внутри строк области;

•

A ‑ символ, который будет заменен;

•

B ‑ символ, которым будет заменен символ A.

Символы должны быть заключены в одинарные кавычки.

Например, если написать #ЗаменаСимвола "@" "#", то внутри строк символы «@», не входящие в названия полей, будут заменены на «#».

Имеет смысл использовать данное ключевое слово в тех случаях, когда в оформление строк макета должен входить символ # (его непосредственное использование указывало бы на служебный характер текста).

После описания замены следует описание форматов полей, используемых в области.

Поле создается с помощью ключевого слова #Поле ПППП, где ПППП ‑ имя поля, формат которого будет описываться.

Далее на следующих строках размещаются ключевые слова для описания поля. Описание поля действует до начала описания следующего поля.

#Выравнивание {Лево | Право | Центр | ПоШирине} ‑ указывает выравнивание поля в пределах отведенных для него знакомест.

#Формат <Форматная строка> ‑ указывает форматную строку для вывода поля.

#Забивать <Параметр> ‑ указывает необходимость забивки области, отведенной для поля, символами «#». Если <Параметр> = Истина и содержимое поля не помещается в отведенное место, будет выполняться забивка.

Копировать в буфер обмена ![Имя ]! [Код ]! [Наименование ] !

Копировать в буфер обмена #Поле Номер #Формат "ЧЦ=3; ЧДЦ=0" #Поле Код #Формат "ЧЦ=5; ЧДЦ=0" #Поле Пометка #Формат "ЧЦ=1" ![ ]! [ Код]![ Наименование ]! [! #Поля Номер Пометка

35.2.2.3.1. Автоматический перенос

Копировать в буфер обмена ![ YY]! [XX ]![ ZZ]! ! ! {XX }! ! ! ! <XX >! !

последней строки, принадлежащей служебной части области, и продолжается до конца области. Внутри строк текстового макета можно указать имя поля: [ПППП].

Количество знакомест, отводимых под поле, соответствует количеству знакомест, указанных скобками (включая скобки). Если размер поля составляет один символ, допускается использование одной скобки. Например:

Если имя поля прижато к левой скобке, считается, что поле имеет левое выравнивание, а если к правой скобке, то правое выравнивание. Если пробелы есть слева и справа от имени поля, оно будет центрироваться в пределах отведенных под него знакомест.

Если имя поля больше, чем количество знакомест, отводимых под поле, имя поля указывается с помощью ключевого слова Поля.

Пример:

Параметры в ключевом слове Поля указываются только для тех полей, имена которых не указаны в теле макета в скобках.

Если текст не умещается в отведенный размер поля, может возникнуть необходимость использовать автоматический перенос текста на новую строку. Для этого предлагается использовать указание расположения поля в макете в фигурных и угловых скобках:

•

{ПППП} ‑ область поля ограничена фигурными скобками. Они показывают, что автоперенос текста, хранящегося в поле ПППП, возможен на эту строку, и указывают область для не поместившегося ранее в поле ПППП текста. При этом, даже если в строке нет необходимости выводить ни одно из полей, строка все равно будет выведена.

•

<ПППП> ‑ область поля ограничена угловыми скобками. Они показывают, что автоперенос текста, хранящегося в поле ПППП, возможен, и указывают область для не поместившегося на предшествующей строке в поле ПППП текста. При этом, если все поля, имеющиеся в строке, указаны в угловых скобках, но ни одно из них не потребовалось для вывода текста, строка не будет выведена. Если при выводе текста из поля в строку, в которой поле размещено в угловых скобках, текст все равно не уместится, такая строка будет размножена до тех пор, пока не удастся вывести весь текст из поля.

Пример:

В этом примере указывается, что поле XX размещается на первой строке. На второй строке размещается та часть поля XX, которая не поместилась на первой строке. На третьей строке размещается часть поля ХХ, которая не поместилась ни на первой, ни на второй строке. При этом если в поле ХХ для третьей строки текста не осталось, она совсем не выводится, а если осталось, то третья строка будет выводиться до тех пор, пока не закончится текст из поля XX.

Область (Area)

Описание:

Указывается начало области макета, а если предшествующая область не закончена, то конец предшествующей.

Синтаксис:

#Область <Имя области> <Код языка>

Параметры:

Обязательный<Имя области>

Указывается имя области, по которому производится ее получение методом ПолучитьОбласть() текстового документа.

Необязательный<Код языка>

Указывается код языка области. Если предполагается использование конфигурации на нескольких языках, то в текстовом макете можно указать несколько областей с одинаковыми именами, но тогда каждая область должна содержать код языка. Если код языка не указан, то такая область выбирается в том случае, когда область запрашивается с кодом языка, отсутствующим в описании областей.

КонецОбласти (EndOfArea)

Описание:

Указывается явный конец области макета.

Синтаксис:

#КонецОбласти

ЗаменаСимвола (ReplaceChar)

Описание:

С помощью данного ключевого слова будет производиться замена символов внутри строк области.

Синтаксис:

#ЗаменаСимвола <Заменяемый символ> <Символ замены>

Параметры:

Обязательный<Заменяемый символ>

В одинарных кавычках указывается символ, который будет заменен.

Обязательный<Символ замены>

Указывается символ, на который будет заменен <Заменяемый символ>.

Поле (Field)

Описание:

Указывается поле, для которого необходимо указать ключевые слова форматирования.

Синтаксис:

#Поле <Имя поля>

Параметры:

Копировать в буфер обмена "ДФ=dd.MM.yy"

Имя поля.

Выравнивание (Align)

Описание:

Указывается выравнивание при выводе содержимого поля.

Синтаксис:

#Выравнивание <Параметр выравнивания>

Параметры:

Обязательный<Параметр выравнивания>

Значение выравнивания поля. Может принимать следующие значения:

•

Лево (Left),

•

Право (Right),

•

Центр (Center),

•

ПоШирине (Justify).

Формат (Format)

Описание:

Указывается формат вывода поля.

Синтаксис:

#Формат <Форматная строка>

Параметры:

Обязательный<Форматная строка>

Определяет формат представления значения поля.

Пример:

Забивать (Block)

Описание:

Если значение параметра Истина, то устанавливается забивка, при которой в поле, значение которого не помещается в отведенное место, выводится символ «#» во всем отведенном месте.

Синтаксис:

#Забивать <Параметр>

Параметры:

Необязательный<Параметр>

Определяет необходимость забивки поля. Может принимать значения:

•

Истина (True),

•

Ложь (False).

35.2.2.5. Пример печати расходной накладной

Копировать в буфер обмена #Область Шапка RU Расходная накладная N [НомерДокумента ] От: [От ] Кому: [Кому ] ================================================= | N| Наименование | Цена |Штук| Сумма | #Область Строка RU #Поле Цена #Формат "ЧЦ=10; ЧДЦ=2; ЧРД=." #Поле Штук #Выравнивание Право #Формат "ЧЦ=4; ЧДЦ=0; ЧРД=." #Поле Сумма #Формат "ЧЦ=12; ЧДЦ=2; ЧРД=." | + + + + | |<span class="operator">[</span><span class="operator">]</span>|<span class="operator"> [</span>Наименование <span class="operator">]</span>|<span class="operator">[</span> Цена<span class="operator">]</span>|<span class="operator">[</span> <span class="operator">]</span>|<span class="operator">[</span> Сумма<span class="operator">] </span>|#Поля Номер Штук | |<Наименование >| | | | #Область Подвал RU #Поле ИтогоШтук #Выравнивание Право #Формат "ЧЦ=4; ЧДЦ=0; ЧРД=." #Поле ИтогоСумма #Выравнивание Право #Формат "ЧЦ=12; ЧДЦ=2; ЧРД=." ================================================= Итого [ ] [ИтогоСумма] #Поля ИтогоШтук Директор: [Директор ]

Копировать в буфер обмена Процедура ПечатьВТекст(Кнопка) ТекДок = Новый ТекстовыйДокумент(); ПечатьТекст(ТекДок); ТекДок.Показать();

Указывается список полей, имена которых нельзя указать в месте их расположения.

Синтаксис:

#Поля <Имя поля 1> <Имя поля 2> … <Имя поля N>

Параметры:

Обязательный<Имя поля>

Имя поля. Обязательно указывать все имена полей, которые не указаны в тексте области макета.

Предполагается, что объект конфигурации Документ с именем Расходная накладная имеет в списке макетов текстового типа макет с именем ПечатьТекст:

Макет содержит следующие области:

•

Шапка ‑ для вывода заголовка отчета;

•

Строка ‑ для вывода табличной части;

•

Подвал ‑ для вывода итоговых данных.

В форме документа размещена кнопка Печать. Ее нажатие вызывает событие Нажатие(), процедура-обработчик которого размещена в модуле формы.

Копировать в буфер обмена Процедура ПечатьТекст(ТекДок) Экспорт // Получение макета Макет = ПолучитьМакет("ПечатьТекст"); // Установим код языка Макет.КодЯзыкаМакета = "RU"; // Заголовок Область = Макет.ПолучитьОбласть("Шапка"); Область.Параметры.НомерДокумента = Номер; Область.Параметры.От = Формат(Дата,"ДФ=dd.MM.yyyy"); Область.Параметры.Кому = Контрагент; ТекДок.Вывести(Область); // Обработка табличной части "Состав" СтрИтого = Новый Структура("ИтогоШтук, ИтогоСумма",0,0); Для Каждого СтрСостава Из Состав Цикл Область = Макет.ПолучитьОбласть("Строка"); Область.Параметры.Номер = СтрСостава.НомерСтроки; Область.Параметры.Наименование = СтрСостава.Номенклатура; Область.Параметры.Штук = СтрСостава.Количество; Область.Параметры.Цена = СтрСостава.Цена; Область.Параметры.Сумма = СтрСостава.Сумма; ТекДок.Вывести(Область); СтрИтого.ИтогоШтук = СтрИтого.ИтогоШтук + СтрСостава.Количество; СтрИтого.ИтогоСумма = СтрИтого.ИтогоСумма + СтрСостава.Сумма; КонецЦикла; // Подвал Область = Макет.ПолучитьОбласть("Подвал"); Область.Параметры.Заполнить(СтрИтого); РС = РегистрыСведений.ОтветственныеСотрудники; Область.Параметры.Директор = РС.ПолучитьПоследнее(Дата).Директор; ТекДок.Вывести(Область); КонецПроцедуры

35.2.3. Редактирование текстов шаблонов

35.2.4. Редактор текста запросов

35.3. Редактор командного интерфейса конфигурации

которая заполняет текстовый документ на основе данных расходной накладной. Процедура расположена в модуле документа. После заполнения документа он выводится на экран.

Текст процедуры ПечатьТекст():

Помимо возможностей текстового редактора модулей, редактор текстов шаблонов позволяет создавать и редактировать имеющиеся шаблоны (подробнее о шаблонах см. здесь).

В данном режиме текстовый редактор помимо основных возможностей обладает рядом дополнительных.

Синтаксические конструкции языка запросов выделяются цветом. Описание языковых конструкций см. здесь или раздел «Работа с запросами» справки по встроенному языку.

В список доступных команд текстового редактора добавляются команды установки и снятия комментария.

В режиме 1С:Предприятие пользователям, обладающим административными правами, предоставляется возможность вызова конструктора запросов.

Помимо текста запроса выполняется редактирование текстов запросов для текстового документа, у которого установлено расширение Язык запросов; для поля текстового документа с установленным расширением Язык запросов.

Редактор командного интерфейса конфигурации позволяет настроить начальный порядок разделов в панели разделов (см. здесь) и начальную видимость разделов в разрезе ролей.

35.3.1. Общие правила установки видимости

35.3.2. Отбор по ролям

35.4. Настройка рабочей области начальной страницы

35.4.1. С помощью редактора рабочей области начальной страницы

Рис. 654. Редактор «Командный интерфейс конфигурации»

В колонке Команда имеется возможность задавать порядок расположения разделов.

В колонках Видимость и Видимость по ролям задается видимость команд открытия подсистем по умолчанию.

В табличном поле размещается общая колонка управления видимостью (колонка Видимость) и столько колонок, сколько ролей определено в конфигурации.

Изначально порядок отображения команд и настройки их видимости устанавливаются системой. Однако при этом можно вручную настраивать видимость для всех команд или отбирать команды по ролям, которым они доступны.

Установка видимости объекта в командном интерфейсе может осуществляться несколькими способами:

•

Редактирование колонки Видимость. В этом случае видимость команды задается сразу для всех ролей. Видимость команды для конкретной роли будет определяться по состоянию колонки Видимость в том случае, если для конкретной роли выбрано особое состояние флажка видимости (см. видимость подсистемы Продажи на рис.654).

•

Указание конкретного значения (установленное или сброшенное) видимости для конкретной роли означает, что команда будет по умолчанию видна (или не видна ‑ в зависимости от состояния флажка) для данной роли. Общее состояние (колонка Видимость) в этом случае игнорируется. Так, на рис.654 для роли Администратор видимость раздела Товарные запасы отключена (несмотря на то, что общая видимость этого раздела включена), а для роли Менеджер по продажам по умолчанию видима команда перехода к подсистеме Предприятие (несмотря на то, что по умолчанию видимость этого раздела отключена).

Возможно множественное изменение видимости сразу для нескольких команд в списке.

Для того чтобы в списке Команда показать только видимые команды, следует нажать кнопку Скрыть невидимые по умолчанию.

В поле Отбор по ролям можно задать несколько ролей, которые будут определять текущее отображение списка команд. В список будут включаться только команды, доступные этим ролям. Для отключения отбора нужно выбрать Не установлен. Список выбора позволяет быстро включать один из нескольких последних установленных отборов.

35.4.2. Программная

Копировать в буфер обмена НастройкиНачальнойСтраницы = ХранилищеСистемныхНастроек.Загрузить("Общее/

также состав форм, которые могут быть отображены на начальной странице.

Рис. 655. Редактор «Рабочая область начальной страницы»

Общую схему расположения форм на начальной странице можно задать с помощью поля Шаблон начальной страницы:

•

Одна колонка ‑ формы будут отображаться в одну колонку.

•

Две колонки одинаковой ширины ‑ для форм будут доступны две колонки одинаковой ширины.

•

Две колонки разной ширины (2:1) ‑ будут отображаться две колонки, причем левая колонка будет в два раза шире правой.

После выбора необходимых форм можно указать порядок их расположения на начальной странице, а также высоту каждой формы (колонка Высота).

Редактор видимости работает аналогично другим ролевым редакторам свойств (см. здесь).

При разработке интерфейса начальной страницы следует обращать особое внимание на то, чтобы этот интерфейс содержал наиболее важные формы. На начальной странице нужно размещать те формы, с которыми наиболее часто выполняется работа пользователя с тем или иным составом ролей.

Следует помнить, что формы, на которые у пользователя нет прав, не будут отображены на начальной странице вне зависимости от состояния колонки Видимость.

Настройку состава и положения форм на начальной странице (рабочем столе) можно выполнить также из встроенного языка. Для выполнения настройки следует воспользоваться методами ПолучитьСоставФорм() и УстановитьСоставФорм() объекта НастройкиНачальнойСтраницы. Таким образом, имеется возможность получить текущее состояние начальной страницы (рабочего стола) клиентского приложения, модифицировать этот состав необходимым образом и установить обратно.

Настройки состава и расположения форм начальной страницы (рабочего стола) хранятся в стандартном хранилище системных настроек. Ключ настроек ‑ Общее/ НастройкиНачальнойСтраницы (см. здесь). Чтобы изменить настройки необходимо в начале прочитать их из хранилища:

Копировать в буфер обмена ХранилищеСистемныхНастроек.Сохранить("Общее/НастройкиНачальнойСтраницы", "", НастройкиНачальнойСтраницы);

Копировать в буфер обмена Процедура ПростаяНачальнаяСтраница() Экспорт НачальнаяСтраница = Новый НастройкиНачальнойСтраницы; СоставФорм = Новый СоставФормНачальнойСтраницы; СоставФорм.ЛеваяКолонка.Добавить("Справочник.Товары.ФормаСписка"); СоставФорм.ПраваяКолонка.Добавить("ФормаПоиска"); НачальнаяСтраница.УстановитьСоставФорм(СоставФорм); ХранилищеСистемныхНастроек.Сохранить("Общее/НастройкиНачальнойСтраницы", "", НачальнаяСтраница);

Копировать в буфер обмена Процедура ПриНачалеРаботыСистемы() РаботаСИнтерфейсом.ПростаяНачальнаяСтраница(); ОбновитьИнтерфейс(); КонецПроцедуры

обратно в хранилище:

После сохранения нового состава форм, необходимо выполнить перестроение интерфейса клиентского приложения с помощью вызова метода ОбновитьИнтерфейс().

Среди разнообразных вариантов применения механизма, можно выделить несколько основных сценариев использования:

•

Необходимо предложить пользователю добавить новую форму на начальную страницу (рабочий стол). Это можно сделать с помощью программного кода, который вызывается из обработчика события ПриНачалеРаботыСистемы. После изменения настроек начальной страницы (рабочего стола) необходимо обновить интерфейс, чтобы изменения стали доступны.

•

Для каких-либо пользователей необходимо поддерживать фиксированный набор форм, который определяется не на этапе конфигурирования, а некоторыми данными информационной базы. В этом случае настройку начальной страницы (рабочего стола) рекомендуется выполнять в обработчике события УстановкаПараметровСеанса модуля сеанса. В этом случае не требуется вызывать метод ОбновитьИнтерфейс(), т. к. считывание настроек начальной страницы (рабочего стола) выполняется после выполнения данного обработчика.

•

Необходимо однократно изменить состав форм начальной страницы (рабочего стола) для всех пользователей информационной базы. В этом случае рекомендуется написать программный модуль, который переберет настройки начальной страницы (рабочего стола) для всех пользователей и внесет в них необходимые изменения. Следует помнить, что изменение интерфейса, выполненные таким образом, будут доступны пользователю только при следующем вход в систему.

Рассмотрим пример, в рамках которого необходимо при каждом начале работы системы принудительно размещать на начальной странице две формы: форму списка справочника Товары и стандартную форму полнотекстового поиска (ФормаПоиска). Для реализации примера необходим общий модуль с установленными признаками Сервер и Вызов сервера. Пусть общий модуль имеет имя РаботаСИнтерфейсом. В общем модуле необходимо поместить следующую процедуру:

КонецПроцедуры В модуле управляемого приложения необходимо разместить обработчик события ПриНачалеРаботыСистемы:

В результате, вне зависимости от того, какие настройки начальной страницы (рабочего стола) настройки осуществил пользователь в предыдущем сеансе работы, каждый новый сеанс будет начинаться с фиксированных настроек начальной страницы (рабочего стола).

При формировании настроек начальной страницы (рабочего стола) можно указывать как полные имена форм объектов конфигурации (например, Справочник.Товары.Форма.ИмяФормы), так и стандартные имена форм (например, Справочник.Товары.ФормаСписка). Также нужно помнить, что программная настройка начальной страницы (рабочего стола) не изменить шаблон начальной области (рабочего стола). При программной настройке будет использовать тот шаблон начальной

35.5. Редактор командного интерфейса основного раздела

при помощи соответствующего редактора (см. здесь).

Редактор позволяет настроить состав команд каждой командной панели, порядок отображения и видимость элементов командного интерфейса по ролям.

Рис. 656. Редактор «Командный интерфейс основного раздела»

В редакторе располагаются два табличных поля. В одном (справа) выполняется собственно редактирование командного интерфейса, а другое (слева) содержит иерархический список доступных команд конфигурации, которые могут быть добавлены в интерфейс основного раздела. Команды, которые попадают в список Доступные команды, отвечают следующим условиям:

•

команда не имеет параметра;

•

группа, которая указана для команды, относится к панели навигации или панели действий.

В табличном поле редактора интерфейса, в колонке Команда, выводится структура команд, сгруппированных по группам панели действий (Важное, Обычное, См. также), панели навигации (Создать, Отчеты, Сервис) и группы команд, определенных в ветке дерева метаданных Общие ‑ Группы команд. В табличном поле размещена колонка Общая видимость команды. Также система размещает колонки настройки видимости команд для каждой определенной в конфигурации роли.

Для выбора команды следует раскрыть нужную ветвь таблицы доступных команд и выбрать команду. Чтобы перенести команду в командный интерфейс, следует указать команду и нажать кнопку Добавить команду в основной раздел (или нажать клавишу Enter, или дважды щелкнуть мышью строку с командой). Выбранная команда переносится в панель и группу, определенную для команды при настройке текущего объекта метаданных (свойство Группа), команда которого переносится. Если кнопка Добавить команду в основной раздел недоступна, то выбранную команду перенести в основной раздел нельзя. Например, если для перечисления не установлено свойство Использовать стандартные команды.

35.6. Редактор командного интерфейса

видимости устанавливаются системой. При этом можно настраивать видимость как для всех команд или отобрать команды по ролям, которым они доступны.

Можно использовать кнопку Переместить команду для перемещения команд между группами. Также команды можно перемещать, перетаскивая их на нужное место мышью в пределах групп одной панели. Для установки порядка команд в группе нужно использовать кнопки перемещения вверх и вниз.

Нажатие кнопки Установить свойства по умолчанию заменяет настройки видимости команды и вхождение в группу на настройки, установленные системой по умолчанию.

Если в конфигурации нет ни одной подсистемы, то редактор имеет другой вид:

Рис. 657. Нет подсистем

В этом случае на рабочем столе доступны все команды системы, и необходимо только расставить доступность команд по умолчанию.

Общие правила управления видимостью см. здесь. Описание отбора по ролям см. здесь.

Редактор командного интерфейса позволяет настроить состав команд каждой командной панели, порядок отображения и видимость элементов командного интерфейса по ролям.

В табличном поле в первой (слева) колонке выводится полный список команд, сгруппированный по группам (как системные Важное, Обычное, См. также, Отчеты, Сервис и др., так и группы, определенные в ветке дерева метаданных Группы команд) панелей действий и навигации. Затем в табличном поле следует колонка для управления общей видимостью команд.

35.7. Редактор «Все подсистемы»

Рис. 658. Редактор «Командный интерфейс»

Система устанавливает порядок команд автоматически. При необходимости ручной настройки порядка отображения команд в группах следует использовать кнопки перемещения или перетаскивать команды. При этом рядом с группой будет отображаться строка Ручной порядок команд. Чтобы отменить изменения порядка, нужно у группы в контекстном меню выбрать пункт контекстного меню Восстановить автоматический порядок команд.

Можно использовать кнопку Переместить команду для перемещения команд между группами. Также команды можно перемещать, перетаскивая их на нужное место мышью в пределах групп одной панели. Для установки порядка команд в группе нужно использовать кнопки перемещения вверх и вниз.

Нажатие кнопки Установить свойства по умолчанию заменяет настройки видимости команды и вхождение в группу на настройки, установленные системой по умолчанию.

Общие правила управления видимостью см. здесь. Описание отбора по ролям см. здесь.

Редактор Все подсистемы предназначен для удобного решения следующих задач:

•

редактирование командного интерфейса любой подсистемы,

•

задание состава и свойств любой подсистемы,

•

настройка порядка следования подсистем,

•

редактирование состава подсистем.

ПРИМЕЧАНИЕ. Редактор командного интерфейса подсистемы можно также открыть из свойства подсистемы Командный интерфейс по ссылке Открыть.

В списке Подсистемы устанавливается порядок подсистем в дереве конфигурации. Этот порядок не влияет на порядок следования подсистем в панели разделов.

35.7.1. Настройка состава подсистемы

35.7.2. Настройка командного интерфейса подсистемы

35.8. Конструктор запросов

Рис. 659. Редактор «Все подсистемы»

Для того чтобы установить порядок подсистем на панели разделов, следует в списке Подсистемы перейти на нужный элемент и выполнить необходимое редактирование (порядок и перемещение подсистемы).

Для редактирования свойств подсистемы нужно использовать палитру свойств или редактор подсистемы (выбрать подсистемы и нажать кнопку Изменить текущий элемент).

Чтобы переместить подсистемы (вместе с подчиненными подсистемами), нужно выбрать подсистему и нажать кнопку Переместить подсистему. В открывшемся окне выбора объекта указать подсистему, в которую будет перенесена текущая подсистема. Запрещается перенос в подсистемы, входящие в текущую подсистему.

Общие правила управления видимостью см. здесь. Описание отбора по ролям см. здесь.

Под списком подсистем находится иерархический список Состав, в котором формируется состав метаданных, относящийся к текущей подсистеме списка подсистем. Следует учитывать, что в показываемый состав не включаются метаданные, относящиеся к подчиненным подсистемам, если в этих подсистемах эти метаданные не определены.

Для изменения состава следует нажать кнопку Редактировать состав подсистемы. Открывается окно выбора объекта, которое содержит дерево метаданных. Объекты, у которых установлены флажки, включены в состав подсистемы.

В окне выбора нужно указать те объекты, которые должны быть включены в состав подсистемы. Нажатие кнопки OK закрывает окно выбора и формирует состав подсистемы.

Настройка командного интерфейса подсистемы осуществляется в табличном поле, расположенном справа от списка подсистем и состава команд подсистемы.

Общие правила управления видимостью см. здесь. Описание отбора по ролям см. здесь.

имеющийся запрос.

Для вызова конструктора запросов нужно открыть модуль, выбрать процедуру, в которую необходимо поместить запрос, установить указатель в той части процедуры, в которой располагается или должно располагаться тело запроса, выбрать пункт Текст ‑ Конструктор запросов.

Если запроса нет, то на экран выводится вопрос: Не найден текст запроса. Создать новый? При выборе Да на экран выводится окно Конструктор запросов. Если запрос редактируется, то на экран выводится окно Конструктор запросов, содержащее данные текущего запроса.

Рис. 660. Конструктор запроса в конструкторе выходной формы

На рис.660 цифрами обозначены следующие кнопки:

1. Кнопка Запрос позволяет получить запрос в текстовом виде, в отдельном окне.

2. Кнопка Упорядочить список позволяет упорядочить список объектов по алфавиту. Повторное нажатие кнопки отменяет упорядочивание.

3. Кнопки Отображать таблицы изменений позволяет показать таблицы изменений объектов конфигурации в списке объектов в виде отдельных веток <ИмяОбъекта>.Изменения. Повторное нажатие кнопки скроет такие ветки в списке.

4. Кнопка Отображать таблицы и поля расширяемой конфигурации доступна в том случае, когда конструктор запроса открыт из расширения конфигурации. Когда кнопка нажата ‑ в списке База данных присутствуют объекты расширяемой конфигурации и объекты текущего расширения. Повторное нажатие кнопки оставит в списке только объекты расширения.

Редактор запросов, открытый из расширения, позволяет открывать и редактировать запрос, в котором используются объекты расширяющей конфигурации, не добавленные в расширение.

5. Кнопка Создать вложенный запрос открывает новый конструктор запроса, в котором следует создать вложенный запрос. В открывшемся конструкторе запроса сформировать требуемый запрос и нажать кнопку ОК. Вложенный запрос отобразится в списке Таблицы.

6. Кнопка Временная таблица позволяет создать временную таблицу. Подробнее об этой

на другую. При этом будет выполнена попытка сохранить все выбранные поля и исправить имена таблиц.

8. Кнопка Параметры виртуальной таблицы позволяет открыть диалог редактирования параметров виртуальных таблиц в том случае, если в списке Таблицы курсор стоит на виртуальной таблице.

Для использования созданной временной таблицы следует нажать кнопку Создать описание временной таблицы (см. рис.660). В отобразившейся форме ввести имя таблицы, имена нужных полей и, при необходимости, указать тип значения полей.

Рис. 661. Описание временной таблицы

С помощью кнопок Далее > конструктора запроса нужно последовательно пройти по закладкам и выбрать необходимые исходные данные, указать группировки и условия, установить нужный порядок и описать итоговые данные. В результате работы конструктора создадутся форма и макет, которые будут располагаться в соответствующих ветвях. По кнопке Запрос в любой момент можно открыть окно с текстом сформированного на основании указанных данных запроса.

Для корректировки данных следует использовать кнопку < Назад.

На закладке Таблицы и поля выбрать нужные объекты и перенести их в разделы Таблицы и Поля.

Для указания дополнительных условий можно воспользоваться режимом формирования произвольных выражений в запросе. Для этого в списке Поля контекстного меню нужно выбрать пункт Добавить. На экран выводится окно произвольного выражения.

Рис. 662. Конструктор произвольного выражения

клавиатуры. Для удобства ввода наименований реквизитов можно перетаскивать мышью нужные поля из списка полей и выбирать нужные функции языка запросов из списка, также перетаскивая их мышью в поле ввода выражения.

Если указано несколько таблиц, то в форму конструктора запроса добавляется закладка Связи.

Рис. 663. Определение условий связи между таблицами

На закладке Связи формируются условия, которые накладываются на связи между полями таблиц. Для ввода нового условия нужно нажать кнопку Добавить и в колонке Таблица1 выбрать одну из таблиц; в колонке Таблица2 выбрать таблицу, поля которой связаны с полями первой. Ниже списка условий расположены элементы управления, с помощью которых формируется условие связи таблиц.

На закладке Группировка, если требуется, нужно выбрать реквизиты, по которым будет выполнена группировка (см. здесь).

На закладке Условия, если требуется, следует указать условия, по которым будет выполняться отбор исходных данных (см. здесь).

Рис. 665. Условия запроса

По каждому выбранному полю необходимо выбрать вид условия (для произвольного условия в колонке Произвольное установить флажок). Если флажок не установлен, то следует выбрать вид условия и указать наименование параметра. Если флажок Произвольное установлен, то можно воспользоваться окном формирования произвольных выражений (см. выше).

На закладке Дополнительно указываются дополнительные условия формирования набора данных.

Рис. 666. Дополнительные параметры запроса

доступные записи и исключения повторяющихся строк. Также имеется возможность указать, что делать с получившимся набором данным: использовать как выборку данных, создать из набора данных временную таблицу (см. здесь), дополнить существующую временную таблицу созданным набором данных (см. здесь) или удалить временную таблицу. При работе с временной таблицей необходимо указать имя временной таблицы в одноименном поле. В случае удаления временной таблицы конструктор сильно «упростит» свою структуру: останутся только текущая вкладка и вкладка Пакет запросов.

Если на закладке Дополнительно выбрано создание временной таблицы, то на появившейся закладке Индекс можно будет указать, какие индексы будут созданы для этой временной таблицы (см. здесь).

Рис. 667. Индекс временной таблицы

Крайняя справа колонка содержит список полей, которые входят в состав текущего индекса, который выбран в крайней левой колонке. Имена индексов предопределены и их невозможно изменить. При этом в списке индексов можно указать признак того, что данный индекс будет содержать только уникальные записи (колонка Уникальность). Средняя колонка содержит поля индексируемой таблицы, которые еще не включены в текущий индекс. Если для временной таблицы создан только один индекс, то для него будет использовано предложение ИНДЕКСИРОВАТЬ ПО. Если индексов несколько, то будет использовано предложение ИНДЕКСИРОВАТЬ ПО НАБОРАМ.

На закладке Объединения/Псевдонимы, если требуется, нужно ввести псевдонимы полей.

Рис. 668. Объединения/псевдонимы запроса

В таблице показано соответствие выбранных полей и исходных данных. Имена полей и соответствие можно изменить. Для изменения имени нужно выбрать поле и нажать клавишу Enter, ввести новое имя поля. Для изменения соответствия в колонке Запрос выбрать нужную строку и нажать клавишу Enter. В выпадающем списке выбрать нужное значение.

Если требуется выбрать только уникальные значения, то следует установить флажок в колонке Без дубл.

Псевдонимы полей, которые изменены пользователем, или были загружены из текста запроса, или при генерации псевдонима конструктор определил, что данный псевдоним обязателен, выделяются жирным шрифтом.

На закладке Порядок, если требуется, нужно указать порядок вывода полученных данных (см. здесь).

одной даты выполняется сортировка по Поставщику.

На закладке Итоги, если требуется, следует указать, по каким полям нужно выводить промежуточные итоговые данные, а также указать необходимость формирования общих итогов (см. здесь).

Рис. 670. Установка итогов для результата запроса

При нажатии кнопки >>, расположенной рядом с групповыми полями, в поля для группировки будут помещены все ссылочные поля. При нажатии кнопки >>, расположенной рядом с суммируемыми полями, в список суммируемых полей будут помещены все поля, имеющие числовой тип.

На закладке Построитель выполняется настройка построителя отчетов. Выбираются таблицы и поля, указываются условия и порядок представления, а также описываются итоговые данные.

•

На закладке Таблицы редактируются параметры построителя отчета для виртуальных таблиц, а также отмечаются необязательные таблицы. Для редактирования параметров виртуальных таблиц необходимо выделить таблицу, для которой требуется настроить параметры, вызвать команду Параметры виртуальной таблицы, после чего в появившемся диалоге ввести необходимые параметры таблицы для построителя отчета. Для того чтобы отметить таблицу как необязательную, необходимо снять флажок Обязательная напротив имени таблицы, которую нужно пометить. Кроме того, для необязательных таблиц можно указать номер группы. Необязательные таблицы, находящиеся рядом в списке соединений и имеющие одинаковые номера групп, будут объединены в одну необязательную группу. Необязательные таблицы с различными номерами групп будут разнесены по различным группам необязательных таблиц.

•

На закладке Поля выбираются поля, которые построитель отчета будет использовать в качестве доступных полей для вывода в отчет.

•

На закладке Условия выбираются поля, которые построитель отчета будет использовать в качестве доступных полей для отбора.

•

На закладке Порядок выбираются поля, которые построитель отчета будет использовать в качестве доступных полей для упорядочивания результата.

•

На закладке Итоги выбираются поля, которые построитель отчета будет использовать в качестве доступных полей для группировки отчета.

На закладке Пакет запросов при работе с пакетными запросами создается последовательность запросов пакета. Каждый запрос редактируется и настраивается в этом же окне, а на всех

35.9. Конструктор запроса с обработкой результата

Рис. 671. Пакет запросов

По нажатию кнопки ОК в программном модуле формируется текст запроса. Если происходит попытка открыть конструктором некорректный текст запроса, то при вызове конструктора запросов происходит автоматическая установка курсора в строку запроса, в которой обнаружена ошибка, и выдается диагностическое сообщение.

В зависимости от того, откуда вызывается конструктор запроса (система компоновки данных, запрос с обработкой результата и т. д.), в форме конструктора могут добавляться новые закладки, описание которых можно увидеть в описании того механизма, откуда вызывается конструктор запроса.

Конструктор предназначен для генерации программного кода обработки результатов запроса. Данный конструктор помогает создавать следующие варианты обработки результатов запроса:

•

простой обход результатов запроса,

•

вывод результатов запроса в табличный документ,

•

вывод результатов запроса в диаграмму.

Для вызова конструктора предназначен пункт Конструктор запроса с обработкой результата контекстного меню редактора модулей.

При вызове конструктор ищет в текущей строке код, который мог быть создан конструктором. Если такой код найден, то конструктор загружает найденный код (включая имена макетов и т. д.).

Окно конструктора запроса будет отличаться от описанного выше редактора запросов (см. здесь).

35.10.Конструктор движений регистров

Рис. 672. Конструктор запроса с обработкой результата

В конструкторе, открытом в таком режиме:

•

На закладке Обработка результата происходит выбор типа обработки результата запроса:

•

Обход результата,

•

Вывод в табличный документ,

•

Вывод в диаграмму.

•

Для типов обработки результата запроса Обход результата и Вывод в диаграмму, форма конструктора не предоставляет возможности настраивать какие-либо параметры вывода.

После нажатия кнопки ОК генерируется программный код, который будет вставлен в текущую позицию модуля. Если конструктор вызывался над уже сгенерированным кодом, старый код заменяется.

Если вывод осуществлялся в табличный документ, то в объекте метаданных, в модуле объекта или модуле формы которого он вызывался, создается макет для вывода в табличный документ. Он же модифицируется при повторном вызове конструктора. Данный макет удаляется, если ранее конструктор использовался для создания табличного документа, а теперь вызывается для генерации другого способа обработки результатов запроса. Если конструктор вызывается в общем модуле, то создается общий макет.

ПРИМЕЧАНИЕ. Если у конфигурации установлен режим редактирования конфигурации для режимов запуска в управляемом приложении, то в меню объектов метаданных недоступна команда вызова конструктора выходных форм.

Конструктор движений регистров применяется для документов.

Для запуска конструктора движений регистров в окне редактирования документа, на закладке Движения нужно указать состав регистров, движения которых осуществляет данный документ, и

движений хотя бы по одному регистру, то указанный пункт контекстного меню будет доступен.

При запуске конструктор запрашивает выбор регистра, по которому будет произведено формирование процедуры ОбработкаПроведения(), и открывает окно конструктора.

Рис. 673. Конструктор движений регистров

Первоначально список содержит только указанный регистр. Список можно изменить, добавляя регистры из списка регистров, отмеченных на закладке Движения окна редактирования документа.

Для каждого регистра в зависимости от его типа необходимо указать предварительные настройки: для регистров накопления остатков указать тип движения; для регистров бухгалтерии, не поддерживающих корреспонденцию, ‑ вид корреспонденции и счет; для регистров, поддерживающих корреспонденцию, ‑ счет дебета и счет кредита.

Если у документа есть табличные части и их данные должны влиять на состояние регистров, то включение табличной части производится в списке выбора Табличная часть.

Затем для каждого регистра производится заполнение формул атрибутов по данным реквизитов документа.

В список формул нужно поместить формулы, определяющие, как вычислять движения регистра по выбранным реквизитам документа.

Эти формулы можно создавать «вручную» следующим образом. Формула вводится в колонке Формула для каждого атрибута регистра, выделенного в списке. Можно вручную набрать ее в этом поле (а также вручную редактировать в нем созданную ранее формулу). Правильность написания формул конструктор не проверяет.

Можно также двойным щелчком в списке реквизитов документа помещать данные соответствующего реквизита в формулу. Конструктор не проверяет соответствие типов выбранных реквизитов.

Если есть хотя бы один тип, принадлежащий как реквизиту, так и измерению/ресурсу регистра и при этом их наименования совпадают, то для таких подчиненных объектов можно применить режим Автозаполнение. Наименование реквизитов при нажатии кнопки Заполнить выражения заносится в колонку Выражение и может быть отредактировано.

35.11.Конструктор печати

В начало процедуры конструктор помещает предупреждение: Данный фрагмент построен конструктором. При повторном использовании конструктора внесенные вручную изменения будут потеряны!

Конструктор печати предназначен для создания макета с заданными именованными областями и процедуры печати для объекта конфигурации.

Конструктор печати работает с объектами конфигурации:

•

Справочники,

•

Документы,

•

Журналы документов,

•

Планы видов характеристик,

•

Планы счетов,

•

Планы расчетов,

•

Планы обмена.

Основные приемы работы с конструктором печати будут рассмотрены ниже на примере работы со справочником. Для других видов объектов конфигурации работа с конструктором может несколько отличаться.

Для запуска конструктора печати в окне Конфигурация нужно указать требуемый объект. В контекстном меню выбрать пункт Конструкторы ‑ Конструктор печати.

В связи с тем, что результатом работы конструктора печати является процедура печати, располагаемая в модуле менеджера объекта, конструктор сначала проверяет доступность данного модуля. Если модуль объекта имеет ограничение доступа, на экран выводится запрос пароля. После ввода пароля на экран выводится окно конструктора.

модуль печати.

Затем конструктор предлагает создать новую команду печати или изменить существующую команду. В случае создания новой команды предлагается указать ее имя. По умолчанию для команды предлагается имя Печать. Указанное имя будет использоваться в качестве:

•

имени команды объекта;

•

имени серверного метода модуля команды;

•

имени метода менеджера объекта, который непосредственно реализует процедуру печати.

Рис. 675. Создание команды печати

Если выбрано изменение существующей команды, то в модуле команды объекта будут замещены тексты обработчика ОбработкаКоманды(), серверного метода с именем команды (в данном случае ‑ Печать()), метода модуля менеджера объекта с именем команды и макета.

После нажатия кнопки Далее > конструктор переходит к выбору реквизитов шапки. С помощью кнопок переноса нужно сформировать список реквизитов.

Рис. 676. Выбор реквизитов шапки

Если объект конфигурации имеет табличные части, то после нажатия кнопки Далее > конструктор переходит к выбору реквизитов очередной табличной части. Список печати формируется аналогично списку реквизитов шапки.

Если объект конфигурации имеет табличные части, то после нажатия кнопки Далее > конструктор переходит к выбору реквизитов подвала.

Затем следует указать, к какой группе будет отнесена созданная команда, и указать некоторые параметры сформированного табличного документа.

35.12.Конструктор ввода на основании

Рис. 677. Настройка конструктора печати

Нажатие кнопки ОК завершает работу конструктора печати.

В результате работы конструктора:

•

У выбранного объекта создается макет Макет с печатной формой (имя формы соответствует имени созданной команды).

•

У выбранного объекта создается команда, которая подготавливает табличный документ и вызывает серверную процедуру (с именем команды), заполняющую переданный табличный документ.

•

В модуле менеджера выбранного объекта генерируется процедура, параметры которой позволяют печатать сразу несколько объектов (список). Созданная команда получает права, аналогичные праву Просмотр объекта, для которого вызывается конструктор.

Конструктор ввода на основании облегчает задачу разработки процедуры, с помощью которой будет формироваться новый объект.

Конструктор ввода на основании применяется:

•

для справочников,

•

документов,

•

планов видов характеристик,

•

планов счетов,

•

планов видов расчета,

•

планов обмена,

•

бизнес-процессов,

меню выбрать пункт Конструкторы ‑ Конструктор ввода на основании. Если для выбранного объекта конфигурации определен режим ввода на основании, то указанный пункт контекстного меню будет доступен.

При запуске открывается окно Конструктор ввода на основании.

Рис. 678. Конструктор ввода на основании

В верхней части содержится список объектов-оснований; список реквизитов объекта-основания, выбранного в первом списке.

В нижней части расположен список реквизитов результирующего объекта. В список реквизитов объекта нужно поместить выражения, определяющие, как заполнять реквизиты документа по выбранным реквизитам объекта-основания.

Эти формулы можно создавать «вручную» следующим образом. Выражение определяется в поле ввода Формула заполнения реквизита для реквизита объекта, выделенного в списке. Можно вручную набрать ее в этом поле (а также вручную редактировать в нем созданную ранее формулу). Правильность написания формул конструктор не проверяет.

Можно также двойным щелчком в списке реквизитов объекта-основания помещать данные соответствующего реквизита в поле Формула заполнения реквизита, причем сразу в правильной записи. Конструктор не проверяет соответствие типов выбранных реквизитов.

Возможна и комбинация двух описанных способов: данные из списка реквизитов объектов-оснований при помещении в поле ввода замещают не всю имеющуюся там информацию, а только выделенные символы.

По кнопке Автозаполнение после запроса и подтверждения программа сама создаст формулы для заполнения по реквизитам объекта-основания. Ранее заполненные формулы при автоматическом заполнении не изменяются. Подбор среди реквизитов объекта-основания соответствий реквизитам документа осуществляется с учетом имен реквизитов, их идентификаторов и типов.

35.13.Конструктор форм объектов конфигурации

как автоматически, так и вручную.

Формулы, созданные для объекта-основания, выбранного в списке объектов-оснований, запоминаются при переходе к другому объекту-основанию этого списка. Поэтому можно, не прекращая работы конструктора, создать процедуры ввода на основании для нескольких документов-оснований. Можно также возвращаться к редактированию процедуры для какого-либо объекта-основания, снова выбирая его в списке.

Для прекращения работы конструктора служат кнопки ОК и Отмена (соответственно с сохранением и без сохранения сделанных изменений).

В результате работы конструктора в модуле объекта создается процедура ОбработкаЗаполнения(). В начало процедуры конструктор помещает предупреждение: Данный фрагмент построен конструктором. При повторном использовании конструктора внесенные вручную изменения будут потеряны!

При повторном использовании конструктора все формулы, сформированные ранее для какого-либо документа-основания, будут появляться в списке реквизитов документа при выделении соответствующего документа-основания в списке документов-оснований. Конструктор предъявит для просмотра и редактирования формулы, сформированные при предыдущем его запуске, как с помощью кнопки Заполнить формулы автоматически, так и вручную. Более того, он учтет и формулы, вручную внесенные в модуль документа, если они помещены в формируемую им процедуру. Правильность этих формул конструктор не проверяет. Например, если для какого-то реквизита документа указано заполнение двумя различными реквизитами документа-основания, конструктор для показа выберет один из них (по алфавиту). Именно он останется в модуле после обновления результатов работы конструктора. Вторая строка, соответствующая тому же реквизиту, будет удалена.

Для каждого объекта конфигурации, в составе которого могут находиться подчиненные объекты типа Форма, при добавлении новой формы запускается Конструктор формы. Это специальный мастер, с помощью которого производится выбор типа формы и размещаются реквизиты объекта конфигурации. Несмотря на существенные различия типов объектов, для которых производится создание формы, конструкторы имеют много общего. Поэтому рассмотрим работу конструктора форм на примере конструктора формы документа.

При создании новой формы объекта на экран выводится конструктор формы.

Рис. 679. Конструктор формы

Группа элементов управления Выберите тип формы предназначена для выбора типа формы (состав определяется видом выбранного объекта конфигурации, для которого создается форма). Для объекта конфигурации Документ это следующие формы:

•

форма документа;

•

форма списка документа;

•

форма выбора документа;

•

произвольная форма (пустая форма).

Число форм по каждому типу форм неограниченно. Если у объекта несколько форм одного типа, то одну из них можно выбрать в качестве основной. Если при вызове формы объекта не указано явно, какую именно форму следует вызвать, на экран будет выводиться основная форма. Для указания основной формы при создании нужно установить флажок Назначить форму основной. В дальнейшем выбор основной формы можно изменить в окне редактирования объекта (см. здесь), на закладке Формы.

Выбор типа Произвольная форма не приводит к созданию основного реквизита. В этом случае форма имеет типовое поведение. Выбор иного типа формы влечет создание основного реквизита и определяет отличительное от типового поведение формы. Данные отличия описываются объектами, называемыми расширение формы (см. описание соответствующих объектов справки по встроенному языку).

Выбор типа формы определяет тип основного реквизита и, следовательно, поведение всей формы, а также возможный состав команд панели инструментов.

Нужно указать имя формы, синоним и комментарий.

Состав команд командных панелей определяется источником действий и типом основного реквизита формы.

Если нажать кнопку Готово, то конструктор самостоятельно разместит элементы управления в форме и откроет форму для редактирования.

Если необходимо изменить состав реквизитов формы, следует нажать кнопку Далее >. Состав

35.13.1. Особенности конструктора форм констант

Рис. 680. Выбор реквизитов формы

На этом шаге конструктора формы следует выбрать реквизиты, которые необходимо разместить в форме. Выбор осуществляется в колонке Реквизиты установкой пометки слева от наименования элемента.

ВНИМАНИЕ! Конструктор формы не включает в список те реквизиты, чей тип не имеет визуального представления (например, ХранилищеЗначения).

Каждая константа может иметь собственную форму редактирования. Для создания такой формы необходимо выполнить команду Создать форму констант контекстного меню нужной константы.

Рис. 681. Создание формы редактирования констант

После выполнения данной команды будет открыт конструктор общей формы, где в качестве данных будут перечислены все константы системы и текущая константа будет единственным выбранным реквизитом (по умолчанию).

35.14.Конструктор макета

Рис. 682. Выбор редактируемых констант

Такая же форма будет автоматически создана системой, если у константы не будет заполнено свойство Основная форма, но будет установлено свойство Использовать стандартные команды.

Если необходимо создать форму редактирования нескольких констант, то следует создать общую форму типа Форма констант, а затем на странице выбора реквизитов указать константы, которые необходимо редактировать.

Формы констант будут входить в командный интерфейс тех подсистем, куда входит сама константа (если у константы установлено свойство Использовать стандартные команды) и общая форма редактирования константы (если у общей формы установлено свойство Использовать стандартные команды).

Если для константы, у которой установлено свойство Использовать стандартные команды, создается форма редактирования, то конструктор общей формы сбрасывает свойство Использовать стандартные команды для формы. Таким образом, формы редактирования константы будут попадать в командные интерфейсы только тех подсистем, куда входит сама константа.

Конструктор макета используется для создания макетов объектов конфигурации и общих макетов.

Окно конструктора выводится на экран при выполнении пункта Действия ‑ Добавить, если выбрана ветвь подчиненного объекта Макеты или Общие макеты.

Рис. 683. Конструктор макета

Нужно указать имя, синоним и комментарий и выбрать тип макета.

Тип Табличный документ предполагает использование стандартной технологии создания и использования макетов табличных документов системы «1С:Предприятие».

Тип макета Текстовый документ предполагает использование специально подготовленных в качестве макетов текстовых документов. Для текстового документа свойство Расширение имеет значение Текстовый макет.

Выбор типа Двоичные данные подразумевает, что разработчик конфигурации знает, как работать с объектом данного типа.

Тип макета Active document позволяет использовать технологию OLE Active document. Если нажать кнопку Готово, то конструктор производит поиск доступных типов Active document и предлагает выбрать один из найденных.

Рис. 684. Вставка Active document

файла прототип макета). Если выбран файл, чей тип не попадает в список поддерживаемых Active document, то конструктор выводит предупреждение.

Указанный документ будет храниться в конфигурации. Работа с макетом должна быть организована с использованием свойств и методов, предоставляемых выбранной технологической платформой.

Если выбран тип HTML-документ, то открывается редактор HTML-макета. В данном режиме поддерживаются все возможности HTML-редактора. В дополнение к этому редактор HTML-макета позволяет использовать картинки библиотеки картинок, из файла, из файла-коллекции или из «внутренних» картинок. Внутренние картинки ‑ это уже выбранные из файла картинки, они хранятся «внутри» макета.

Чтобы поместить картинку в макет, нужно выбрать пункт Элементы ‑ Картинка…

Рис. 685. Вставка картинки

Для выбора картинки нажать кнопку выбора. В открывшемся окне выбрать нужную картинку.

Рис. 686. Выбор картинки

Выбор типа Географическая схема позволяет использовать подготовленные редактором географических схем документы для создания макета.

Выбор типа Графическая схема позволяет использовать графические схемы, подготовленные в редакторе графических схем, или загрузить схему из файла и использовать ее в качестве макета.

Выбор типа Схема компоновки данных открывает конструктор схемы компоновки данных (см. здесь).

Выбор типа Макет оформления компоновки данных открывает окно конструктора макета оформления (см. здесь). Выбор типа Внешняя компонента позволяет загрузить внешнюю компоненту в zip-архиве. В архив должны входить собственно файлы внешних компонент и специальный манифест. Внешняя компонента, загруженная таким образом, может использоваться

35.15.Конструктор форматной строки

Для написания выражений, использующих представление числа, даты и логического выражения, можно использовать конструктор форматной строки.

Чтобы вызвать конструктор, нужно установить курсор в требуемое место текста модуля и выбрать пункт Текст ‑ Конструктор форматной строки. Для новой строки редактор выводит сообщение: Форматная строка не найдена. Создать новую форматную строку? После нажатия кнопки Да на экран выводится окно конструктора.

Также конструктор можно вызвать из свойств Формат и Формат редактирования элемента формы. Для этого нужно нажать кнопку выбора соответствующего свойства.

Закладки окна соответствуют типу данных, форматная строка которых формируется в окне.

Элементы управления, с помощью которых выбирается формат представления, размещены на трех закладках по типам данных:

•

число,

•

дата,

•

логические значения.

Поле Язык (Страна) (параметр Л) определяет представление информации в соответствии с национальными представлениями. Значения, заданные на следующих закладках, являются более приоритетными по отношению к указанию страны.

Для числа нужно выбрать закладку Число.

Рис. 687. Конструктор форматной строки для числа

В поле Длина (параметр ЧЦ) указывается общее число десятичных знаков (целой и дробной частей). В поле Точность (параметр ЧДЦ) указывается число десятичных знаков дробной части.

В поле Сдвиг (параметр ЧС) указывается сдвиг разрядов. Если значение поля положительное, то производится деление числа на 10 в соответствующей степени, если отрицательное ‑ умножение.

В поле Разделитель дробной части (параметр ЧРД) задается символ разделителя.

Копировать в буфер обмена Формат('20151201', "Л=ru;ДЛФ=Д") = 01.12.2015 Формат('20151201', "Л=en_US;ДЛФ=Д") = 12/1/2015 Формат('20151201', "Л=ru;ДЛФ=ДB") = 01.12.2015 0:00:00 Формат('20151201', "Л=en_US;ДЛФ=ДВ") = 12/1/2015 12:00:00 AM

разделителя использовать пустую строку, то разделителем будет символ неразрывного пробела.

В поле Группировка (параметр ЧГ) выбирается вариант группировки цифр в целой части числа.

В поле Представление нуля (параметр ЧН) выбирается вариант представления нулевого значения. Параметр можно использовать в форматной строке, для поля ввода он не используется.

В поле Представление отрицательных чисел (параметр ЧО) выбирается вариант представления отрицательных чисел.

Если флажок Выводить лидирующие нули (параметр ЧВН) установлен, то лидирующие нули выводятся.

СОВЕТ. В нижней части окна конструктора расположена область, в которую выводится результат действия форматной строки (группа Пример) и сама форматная строка.

Для настройки даты нужно выбрать закладку Дата.

Рис. 688. Конструктор форматной строки для даты

В поле Формат даты (параметр ДФ) выбирается вариант представления даты. Рекомендуется использовать этот формат в том случае, когда требуется получить в точности тот или иной формат представления даты, вне зависимости от параметров локализации. Например, для форматной строки ДФ=гггг-ММ-дд, представление даты всегда будет выглядеть как 2015-12-01.

В поле Локальный формат даты (параметр ДЛФ) выбирается локальный вариант представления даты. Для поля ввода не допускается выбор значения параметра ДД. Этот вариант представления рекомендуется выбирать в тех случаях, когда при формировании представления даты следует учитывать текущие параметры локализации. Параметры локализации могут указываться как непосредственно в форматной строке, так и получаться из региональных настроек информационной базы.

Пример:

35.16.Конструктор строк на разных языках

Копировать в буфер обмена <код_языка1> = <Строка_1>; <код_языка2> = <Строка_2>;…

Параметр можно использовать в форматной строке, для поля ввода он не используется.

СОВЕТ. В нижней части окна конструктора расположена область, в которую выводится результат действия форматной строки (группа Пример) и сама форматная строка.

Для данных типа Булево нужно выбрать закладку Логическое значение.

Рис. 689. Конструктор форматной строки для логического значения

Если какое-то значение не выбрано, то оно выбирается из настроек, устанавливаемых по умолчанию.

Подробнее о параметрах форматной строки написано в описании параметра ФорматнаяСтрока метода Формат() в описании встроенного языка.

В результате использования конструктора форматной строки в текст (или поле ввода) будет вставлена сформированная строка (при нажатии кнопки ОК).

Совет. В редакторе текстов можно установить курсор внутри форматной строки и выбрать пункт меню Текст ‑ Конструктор форматной строки для изменения существующей форматной строки.

Конструктор позволяет отредактировать строки на всех языках конфигурации и дополнительно тех, чьи коды содержатся в редактируемом наборе, однако конфигурация не содержит языков с таким кодом.

Результатом работы конструктора будет строка вида:

Конструктор удобно использовать при создании параметра ИсходнаяСтрока функции глобального контекста НСтр().

Для вызова конструктора следует установить курсор в нужное место модуля и выбрать пункт Текст ‑ Конструктор строк на разных языках. Редактор анализирует текст модуля в области курсора и, когда найдена конструкция, открывает окно конструктора. Если конструкция не найдена, то

Копировать в буфер обмена ru = 'Доброе утро!'; en = 'Good Morning!'

35.17.Редактор табличных документов

35.17.1. Что такое табличный документ в системе «1С:Предприятие»

Рис. 690. Конструктор строк на разных языках

В окне конструктора будет столько полей для ввода текста, сколько языков определено для конфигурации.

Нужно ввести тексты и нажать кнопку ОК. Результатом работы конструктора будет строка:

Для создания различных печатных форм, а также форм, предназначенных для представления и ввода информации с использованием табличных документов, в системе «1С:Предприятие» используется специализированный редактор табличных документов.

Таблицу сочетаний клавиш для редактора табличных документов можно найти в справке при использовании программы.

Хотя в программе реализована возможность использования табличного документа для непосредственного ввода, обработки и отображения данных различных типов, как в «обычных» электронных таблицах (использование табличных документов, размещенных в форме), табличные документы в системе «1С:Предприятие» используются в основном для представления уже обработанной информации, в частности, описания печатной формы отчета. Обработка информации и помещение ее в нужные места табличного документа для большинства объектов конфигурации выполняются программными модулями на языке системы «1С:Предприятие».

В системе программ «1С:Предприятие» табличный редактор применяется для работы с отдельными табличными документами и макетами печатных форм.

Сформированный табличный документ можно сохранить в файл на диске в различных форматах. Если документ сохранен в формате MXL, то в дальнейшем этот документ можно просмотреть с помощью программы работы с файлами, скачать которую можно по этому адресу: http://v8.1c.ru/metod/fileworkshop.htm. В том случае, если сохраненный табличный документ планируется использовать в веб-клиенте или на операционных системах, отличных от Windows, то в такой табличный документ не рекомендуется включать OLE-объекты.

Макет хранится внутри конфигурации. Макеты бывают общими (располагаются в ветви Общие ‑ Макеты; например, макеты стандартных платежных документов, печатающихся из различных документов), а также могут относиться к определенному объекту конфигурации (например, карточка основного средства). Объект конфигурации может иметь несколько различных макетов печатных форм.

В форме также можно расположить табличный документ. Для этого необходимо использовать элемент управления Поле табличного документа. В этом режиме в табличный документ можно вставить другие элементы управления.

Макеты и табличные документы с точки зрения приемов работы практически полностью совпадают.

Табличные документы (отдельные файлы и макеты) можно сравнивать и объединять.

35.17.2.1. Общие принципы проектирования макета

Создание макета производится конструктором макетов (см. здесь) и конструктором запроса с обработкой результата (см. здесь).

Проектирование макета заключается в «рисовании» составных частей, кирпичиков ‑ именованных областей, из которых затем будет «собрана» готовая выходная форма ‑ отчет. Так как практически все деловые документы имеют «прямоугольную» структуру, удобнее всего создавать макеты таких документов в редакторе, способном манипулировать прямоугольными элементами.

Именно таким редактором и является табличный редактор, входящий в систему «1С:Предприятие». В процессе создания макета можно вводить в ячейки табличного документа разнообразный текст; задавать параметры форматирования (ячейке в целом); изменять высоту строк и ширину колонок; включать в макет рисованные элементы ‑ линии и прямоугольники, а также другие графические объекты: картинки, OLE-объекты и диаграммы, различные элементы управления; определять оформление как всего табличного документа, так и отдельных ячеек или групп ячеек.

При создании макета отчета руководствуются следующим.

Практически каждый отчет состоит из так называемой шапки (заголовка) отчета, в которой указывается наименование отчета, исходные параметры построения. Для формирования таких данных создают именованную область, которую чаще всего называют Шапка. Если в отчете присутствует табличная часть, то в шапку обычно включают наименования колонок.

Для вывода строк создают именованные области (в показанном на рис.691 примере это Строка), отвечающие за вывод различной информации в табличную часть. Число строк табличной части обычно невозможно узнать при подготовке макета, но структурно информация в табличной части повторяется, поэтому при построении отчета используют одни и те же области, описывающие отдельную строку. Ячейкам, предназначенным для вывода конкретной информации, ставят в соответствие параметры (в приведенном примере это Счет, Наименование, Цена, Сумма и др.). При выводе очередной строки этим параметрам присваивают содержимое каждой выводимой строки, а затем уже включают сформированную область в состав отчета. Так происходит до тех пор, пока не будет выведена вся информация табличной части.

Обычно отчет завершается выводом итоговых данных и реквизитами ответственных лиц. Эти данные обычно размещают в области, именуемой Подвал.

В окончательном виде макет представляет собой совокупность прямоугольных областей, каждая из которых служит для выдачи какой-то части готового отчета: область для выдачи заголовочной части (наименования, даты и т. п.); область для выдачи шапки табличной части и так далее.

35.17.2.2. Свойства ячеек макета

Категория свойств «Макет»

Рис. 691. Пример макета

Сам процесс построения отчета происходит следующим образом:

•

Вначале отчет строится как пустой табличный документ. Необходимо иметь в виду, что макет не связан напрямую с готовым отчетом. Скорее макет представляет собой некий конструктор, набор областей, из которых в процессе работы программного модуля складывается готовый отчет.

•

В процессе обработки алгоритма отчета из макета в нужном порядке извлекаются поименованные области, транслируются (вместо параметров подставляются их значения) и копируются в табличный документ готового отчета. Средства языка формирования отчетов позволяют наращивать отчет как вниз, так и вправо.

Категория свойств Макет показывается, если в свойствах табличного документа установлено свойство Макет.

Заполнение ‑ пункты свойства Заполнение устанавливают, какого рода информация введена в ячейку. Свойство показывается, если в категории Значения не установлено свойство Содержит значение. Пункты не изменяют внешний вид ячейки, а используются только в процессе обработки шаблона, при формировании готового табличного документа.

Пункты этого списка имеют следующий смысл:

Формат данных

Пояснение

Текст Информация в ячейке является текстом и при формировании табличного документа будет перенесена из макета в готовый табличный документ без изменений. Текст содержится в свойстве Текст и может быть как простым текстом, так и форматированной строкой.

Формат данных

Пояснение

Параметр Информация в ячейке представляет собой параметр, имя которого указывается в свойстве Параметр. Свойство Текст будет игнорироваться.

Шаблон Информация в ячейке представляет собой текст с включенными в него именами параметров, заключенных в квадратные скобки. При формировании табличного документа переменные будут вычислены и включены в текст. Место, отводимое в тексте для вывода значений параметров, определяется длиной этих значений.

Пример шаблона: Директор: [Директор].

Сам текст шаблонной сроки расположен в свойстве Текст и может быть как обычным текстом, так и форматированной строкой.

Информация в ячейке готового табличного документа преобразуется в тип Строка или ФорматированнаяСтрока (если для формирования результирующего значения использовались форматированные строки).

Параметр ‑ имя параметра для вывода содержимого ячейки. Свойство показывается, если в категории Значения установлено свойство Содержит значение или когда в свойстве Заполнение категории Макет выбрано значение Параметр. Если в качестве значения параметра подставляется форматированная строка, то базовый формат для подставленного значения в результирующей строке определяется по типу заполнения (значение свойства Заполнение). При этом форматирование самого параметра сохраняется:

•

Параметр. В этом случае базовое форматирование значения определяется форматированием ячейки.

•

Шаблон, где сам шаблон - обычная строка. В этом случае базовое форматирование значения определяется форматированием ячейки.

•

Шаблон, где сам шаблон - форматированная строка. В этом случае базовым форматированием значения будет форматирование символа «[» в имени заменяемого параметра.

Параметр расшифровки ‑ указывается имя параметра, по которому программа производит обработку расшифровки значения, находящегося в ячейке. Имеет смысл использовать, когда результирующий табличный документ размещен в форме (элемент управления Поле табличного документа).

Рис. 692. Виды курсоров в табличном документе

Когда готовый табличный документ открыт в режиме Только просмотр, при помещении указателя мыши над ячейкой, содержащей заполненное свойство Параметр расшифровки, указатель мыши может принимать форму как на рис.692 (курсор вида Гиперссылка будет появляться тогда, когда для ячейки-ссылки установлено свойство Гиперссылка). Это значит, что возможна детализация (расшифровка) данных табличного документа. Теперь, если дважды щелкнуть левой кнопкой мыши на этой ячейке (или сделать ее активной и нажать клавишу Enter, а для гиперссылки просто щелкнуть мышью), значение поля будет выдано на экран:

•

Значения типа Строка, Число, Дата и Перечисление будут выданы для просмотра.

•

Если значение имеет тип Документ, соответствующий документ будет открыт для просмотра и редактирования.

•

Если значение является элементом справочника, этот элемент будет открыт для просмотра и редактирования в диалоге. Если при настройке свойств справочника было задано редактирование в списке, будет открыта форма списка справочника, а указатель в табличном поле будет установлен на нужный элемент справочника.

Эта обработка расшифровки называется стандартной и не требует никаких дополнительных настроек.

Если требуется, чтобы обработка расшифровки производилась особенным образом, то необходимо в свойствах поля табличного документа, в категории События для события Обработка расшифровки указать имя процедуры, осуществляющей обработку события, возникающего при выборе ячейки с расшифровкой. В модуле формы в теле этой процедуры нужно средствами встроенного языка описать обработку расшифровки.

Приведем пример. Для отчета создана форма и макет МакетПечати. Макет содержит именованные области Заголовок, Шапка, ТоварыШапка и Товары. Область Товары содержит ячейку, в параметрах расшифровки которой указано имя параметра расшифровки Расшифровка. В форме размещен элемент формы типа Таблица, связанный с реквизитом формы ТабДок типа ТабличныйДокумент. В категории свойств События этого элемента для свойства Обработка расшифровки указывается на процедуру обработки выбора ячейки РезультатОбработкиРасшифровки(), расположенной в модуле отчета.

Формирование табличного документа производится по следующей примерной схеме:

ТабДок.ОтображатьСетку = Ложь; ТабДок.ОтображатьЗаголовки = Ложь; ТабДок.Защита = Истина; ТабДок.ТолькоПросмотр = Истина; Макет = Документы.РасходТовара.ПолучитьМакет("МакетПечати"); // Заголовок Область = Макет.ПолучитьОбласть("Заголовок"); ТабДок.Вывести(Область); // Шапка Шапка = Макет.ПолучитьОбласть("Шапка"); Шапка.Параметры.Заполнить(ЭтотОбъект); ТабДок.Вывести(Шапка); // Товары Область = Макет.ПолучитьОбласть("ТоварыШапка"); ТабДок.Вывести(Область); ОбластьТовары = Макет.ПолучитьОбласть("Товары"); Для Каждого ТекСтрокаТовары Из Товары Цикл ОбластьТовары.Параметры.Заполнить(ТекСтрокаТовары); ТабДок.Вывести(ОбластьТовары); КонецЦикла;

Копировать в буфер обмена Процедура РезультатОбработкаРасшифровки(Эл, Расшифровка, СтандартнаяОбработка) СтандартнаяОбработка = Ложь; ТипРасшифровки = ТипЗнч(Расшифровка); Если ТипРасшифровки = Тип("СправочникСсылка.Номенклатура") Тогда ИмяФормыОтчета = "ФормаОтчета1"; Иначе ИмяФормыОтчета = "ФормаОтчета2"; КонецЕсли; ФормаОтчета = ОбработкаОбъект.ПолучитьФорму(ИмяФормыОтчета); ФормаОтчета.ВыполнитьОтчет(Расшифровка, ПериодС, ПериодПо); ФормаОтчета.Открыть(); КонецПроцедуры

Категория свойств «Значения»

Пример реализации процедуры обработки выбора расшифровки:

ФормаОтчета1 и ФормаОтчета2 ‑ имена форм, разработанных специально для детализированных отчетов (обычно такие формы содержат поле табличного документа, в которое выводится результат).

Использование расшифровки ‑ определяется область использования расшифровки. При выборе ячейки расшифровка возможна только для указанной ячейки; при выборе строки расшифровка действует в каждой ячейке текущей строки. Если выбрано Не использовать и указана расшифровка, расшифровка не действует: указатель мыши не изменяет форму (возможные виды курсоров (см. рис.692) и выбор в ячейке не отрабатывается.

Содержит значение ‑ если установлено, то ячейка содержит значение. Установка свойства влияет на состав свойств других категорий.

Тип значения ‑ тип значения ячейки. Для табличного документа перечень содержит типы Число, Строка, Дата и Булево. Для элемента управления формы Поле табличного документа помимо примитивных типов перечень дополнительно содержит типы, определенные для текущей конфигурации, ‑ документы, справочники, перечисления и т. д. Кроме того, можно установить тип данных Произвольный. В таком случае он может быть определен уже во время заполнения формы с помощью средств встроенного языка.

Элемент управления ‑ выбирается элемент управления для редактирования содержимого ячейки. Список возможных значений зависит от выбранного типа содержимого. Например, при выборе в типе данных значения Число в качестве редактора можно выбрать Поле ввода или Флажок. Для выбранного типа редактора в список объектов (Ячейки, Табличный документ) будет добавлена строка, содержащая тип редактора Поле ввода или Флажок. Состав свойств палитры свойств данного объекта определяется типом выбранного элемента управления.

35.17.3. Табличный документ в режиме ввода данных

35.17.3.1. Подготовка табличного документа

производить настройку формата изображения, то формат будет выбран из региональных настроек информационной базы.

Формат редактирования ‑ задается форматная строка, которая будет использоваться для отображения значения при его редактировании. Если не производить настройку формата изображения, то формат будет выбран из региональных настроек информационной базы.

Формат можно ввести вручную или с помощью конструктора форматной строки (см. здесь).

ПРИМЕЧАНИЕ. При редактировании табличного документа в тонком клиенте недоступны следующие свойства ячейки: Содержит значение, Тип значения, Элемент управления, Формат редактирования.

Другой способ построения отчета заключается в том, что пользователь вводит данные в предназначенные для этого ячейки табличного документа, размещенного в элементе формы.

В процессе ввода эти данные обрабатываются процедурами, написанными на встроенном языке, располагаемыми в модуле формы. Результаты расчетов могут использоваться при вычислении других ячеек табличного документа.

После ввода данных можно распечатать отчет и сохранить его для последующей работы.

Общая схема работы с табличным документом в режиме ввода данных выглядит следующим образом:

•

формируется макет типа Табличный документ, подготовленный особым образом, в который будет выполняться ввод данных;

•

формируется форма, в которой будет расположено поле вида Табличный документ, и в нем будет организован ввод данных;

•

формируются обработчики элемента формы вида Табличный документ, которые будут обрабатывать данные, введенные пользователем (при необходимости).

Рассмотрим перечисленные этапы подробнее на примере формирования бланка доставки товара из документа ДоставкаТоваров. Желаемый бланк приведен на рис.693. В этом бланке поля, выделенные подчеркиванием, должны вводиться пользователем. Причем поле Дата доставки будет автоматически рассчитываться как поле Дата оформления, увеличенное на Срок доставки. Дата оформления является датой документа.

Рис. 693. Бланк доставки

Для того чтобы реализовать табличное поле в режиме ввода данных, необходимо создать макет типа Табличный документ (с именем БланкДоставки). Затем нужно открыть сформированный макет и установить свойство Макет в значение Ложь.

Рис. 694. Свойства табличного документа

Далее нужно сформировать необходимую структуру документа, который будет формироваться.

Сформируем необходимые поля:

•

Адрес доставки. Нужно объединить несколько ячеек и затем определить следующие свойства:

•

Имя ‑ АдресДоставки;

•

Защита ‑ Ложь;

•

Содержит значение ‑ Истина;

•

Тип значения ‑ Строка;

•

Элемент управления ‑ Поле ввода.

•

Срок доставки. Для ячейки определить следующие свойства:

•

Имя ‑ СрокДоставки;

•

Защита ‑ Ложь;

•

Содержит значение ‑ Истина;

•

Тип значения ‑ Число, длина 3, точность ‑ 0, неотрицательное;

•

Элемент управления ‑ Поле ввода.

•

Дата доставки. Для ячейки определить следующие свойства:

•

Имя ‑ ДатаДоставки;

•

Защита ‑ Ложь;

•

Содержит значение ‑ Истина;

•

Тип значения ‑ Дата, состав даты ‑ Дата;

•

Элемент управления ‑ Поле ввода.

•

Дата оформления. Для ячейки определить следующие свойства:

•

Имя ‑ ДатаОформления;

•

Защита ‑ Истина;

•

Содержит значение ‑ Истина;

•

Тип значения ‑ Дата, состав даты ‑ Дата;

•

Элемент управления ‑ Поле ввода;

•

Формат ‑ ДЛФ=DD.

35.17.3.2. Подготовка формы к вводу данных

Копировать в буфер обмена &НаКлиенте Процедура ОформитьДоставку(Команда) ПараметрыДоставки = Новый Структура("ДатаДокумента", Объект.Дата); ОткрытьФормуМодально("Документ.ДоставкаТоваров.Форма.ОформлениеДоставки", ПараметрыДоставки); КонецПроцедуры

Рис. 695. Готовый макет

Макет представлен с включенным режимом Отображать именованные ячейки (можно включить с помощью команды меню Таблица ‑ Имена ‑ Отображать именованные ячейки).

ПРИМЕЧАНИЕ. Свойства, которые могут быть заданы для поля ввода в макете, не сохраняются и не используются системой при формировании полей ввода в табличном документе в режиме ввода данных.

После того как подготовлен макет табличного документа, следует сформировать форму, в которой будет выполняться ввод данных, и реализовать ее вызов из документа.

В документе нужно создать команду формы ОформитьДоставку со следующим программным текстом:

Команду следует разместить на форме.

Теперь необходимо создать форму, в которой будет происходить ввод данных.

Для этого следует в документе ДоставкаТоваров создать произвольную форму ОформлениеДоставки. В ней нужно создать следующие элементы:

•

параметр формы ДатаДокумента типа Дата;

•

реквизит формы ДатаДокумента типа Дата;

•

реквизит формы ТабличныйДокумент типа ТабличныйДокумент;

•

элемент формы ТабличныйДокумент, связанный с реквизитом формы ТабличныйДокумент.

Копировать в буфер обмена &НаСервере Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка) // Запомним дату формирования документа ДатаДокумента = Параметры.ДатаДокумента; // Установим подготовленный макет ТабличныйДокумент = Документы.ДоставкаТоваров.ПолучитьМакет("БланкДоставки"); // Установим дату создания документа в поле табличного документа ТабличныйДокумент.Область("ДатаОформления").Значение = ДатаДокумента; КонецПроцедуры &НаКлиенте Процедура ПриОткрытии(Отказ) // Активизируем область табличного документа Элементы.ТабличныйДокумент.ТекущаяОбласть = ТабличныйДокумент.Область("АдресДоставки"); КонецПроцедуры

Рис. 696. Форма «ОформлениеДоставки»

Затем необходимо реализовать в форме следующие обработчики:

В результате получается следующая форма, заполненная данными:

35.17.3.3. Реализация реакции на изменение ячеек табличного документа

Копировать в буфер обмена &НаКлиенте Процедура ТабличныйДокументПриИзмененииСодержимогоОбласти(Элемент, Область) СекундВСутках = 24 * 60 * 60; Если Область.Имя = "ДатаДоставки" Тогда ТабличныйДокумент.Область("СрокДоставки").Значение = (ТабличныйДокумент.Область("ДатаДоставки").Значение - НачалоДня(ДатаДокумента)) / СекундВСутках; ИначеЕсли Область.Имя = "СрокДоставки" Тогда ТабличныйДокумент.Область("ДатаДоставки").Значение = НачалоДня(ДатаДокумента) + ТабличныйДокумент.Область("СрокДоставки").Значение * СекундВСутках; КонецЕсли КонецПроцедуры

35.18.Редактор карты маршрута

Рис. 697. Бланк доставки

В получившейся форме отсутствует автоматический пересчет полей Срок доставки и Дата доставки при их изменении.

Для того чтобы такой пересчет стал возможным, следует реализовать обработку соответствующего события для реквизита формы, связанного с табличным документом.

Нужно добавить обработчик ПриИзмененииСодержимогоОбласти для элемента формы ТабличныйДокумент. В обработчике должен располагаться следующий программный текст:

Теперь табличный документ обрел желаемую интерактивность.

Карта маршрута ‑ это схематическое изображение последовательности выполнения действий, предусмотренных бизнес-процессом. Она является частным случаем графической схемы.

Основное отличие карты маршрута от графической схемы ‑ особая обработка специальных

35.18.1. Редактирование карты маршрута

35.18.2. Элементы карты маршрута

35.18.2.1. Рекомендации по оформлению

35.18.2.2. Порядок элементов

последовательности действий бизнес-процесса, и иллюстрацией для пользователя структуры этих действий, а также средством отображения текущего состояния бизнес-процесса (описание метода ПолучитьКартуМаршрута() справки по встроенному языку).

Карта маршрута представляет собой прямоугольную область экрана, которая в самом общем случае содержит различные элементы карты маршрута, например, точку старта, точку завершения, декорации, соединительные линии и т. д.

Для редактирования карты маршрута в окне редактирования бизнес-процесса, на закладке Прочее нужно нажать кнопку Карта маршрута.

Процесс редактирования карты маршрута заключается в размещении на карте маршрута элементов карты различных типов, редактировании их свойств и соединении их друг с другом соединительными линиями.

Для редактирования карты маршрута используется мышь или клавиатура (некоторые операции выполняются только с помощью мыши ‑ например, соединение элементов карты маршрута с помощью соединительных линий). При появлении редактируемой карты маршрута на экране становятся доступными кнопки панели инструментов Вставка элементов карты маршрута и пункт меню верхнего уровня Карта маршрута.

Установка свойств карты маршрута производится с помощью палитры свойств (см. здесь).

Наилучшим подходом для рисования карт маршрута является вертикальная ориентация карты. Карта маршрута предполагает вертикальное расположение (сверху вниз). Например, при добавлении элемента карты маршрута (далее в данном разделе «элемента») Точка действия он сразу создается с исходящей соединительной линией, направленной вниз.

При создании надписей желательно использовать одинаковые шрифты. Использование другого шрифта является дополнительным средством привлечения внимания (например, заголовок декорации, выделяющей группу элементов).

Редактор карты маршрута позволяет размещать в карте маршрута различные элементы, задавать их размеры и выравнивать границы и т. д.

Чтобы облегчить размещение элементов, редактор карты маршрута предоставляет различные сервисные средства. Это использование разметочной сетки, а также выполнение различных действий над группой элементов (выравнивание, распределение в карте маршрута, установка размеров и т. д.).

В качестве дополнительных возможностей можно использовать индивидуальное оформление элементов. С помощью свойств категории Оформление производится настройка цвета текста и фона поля, шрифта текста, выбирается вид и цвет рамки, использование картинки, подсказки и другие приемы оформления. Состав свойств зависит от типа элемента.

В отличие от обычной графической схемы, в карте маршрута даже после изменения порядка определенные типы элементов все равно сохраняют порядок, характерный для данного типа. А именно:

•

Декорации всегда находятся на заднем плане (внизу) (т. е. менять порядок декораций можно только относительно друг друга ‑ относительно других элементов они всегда будут ниже).

•

Следом за декорациями (выше их) идут соединительные линии.

•

На самом верху ‑ все остальные элементы (визуализирующие точки бизнес-процесса). Таким образом, элементы, составляющие логику карты маршрута, всегда лежат выше декораций и

35.18.2.4. Проверка корректности карты маршрута

Смысл карты маршрута состоит в описании последовательности действий бизнес-процесса ‑ она задается именно связью элементов с помощью элемента Соединительная линия. Соединительные линии нельзя вставлять просто так ‑ они всегда присоединены к каким-либо точкам бизнес-процесса и не могут существовать сами по себе. Соединительные линии нельзя удалить, если это не предусмотрено точкой бизнес-процесса (например, точка разделения и точка выбора варианта).

Связывать друг с другом можно все элементы, визуализирующие точки бизнес-процесса, т. е. все элементы, кроме элементов Декорация, Соединительная линия и Декоративная линия. По умолчанию большинство элементов, визуализирующие точки бизнес-процесса, вставляются в карту маршрута с одной исходящей линией, которую нельзя ни отсоединить, ни удалить. Ее можно только передвинуть на другой порт (порт ‑ область элемента, куда может быть присоединена линия ‑ обычно это середина стороны прямоугольника, занимаемого элементом; на схеме незанятый порт обозначается синим крестиком).

Для работы с элементом карты маршрута Соединительная линия нужно выбрать ее нажатием мыши на любом сегменте (отрезке) соединительной линии либо перейти к ней с помощью клавиши Tab (Shift + Tab).

Если конец линии не присоединен ни к какому элементу, то прямоугольник на конце линии имеет красный цвет, а стрелка имеет контур, т. е. не закрашена внутри. Для присоединения нужно мышью захватить конец соединительной линии (серый или красный прямоугольник) и, потащив в область порта какого-либо элемента, там отпустить. После этого соединительная линия автоматически перестроится. Можно также переприсоединить соединительную линию (присоединив ее конец к другому элементу). При этом действует следующее ограничение: нельзя напрямую зациклить один элемент на втором (точка1 à точка2 и точка2 à точка1), если ни один из этих элементов не является элементом карты маршрута Точка условия или Точка выбора варианта.

При вставке элемента в карту маршрута автоматически происходит попытка присоединить незанятые порты этого элемента к близлежащим неприсоединенным линиям. При перемещении или изменении размера элемента автоматически происходит попытка присоединить незанятые порты этого элемента к близлежащим свободным (неприсоединенным) линиям, а также исходящие из этого элемента линии, чей конец не присоединен к незанятым портам других элементов, находящимся в непосредственной близости.

Элемент Декоративная линия предназначен для соединения декораций и точек карты маршрута. В карте маршрута может быть размещено произвольное число декоративных линий.

При выборе пункта Карта маршрута ‑ Проверить, а также автоматически при сохранении карты маршрута происходит проверка корректности карты маршрута. При этом проверяются следующие некорректные ситуации:

•

зацикливание;

•

наличие неприсоединенных линий;

•

наличие точек маршрута, не являющихся точкой старта и при этом не имеющих ни одной входящей линии;

•

карта маршрута, не имеющая ни одной точки старта;

•

наличие точек маршрута, не имеющих пути в точку завершения;

•

карта маршрута, в которой не все линии, вошедшие в точку слияния, вышли из соответствующей ему точки разделения;

•

карта маршрута, в которой распараллеленные ветки (исходящие из точки разделения) входят в одни и те же точки маршрута (до точки слияния);

•

карта маршрута с циклами, которые не содержат ни одной точки вида Точка действия, Точка вложенного бизнес-процесса или Точка обработки (цикл ‑ замкнутая уникальная последовательность точек маршрута);

35.18.3. Элементы карты маршрута

35.18.3.1. Общие свойства элементов карты маршрута

35.18.3.1.1. Категория свойств «Основные»

35.18.3.1.2. Категория свойств «События»

варианта не имеет обработчика события (соответственно ПроверкаУсловия() либо ВыборВарианта()).

В разделе описываются все типы элементов карты маршрута в алфавитном порядке представления элементов.

Поведение элементов настраивается в палитре свойств путем установки и выбора значений. Некоторые свойства элементов присущи всем или большинству типов элементов. Индивидуальные свойства приводятся в справке по встроенному языку для каждого вида элементов.

Существует ряд свойств, которые присущи всем или большинству типов элементов. Обычно такие свойства имеют одинаковое назначение и редактируются одинаковым образом. Ниже будут описаны такие свойства, а в разделах, посвященных отдельным типам элементов, будет изложен порядок редактирования уникальных свойств элементов.

Приводятся только свойства, отличающие элементы карты от соответствующих элементов графической схемы.

Для удобства описания свойства будут сгруппированы по категориям палитры свойств.

Некоторые свойства, описываемые ниже, для некоторых элементов могут отсутствовать.

Наименование задачи ‑ наименование задачи, которая будет формироваться в точках вида Точка действия или Точка вложенного бизнес-процесса.

Свойства этой категории определяют поведение точек бизнес-процесса, представленных элементами, при определенных действиях, например, при интерактивной активации, при создании задач, при проверке условия (для элементов вида Точка условия) и т. д.

При работе с элементами большинство действий может инициировать запуск связанных с этими действиями процедур. В теле каждой процедуры средствами встроенного языка описывается обработка события.

Рис. 698. Создание обработчика события

Инициализация создания процедуры, отвечающей за отработку события, производится нажатием специальной кнопки палитры свойств, расположенной справа от реквизита с наименованием события в категории свойств События (см. рис.698).

Процедуры создаются в модуле бизнес-процесса, свойством которого является редактируемая карта маршрута.

В режиме работы с бизнес-процессом при наступлении события управление выполнением

35.18.3.2. Соединительная линия

35.18.3.3. Точка действия

35.18.3.3.1. Категория свойств «Адресация»

35.18.3.4. Точка разделения

35.18.3.5. Точка условия

35.18.3.6. Точка завершения

справке по встроенному языку, в описании соответствующего объекта.

Элемент карты маршрута Соединительная линия предназначен для соединения в карте маршрута элементов, визуализирующих точки бизнес-процесса (например, элемент Точка старта, элемент Точка действия, элемент Точка условия и т. д.). Элемент Соединительная линия автоматически перестраивается при изменении положения элементов. Возможности вмешиваться в алгоритм построения нет.

Элемент Соединительная линия вставляется автоматически при вставке других элементов карты маршрута и не может существовать сам по себе. Вставка дополнительных соединительных линий предусмотрена только в элементах карты маршрута вида Точка разделения и Точка выбора варианта.

При построении линии система руководствуется правилом выбора кратчайшего пути, состоящего из вертикальных и горизонтальных отрезков линий и не пересекающего другие точки карты.

Элемент карты маршрута вида Точка действия отображает основную точку бизнес-процесса, по которой выдаются и выполняются задачи.

Пояснение ‑ строка, дополнительно характеризующая адресацию точки действия. Применяется, когда атрибуты адресации проставляются из встроенного языка, а не задаются заранее на этапе проектирования карты маршрута.

Групповая ‑ если установлено в значение Истина, то задачи на данной точке бизнес-процесса будут выданы каждому члену группы (отдела). В противном случае выдается одна задача на всю группу, например, «Отдел продаж», выполняет ее один человек (первый взявший ее).

Реквизиты адресации ‑ этих свойств столько, сколько реквизитов адресации у задачи, указанной в свойстве Задача данного бизнес-процесса. В палитре свойств можно выбрать значение из предопределенных данных, тип которых задан в реквизите адресации задачи (например, из справочника Отделы или Исполнители).

Элемент карты маршрута Точка разделения отображает точку бизнес-процесса, в которой поток исполнения разделяется на несколько параллельных веток, идущих одновременно. По умолчанию размещается в карте маршрута с тремя исходящими соединительными линиями.

Для добавления выходящей линии в контекстном меню нужно выбрать пункт Добавить линию. Для удаления ‑ выделить линию, выбрать пункт Удалить. При этом нельзя удалить единственную оставшуюся исходящую линию.

Элемент карты маршрута Точка условия отображает точку бизнес-процесса, из которой есть два выхода, отражающие результат выполнения логического условия.

По умолчанию элемент Точка условия вставляется в карту маршрута с двумя исходящими слева и справа соединительными линиями. Справа располагается ветка, по которой идет процесс при возврате значения Истина в обработчике ПроверкаУсловия(). Ветки условия можно поменять местами. Для этого нужно выбрать линию, исходящую из элемента Точка условия и, захватив мышью прямоугольник у начала линии, перенести его на противоположную сторону элемента Точка условия.

35.18.3.7. Точка старта

35.18.3.8. Точка слияния

35.18.3.9. Точка вложенного бизнес-процесса

35.18.3.9.1. Категория свойств «Данные»

35.18.3.10. Точка обработки

35.18.3.11. Точка выбора варианта

35.18.4. Модуль

35.19.Редактор картинок

35.19.1. Общая информация

завершается бизнес-процесс. В карте маршрута может быть несколько элементов этого вида.

Элемент Точка старта отображает точку бизнес-процесса, с которой начинается выполнение бизнес-процесса. Для бизнес-процесса, имеющего несколько точек вида Точка старта, при запуске должна быть указана нужная точка старта. В элемент Точка старта не могут входить соединительные линии.

Элемент карты маршрута Точка слияния отображает точку бизнес-процесса, в которую сходятся параллельные пути исполнения, начавшиеся в точке разделения. Пока исполнение задач по всем параллельным путям не придет в точку слияния, переход к следующей за слиянием точке не будет выполнен. Одной точке слияния всегда соответствует одна точка разделения (но не наоборот, т. к. могут быть точки разделения без точек слияния). Не требуется явно указывать, какому элементу Точка разделения соответствует элемент Точка слияния. Это будет определено автоматически.

Элемент карты маршрута Точка вложенного бизнес-процесса отображает точку бизнес-процесса, в которой запускается на исполнение вложенный бизнес-процесс. Исполнение основного (родительского) процесса возобновляется только после завершения вложенного процесса.

Бизнес-процесс ‑ ссылка на вложенный бизнес-процесс.

Элемент карты маршрута Точка обработки отображает точку бизнес-процесса, выполняемую в автоматическом режиме и не имеющую адресата.

Элемент карты маршрута Точка выбора варианта отображает точку бизнес-процесса, имеющую несколько выходов (вариантов), из которых, в зависимости от значения возвращаемого параметра Вариант обработчика ОбработкаВыбораВарианта(), выбирается только один.

Карта маршрута не имеет собственного модуля. Обработчики событий помещаются в модуль объекта бизнес-процесса.

Конфигуратор предоставляет средство редактирования картинок и коллекций картинок.

Картинки хранятся в конфигурации в ветви Общие ‑ Общие картинки или в файлах на диске.

Для создания новой картинки в конфигурации в ветви Общие ‑ Общие картинки нужно выполнить команду Действия ‑ Добавить, а далее открыть созданную пустую картинку для редактирования.

Для редактирования картинки в конфигурации в ветви Общие ‑ Общие картинки следует выбрать картинку и выполнить команду меню Действия ‑ Изменить, далее в открывшемся диалоге нажать кнопку Редактировать. Если картинка хранится в формате, отличном от формата PNG, то при открытии будет предложено конвертировать картинку в формат PNG. При отказе от конвертации редактировать картинку невозможно.

35.19.2. Редактирование картинки

‑ Новый и в окне выбора типа редактора выбрать Картинка. Далее отредактировать пустую картинку и сохранить ее командой Файл ‑ Сохранить или Файл ‑ Сохранить как…

Для редактирования картинки, расположенной в файле на диске, следует выполнить команду меню Файл ‑ Открыть и в списке файлов выбрать нужный файл.

Редактор работает в двух режимах: редактирование картинки и редактирование коллекции картинок. Различие между картинкой и коллекцией картинок носит условный характер. Под коллекцией картинок понимается картинка, состоящая из картинок-элементов, имеющих одинаковый размер. Любую картинку можно представить как коллекцию картинок. Коллекция картинок позволяет хранить и редактировать картинки, чье использование однотипно, например, пиктограммы, картинки кнопок, иконки и т. д. По умолчанию редактор открывается в режиме редактирования картинок.

Приемы редактирования картинки не зависят от выбора вида картинки (см. здесь). Особенности работы с коллекцией картинок см. здесь.

После выбора (или создания) картинки ее можно редактировать с помощью редактора картинок.

Рис. 699. Редактор картинок

Окно редактора состоит из панели инструментов, двух полей для редактирования картинки (левое представляет картинку в натуральную величину и предназначено для просмотра результата

для редактирования) и палитры цветов для выбора цвета.

Редактировать картинку можно в любом поле. Редактирование осуществляется мышью. Предварительно нужно выбрать инструмент или фигуру для рисования (карандаш, кисть, аэрограф, линию, прямоугольник, эллипс), в палитре цветов следует выбрать цвет для инструмента.

Текущее положение указателя мыши и размер области, а также масштаб показываются в панели состояния.

Картинка представляет собой прямоугольную область, состоящую из набора точек (пикселей), размер которой можно изменить с помощью мыши, потянув маркер нижней или правой границы или правого нижнего угла. Размеры картинки также можно изменить в окне Параметры картинки (см. ниже).

Редактирование сводится к указанию определенного цвета каждой точки картинки. Количество цветов определяется разрешением картинки. Чем больше разрешение, тем больше цветов можно использовать.

ВНИМАНИЕ! Использование разрешения 24 бита на пиксель при больших размерах картинок приводит к увеличению размеров конфигурации.

Выбор цвета производится в палитре цветов отдельно для каждой кнопки мыши. Выбранный цвет показывается двойной рамкой.

Состав цветов можно менять. Для этого нужно дважды щелкнуть мышью цвет, который требуется изменить. В открывшемся окне выбора цвета выбрать нужный из стилей или создать новый цвет.

Размер картинки можно менять. Для этого достаточно с помощью указателя мыши потянуть маркер стороны или угла области картинки.

Сетка (пиксельная) предназначена для облегчения редактирования картинки. Сетка показывается прерывистой линией. Для настройки показа сетки нужно выбрать пункт Действия ‑ Сетка. На экран выводится диалог.

Рис. 700. Установка параметров сетки

Если флажок По точкам установлен, то показывается пиксельная сетка.

Если установлен флажок По изображениям, то подразумевается, что картинка представляет собой коллекцию картинок одинакового размера (о редактировании коллекции (см. раздел ниже). В этом случае становятся доступными поля для указания размеров элемента коллекции. Помимо пиксельной сетки в поле редактирования картинки выводится сетка коллекции в виде тонких сплошных линий. При этом режим редактирования не изменяется.

При установленном флажке По изображениям изменение размера картинки кратно размеру ячейки. Если флажок не установлен, то размер изменяется с точностью до пикселя.

Для рисования используют различные инструменты и набор фигур. Набор и порядок использования инструментов аналогичны стандартному набору инструментов, используемых в программе Paint, входящей в Microsoft Windows. Таблицу сочетаний клавиш для редактора картинок (см. в справке при использовании программы).

Но есть и некоторые отличия. По кнопке Масштаб изображение поля редактирования может масштабироваться в пределах от 1:1 до 20:1 с шестью ступенями выбора. Нажатие кнопки приводит к выбору следующей ступени масштаба. Когда достигнут масштаб 20:1, очередное нажатие кнопки приводит к выбору масштаба 1:1. Нужный масштаб можно выбрать сразу, нажав справа от кнопки масштаба кнопку выбора (с маленьким треугольником вершиной вниз).

Если нажать кнопку Масштаб и перевести указатель мыши на любую из областей рисунка, то

35.19.3. Коллекции картинок

Изменить масштаб также можно, используя мышь с колесом прокрутки с нажатой клавишей Ctrl.

Кнопки рисования фигур (прямоугольник, прямоугольник с закругленными краями, эллипс) также имеют кнопки выбора, нажав которые можно выбрать вид фигуры (простой, обведенный закрашенный, закрашенный).

Кнопка Параметры картинки вызывает на экран диалог:

Рис. 701. Параметры картинки

В диалоге задается размер картинки и разрешение (определяет максимальное число используемых цветов). Для картинок, у которых разрешение установлено в 1, 4 или 8 бит на пиксель, невозможно использовать альфа-канал. Разрешается использование только одного прозрачного цвета. Использовать альфа-канал можно в случае, если разрешение больше 8 бит на пиксель.

ПРИМЕЧАНИЕ. Не следует использовать в конфигурациях альфа-канал у картинок, чей размер превышает 40 000 точек (например, картинка 200х200 точек). Для таких картинок не поддерживается корректное отображение в веб-клиенте, который работает в веб-браузере Microsoft Internet Explorer 6.0. Это правило не относится к картинкам-коллекциям, размер элементов которых меньше указанного ограничения.

Редактор картинок допускает использование стандартных команд работы с буфером обмена. Для вставки рисунка нужно использовать Ctrl + V, для копирования ‑ Ctrl + С, для копирования с удалением ‑ Ctrl + X. Если размер картинки превышает текущий размер, то редактор предлагает изменить его.

В палитре инструментов есть многоцелевая кнопка, которая меняет свое назначение в зависимости от выбранного инструмента или фигуры. Она расположена во втором ряду справа, перед кнопкой Параметры картинки. При выборе линии, кривой, прямоугольника и эллипса данная кнопка показывает толщину используемой линии, с помощью которой рисуется фигура, в пикселях. Нажатие кнопки приводит к последовательной смене толщины (пять ступеней). При нажатии кнопки выбора открывается выпадающее меню, в котором можно выбрать нужную толщину линии рисования фигуры. Для аэрографа с помощью данной кнопки определяется размер пятна, для кисти ‑ размер и форма, для ластика ‑ размер. При выборе режима выделения или ввода текста кнопка предоставляет возможность задать режим прозрачности.

Для ввода текста нужно нажать кнопку Текст. На экран выводится диалог:

Рис. 702. Диалог ввода текста

В многострочном поле ввода вводится текст. По кнопке Шрифт выбирается требуемый шрифт (начертание, размер и другие характеристики). Выбор шрифта осуществляется из системных шрифтов или из стилей, определенных в конфигурации.

С помощью кнопки Замена цветов просто осуществляется замена выбранного указателем мыши цвета (указывается пиксель) на цвет, установленный для данной кнопки мыши. Таким образом можно быстро перекрашивать рисунки, используя сразу два цвета на каждую кнопку мыши.

Коллекция картинок ‑ это картинка, состоящая из отдельных элементов (картинок) одинакового размера. Элементы образуют прямоугольную матрицу, каждая ячейка которой представляет самостоятельную картинку.

Коллекция картинок предназначена для упрощения выбора нужной картинки в элементы

35.20.Редактор HTML-документа

35.20.1. Общая информация

С помощью редактора картинок можно создавать и редактировать коллекции картинок. Для перехода в режим редактирования коллекции нужно выбрать пункт Режим коллекции. При этом картинка, показанная в поле просмотра, разбивается на ячейки. Для редактирования картинки-элемента следует дважды щелкнуть ячейку мышью ‑ картинка-элемент показывается в поле редактирования. Приемы редактирования описаны в разделе выше.

В панели инструментов добавляются две кнопки ‑ Добавить колонку и Добавить строку. При нажатии той или иной кнопки в картинку добавляется новая колонка или строка.

Изменить размер элемента можно только в диалоге Параметры картинки (маркеры изменения размера недоступны).

Рис. 703. Параметры коллекции

В группе элементов Параметры картинки задаются размеры картинки в элементах (ячейках). В группе элементов Параметры коллекции задаются размеры ячейки в пикселях (точках). Параметры коллекции задаются с помощью сооветствующих атрибутов файла манифеста картинки с вариантами (подробнее см. здесь).

Коллекцию картинок можно также редактировать как обычную картинку. При этом рекомендуется предварительно настроить показ сетки по изображениям (см. здесь).

Данный редактор предоставляет основные возможности по редактированию HTML-документов. Также с помощью этого редактора редактируется справочная информация для объектов конфигурации.

Рис. 704. Редактор HTML-документа

Редактор состоит из трех закладок:

•

Редактирование ‑ с помощью этой закладки имеется возможность редактировать документ в визуальном режиме.

•

Текст ‑ с помощью этой закладки имеется возможность редактировать документ непосредственно с помощью языка разметки HTML. При этом возможности редактора совпадают

35.20.2. Визуальное редактирование

35.20.2.1. Форматирование текста

35.20.2.2. Вставка и работа с таблицей

35.20.2.3. Вставка картинки

однако недоступно непосредственное изменение документа.

Текст HTML-документа можно форматировать, т. е. устанавливать его стиль (шрифт, размер, оформление, отступы, выравнивание и т. д.).

При копировании текста из других текстовых редакторов, например, Microsoft Word, сохраняется исходное форматирование текста.

В HTML-документ можно вставлять таблицы. Для вставки таблицы нужно выбрать пункт Таблица ‑ Вставить таблицу. В открывшемся диалоге указать количество строк и колонок.

Если в дальнейшем в процессе редактирования выяснится, что указанного количества строк или колонок не хватает, их можно добавить.

Для работы с таблицей (вставка, удаление строк, колонок и ячеек) предназначены команды, выполняемые при выборе пунктов меню Таблица главного меню конфигуратора.

Пункт меню «Таблица»

Действие

Вставить строку Сверху от текущей строки добавляется новая строка

Удалить строку Удаляется текущая строка

Вставить колонку

Справа от текущей колонки добавляется новая колонка

Удалить колонку

Удаляется текущая колонка

Вставить ячейку

В таблицу слева от текущей ячейки добавляется ячейка. При этом все ячейки справа сдвигаются

Удалить ячейку Удаляет текущую ячейку. Все ячейки справа сдвигаются влево

Объединить ячейки

Объединяет две ячейки: текущую и ячейку, расположенную справа от текущей. При этом введенная информация в этих ячейках также объединяется. Если требуется объединить больше чем две ячейки, нужно выполнить эту операцию несколько раз

Разбить ячейку Разделяет текущую ячейку на две ячейки

Таблицы могут быть вложенными. Для создания вложенной таблицы необходимо создать новую таблицу в ячейке уже существующей таблицы.

В HTML-документ можно вставлять картинки.

Для вставки картинки нужно выбрать пункт Элементы ‑ Картинка. В открывшемся диалоге указать адрес картинки (путь и имя файла картинки) или выбрать файл в стандартном диалоге выбора файла. В поле Текст ввести поясняющий текст, который будет появляться в режиме просмотра в виде всплывающей подсказки при помещении указателя мыши над картинкой.

В группе реквизитов Расположение необходимо указать, если требуется, выравнивание картинки (как располагается картинка в документе).

35.20.2.4. Надпись

35.20.2.5. Гиперссылка

Значение выравнивания

Действия

Не задано Картинка располагается в тексте

Лево Картинка располагается в новой строке, прижата к левой границе документа

Право Картинка располагается в новой строке, прижата к правой границе документа

Низ Картинка располагается в тексте с выравниванием текста по нижней границе картинки

Центр Картинка располагается в тексте с выравниванием текста по центру картинки

Верх Картинка располагается в тексте с выравниванием текста по верхней границе картинки

Если требуется поместить картинку в рамку, в реквизите диалога Рамка нужно указать толщину рамки. Если толщина не указана или равна 0, то рамка не рисуется. Для вставки картинки нажать кнопку ОК. Указанные в диалоге реквизиты можно изменить в палитре свойств картинки.

Вставленную картинку можно переместить. Для этого следует указать картинку и перетащить ее мышью в нужное место документа. При этом свойство картинки Положение не меняется, т. е. если установлено не Лево и не Право, то картинку можно расположить в тексте, в противном случае картинка будет располагаться в новой строке.

При вставке картинки в формате SVG, если в HTML-странице отсутствует элемент вида: <meta http-equiv="X-UA-Compatible" content="IE=*"/>, то на страницу добавится такой элемент с текстом content="IE=Egde". Этот элемент выключает режим совместимости Microsoft Internet Explorer (по умолчанию, страница отрисовывается в режиме совместимости с Microsoft Internet Explorer версии 7). После добавления такого элемента, веб-браузер перезагружает страницу без режима совместимости (теряется текущая позиция курсора).

Если на компьютере установлен Microsoft Internet Explorer версии ниже 9, то в редакторе HTML картинка в формате SVG отображаться не будет.

Картинку можно копировать. Копирование осуществляется стандартным образом (с помощью буфера обмена или с помощью мыши при нажатой клавише Ctrl).

Картинку можно расположить в любой части HTML-документа (текст, таблица и надпись).

Надпись ‑ специальный объект HTML-документа. Он представляет собой область, в которую можно поместить текст, таблицу, картинку или другую надпись. При просмотре надписи вложенные объекты непрерывно прокручиваются справа налево.

Для вставки линии нужно выбрать пункт Элементы ‑ Надпись.

Размер надписи можно изменить. Для этого следует выделить надпись и с помощью мыши переместить маркер надписи.

Надписи можно располагать в тексте и в таблице.

Для создания гиперссылки в HTML-документе можно создавать ссылки.

Нужно выделить объект (текст или картинку), выбрать пункт Элементы ‑ Ссылка. На экран выводится диалог формирования ссылки.

35.20.2.6. Закладки

35.20.2.7. Линия

Рис. 705. Вставка гиперссылки

В реквизите Адрес нужно указать:

•

Адрес гиперссылки.

•

Ссылку на справочную информацию по объекту конфигурации.

•

Ссылку на системный раздел справки. Если режим редактирования конфигурации установлен в значение Управляемое приложение, то будут отображены только разделы справки, относящиеся к управляемому приложению (а также колонка, описывающая доступность раздела в веб-клиенте). Если режим редактирования конфигурации установлен в значение Управляемое приложение и обычное приложение, то будут отображены все разделы справки с указанием доступности раздела в управляемом приложении, веб-клиенте и обычном приложении.

•

Имя закладки (предваренное символом «#»).

Для создания ссылки следует нажать кнопку ОК.

Выделенный объект форматируется в соответствии со стилем гиперссылки. Обычно это синий цвет текста с подчеркиванием. Картинка помещается в рамку синего цвета.

Для создания внутренней ссылки в HTML-документе можно создавать закладки. Для этого следует выделить объект (текст или картинку) и выбрать пункт Элементы ‑ Закладка. На экран выводится диалог ввода имени закладки. Выделенный объект при этом не форматируется.

Закладки используются для организации внутренней ссылки.

С помощью линий производится зрительное разделение документа.

35.20.4. Просмотр результата

35.21.Локализация конфигураций

ограниченны. На закладке Текст разработчик может отредактировать документ в формате HTML-кода.

Следует помнить, что ручное изменение кодировки с помощью атрибута charset тега META не оказывают влияние на поведение редактора. При сохранении HTML-документ будет записан в кодировке UTF-8 с неизменным тегом charset, а при чтении тег charset будет установлен в значение utf-8.

Для просмотра результата редактирования HTML-документа нужно перейти на закладку Просмотр и проверить работу объектов документа.

Под локализацией конфигураций понимается формирование строковых значений, появляющихся в программе в режиме 1С:Предприятие, на языках, указанных в ветви Общие ‑ Языки дерева объектов конфигурации. Это может быть наименование пунктов в интерфейсе, наименованиях (синонимах) объектов, справочной информации, текстах модулей и т. д.

Наиболее сложным при выполнении данной работы является поиск мест, в которых необходимо ввести текст на требуемом языке. Поэтому данным режимом удобно пользоваться даже тогда, когда определен только один язык.

Для начала поиска нужно выбрать пункт Правка ‑ Редактирование текстов интерфейса.

На экран выводится диалог:

Рис. 706. Редактирование текстов интерфейса

На закладке Конфигурации выбираются объекты конфигурации, в которых требуется осуществить редактирование текстов интерфейса.

В список конфигураций будут включены все открытые на текущий момент окна конфигураций (помимо основной это может быть конфигурация базы данных, конфигурации, расположенные в

полный список объектов конфигурации, которые содержат интерфейсные свойства. Поиск можно осуществлять только в определенных объектах, если в поле выбора выбрать этот объект.

На закладке Файлы можно выбрать текстовые и табличные документы, внешние обработки, размещенные в файлах.

Рис. 707. Настройка поиска в файлах

На закладке Модули нужно установить флажок Искать в функциях "НСтр" ("NStr") в модулях, если требуется определить места использования оператора НСтр() в модулях. При использовании данного флажка следует помнить, что обработка оператора НСтр() выполняется без применения синтаксического анализа. Так, операторы НСтр() в комментариях также будут обработаны, при этом если строки на разных языках будут включать переносы строк, то признак комментария (//) перед такими («добавленными») строками не будет добавлен.

Для запоминания области поиска (список объектов конфигураций, файлов и открытые документы) в реквизите Область поиска следует указать наименование текущих установок. При повторном открытии окна поиска в списке областей достаточно выбрать нужную и выполнить поиск.

После того как выбраны нужные объекты, следует нажать кнопку Искать. На экран выводится окно:

Рис. 708. Окно с результатами поиска

Окно содержит табличное поле, в первой колонке которого выводится расположение найденного текста. Другие колонки обычно соответствуют указанным языкам. В табличном поле может быть больше колонок, чем определено языков. Дополнительные колонки появляются в том случае, когда в процессе конфигурирования создавались новые объекты Язык, которые затем либо удалялись, либо у них менялся код языка (при удалении или смене кода языка объектов данного типа конфигуратор не сбрасывает текст интерфейсов, введенных для этих языков).

достаточно щелкнуть заголовок колонки. При повторном щелчке заголовка производится смена направления сортировки.

Текст можно также изменить прямо в ячейке. Для этого нужно выбрать ячейку и нажать клавишу Enter. Поле ввода переводится в режим редактирования. Следует ввести нужный текст и снова нажать клавишу Enter. Измененный текст показывается красным цветом.

Для быстрого доступа к тексту интерфейса определенного объекта достаточно в колонке Расположение дважды щелкнуть мышью нужную строку. На экран выводится форма, в которой данный текст используется. В палитре свойств можно также произвести просмотр и замену найденного текста. Если текст изменялся вне окна редактирования, то табличное поле можно обновить.

Над табличным полем расположены элементы управления, предназначенные для выполнения различных действий и настройки окна.

В поле выбора Сворачивать производится выбор режима сворачивания текстов на разных языках. Если выбрано значение Нет, то сворачивание не производится. Если выбрано Совпадающие на языке сортировки, то все элементы, имеющие одинаковый текст в колонке, по которой производится сортировка, сворачиваются. При этом в первой колонке показывается значок группы (+), щелкнув который можно развернуть группу. В первой колонке будет показан текст <Вхождений N> (где N ‑ число вхождений). Если в других колонках по этой группе будут различные значения текста, то в ячейке этих колонок будет надпись <Различные значения>.

Если выбрано Совпадающие на всех языках, то все элементы, имеющие одинаковый текст, сворачиваются.

Для свернутых строк можно производить групповую замену текста. Для этого в ячейке нужного языка достаточно ввести его так, как если бы это была одна строка. Введенный текст заменяет текст сразу во всех строках, входящих в группу.

С помощью пункта Действия ‑ Новый поиск открывается окно настройки для изменения разделов конфигурации, в которых будет произведен поиск.

С помощью пункта Действия ‑ Копировать тексты производится полное копирование текстов одного языка в другой язык. Эта операция рекомендуется тогда, когда используемые слова и фразы на различных языках в основном совпадают.

Пункт Действия ‑ Очистить тексты производит полную очистку текстов указанного языка.

Пункт Действия ‑ Заполнить тексты производит оперативный перевод синонимов, заголовков, подсказок и текстов интерфейсов с использованием файла соответствия. Он представляет собой табличный документ, состоящий из нескольких колонок (по числу используемых языков).

В первой строке каждой колонки должен быть написан код языка (например, ru или lv). В остальных строках следуют образцы соответствий. Никаких требований к упорядочиванию (сортировке) строк не предъявляется. Строки могут дублироваться.

Рис. 709. Заполнение текстов

После выбора файла соответствия нужно указать основной язык (По языку) и языки, для которых требуется выполнить перевод текста (В языки). Установка флажка Заполнять только незаполненные приводит к блокировке перезаписи уже локализованных строк.

Выбор ключевого языка и языков для заполнения осуществляется из числа языков, которые были

35.22.Выполнение централизованной проверки конфигурации

заголовками, соответствующими кодам этих языков).

ПРИМЕЧАНИЕ. Если при открытии окна Редактирование текстов интерфейса обнаружены строки только на одном языке, команда Заполнить тексты будет недоступна.

Нажатие кнопки ОК производит заполнение текстов интерфейсов. При этом выполняется заполнение текстов с проверкой соответствия не только по тому языку, на основании которого выполняется загрузка, но и по всем языкам, которые присутствуют в файле соответствия текстов.

Это позволяет, например, поставить в соответствие одинаковым строкам на одном языке разные строки на другом. Для этого можно в двуязычной конфигурации завести еще один вспомогательный язык для комментирования текстов интерфейса и по-разному заполнять такой комментарий для омонимов основного языка. Например, для слова «Счет» на русском языке можно написать комментарии «бухгалтерский счет» и «документ счет». Это даст возможность при заполнении текстов из файла соответствия текстов сопоставить с первым из этих слов английское «Account», а со вторым ‑ «Invoice».

Пункт Действия ‑ Экспорт в табличный документ производит выгрузку содержимого табличного поля в табличный документ. Выполнение команды осуществляет вывод только уникальных строк.

С помощью пункта Действия ‑ Настройка осуществляется настройка показа табличного поля и установка режима открытия редакторов при групповой замене.

Рис. 710. Настройка окна редактирования текстов интерфейса

В группе Расположение колонок производится выбор способа расположения колонок:

•

Горизонтально ‑ это так, как показано на рис.710.

•

Комбинированно ‑ располагает колонки одна под другой.

•

Комбинированно, с выделением языка сортировки ‑ размещает колонки следующим образом: справа от колонки Расположение будет колонка с языком, по которому производится сортировка, а правее будут располагаться одна под другой колонки с другими языками. При щелчке мышью в области заголовка колонки выполняется сортировка по этой колонке, и она располагается справа от колонки Расположение. Колонка, по которой ранее выполнялась сортировка, занимает место выбранной колонки. Если языков всего два, то колонки просто меняются местами.

Если флажок При сворачивании отображать в виде дерева установлен, то доступ к свернутым строкам возможен, а свернутые группы показываются в виде дерева.

Рекомендуется не устанавливать флажок Открывать редакторы при групповой замене, если число вхождений достаточно большое.

Если флажок Изображать другим цветом отредактированные строки установлен, то измененный текст строк будет показан другим цветом.

Для выполнения проверки конфигурации нужно выбрать пункт Конфигурация ‑ Проверка конфигурации. На экран выводится окно:

Рис. 711. Проверка конфигурации

Рассмотрим подробнее, как выполняется проверка конфигурации. Любой прикладной код в системе «1С:Предприятие» выполняется в некотором окружении. Это окружение характеризуется некоторым набором определенных инструкций препроцессора (см. здесь) и набором доступных объектов. Соответственно, при выполнении проверки конфигуратор определяет инструкции препроцессора для каждого отмеченного пункта и выполняет проверку. Следует отметить, что если проверяется клиентское приложение в клиент-серверном варианте, то на стороне клиента проверяется весь прикладной код, а на стороне сервера ‑ только те общие модули, которые доступны для вызова из клиентской части приложения. В том случае, если в проверяемом приложении существует общий модуль, поставляемый без исходных текстов, то при проверке конфигурации все вызовы методов этого общего модуля будут отмечаться как возможно ошибочные. Проверки, выполняемые с помощью данного диалога, можно выполнить с помощью команды /CheckConfig командной строки пакетного запуска конфигуратора.

Так как различных режимов работы получается достаточно много, то проверки разделены на две группы:

•

Группа проверок, доступная для принудительной и автоматической проверки при редактировании конфигурации. Эти режимы доступны для выбора на закладке Модули ‑ Проверка диалога настройки параметров конфигуратора (см. здесь).

(описываемый режим).

Для каждого режима синтаксического контроля модулей, указываемого в диалоге, будут описаны:

•

Инструкции препроцессора, которые будут определены при выборе этого режима проверки.

•

Особенности контроля (если они есть).

•

Параметр команды /CheckConfig, который позволит выполнить аналогичную проверку.

Также будут описаны режимы проверки, которые не имеют отношения к синтаксическому контролю модулей, но позволяют выполнять различные вспомогательные проверки. Для таких режимов проверки таже будут указаны параметры команды /CheckConfig, позволяющие выполнить проверку с помощью командой строки.

Смотри также:

•

Команда /CheckConfig командной строки пакетного запуска конфигуратора (см. здесь).

Общие параметры

Проверка логической целостности конфигурации

Стандартная проверка, обычно выполняемая перед обновлением базы данных. При выполнении данной проверки выполняется удаление некорректной информации, которая могла оказаться в конфигурации после редактирования предыдущими версиями системы.

Параметр команды /CheckConfig: ‑ConfigLogIntegrity.

Поиск некорректных ссылок

Поиск ссылок на удаленные объекты. Выполняется по всей конфигурации, включая формы, макеты, интерфейсы и т. д. Также выполняется поиск некорректных ссылок на предопределенные данные для планов счетов (если для плана счетов задано свойство Виды субконто) и планов видов расчетов.

Параметр команды /CheckConfig: ‑IncorrectReferences.

Синтаксический контроль модулей

Тонкий клиент

Проверка компиляции модулей в режиме проверки среды тонкого клиента в режиме управляемого приложения, выполняемого в файловом варианте.

Определены инструкции препроцессора: Клиент, НаКлиенте, ТонкийКлиент.

Параметр команды /CheckConfig: ‑ThinClient.

Веб-клиент

Проверка компиляции модулей в режиме проверки среды веб-клиента в режиме управляемого приложения, выполняемого в файловом варианте.

Определены инструкции препроцессора: Клиент, НаКлиенте, ВебКлиент.

Параметр команды /CheckConfig: ‑WebClient.

Мобильный клиент

Проверка компиляции модулей в режиме проверки среды мобильного клиента.

Определены инструкции препроцессора: Клиент, НаКлиенте, МобильныйКлиент.

Параметр команды /CheckConfig: ‑MobileClient.

Мобильный клиент (автономный режим) и мобильный автономный сервер

отличающиеся определенными инструкциями препроцессора:

•

Первая проверка: Клиент, НаКлиенте, МобильныйКлиент.

•

Вторая проверка: Сервер, НаСервере, МобильныйАвтономныйСервер.

Параметр команды /CheckConfig: ‑MobileClientStandalone.

Сервер

Проверка компиляции модулей в режиме проверки среды сервера «1С:Предприятия».

Определены инструкции препроцессора: Сервер, НаСервере.

Параметр команды /CheckConfig: ‑Server.

Внешнее соединение

Проверка компиляции модулей в режиме проверки среды внешнего соединения, выполняемого в файловом варианте.

Определены инструкции препроцессора: ВнешнееСоединение, Сервер.

Параметр команды /CheckConfig: ‑ExternalConnection.

Внешнее соединение (вариант клиент-сервер)

Проверка компиляции модулей в режиме проверки среды внешнего соединения, выполняемого в варианте клиент-сервер.

Определены инструкции препроцессора: ВнешнееСоединение.

Параметр команды /CheckConfig: ‑ExternalConnectionServer.

Мобильное приложение ‑ клиент

Проверка компиляции модулей в режиме проверки среды клиентского приложения, выполняемого на мобильной платформе.

Определены инструкции препроцессора: Клиент, НаКлиенте, МобильноеПриложениеКлиент.

Параметр команды /CheckConfig: ‑MobileAppClient.

Мобильное приложение ‑ сервер

Проверка компиляции модулей в режиме проверки среды клиентского приложения, выполняемого на мобильной платформе.

Определены инструкции препроцессора: Сервер, НаСервере, МобильноеПриложениеСервер.

Параметр команды /CheckConfig: ‑MobileAppServer.

Толстый клиент

Проверка компиляции модулей в режиме проверки среды управляемого клиента, выполняемого в файловом варианте.

Если свойство конфигурации Использовать обычные формы в управляемом приложении имеет значение Ложь, то модули обычных форм не проверяются при выборе этого теста.

Определены инструкции препроцессора: Клиент, НаКлиенте, ТолстыйКлиентУправляемоеПриложение, Сервер, НаСервере.

Параметр команды /CheckConfig: ‑ThickClientManagedApplication.

Толстый клиент (вариант клиент-сервер)

варианте клиент-сервер.

Если свойство конфигурации Использовать обычные формы в управляемом приложении имеет значение Ложь, то модули обычных форм не проверяются при выборе этого теста.

Определены инструкции препроцессора: Клиент, НаКлиенте, ТолстыйКлиентУправляемоеПриложение.

Параметр команды /CheckConfig: ‑ThickClientServerManagedApplication.

Поставка модулей без исходных текстов

Если в настройках поставки конфигурации для некоторых модулей указана поставка без исходных текстов, проверяется возможность генерации образов этих модулей.

Параметр команды /CheckConfig: ‑DistributiveModules.

Логическая проверка модулей

Поиск неиспользуемых процедур и функций

Поиск локальных (не экспортируемых) процедур и функций, на которые отсутствуют ссылки. В том числе осуществляется поиск неиспользуемых обработчиков событий.

Процедура или функция модуля формы будет считаться используемой, если ее имя встречается в виде "ИмяПроцедуры" (включая кавычки), т. е. является параметром какого-либо метода, например, назначение обработчика какого-либо события.

Параметр команды /CheckConfig: ‑UnreferenceProcedures.

Проверка существования назначенных обработчиков

Проверка существования обработчиков событий интерфейсов, форм, элементов управления, элементов карт маршрута.

Параметр команды /CheckConfig: ‑HandlersExistence.

Поиск пустых обработчиков

Поиск назначенных обработчиков событий, в которых не выполняется никаких действий. Существование таких обработчиков может привести к падению производительности системы.

Параметр команды /CheckConfig: ‑EmptyHandlers.

Расширенная проверка

Для ограниченного набора типов выполняется проверка обращений к методам и свойствам объектов «через точку». Также выполняется проверка корректности указания параметров, заданных строкой, для ограниченного набора методов. Сообщения, которые формируются в результате расширенной проверки модулей, не содержат номеров строк с обнаруженными проблемами.

Параметр команды /CheckConfig: ‑ExtendedModulesCheck.

Поиск использования модальности

Данный флажок становится доступным только в том случае, если включена расширенная проверка конфигурации. В этом режиме конфигуратор выполняет поиск в модулях методов, открывающих модальные диалоговые окна. Свойство конфигурации Режим использования модальности не влияет на работу механизма проверки. При включении данного флажка ошибки будут выдаваться и в том случае, если свойство Режим использование модальности установлено в значение Использовать или Использовать с предупреждением.

Параметр команды /CheckConfig: ‑CheckUseModality, но только совместно с параметром ‑ExtendedModulesCheck.

конфигурации. В этом режиме конфигуратор выполняет поиск в модулях фрагментов кода на встроенном языке, в которых используются синхронные вызовы. Свойство конфигурации Режим использования синхронных вызовов расширений платформы и внешних компонент не влияет на работу механизма проверки. При включении данного флажка ошибки будут выдаваться и в том случае, если свойство Режим использование модальности установлено в значение Использовать или Использовать с предупреждением.

Более подробно особенности поиска синхронных вызовов см. здесь.

Параметр команды /CheckConfig: ‑CheckUseSynchronousCalls, но только совместно с параметром ‑ExtendedModulesCheck..

Проверка мобильного приложения

Поиск неподдерживаемой функциональности

Проверка в этом режиме показывает:

•

Наличие в прикладном решении объектов конфигурации, которые не реализованы для мобильной платформы;

•

Наличие в прикладном решении планов обмена, у которых установлено свойство Распределенная информационная база;

•

Использование объектов конфигурации, которые не поддерживаются мобильной платформой:

•

В свойствах Тип реквизитов объектов конфигурации, констант, параметров сеанса;

•

В свойстве Тип параметра команды объекта Команда;

•

В свойстве Тип реквизитов и колонок реквизита формы.

•

Наличие неуправляемых форм;

•

Наличие в формах элементов, которые не поддерживаются мобильной платформой. Эта проверка не делается для форм, у которых свойство Назначения использования не предполагает использование на мобильной платформе.

•

Проверка, что начальная страница состоит не более чем из одной формы.

Параметр команды /CheckConfig: ‑UnsupportedFunctional.

Проверка мобильного клиента

Проверка подписи

Выполняет проверку цифровой подписи конфигурации для мобильного клиента.

Параметр команды /CheckConfig: ‑MobileClientDigiSign.

Выбранную совокупность настроек можно сохранить для дальнейшего использования. Для этого в поле Настройка проверки нужно указать имя настройки. Для использования прежней настройки достаточно выбрать имя настройки.

Все сообщения об ошибках выдаются в окно сообщений. Для прерывания проверки конфигурации следует использовать комбинацию клавиш Ctrl + Break или Ctrl + Alt + E.

ПРИМЕЧАНИЕ. В начальной стадии проверки прерывание может быть обработано с задержкой.

При проверке конфигурации, подключенной к хранилищу, во избежание ошибок, связанных с информацией о метаданных, рекомендуется захватить корневой объект конфигурации.

Если параметр Редактирование конфигурации для режимов запуска (см. здесь) имеет значение Управляемое приложение и обычное приложение, то в диалоге добавляются следующие параметры:

•

Толстый клиент (обычное приложение, вариант клиент-сервер).

При этом диалог приобретает следующий вид:

Рис. 712. Проверка конфигурации

Далее приводится описание этих тестов.

Толстый клиент (обычное приложение)

Проверка компиляции модулей в режиме проверки среды клиентского приложения, выполняемого в файловом варианте.

Если свойство конфигурации Использовать управляемые формы в обычном приложении имеет значение Ложь, то модули управляемых форм и модули команд не проверяются при выборе этого теста. Модуль формы, указанной в свойстве Основная форма констант, проверяется при выборе этого теста независимо от значения свойства Использовать управляемые формы в обычном

Сервер, НаСервере.

Параметр команды /CheckConfig: ‑ThickClientOrdinaryApplication.

Толстый клиент (обычное приложение, вариант клиент-сервер)

Проверка компиляции модулей в режиме проверки среды клиентского приложения, выполняемого в варианте клиент-сервер.

Если свойство конфигурации Использовать управляемые формы в обычном приложении имеет значение Ложь, то модули управляемых форм и модули команд не проверяются при выборе этого теста. Модуль формы, указанной в свойстве Основная форма констант, проверяется при выборе этого теста независимо от значения свойства Использовать управляемые формы в обычном приложении.

Определены инструкции препроцессора: Клиент, НаКлиенте, ТолстыйКлиентОбычноеПриложение.

Параметр команды /CheckConfig: ‑ThickClientServerOrdinaryApplication.