# 2. Требования к изменениям программного кода и оформлению комментариев к версиям в хранилищах 1С.

**Создатель** Kondratov Vasiliy | Кондратов Василий Анатольевич, отредактировано июл 31, 2020

## 2.1. Комментарии к изменениям в хранилище

### 2.1.1. 
При помещении версий измененных объектов в хранилище конфигурации (далее - коммитов) в соответствующем диалоге конфигуратора необходимо заполнять поле "комментарий" (далее - сообщение коммита, либо сообщение). В него заносится краткое описание характера изменений с точки зрения пользователя. Это действие в дальнейшем облегчит сборку общего описания изменений к релизу.

Формат сообщения коммита регламентирован и основан на стандарте [Conventional Commits](https://www.conventionalcommits.org/)

**Основные положения:**

Сообщения коммитов должны быть следующей структуры:

```
<type>[optional scope]: <description>

[body]

[footer]
```

### 2.1.2. 
Заголовок сообщения коммита (далее - заголовок или description) должен начинаться с типа (type), указывающего на специфику внесенных в кодовую базу изменений, и завершаться описанием (description). Типы используемых коммитов приведены ниже в разделе "Типы коммитов".

### 2.1.3. 
В теле сообщения коммита (далее - тело или body) необходимо писать что было изменено и почему, либо добавлять дополнительную информацию об изменениях в коде. Тело должно быть отделено от заголовка коммита одной пустой строкой.

### 2.1.4. 
Подвал сообщения коммита (далее - подвал или footer) должен быть отделен от body одной пустой строкой. Подвал содержит мета-информацию о коммите. Например, связанные pull-request'ы, обсуждения, изменения, нарушающие обратную совместимость, номера задач (issues). По одной мета-информации на строку.

### 2.1.5. 
Изменения, нарушающие обратную совместимость (breaking changes) должны быть указаны в самом начале тела (body) или в начале одной из строк подвала (footer). Изменения, нарушающие обратную совместимость, должны начинаться с текста, написанного прописными буквами, BREAKING CHANGE, за которым должны следовать двоеточие и пробел.

### 2.1.6. 
Знак ! может быть добавлен перед : в тип/контекст, чтоб обратить внимание на изменения. Строка BREAKING CHANGE: description должна быть добавлена в тело (body) или подвал (footer), если используется ! в префиксе.

### 2.1.7. 
Контекст (далее - scope) может быть объявлен рядом с типом коммита для добавления дополнительной информации о контексте. Он должен содержаться в круглых скобках, например,

```
feat(Производство): Изменен алгоритм схемы закрытия смены.

Общепроизводственные расходы распределяются по настройке справочника "Правила распределения
```

### 2.1.8. 
Scope для каждого проекта должен быть стандартизирован, то есть каждый проект имеет свои scopes, которые могут совпадать, а могут и нет. Scope должны быть документированы для проекта. Если отсутствует документация по scope проекта, значит его не нужно использовать в сообщениях. Например,

## Типы коммитов

### 2.1.9. 
В сообщении коммита разрешено использование следующих типов (type)

| Тип (type) | Описание |
|------------|----------|
| build | Сборка релиза, добавление новых библиотек, зависимостей |
| vbuild | Сборка релиза, добавление новых библиотек, зависимостей, предоставляемых поставщиком прикладного решения - фирмой 1С или другой компанией |
| ci | Работа с контуром CI |
| docs | Добавление, изменение документации |
| feat | Добавление нового функционала |
| fix | Исправление ошибок |
| perf | Изменения направленные на улучшение производительности |
| refactor | Работа с техническим долгом. Рефакторинг. Правки кода без исправления ошибок или добавления новых функций |
| style | Работа с техническим долгом. Правки по кодстайлу (табуляция, отступы, точки, запятые и т.д.) |
| revert | Откат на предыдущие версии |
| test | Добавление, изменение тестов |
| improvement | Улучшение существующей функциональности, ее развитие |
| adapt | Адаптация измененной или доработанной функциональности под новую конфигурацию поставщика. Только для обновляемых конфигураций, основанных на типовых (коробочных) продуктах |

## Зависимости тела коммита от типа

### 2.1.10. 
Структура тела коммита [body] зависит от его типа:

#### feat:

```
Как было:
<Описание состояния системы (функционала) до внесения изменений>

Как стало:
<Описание состояния системы (функционала) после внесения изменений>
```

#### fix:

```
Ошибочное поведение:
<Диагностика ошибочного поведения. Описание воспроизведения ошибки>

Исправление:
<Описание исправлений>
```

#### vbuild, build:

```
Как было:
<Версия библиотеки (конфигурации поставщика до)>

Как стало:
<Версия библиотеки (конфигурации поставщика после). Краткое описание изменений (улучшений)>
```

#### refactor, style:

```
< Описание сути рефакторинга. Что было переработано? Почему? Основание для рефакторинга (например, техдолг)>
```

#### adapt:

```
< Описание причины из за которой потребовалась адаптация функционала. Что было изменено.>
```

Для остальных типов форма тела произвольно и опционально (необязательна).

## Примеры сообщений коммитов

### 1. 
Сообщение коммита описывающее исправление ошибки функциональности библиотеки. В подвале указан номер задачи (issue) в системе трекинга задач.

```
fix(products): Обязательное заполнение поля "Код в программе" объекта формата ED Справочник

Ошибочное поведение:
Обязательное заполнение поля "Код в программе" объекта Справочник.гкс_ЦФО не позволяет корректного взаимодействия с внешними программами. Часто бывает так, что внешние программы ничего не знают о нумерации ЦФО.

Исправление:
Поле "Код в программе" в объекте XDTO нужно сделать необязательным

МЕТАДАННЫЕ: RMQ-115
```

### 2. 
Сообщение коммита описывающее новую функциональность библиотеки. В подвале указан номер задачи (issue) в системе трекинга задач.

```
feat(products): Защита рабочей среды от конфликтов с тестовыми базами

Как было:
Имел место конфликт взаимодействия рабочей среды и тестовой.

Как стало:
Введена константа,в которой сохраняется строка соединения с ИБ, в которой настроен обмен через RMQ. Чтобы в тестовой среде включить обмен - нужно изменить константу, это повышает взвешенность решений.

МЕТАДАННЫЕ: RMQ-117
```

**Нет меток**