# GitLab Flow & Merge Request

**Создал(а)** Pavlenko Aleksey | Павленко Алексей Николаевич, **редактировал(а)** Lgovskiy Roman | Льговский Роман Николаевич июн 06, 2024

## GitLab Flow

Разработчики создают ветки feat_XXX (XXX это номер задачи Jira) или feature_XXX, после реализации задачи производят слияние локально веток feats_XXX и локальной ветки develop. Отправляют результат объединения на удаленный репозиторий в ветку Develop. Отправленные изменения ветки Develop превращаются в Merge Request (MR, Запрос на слияние). Ответственный за проект (Maintainer) обрабатывает MR и принимает одно из двух решений: устранить замечания или принимает доработку в ветку Develop. Далее по согласованию с аналитиком производить сборку конфигурации из ветки Develop в тестовую базу для проверки аналитиком. По результатам тестирования аналитик может предоставить замечания для устранения или принять без изменений конфигурацию из тестовой базы. При отсутствии замечаний Maintainer проекта переносит доработки из ветки develop в ветку ReleaseCandidate. Далее создается поставка, которая разворачивается на специальную базу для тестирования, при отсутствии замечаний ветка сливается с веткой Master, а поставка устанавливается на рабочую базу.

### РЛ Комменты

- Привести список всех веток, в порядке их перетекания. Например feat_342 → develop и так далее..
- Расписать назначение каждой ветки
- Дополнит по тексту (выделено жирным)
- На вопросы как это делают - следует привести порядок шагов + добавить скриншоты, если применимо

Разработчики создают ветки feat_XXX (XXX это номер задачи Jira) ( - где создают? как создают? - расписать) или feature_XXX, после окончанию разработки задачи производят слияние локально веток feats_XXX и локальной ветки develop (- как выполняют слияние?). Отправляют (как отправляют) результат объединения на удаленный репозиторий (почему "удаленный", так же добавить, что разработчику необходимо указать результат изменений, что сделано, как было, как стало) в ветку develop . Отправленные изменения ветки develop превращаются (git превращает? у каждого действия должен быть исполнитель) в Merge Request (MR, Запрос на слияние). Ответственный за проект (Maintainer) или ответственный за code review обрабатывает MR и принимает одно из двух решений:

- вернуть доработку на устранение замечаний?
- принять доработку в ветку develop

Далее по согласованию с аналитиком производит (кто производит) сборку конфигурации (что такое сборка, как пошагово она выполняется) из ветки develop в тестовую базу для проверки аналитиком. По результатам тестирования аналитик может предоставить замечания для устранения или принять без изменений конфигурацию из тестовой базы. При отсутствии замечаний Maintainer проекта переносит доработки из ветки develop в ветку ReleaseCandidate (в гит?). Далее создается поставка (кем создается, поставка, как поставка конфигурации 1С?), которая разворачивается на специальную базу для тестирования, при отсутствии замечаний ветка сливается с веткой Master, а поставка устанавливается на рабочую базу.

## Обработка MR на сайте GitLab

Для обработки MR нужен доступ к GitLab и разрешения на соответствующий репозиторий.

- Запросить у DevOps инженера права на Git
- Открыть в браузере ссылку: GitLab (sodru.com)
- Перейти на страничку целевого проекта

Для этого на левой панели на сайте переходим в раздел Merge Requests. В данном случае поступило 7 запросов на слияние. Справа от названия веток и запросов отображается состояние проверки кода SonarQube.

❌ Проверка не пройдена/устранить замечания
✅ Проверка пройдена успешно

На странице Merge Request содержится следующая информация:

![GitLab Merge Request страница](изображение_1.png)

Название ветки Git репозитория feat или feature – обозначает что, это свойство добавляемое в конфигурацию по средствам кода, разработчик на каждую задачу создает отдельную ветку по правилам именования.

Кнопка Merge – позволяет произвести слияние текущей ветки с веткой develop

Галочка Delete source branch – позволяет при нажатие кнопки Merge по завершении процесса удалить ветку доработки в репозитории.

После принятия MR, требуется выполнить дополнительные действия в Jira.

Для этого, по меткам задач переходим в Jira (меток может быть несколько, поскольку MR может быть выполнен по нескольким задачам одновременно).

Выставляем значение "develop" в реквизит «Исправить в версиях» каждой задачи. Результат:

![Jira задача с полем "Исправить в версиях"](изображение_2.png)

## Алгоритм принятия MR в SonarQube

После поступления изменений в хранилище на сервере сборок Jenkins запускается задача по анализу ошибок в SonarQube. Результат анализа передается в GitLab и отображается в свойствах MR. Пример:

![SonarQube анализ в GitLab MR](изображение_3.png)

Статус проверки Failed - проверка не пройдена, имеются замечания требующие устранения.

Статус проверки Passed - Проверка пройдена, замечания отсутствуют.

По ссылке View in SonarQube можно ознакомится с детальным отчетом, в отчете имеется подробное обоснование найденных ошибок.

В самом низу таблицы можно оставить комментарий для разработчика в котором можно описать какие ошибки требуется исправить для принятия MR в ветку Develop.

## Обновление ветки vendor

Обновление ветки vendor происходит по запросу от аналитиков, при обновлении следует учитывать совместимость релизов. Не следует игнорировать совместимость версий.

С сайта ИТС используется конфигурация 1C:ERP WE (с русским кодом), учетные данные для доступа к сайту ИТС расположены здесь Внешние ресурсы - Wiki / ИТ / ОТПиРПР1С - Confluence Sodrugestvo

### Работа с веткой Develop в EDT

- Обновление ветки Develop из удаленной ветки GitLab
- Выбрать перспективу Git
- Раскрыть ветки удаленные и выбрать ветку Develop

Для обновления ветки потребуется:

- скачать репозиторий vendor
- скачать с сайта ИТС конфигурацию нужной версии (указывает аналитик в задаче перехода),
- распаковать cf файл
- создать пустую локальную базу и привязать к ветке feat_XXX
- загрузить в нее cf файл от вендора, снять с поддержки

Открыть конфигуратор, выбрать меню Конфигурация, Поддержка, Настройка поддержки.

![Конфигуратор 1С - Настройка поддержки](изображение_4.png)

Нажать кнопку снять с поддержки

![Конфигуратор 1С - Снять с поддержки](изображение_5.png)

Обновить конфигурацию базы данных.

- подключить конфигурацию к проекту в EDT.

![EDT - подключение конфигурации к проекту](изображение_6.png)

- Синхронизировать проект с конфигурацией базы
- зафиксировать изменения в проекте EDT в перспективе Git
- отправить локальную ветку Vendor в репозиторий GitLab
- произвести слияние ветки Develop с веткой Vendor
- проверить зависимости и замечания в конфигурации расширения, можно проверить работоспособность в конфигураторе
- устранить расхождения и замечания после слияния и обновить расширение
- создается ветка RC по правилу, например «Release Candidate 2024.5.7», шаблон именования следующий: [RC_ГГГГ.ММ.НомерРелизаВМесяце.НомерИтерации]
- далее делается слияние с веткой RC и заливается в тестовую базу которую в последствии отдают на тестирование аналитикам (Srvr="ms-sdev1cwe01";Ref="PROJECT_ERP_WE_preprod";)

### Ошибки при принятии обновлений при работе в EDT

После обновления имеется вероятность поломки расширения. Один из вариантов удаление заимствованой формы в расширении и удаление папки в репозитории папки с файлами описания заимствованной формы.

Нет меток