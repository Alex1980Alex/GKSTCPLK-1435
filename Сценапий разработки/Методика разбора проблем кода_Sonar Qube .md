# Методика разбора проблем кода/Sonar Qube

**Создал(а)** Lgovskiy Roman | Льговский Роман Николаевич июн 22, 2024

## 1.1. Минимальная схема работы

Программист видит плохой/подозрительный код - исправляет его согласно расширенному описанию правила.

## 1.2. Sonarqube

Sonarqube (далее SQ) - это платформа статического анализа программного кода. Как любая программа SQ может ошибаться, например, неверно диагностировать ошибку, показывать уязвимость там где ее нет. Разработчику следует учитывать это в своей работе.

Результатом анализа SQ прикладных решений на платформе 1С является:

- Анализ дублирования кода
- Анализ запутанности кода
- Анализ динамики проблем
- Непрерывные проверки (проверка качества каждого помещения в хранилище)
- Контроль "технического долга"

### Замечания, формируемые платформой SQ:

- **ошибки** – замечания, которые с высокой вероятностью воздействия на поведение приложения в производстве: например, утечка памяти, незакрытое соединение. Код с этими ошибками **ДОЛЖЕН** быть немедленно исправлен.

- **уязвимости** – замечания, которые
  - с малой вероятностью влияет на поведение приложения в производстве
  - проблема, которая представляет собой недостаток безопасности: например, пустой блок попытка...исключение...конецпопытки, SQL injection и т.д. Код **ДОЛЖЕН** быть немедленно рассмотрен.

- **дефекты кода** - недостатки качества, которые могут сильно повлиять на производительность разработчика: например непокрытый фрагмент кода, дублированные блоки, неиспользуемые параметры.

## 1.3. Обязательная реакция на замечания

Обязательной является реакция на замечания с типом ошибка (bug) и уязвимость (vulnerability). Программист обязан либо исправить замечания с таким типом в программном коде, либо закрыть как неактуальные, если замечание неактуально или если это ложное срабатывание. Работы по исправлению замечаний с типом "дефект кода" программист может планировать индивидуально, предварительно согласовав это отделом обеспечения учета.

## 1.4. Контролирующие правила

Некоторые правила проверки в SQ являются "контролирующими". Это означает, что не всякое срабатывание такого правила является ошибкой. Например, правило "Виртуальные таблицы в запросе без отборов", суть этого правила заключается в контроле использования виртуальных таблиц регистров накопления, бухгалтерии без отборов в "условиях" виртуальных таблиц. Это может быть ошибкой, а может и не быть. Программист должен проконтролировать этот момент в своем программном коде, и если ошибки действительно нет - отметить sonar issue (далее SI) неактуальной (или как ложное срабатывание).

## 1.5. Профиль качества проекта

Каждый проект анализируется согласно его установленному профилю качества - совокупности диагностических правил. Для всех проектов по умолчанию задан профиль - "Sodru way (main)".

## 1.6. Индивидуальные профили качества

Для отдельных проектов может быть задан иной профиль качества, в зависимости от "важности" проекта и критичности замечания в нем. За формирование (наполнение правилами) и назначение отдельного профиля качества проекту отвечает архитектор проекта, при его отсутствии эту роль выполняет начальник отдела обеспечения учета.

## 1.7. Отметка исправлений замечаний SQ

Отметка исправлений замечаний SQ должна отражаться соответствующим сообщением в комментарии к версии в хранилище (либо коммите в репозитории GIT).

1. Тема должна содержать текст - "Контроль технического долга от [ТекущаяДата]". ([ТекущаяДата] - дата помещения в хранилище в формате дд.мм.гггг.)

2. Тип коммита может быть:
   - **refactor** - изменения касаются улучшению работы программного кода, без написания новой функциональности,
   - **style** - изменения касаются исправлению замечаний с типа "Дефекты кода" ("code smell"),
   - **improvement** - изменения касаются исправлению замечаний с типами ошибка (bug) или уязвимость (vulnerability).