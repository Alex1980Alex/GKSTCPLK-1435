# 2. Требования к изменениям программного кода и оформлению комментариев к версиям в хранилищах 1С

**Создатель:** Kondratov Vasiliy | Кондратов Василий Анатольевич, отредактировано июл 31, 2020

## 2.2. Комментирование изменений в коде

### Общие правила

**3.2.1.** Все изменения (**абсолютно все**), вносимые в программный код модулей объектов метаданных модифицируемой типовой конфигурации, должны обрамляться комментарием. Комментарий это пометка особого вида, которая в общем случае отражает информацию следующего вида:

- Идентификатор задачи из трекера проекта, в рамках которого вносятся изменения. (в структуре - issue id)
- Дата внесения изменений. (в структуре - date of change)
- Идентификатор исполнителя, вносящего изменения. Например, фамилия разработчика, название организации или идентификатор, определенный в рамках проекта (в случае работы с внешним подрядом). (в структуре - programmer id)
- Краткое описание сути вносимых изменений. (в структуре - description)

### Общая структура комментария

```
// Гкс+[issue id] <programmer id> <date of change>
// <description>
// < Commented code >
< Code >
// Гкс-[issue id] <programmer id> <date of change>
```

**3.2.2.** При внесении изменений и удалении кода исходный код должен быть закомментирован. Допускается наличие в комментарии дополнительных сведений и маркеров управления структурой модуля. Также комментарий должен содержать краткое и емкое описание сути вносимых изменений, если они не очевидны. Комментарий обязательно должен начинаться и заканчиваться меткой "Гкс". Для упрощения понимания границ комментария к метке в начале комментария необходимо добавлять символ "+", в конце "-".

Для добавляемых методов пометки должны располагаться снаружи метода. Для обработчиков событий - внутри.

**3.2.3.** При большом количестве наложений разных комментариев друг на друга, допускается удалять "лишние" комментарии, потеря которых не повлияет на понимание программного кода другими разработчиками. Единственное, в чем необходимо убедиться - что программный код проекта версионируется и при необходимости "удаленные" комментарий возможно будет найти.

**3.2.4.** Без потери смысла допускается сокращать общую структуру комментария. Это касается управляющих конструкций и концевой части. (Подробнее в примерах)

### Примеры изменений в программном коде:

#### Добавление:

```
// Гкс+[TASK-54] Иванов И.И 20.12.2019 Добавлено:
ДокументОбъект.Записать(РежимЗаписиДокумента.Запись);
// Гкс-[TASK-54] Иванов И.И 20.12.2019 Добавлено:
```

**Эквивалентно (используется сокращение концевой части):**

```
// Гкс+[TASK-54] Иванов И.И 20.12.2019
ДокументОбъект.Записать(РежимЗаписиДокумента.Запись); // Гкс-
```

Однако в случае наложения комментариев разных разработчиков друг на друга необходимо в конце указывать идентификатор задачи для явного понимания границ

```
// Гкс+[TASK-12] Сидоров И.И 13.12.2019
ДокументОбъект = Документы.ОченьВажныеДокументы.ПолучитьОбъект()
// Гкс+[TASK-54] Иванов И.И 20.12.2019
ДокументОбъект.Заполнить(); // Гкс-[TASK-54]
ДокументОбъект.Записать(РежимЗаписиДокумента.Запись); // Гкс-[TASK-12]
```

#### Изменение:

```
// Гкс+[TASK-61] Иванов 29.12.2019 Изменено: {
// ДокументОбъект.Записать(РежимЗаписиДокумента.Запись);
// На: {
ДокументОбъект.Записать(РежимЗаписиДокумента.Проведение); // Гкс-[TASK-61]
```

#### Удаление:

```
// Гкс+[TASK-61] Иванов 29.12.2019 Удалено:
// ДокументОбъект.Записать(РежимЗаписиДокумента.Запись);
// Гкс-
```

**Эквивалентно:**

```
// Гкс+[TASK-61] Иванов 29.12.2019 Удалено:
// ДокументОбъект.Записать(РежимЗаписиДокумента.Запись);
// Гкс+[TASK-61]
```

**Эквивалентно:**

```
// Гкс+[TASK-61] Иванов 29.12.2019 Удалено:
// ДокументОбъект.Записать(РежимЗаписиДокумента.Запись); // Гкс-
```

### Добавление процедур и функций в модулях

**3.2.5.** Для добавляемых процедур и функций модулей объектов конфигураций действуют дополнительные правила оформления комментариев:

- Комментируется каждая добавляемая функция, процедура по отдельности
- Обрамление комментарием начинается на строке, предшествующей заголовку процедуры или функции.
- Обрамление комментарием заканчивается на той строке, где заканчивается процедура или функция, то есть там где написано "КонецПроцедуры" или "КонецФункции"

Такие дополнительные требования направлены на:

- упрощение процедуры последующего обновления, если модицируемая конфигурация находится на поддержке поставщика.
- упрощению процедур сравнения-объединения, используемых для переносов изменений между конфигурациями.
- общее повышение качества программного кода и культуры разработки.

Комментирование изменений внутри существующих процедур осуществляется по общим правилам (см. выше).

## Исключения

**3.2.6.** Проекты могут вестись с несоблюдением указанных выше правил. Например, если разрабатывается собственная (для предприятия) конфигурация внутреннего пользования или конфигурация - библиотека для встраивания в другие конфигурации. Также некоторые проекты могут иметь другую модель разработки, например использовать в качестве SCM - GIT, в таком случае приведенные выше правила лишаются смысла.

В любом случае - **каждый проект-исключение должен согласовываться с начальником отдела обеспечения учета**

---

**Нет меток**

## 1 комментарий

**Kiselev Aleksandr | Киселев Александр Сергеевич**

Немного странные шаблоны. Кажется, что они должны быть однотипными.

Сейчас же почему-то коммент добавления:

```
// Гкс+[TASK-54] Иванов И.И 20.12.2019 Добавлено:
ДокументОбъект.Записать(РежимЗаписиДокумента.Запись);
// Гкс-[TASK-54] Иванов И.И 20.12.2019 Добавлено:
```

, а коммент изменения:

```
// Гкс+[TASK-61] Иванов 29.12.2019 Изменено: {
// ДокументОбъект.Записать(РежимЗаписиДокумента.Запись);
// На: {
ДокументОбъект.Записать(РежимЗаписиДокумента.Проведение); // Гкс-[TASK-61]
```

, или коммент удаления:

```
// Гкс+[TASK-61] Иванов 29.12.2019 Удалено:
// ДокументОбъект.Записать(РежимЗаписиДокумента.Запись);
// Гкс-
```

Т.е. в одном случае в закрывающей конструкции указывается полностью <префикс><задача><ФИО><Дата><Постфикс>, а в другом случае, только <префикс> (для удаления).

Предлагаю сделать шаблоны унифицированными:

```
// Гкс+[TASK-54] Иванов И.И 20.12.2019 Добавлено/Изменено/Удалено:
{код добавления} - для добавления
{исходный код} - для изменения и удаления
{// На} - для изменения
{код изменения} - для изменения
// Гкс-[TASK-54] Иванов И.И 20.12.2019
```